(function(){"use strict";function kr(i){return i instanceof Uint8Array||ArrayBuffer.isView(i)&&i.constructor.name==="Uint8Array"}function jt(i,e=""){if(!Number.isSafeInteger(i)||i<0){const t=e&&`"${e}" `;throw new Error(`${t}expected integer >= 0, got ${i}`)}}function Be(i,e,t=""){const r=kr(i),s=i?.length,f=e!==void 0;if(!r||f&&s!==e){const d=t&&`"${t}" `,g=f?` of length ${e}`:"",y=r?`length=${s}`:`type=${typeof i}`;throw new Error(d+"expected Uint8Array"+g+", got "+y)}return i}function Ki(i){if(typeof i!="function"||typeof i.create!="function")throw new Error("Hash must wrapped by utils.createHasher");jt(i.outputLen),jt(i.blockLen)}function Kn(i,e=!0){if(i.destroyed)throw new Error("Hash instance has been destroyed");if(e&&i.finished)throw new Error("Hash#digest() has already been called")}function ia(i,e){Be(i,void 0,"digestInto() output");const t=e.outputLen;if(i.length<t)throw new Error('"digestInto() output" expected to be of length >='+t)}function It(...i){for(let e=0;e<i.length;e++)i[e].fill(0)}function nn(i){return new DataView(i.buffer,i.byteOffset,i.byteLength)}function gt(i,e){return i<<32-e|i>>>e}function $n(i,e){return i<<e|i>>>32-e>>>0}const $i=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",oa=Array.from({length:256},(i,e)=>e.toString(16).padStart(2,"0"));function He(i){if(Be(i),$i)return i.toHex();let e="";for(let t=0;t<i.length;t++)e+=oa[i[t]];return e}const Ct={_0:48,_9:57,A:65,F:70,a:97,f:102};function Wi(i){if(i>=Ct._0&&i<=Ct._9)return i-Ct._0;if(i>=Ct.A&&i<=Ct.F)return i-(Ct.A-10);if(i>=Ct.a&&i<=Ct.f)return i-(Ct.a-10)}function Ne(i){if(typeof i!="string")throw new Error("hex string expected, got "+typeof i);if($i)return Uint8Array.fromHex(i);const e=i.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(t);for(let s=0,f=0;s<t;s++,f+=2){const d=Wi(i.charCodeAt(f)),g=Wi(i.charCodeAt(f+1));if(d===void 0||g===void 0){const y=i[f]+i[f+1];throw new Error('hex string expected, got non-hex character "'+y+'" at index '+f)}r[s]=d*16+g}return r}function zi(i){if(typeof i!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(i))}function Xe(...i){let e=0;for(let r=0;r<i.length;r++){const s=i[r];Be(s),e+=s.length}const t=new Uint8Array(e);for(let r=0,s=0;r<i.length;r++){const f=i[r];t.set(f,s),s+=f.length}return t}function Er(i,e={}){const t=(s,f)=>i(f).update(s).digest(),r=i(void 0);return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=s=>i(s),Object.assign(t,e),Object.freeze(t)}function Kt(i=32){const e=typeof globalThis=="object"?globalThis.crypto:null;if(typeof e?.getRandomValues!="function")throw new Error("crypto.getRandomValues must be defined");return e.getRandomValues(new Uint8Array(i))}const Vi=i=>({oid:Uint8Array.from([6,9,96,134,72,1,101,3,4,2,i])});function sa(i,e,t){return i&e^~i&t}function aa(i,e,t){return i&e^i&t^e&t}class Cr{blockLen;outputLen;padOffset;isLE;buffer;view;finished=!1;length=0;pos=0;destroyed=!1;constructor(e,t,r,s){this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=s,this.buffer=new Uint8Array(e),this.view=nn(this.buffer)}update(e){Kn(this),Be(e);const{view:t,buffer:r,blockLen:s}=this,f=e.length;for(let d=0;d<f;){const g=Math.min(s-this.pos,f-d);if(g===s){const y=nn(e);for(;s<=f-d;d+=s)this.process(y,d);continue}r.set(e.subarray(d,d+g),this.pos),this.pos+=g,d+=g,this.pos===s&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Kn(this),ia(e,this),this.finished=!0;const{buffer:t,view:r,blockLen:s,isLE:f}=this;let{pos:d}=this;t[d++]=128,It(this.buffer.subarray(d)),this.padOffset>s-d&&(this.process(r,0),d=0);for(let _=d;_<s;_++)t[_]=0;r.setBigUint64(s-8,BigInt(this.length*8),f),this.process(r,0);const g=nn(e),y=this.outputLen;if(y%4)throw new Error("_sha2: outputLen must be aligned to 32bit");const w=y/4,C=this.get();if(w>C.length)throw new Error("_sha2: outputLen bigger than state");for(let _=0;_<w;_++)g.setUint32(4*_,C[_],f)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||=new this.constructor,e.set(...this.get());const{blockLen:t,buffer:r,length:s,finished:f,destroyed:d,pos:g}=this;return e.destroyed=d,e.finished=f,e.length=s,e.pos=g,s%t&&e.buffer.set(r),e}clone(){return this._cloneInto()}}const Mt=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Ve=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),Wn=BigInt(2**32-1),Qi=BigInt(32);function ua(i,e=!1){return e?{h:Number(i&Wn),l:Number(i>>Qi&Wn)}:{h:Number(i>>Qi&Wn)|0,l:Number(i&Wn)|0}}function ca(i,e=!1){const t=i.length;let r=new Uint32Array(t),s=new Uint32Array(t);for(let f=0;f<t;f++){const{h:d,l:g}=ua(i[f],e);[r[f],s[f]]=[d,g]}return[r,s]}const Gi=(i,e,t)=>i>>>t,Zi=(i,e,t)=>i<<32-t|e>>>t,rn=(i,e,t)=>i>>>t|e<<32-t,on=(i,e,t)=>i<<32-t|e>>>t,zn=(i,e,t)=>i<<64-t|e>>>t-32,Vn=(i,e,t)=>i>>>t-32|e<<64-t;function Tt(i,e,t,r){const s=(e>>>0)+(r>>>0);return{h:i+t+(s/2**32|0)|0,l:s|0}}const fa=(i,e,t)=>(i>>>0)+(e>>>0)+(t>>>0),la=(i,e,t,r)=>e+t+r+(i/2**32|0)|0,ha=(i,e,t,r)=>(i>>>0)+(e>>>0)+(t>>>0)+(r>>>0),da=(i,e,t,r,s)=>e+t+r+s+(i/2**32|0)|0,pa=(i,e,t,r,s)=>(i>>>0)+(e>>>0)+(t>>>0)+(r>>>0)+(s>>>0),ga=(i,e,t,r,s,f)=>e+t+r+s+f+(i/2**32|0)|0,ya=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Bt=new Uint32Array(64);class ma extends Cr{constructor(e){super(64,e,8,!1)}get(){const{A:e,B:t,C:r,D:s,E:f,F:d,G:g,H:y}=this;return[e,t,r,s,f,d,g,y]}set(e,t,r,s,f,d,g,y){this.A=e|0,this.B=t|0,this.C=r|0,this.D=s|0,this.E=f|0,this.F=d|0,this.G=g|0,this.H=y|0}process(e,t){for(let _=0;_<16;_++,t+=4)Bt[_]=e.getUint32(t,!1);for(let _=16;_<64;_++){const A=Bt[_-15],I=Bt[_-2],S=gt(A,7)^gt(A,18)^A>>>3,R=gt(I,17)^gt(I,19)^I>>>10;Bt[_]=R+Bt[_-7]+S+Bt[_-16]|0}let{A:r,B:s,C:f,D:d,E:g,F:y,G:w,H:C}=this;for(let _=0;_<64;_++){const A=gt(g,6)^gt(g,11)^gt(g,25),I=C+A+sa(g,y,w)+ya[_]+Bt[_]|0,R=(gt(r,2)^gt(r,13)^gt(r,22))+aa(r,s,f)|0;C=w,w=y,y=g,g=d+I|0,d=f,f=s,s=r,r=I+R|0}r=r+this.A|0,s=s+this.B|0,f=f+this.C|0,d=d+this.D|0,g=g+this.E|0,y=y+this.F|0,w=w+this.G|0,C=C+this.H|0,this.set(r,s,f,d,g,y,w,C)}roundClean(){It(Bt)}destroy(){this.set(0,0,0,0,0,0,0,0),It(this.buffer)}}class wa extends ma{A=Mt[0]|0;B=Mt[1]|0;C=Mt[2]|0;D=Mt[3]|0;E=Mt[4]|0;F=Mt[5]|0;G=Mt[6]|0;H=Mt[7]|0;constructor(){super(32)}}const Xi=ca(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(i=>BigInt(i))),ba=Xi[0],va=Xi[1],Ot=new Uint32Array(80),Pt=new Uint32Array(80);class xa extends Cr{constructor(e){super(128,e,16,!1)}get(){const{Ah:e,Al:t,Bh:r,Bl:s,Ch:f,Cl:d,Dh:g,Dl:y,Eh:w,El:C,Fh:_,Fl:A,Gh:I,Gl:S,Hh:R,Hl:K}=this;return[e,t,r,s,f,d,g,y,w,C,_,A,I,S,R,K]}set(e,t,r,s,f,d,g,y,w,C,_,A,I,S,R,K){this.Ah=e|0,this.Al=t|0,this.Bh=r|0,this.Bl=s|0,this.Ch=f|0,this.Cl=d|0,this.Dh=g|0,this.Dl=y|0,this.Eh=w|0,this.El=C|0,this.Fh=_|0,this.Fl=A|0,this.Gh=I|0,this.Gl=S|0,this.Hh=R|0,this.Hl=K|0}process(e,t){for(let ue=0;ue<16;ue++,t+=4)Ot[ue]=e.getUint32(t),Pt[ue]=e.getUint32(t+=4);for(let ue=16;ue<80;ue++){const ce=Ot[ue-15]|0,ve=Pt[ue-15]|0,Ae=rn(ce,ve,1)^rn(ce,ve,8)^Gi(ce,ve,7),u=on(ce,ve,1)^on(ce,ve,8)^Zi(ce,ve,7),J=Ot[ue-2]|0,B=Pt[ue-2]|0,L=rn(J,B,19)^zn(J,B,61)^Gi(J,B,6),pe=on(J,B,19)^Vn(J,B,61)^Zi(J,B,6),oe=ha(u,pe,Pt[ue-7],Pt[ue-16]),P=da(oe,Ae,L,Ot[ue-7],Ot[ue-16]);Ot[ue]=P|0,Pt[ue]=oe|0}let{Ah:r,Al:s,Bh:f,Bl:d,Ch:g,Cl:y,Dh:w,Dl:C,Eh:_,El:A,Fh:I,Fl:S,Gh:R,Gl:K,Hh:W,Hl:de}=this;for(let ue=0;ue<80;ue++){const ce=rn(_,A,14)^rn(_,A,18)^zn(_,A,41),ve=on(_,A,14)^on(_,A,18)^Vn(_,A,41),Ae=_&I^~_&R,u=A&S^~A&K,J=pa(de,ve,u,va[ue],Pt[ue]),B=ga(J,W,ce,Ae,ba[ue],Ot[ue]),L=J|0,pe=rn(r,s,28)^zn(r,s,34)^zn(r,s,39),oe=on(r,s,28)^Vn(r,s,34)^Vn(r,s,39),P=r&f^r&g^f&g,z=s&d^s&y^d&y;W=R|0,de=K|0,R=I|0,K=S|0,I=_|0,S=A|0,{h:_,l:A}=Tt(w|0,C|0,B|0,L|0),w=g|0,C=y|0,g=f|0,y=d|0,f=r|0,d=s|0;const H=fa(L,oe,z);r=la(H,B,pe,P),s=H|0}({h:r,l:s}=Tt(this.Ah|0,this.Al|0,r|0,s|0)),{h:f,l:d}=Tt(this.Bh|0,this.Bl|0,f|0,d|0),{h:g,l:y}=Tt(this.Ch|0,this.Cl|0,g|0,y|0),{h:w,l:C}=Tt(this.Dh|0,this.Dl|0,w|0,C|0),{h:_,l:A}=Tt(this.Eh|0,this.El|0,_|0,A|0),{h:I,l:S}=Tt(this.Fh|0,this.Fl|0,I|0,S|0),{h:R,l:K}=Tt(this.Gh|0,this.Gl|0,R|0,K|0),{h:W,l:de}=Tt(this.Hh|0,this.Hl|0,W|0,de|0),this.set(r,s,f,d,g,y,w,C,_,A,I,S,R,K,W,de)}roundClean(){It(Ot,Pt)}destroy(){It(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class ka extends xa{Ah=Ve[0]|0;Al=Ve[1]|0;Bh=Ve[2]|0;Bl=Ve[3]|0;Ch=Ve[4]|0;Cl=Ve[5]|0;Dh=Ve[6]|0;Dl=Ve[7]|0;Eh=Ve[8]|0;El=Ve[9]|0;Fh=Ve[10]|0;Fl=Ve[11]|0;Gh=Ve[12]|0;Gl=Ve[13]|0;Hh=Ve[14]|0;Hl=Ve[15]|0;constructor(){super(64)}}const je=Er(()=>new wa,Vi(1)),Yi=Er(()=>new ka,Vi(3));const Tr=BigInt(0),_r=BigInt(1);function Qn(i,e=""){if(typeof i!="boolean"){const t=e&&`"${e}" `;throw new Error(t+"expected boolean, got type="+typeof i)}return i}function Ji(i){if(typeof i=="bigint"){if(!Zn(i))throw new Error("positive bigint expected, got "+i)}else jt(i);return i}function Gn(i){const e=Ji(i).toString(16);return e.length&1?"0"+e:e}function eo(i){if(typeof i!="string")throw new Error("hex string expected, got "+typeof i);return i===""?Tr:BigInt("0x"+i)}function En(i){return eo(He(i))}function to(i){return eo(He(Ea(Be(i)).reverse()))}function Sr(i,e){jt(e),i=Ji(i);const t=Ne(i.toString(16).padStart(e*2,"0"));if(t.length!==e)throw new Error("number too large");return t}function no(i,e){return Sr(i,e).reverse()}function Ea(i){return Uint8Array.from(i)}function Ca(i){return Uint8Array.from(i,(e,t)=>{const r=e.charCodeAt(0);if(e.length!==1||r>127)throw new Error(`string contains non-ASCII character "${i[t]}" with code ${r} at position ${t}`);return r})}const Zn=i=>typeof i=="bigint"&&Tr<=i;function Ta(i,e,t){return Zn(i)&&Zn(e)&&Zn(t)&&e<=i&&i<t}function _a(i,e,t,r){if(!Ta(e,t,r))throw new Error("expected valid "+i+": "+t+" <= n < "+r+", got "+e)}function Sa(i){let e;for(e=0;i>Tr;i>>=_r,e+=1);return e}const Ar=i=>(_r<<BigInt(i))-_r;function Aa(i,e,t){if(jt(i,"hashLen"),jt(e,"qByteLen"),typeof t!="function")throw new Error("hmacFn must be a function");const r=K=>new Uint8Array(K),s=Uint8Array.of(),f=Uint8Array.of(0),d=Uint8Array.of(1),g=1e3;let y=r(i),w=r(i),C=0;const _=()=>{y.fill(1),w.fill(0),C=0},A=(...K)=>t(w,Xe(y,...K)),I=(K=s)=>{w=A(f,K),y=A(),K.length!==0&&(w=A(d,K),y=A())},S=()=>{if(C++>=g)throw new Error("drbg: tried max amount of iterations");let K=0;const W=[];for(;K<e;){y=A();const de=y.slice();W.push(de),K+=y.length}return Xe(...W)};return(K,W)=>{_(),I(K);let de;for(;!(de=W(S()));)I();return _(),de}}function Ir(i,e={},t={}){if(!i||typeof i!="object")throw new Error("expected valid options object");function r(f,d,g){const y=i[f];if(g&&y===void 0)return;const w=typeof y;if(w!==d||y===null)throw new Error(`param "${f}" is invalid: expected ${d}, got ${w}`)}const s=(f,d)=>Object.entries(f).forEach(([g,y])=>r(g,y,d));s(e,!1),s(t,!0)}function ro(i){const e=new WeakMap;return(t,...r)=>{const s=e.get(t);if(s!==void 0)return s;const f=i(t,...r);return e.set(t,f),f}}const Ye=BigInt(0),Ge=BigInt(1),$t=BigInt(2),io=BigInt(3),oo=BigInt(4),so=BigInt(5),Ia=BigInt(7),ao=BigInt(8),Ma=BigInt(9),uo=BigInt(16);function ut(i,e){const t=i%e;return t>=Ye?t:e+t}function rt(i,e,t){let r=i;for(;e-- >Ye;)r*=r,r%=t;return r}function co(i,e){if(i===Ye)throw new Error("invert: expected non-zero number");if(e<=Ye)throw new Error("invert: expected positive modulus, got "+e);let t=ut(i,e),r=e,s=Ye,f=Ge;for(;t!==Ye;){const g=r/t,y=r%t,w=s-f*g;r=t,t=y,s=f,f=w}if(r!==Ge)throw new Error("invert: does not exist");return ut(s,e)}function Mr(i,e,t){if(!i.eql(i.sqr(e),t))throw new Error("Cannot find square root")}function fo(i,e){const t=(i.ORDER+Ge)/oo,r=i.pow(e,t);return Mr(i,r,e),r}function Ba(i,e){const t=(i.ORDER-so)/ao,r=i.mul(e,$t),s=i.pow(r,t),f=i.mul(e,s),d=i.mul(i.mul(f,$t),s),g=i.mul(f,i.sub(d,i.ONE));return Mr(i,g,e),g}function Oa(i){const e=Xn(i),t=lo(i),r=t(e,e.neg(e.ONE)),s=t(e,r),f=t(e,e.neg(r)),d=(i+Ia)/uo;return(g,y)=>{let w=g.pow(y,d),C=g.mul(w,r);const _=g.mul(w,s),A=g.mul(w,f),I=g.eql(g.sqr(C),y),S=g.eql(g.sqr(_),y);w=g.cmov(w,C,I),C=g.cmov(A,_,S);const R=g.eql(g.sqr(C),y),K=g.cmov(w,C,R);return Mr(g,K,y),K}}function lo(i){if(i<io)throw new Error("sqrt is not defined for small field");let e=i-Ge,t=0;for(;e%$t===Ye;)e/=$t,t++;let r=$t;const s=Xn(i);for(;po(s,r)===1;)if(r++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(t===1)return fo;let f=s.pow(r,e);const d=(e+Ge)/$t;return function(y,w){if(y.is0(w))return w;if(po(y,w)!==1)throw new Error("Cannot find square root");let C=t,_=y.mul(y.ONE,f),A=y.pow(w,e),I=y.pow(w,d);for(;!y.eql(A,y.ONE);){if(y.is0(A))return y.ZERO;let S=1,R=y.sqr(A);for(;!y.eql(R,y.ONE);)if(S++,R=y.sqr(R),S===C)throw new Error("Cannot find square root");const K=Ge<<BigInt(C-S-1),W=y.pow(_,K);C=S,_=y.sqr(W),A=y.mul(A,_),I=y.mul(I,W)}return I}}function Pa(i){return i%oo===io?fo:i%ao===so?Ba:i%uo===Ma?Oa(i):lo(i)}const Da=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Na(i){const e={ORDER:"bigint",BYTES:"number",BITS:"number"},t=Da.reduce((r,s)=>(r[s]="function",r),e);return Ir(i,t),i}function qa(i,e,t){if(t<Ye)throw new Error("invalid exponent, negatives unsupported");if(t===Ye)return i.ONE;if(t===Ge)return e;let r=i.ONE,s=e;for(;t>Ye;)t&Ge&&(r=i.mul(r,s)),s=i.sqr(s),t>>=Ge;return r}function ho(i,e,t=!1){const r=new Array(e.length).fill(t?i.ZERO:void 0),s=e.reduce((d,g,y)=>i.is0(g)?d:(r[y]=d,i.mul(d,g)),i.ONE),f=i.inv(s);return e.reduceRight((d,g,y)=>i.is0(g)?d:(r[y]=i.mul(d,r[y]),i.mul(d,g)),f),r}function po(i,e){const t=(i.ORDER-Ge)/$t,r=i.pow(e,t),s=i.eql(r,i.ONE),f=i.eql(r,i.ZERO),d=i.eql(r,i.neg(i.ONE));if(!s&&!f&&!d)throw new Error("invalid Legendre symbol result");return s?1:f?0:-1}function La(i,e){e!==void 0&&jt(e);const t=e!==void 0?e:i.toString(2).length,r=Math.ceil(t/8);return{nBitLength:t,nByteLength:r}}class Ra{ORDER;BITS;BYTES;isLE;ZERO=Ye;ONE=Ge;_lengths;_sqrt;_mod;constructor(e,t={}){if(e<=Ye)throw new Error("invalid field: expected ORDER > 0, got "+e);let r;this.isLE=!1,t!=null&&typeof t=="object"&&(typeof t.BITS=="number"&&(r=t.BITS),typeof t.sqrt=="function"&&(this.sqrt=t.sqrt),typeof t.isLE=="boolean"&&(this.isLE=t.isLE),t.allowedLengths&&(this._lengths=t.allowedLengths?.slice()),typeof t.modFromBytes=="boolean"&&(this._mod=t.modFromBytes));const{nBitLength:s,nByteLength:f}=La(e,r);if(f>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");this.ORDER=e,this.BITS=s,this.BYTES=f,this._sqrt=void 0,Object.preventExtensions(this)}create(e){return ut(e,this.ORDER)}isValid(e){if(typeof e!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof e);return Ye<=e&&e<this.ORDER}is0(e){return e===Ye}isValidNot0(e){return!this.is0(e)&&this.isValid(e)}isOdd(e){return(e&Ge)===Ge}neg(e){return ut(-e,this.ORDER)}eql(e,t){return e===t}sqr(e){return ut(e*e,this.ORDER)}add(e,t){return ut(e+t,this.ORDER)}sub(e,t){return ut(e-t,this.ORDER)}mul(e,t){return ut(e*t,this.ORDER)}pow(e,t){return qa(this,e,t)}div(e,t){return ut(e*co(t,this.ORDER),this.ORDER)}sqrN(e){return e*e}addN(e,t){return e+t}subN(e,t){return e-t}mulN(e,t){return e*t}inv(e){return co(e,this.ORDER)}sqrt(e){return this._sqrt||(this._sqrt=Pa(this.ORDER)),this._sqrt(this,e)}toBytes(e){return this.isLE?no(e,this.BYTES):Sr(e,this.BYTES)}fromBytes(e,t=!1){Be(e);const{_lengths:r,BYTES:s,isLE:f,ORDER:d,_mod:g}=this;if(r){if(!r.includes(e.length)||e.length>s)throw new Error("Field.fromBytes: expected "+r+" bytes, got "+e.length);const w=new Uint8Array(s);w.set(e,f?0:w.length-e.length),e=w}if(e.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+e.length);let y=f?to(e):En(e);if(g&&(y=ut(y,d)),!t&&!this.isValid(y))throw new Error("invalid field element: outside of range 0..ORDER");return y}invertBatch(e){return ho(this,e)}cmov(e,t,r){return r?t:e}}function Xn(i,e={}){return new Ra(i,e)}function go(i){if(typeof i!="bigint")throw new Error("field order must be bigint");const e=i.toString(2).length;return Math.ceil(e/8)}function yo(i){const e=go(i);return e+Math.ceil(e/2)}function mo(i,e,t=!1){Be(i);const r=i.length,s=go(e),f=yo(e);if(r<16||r<f||r>1024)throw new Error("expected "+f+"-1024 bytes of input, got "+r);const d=t?to(i):En(i),g=ut(d,e-Ge)+Ge;return t?no(g,s):Sr(g,s)}const sn=BigInt(0),Wt=BigInt(1);function Yn(i,e){const t=e.negate();return i?t:e}function wo(i,e){const t=ho(i.Fp,e.map(r=>r.Z));return e.map((r,s)=>i.fromAffine(r.toAffine(t[s])))}function bo(i,e){if(!Number.isSafeInteger(i)||i<=0||i>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+i)}function Br(i,e){bo(i,e);const t=Math.ceil(e/i)+1,r=2**(i-1),s=2**i,f=Ar(i),d=BigInt(i);return{windows:t,windowSize:r,mask:f,maxNumber:s,shiftBy:d}}function vo(i,e,t){const{windowSize:r,mask:s,maxNumber:f,shiftBy:d}=t;let g=Number(i&s),y=i>>d;g>r&&(g-=f,y+=Wt);const w=e*r,C=w+Math.abs(g)-1,_=g===0,A=g<0,I=e%2!==0;return{nextN:y,offset:C,isZero:_,isNeg:A,isNegF:I,offsetF:w}}const Or=new WeakMap,xo=new WeakMap;function Pr(i){return xo.get(i)||1}function ko(i){if(i!==sn)throw new Error("invalid wNAF")}class Ha{BASE;ZERO;Fn;bits;constructor(e,t){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=t}_unsafeLadder(e,t,r=this.ZERO){let s=e;for(;t>sn;)t&Wt&&(r=r.add(s)),s=s.double(),t>>=Wt;return r}precomputeWindow(e,t){const{windows:r,windowSize:s}=Br(t,this.bits),f=[];let d=e,g=d;for(let y=0;y<r;y++){g=d,f.push(g);for(let w=1;w<s;w++)g=g.add(d),f.push(g);d=g.double()}return f}wNAF(e,t,r){if(!this.Fn.isValid(r))throw new Error("invalid scalar");let s=this.ZERO,f=this.BASE;const d=Br(e,this.bits);for(let g=0;g<d.windows;g++){const{nextN:y,offset:w,isZero:C,isNeg:_,isNegF:A,offsetF:I}=vo(r,g,d);r=y,C?f=f.add(Yn(A,t[I])):s=s.add(Yn(_,t[w]))}return ko(r),{p:s,f}}wNAFUnsafe(e,t,r,s=this.ZERO){const f=Br(e,this.bits);for(let d=0;d<f.windows&&r!==sn;d++){const{nextN:g,offset:y,isZero:w,isNeg:C}=vo(r,d,f);if(r=g,!w){const _=t[y];s=s.add(C?_.negate():_)}}return ko(r),s}getPrecomputes(e,t,r){let s=Or.get(t);return s||(s=this.precomputeWindow(t,e),e!==1&&(typeof r=="function"&&(s=r(s)),Or.set(t,s))),s}cached(e,t,r){const s=Pr(e);return this.wNAF(s,this.getPrecomputes(s,e,r),t)}unsafe(e,t,r,s){const f=Pr(e);return f===1?this._unsafeLadder(e,t,s):this.wNAFUnsafe(f,this.getPrecomputes(f,e,r),t,s)}createCache(e,t){bo(t,this.bits),xo.set(e,t),Or.delete(e)}hasCache(e){return Pr(e)!==1}}function Ua(i,e,t,r){let s=e,f=i.ZERO,d=i.ZERO;for(;t>sn||r>sn;)t&Wt&&(f=f.add(s)),r&Wt&&(d=d.add(s)),s=s.double(),t>>=Wt,r>>=Wt;return{p1:f,p2:d}}function Eo(i,e,t){if(e){if(e.ORDER!==i)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return Na(e),e}else return Xn(i,{isLE:t})}function Fa(i,e,t={},r){if(r===void 0&&(r=i==="edwards"),!e||typeof e!="object")throw new Error(`expected valid ${i} CURVE object`);for(const y of["p","n","h"]){const w=e[y];if(!(typeof w=="bigint"&&w>sn))throw new Error(`CURVE.${y} must be positive bigint`)}const s=Eo(e.p,t.Fp,r),f=Eo(e.n,t.Fn,r),g=["Gx","Gy","a","b"];for(const y of g)if(!s.isValid(e[y]))throw new Error(`CURVE.${y} must be valid field element of CURVE.Fp`);return e=Object.freeze(Object.assign({},e)),{CURVE:e,Fp:s,Fn:f}}function Co(i,e){return function(r){const s=i(r);return{secretKey:s,publicKey:e(s)}}}class To{oHash;iHash;blockLen;outputLen;finished=!1;destroyed=!1;constructor(e,t){if(Ki(e),Be(t,void 0,"key"),this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const r=this.blockLen,s=new Uint8Array(r);s.set(t.length>r?e.create().update(t).digest():t);for(let f=0;f<s.length;f++)s[f]^=54;this.iHash.update(s),this.oHash=e.create();for(let f=0;f<s.length;f++)s[f]^=106;this.oHash.update(s),It(s)}update(e){return Kn(this),this.iHash.update(e),this}digestInto(e){Kn(this),Be(e,this.outputLen,"output"),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||=Object.create(Object.getPrototypeOf(this),{});const{oHash:t,iHash:r,finished:s,destroyed:f,blockLen:d,outputLen:g}=this;return e=e,e.finished=s,e.destroyed=f,e.blockLen=d,e.outputLen=g,e.oHash=t._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Cn=(i,e,t)=>new To(i,e).update(t).digest();Cn.create=(i,e)=>new To(i,e);const _o=(i,e)=>(i+(i>=0?e:-e)/So)/e;function ja(i,e,t){const[[r,s],[f,d]]=e,g=_o(d*i,t),y=_o(-s*i,t);let w=i-g*r-y*f,C=-g*s-y*d;const _=w<_t,A=C<_t;_&&(w=-w),A&&(C=-C);const I=Ar(Math.ceil(Sa(t)/2))+an;if(w<_t||w>=I||C<_t||C>=I)throw new Error("splitScalar (endomorphism): failed, k="+i);return{k1neg:_,k1:w,k2neg:A,k2:C}}function Dr(i){if(!["compact","recovered","der"].includes(i))throw new Error('Signature format must be "compact", "recovered", or "der"');return i}function Nr(i,e){const t={};for(let r of Object.keys(e))t[r]=i[r]===void 0?e[r]:i[r];return Qn(t.lowS,"lowS"),Qn(t.prehash,"prehash"),t.format!==void 0&&Dr(t.format),t}class Ka extends Error{constructor(e=""){super(e)}}const Dt={Err:Ka,_tlv:{encode:(i,e)=>{const{Err:t}=Dt;if(i<0||i>256)throw new t("tlv.encode: wrong tag");if(e.length&1)throw new t("tlv.encode: unpadded data");const r=e.length/2,s=Gn(r);if(s.length/2&128)throw new t("tlv.encode: long form length too big");const f=r>127?Gn(s.length/2|128):"";return Gn(i)+f+s+e},decode(i,e){const{Err:t}=Dt;let r=0;if(i<0||i>256)throw new t("tlv.encode: wrong tag");if(e.length<2||e[r++]!==i)throw new t("tlv.decode: wrong tlv");const s=e[r++],f=!!(s&128);let d=0;if(!f)d=s;else{const y=s&127;if(!y)throw new t("tlv.decode(long): indefinite length not supported");if(y>4)throw new t("tlv.decode(long): byte length is too big");const w=e.subarray(r,r+y);if(w.length!==y)throw new t("tlv.decode: length bytes not complete");if(w[0]===0)throw new t("tlv.decode(long): zero leftmost byte");for(const C of w)d=d<<8|C;if(r+=y,d<128)throw new t("tlv.decode(long): not minimal encoding")}const g=e.subarray(r,r+d);if(g.length!==d)throw new t("tlv.decode: wrong value length");return{v:g,l:e.subarray(r+d)}}},_int:{encode(i){const{Err:e}=Dt;if(i<_t)throw new e("integer: negative integers are not allowed");let t=Gn(i);if(Number.parseInt(t[0],16)&8&&(t="00"+t),t.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return t},decode(i){const{Err:e}=Dt;if(i[0]&128)throw new e("invalid signature integer: negative");if(i[0]===0&&!(i[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return En(i)}},toSig(i){const{Err:e,_int:t,_tlv:r}=Dt,s=Be(i,void 0,"signature"),{v:f,l:d}=r.decode(48,s);if(d.length)throw new e("invalid signature: left bytes after parsing");const{v:g,l:y}=r.decode(2,f),{v:w,l:C}=r.decode(2,y);if(C.length)throw new e("invalid signature: left bytes after parsing");return{r:t.decode(g),s:t.decode(w)}},hexFromSig(i){const{_tlv:e,_int:t}=Dt,r=e.encode(2,t.encode(i.r)),s=e.encode(2,t.encode(i.s)),f=r+s;return e.encode(48,f)}},_t=BigInt(0),an=BigInt(1),So=BigInt(2),Jn=BigInt(3),$a=BigInt(4);function Wa(i,e={}){const t=Fa("weierstrass",i,e),{Fp:r,Fn:s}=t;let f=t.CURVE;const{h:d,n:g}=f;Ir(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object"});const{endo:y}=e;if(y&&(!r.is0(f.a)||typeof y.beta!="bigint"||!Array.isArray(y.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const w=Io(r,s);function C(){if(!r.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function _(oe,P,z){const{x:H,y:Z}=P.toAffine(),D=r.toBytes(H);if(Qn(z,"isCompressed"),z){C();const F=!r.isOdd(Z);return Xe(Ao(F),D)}else return Xe(Uint8Array.of(4),D,r.toBytes(Z))}function A(oe){Be(oe,void 0,"Point");const{publicKey:P,publicKeyUncompressed:z}=w,H=oe.length,Z=oe[0],D=oe.subarray(1);if(H===P&&(Z===2||Z===3)){const F=r.fromBytes(D);if(!r.isValid(F))throw new Error("bad point: is not on curve, wrong x");const V=R(F);let k;try{k=r.sqrt(V)}catch(G){const ee=G instanceof Error?": "+G.message:"";throw new Error("bad point: is not on curve, sqrt error"+ee)}C();const b=r.isOdd(k);return(Z&1)===1!==b&&(k=r.neg(k)),{x:F,y:k}}else if(H===z&&Z===4){const F=r.BYTES,V=r.fromBytes(D.subarray(0,F)),k=r.fromBytes(D.subarray(F,F*2));if(!K(V,k))throw new Error("bad point: is not on curve");return{x:V,y:k}}else throw new Error(`bad point: got length ${H}, expected compressed=${P} or uncompressed=${z}`)}const I=e.toBytes||_,S=e.fromBytes||A;function R(oe){const P=r.sqr(oe),z=r.mul(P,oe);return r.add(r.add(z,r.mul(oe,f.a)),f.b)}function K(oe,P){const z=r.sqr(P),H=R(oe);return r.eql(z,H)}if(!K(f.Gx,f.Gy))throw new Error("bad curve params: generator point");const W=r.mul(r.pow(f.a,Jn),$a),de=r.mul(r.sqr(f.b),BigInt(27));if(r.is0(r.add(W,de)))throw new Error("bad curve params: a or b");function ue(oe,P,z=!1){if(!r.isValid(P)||z&&r.is0(P))throw new Error(`bad point coordinate ${oe}`);return P}function ce(oe){if(!(oe instanceof B))throw new Error("Weierstrass Point expected")}function ve(oe){if(!y||!y.basises)throw new Error("no endo");return ja(oe,y.basises,s.ORDER)}const Ae=ro((oe,P)=>{const{X:z,Y:H,Z}=oe;if(r.eql(Z,r.ONE))return{x:z,y:H};const D=oe.is0();P==null&&(P=D?r.ONE:r.inv(Z));const F=r.mul(z,P),V=r.mul(H,P),k=r.mul(Z,P);if(D)return{x:r.ZERO,y:r.ZERO};if(!r.eql(k,r.ONE))throw new Error("invZ was invalid");return{x:F,y:V}}),u=ro(oe=>{if(oe.is0()){if(e.allowInfinityPoint&&!r.is0(oe.Y))return;throw new Error("bad point: ZERO")}const{x:P,y:z}=oe.toAffine();if(!r.isValid(P)||!r.isValid(z))throw new Error("bad point: x or y not field elements");if(!K(P,z))throw new Error("bad point: equation left != right");if(!oe.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function J(oe,P,z,H,Z){return z=new B(r.mul(z.X,oe),z.Y,z.Z),P=Yn(H,P),z=Yn(Z,z),P.add(z)}class B{static BASE=new B(f.Gx,f.Gy,r.ONE);static ZERO=new B(r.ZERO,r.ONE,r.ZERO);static Fp=r;static Fn=s;X;Y;Z;constructor(P,z,H){this.X=ue("x",P),this.Y=ue("y",z,!0),this.Z=ue("z",H),Object.freeze(this)}static CURVE(){return f}static fromAffine(P){const{x:z,y:H}=P||{};if(!P||!r.isValid(z)||!r.isValid(H))throw new Error("invalid affine point");if(P instanceof B)throw new Error("projective point not allowed");return r.is0(z)&&r.is0(H)?B.ZERO:new B(z,H,r.ONE)}static fromBytes(P){const z=B.fromAffine(S(Be(P,void 0,"point")));return z.assertValidity(),z}static fromHex(P){return B.fromBytes(Ne(P))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(P=8,z=!0){return pe.createCache(this,P),z||this.multiply(Jn),this}assertValidity(){u(this)}hasEvenY(){const{y:P}=this.toAffine();if(!r.isOdd)throw new Error("Field doesn't support isOdd");return!r.isOdd(P)}equals(P){ce(P);const{X:z,Y:H,Z}=this,{X:D,Y:F,Z:V}=P,k=r.eql(r.mul(z,V),r.mul(D,Z)),b=r.eql(r.mul(H,V),r.mul(F,Z));return k&&b}negate(){return new B(this.X,r.neg(this.Y),this.Z)}double(){const{a:P,b:z}=f,H=r.mul(z,Jn),{X:Z,Y:D,Z:F}=this;let V=r.ZERO,k=r.ZERO,b=r.ZERO,$=r.mul(Z,Z),G=r.mul(D,D),ee=r.mul(F,F),X=r.mul(Z,D);return X=r.add(X,X),b=r.mul(Z,F),b=r.add(b,b),V=r.mul(P,b),k=r.mul(H,ee),k=r.add(V,k),V=r.sub(G,k),k=r.add(G,k),k=r.mul(V,k),V=r.mul(X,V),b=r.mul(H,b),ee=r.mul(P,ee),X=r.sub($,ee),X=r.mul(P,X),X=r.add(X,b),b=r.add($,$),$=r.add(b,$),$=r.add($,ee),$=r.mul($,X),k=r.add(k,$),ee=r.mul(D,F),ee=r.add(ee,ee),$=r.mul(ee,X),V=r.sub(V,$),b=r.mul(ee,G),b=r.add(b,b),b=r.add(b,b),new B(V,k,b)}add(P){ce(P);const{X:z,Y:H,Z}=this,{X:D,Y:F,Z:V}=P;let k=r.ZERO,b=r.ZERO,$=r.ZERO;const G=f.a,ee=r.mul(f.b,Jn);let X=r.mul(z,D),ie=r.mul(H,F),te=r.mul(Z,V),le=r.add(z,H),fe=r.add(D,F);le=r.mul(le,fe),fe=r.add(X,ie),le=r.sub(le,fe),fe=r.add(z,Z);let he=r.add(D,V);return fe=r.mul(fe,he),he=r.add(X,te),fe=r.sub(fe,he),he=r.add(H,Z),k=r.add(F,V),he=r.mul(he,k),k=r.add(ie,te),he=r.sub(he,k),$=r.mul(G,fe),k=r.mul(ee,te),$=r.add(k,$),k=r.sub(ie,$),$=r.add(ie,$),b=r.mul(k,$),ie=r.add(X,X),ie=r.add(ie,X),te=r.mul(G,te),fe=r.mul(ee,fe),ie=r.add(ie,te),te=r.sub(X,te),te=r.mul(G,te),fe=r.add(fe,te),X=r.mul(ie,fe),b=r.add(b,X),X=r.mul(he,fe),k=r.mul(le,k),k=r.sub(k,X),X=r.mul(le,ie),$=r.mul(he,$),$=r.add($,X),new B(k,b,$)}subtract(P){return this.add(P.negate())}is0(){return this.equals(B.ZERO)}multiply(P){const{endo:z}=e;if(!s.isValidNot0(P))throw new Error("invalid scalar: out of range");let H,Z;const D=F=>pe.cached(this,F,V=>wo(B,V));if(z){const{k1neg:F,k1:V,k2neg:k,k2:b}=ve(P),{p:$,f:G}=D(V),{p:ee,f:X}=D(b);Z=G.add(X),H=J(z.beta,$,ee,F,k)}else{const{p:F,f:V}=D(P);H=F,Z=V}return wo(B,[H,Z])[0]}multiplyUnsafe(P){const{endo:z}=e,H=this;if(!s.isValid(P))throw new Error("invalid scalar: out of range");if(P===_t||H.is0())return B.ZERO;if(P===an)return H;if(pe.hasCache(this))return this.multiply(P);if(z){const{k1neg:Z,k1:D,k2neg:F,k2:V}=ve(P),{p1:k,p2:b}=Ua(B,H,D,V);return J(z.beta,k,b,Z,F)}else return pe.unsafe(H,P)}toAffine(P){return Ae(this,P)}isTorsionFree(){const{isTorsionFree:P}=e;return d===an?!0:P?P(B,this):pe.unsafe(this,g).is0()}clearCofactor(){const{clearCofactor:P}=e;return d===an?this:P?P(B,this):this.multiplyUnsafe(d)}isSmallOrder(){return this.multiplyUnsafe(d).is0()}toBytes(P=!0){return Qn(P,"isCompressed"),this.assertValidity(),I(B,this,P)}toHex(P=!0){return He(this.toBytes(P))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}const L=s.BITS,pe=new Ha(B,e.endo?Math.ceil(L/2):L);return B.BASE.precompute(8),B}function Ao(i){return Uint8Array.of(i?2:3)}function Io(i,e){return{secretKey:e.BYTES,publicKey:1+i.BYTES,publicKeyUncompressed:1+2*i.BYTES,publicKeyHasPrefix:!0,signature:2*e.BYTES}}function za(i,e={}){const{Fn:t}=i,r=e.randomBytes||Kt,s=Object.assign(Io(i.Fp,t),{seed:yo(t.ORDER)});function f(I){try{const S=t.fromBytes(I);return t.isValidNot0(S)}catch{return!1}}function d(I,S){const{publicKey:R,publicKeyUncompressed:K}=s;try{const W=I.length;return S===!0&&W!==R||S===!1&&W!==K?!1:!!i.fromBytes(I)}catch{return!1}}function g(I=r(s.seed)){return mo(Be(I,s.seed,"seed"),t.ORDER)}function y(I,S=!0){return i.BASE.multiply(t.fromBytes(I)).toBytes(S)}function w(I){const{secretKey:S,publicKey:R,publicKeyUncompressed:K}=s;if(!kr(I)||"_lengths"in t&&t._lengths||S===R)return;const W=Be(I,void 0,"key").length;return W===R||W===K}function C(I,S,R=!0){if(w(I)===!0)throw new Error("first arg must be private key");if(w(S)===!1)throw new Error("second arg must be public key");const K=t.fromBytes(I);return i.fromBytes(S).multiply(K).toBytes(R)}const _={isValidSecretKey:f,isValidPublicKey:d,randomSecretKey:g},A=Co(g,y);return Object.freeze({getPublicKey:y,getSharedSecret:C,keygen:A,Point:i,utils:_,lengths:s})}function Va(i,e,t={}){Ki(e),Ir(t,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"}),t=Object.assign({},t);const r=t.randomBytes||Kt,s=t.hmac||((z,H)=>Cn(e,z,H)),{Fp:f,Fn:d}=i,{ORDER:g,BITS:y}=d,{keygen:w,getPublicKey:C,getSharedSecret:_,utils:A,lengths:I}=za(i,t),S={prehash:!0,lowS:typeof t.lowS=="boolean"?t.lowS:!0,format:"compact",extraEntropy:!1},R=g*So<f.ORDER;function K(z){const H=g>>an;return z>H}function W(z,H){if(!d.isValidNot0(H))throw new Error(`invalid signature ${z}: out of range 1..Point.Fn.ORDER`);return H}function de(){if(R)throw new Error('"recovered" sig type is not supported for cofactor >2 curves')}function ue(z,H){Dr(H);const Z=I.signature,D=H==="compact"?Z:H==="recovered"?Z+1:void 0;return Be(z,D)}class ce{r;s;recovery;constructor(H,Z,D){if(this.r=W("r",H),this.s=W("s",Z),D!=null){if(de(),![0,1,2,3].includes(D))throw new Error("invalid recovery id");this.recovery=D}Object.freeze(this)}static fromBytes(H,Z=S.format){ue(H,Z);let D;if(Z==="der"){const{r:b,s:$}=Dt.toSig(Be(H));return new ce(b,$)}Z==="recovered"&&(D=H[0],Z="compact",H=H.subarray(1));const F=I.signature/2,V=H.subarray(0,F),k=H.subarray(F,F*2);return new ce(d.fromBytes(V),d.fromBytes(k),D)}static fromHex(H,Z){return this.fromBytes(Ne(H),Z)}assertRecovery(){const{recovery:H}=this;if(H==null)throw new Error("invalid recovery id: must be present");return H}addRecoveryBit(H){return new ce(this.r,this.s,H)}recoverPublicKey(H){const{r:Z,s:D}=this,F=this.assertRecovery(),V=F===2||F===3?Z+g:Z;if(!f.isValid(V))throw new Error("invalid recovery id: sig.r+curve.n != R.x");const k=f.toBytes(V),b=i.fromBytes(Xe(Ao((F&1)===0),k)),$=d.inv(V),G=Ae(Be(H,void 0,"msgHash")),ee=d.create(-G*$),X=d.create(D*$),ie=i.BASE.multiplyUnsafe(ee).add(b.multiplyUnsafe(X));if(ie.is0())throw new Error("invalid recovery: point at infinify");return ie.assertValidity(),ie}hasHighS(){return K(this.s)}toBytes(H=S.format){if(Dr(H),H==="der")return Ne(Dt.hexFromSig(this));const{r:Z,s:D}=this,F=d.toBytes(Z),V=d.toBytes(D);return H==="recovered"?(de(),Xe(Uint8Array.of(this.assertRecovery()),F,V)):Xe(F,V)}toHex(H){return He(this.toBytes(H))}}const ve=t.bits2int||function(H){if(H.length>8192)throw new Error("input is too large");const Z=En(H),D=H.length*8-y;return D>0?Z>>BigInt(D):Z},Ae=t.bits2int_modN||function(H){return d.create(ve(H))},u=Ar(y);function J(z){return _a("num < 2^"+y,z,_t,u),d.toBytes(z)}function B(z,H){return Be(z,void 0,"message"),H?Be(e(z),void 0,"prehashed message"):z}function L(z,H,Z){const{lowS:D,prehash:F,extraEntropy:V}=Nr(Z,S);z=B(z,F);const k=Ae(z),b=d.fromBytes(H);if(!d.isValidNot0(b))throw new Error("invalid private key");const $=[J(b),J(k)];if(V!=null&&V!==!1){const ie=V===!0?r(I.secretKey):V;$.push(Be(ie,void 0,"extraEntropy"))}const G=Xe(...$),ee=k;function X(ie){const te=ve(ie);if(!d.isValidNot0(te))return;const le=d.inv(te),fe=i.BASE.multiply(te).toAffine(),he=d.create(fe.x);if(he===_t)return;const ke=d.create(le*d.create(ee+he*b));if(ke===_t)return;let Ee=(fe.x===he?0:2)|Number(fe.y&an),Oe=ke;return D&&K(ke)&&(Oe=d.neg(ke),Ee^=1),new ce(he,Oe,R?void 0:Ee)}return{seed:G,k2sig:X}}function pe(z,H,Z={}){const{seed:D,k2sig:F}=L(z,H,Z);return Aa(e.outputLen,d.BYTES,s)(D,F).toBytes(Z.format)}function oe(z,H,Z,D={}){const{lowS:F,prehash:V,format:k}=Nr(D,S);if(Z=Be(Z,void 0,"publicKey"),H=B(H,V),!kr(z)){const b=z instanceof ce?", use sig.toBytes()":"";throw new Error("verify expects Uint8Array signature"+b)}ue(z,k);try{const b=ce.fromBytes(z,k),$=i.fromBytes(Z);if(F&&b.hasHighS())return!1;const{r:G,s:ee}=b,X=Ae(H),ie=d.inv(ee),te=d.create(X*ie),le=d.create(G*ie),fe=i.BASE.multiplyUnsafe(te).add($.multiplyUnsafe(le));return fe.is0()?!1:d.create(fe.x)===G}catch{return!1}}function P(z,H,Z={}){const{prehash:D}=Nr(Z,S);return H=B(H,D),ce.fromBytes(z,"recovered").recoverPublicKey(H).toBytes()}return Object.freeze({keygen:w,getPublicKey:C,getSharedSecret:_,utils:A,lengths:I,Point:i,sign:pe,verify:oe,recoverPublicKey:P,Signature:ce,hash:e})}const er={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:BigInt(1),a:BigInt(0),b:BigInt(7),Gx:BigInt("0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),Gy:BigInt("0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")},Qa={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),basises:[[BigInt("0x3086d221a7d46bcde86c90e49284eb15"),-BigInt("0xe4437ed6010e88286f547fa90abfe4c3")],[BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),BigInt("0x3086d221a7d46bcde86c90e49284eb15")]]},Ga=BigInt(0),qr=BigInt(2);function Za(i){const e=er.p,t=BigInt(3),r=BigInt(6),s=BigInt(11),f=BigInt(22),d=BigInt(23),g=BigInt(44),y=BigInt(88),w=i*i*i%e,C=w*w*i%e,_=rt(C,t,e)*C%e,A=rt(_,t,e)*C%e,I=rt(A,qr,e)*w%e,S=rt(I,s,e)*I%e,R=rt(S,f,e)*S%e,K=rt(R,g,e)*R%e,W=rt(K,y,e)*K%e,de=rt(W,g,e)*R%e,ue=rt(de,t,e)*C%e,ce=rt(ue,d,e)*S%e,ve=rt(ce,r,e)*w%e,Ae=rt(ve,qr,e);if(!tr.eql(tr.sqr(Ae),i))throw new Error("Cannot find square root");return Ae}const tr=Xn(er.p,{sqrt:Za}),zt=Wa(er,{Fp:tr,endo:Qa}),Pe=Va(zt,je),Mo={};function nr(i,...e){let t=Mo[i];if(t===void 0){const r=je(Ca(i));t=Xe(r,r),Mo[i]=t}return je(Xe(t,...e))}const Lr=i=>i.toBytes(!0).slice(1),Rr=i=>i%qr===Ga;function Hr(i){const{Fn:e,BASE:t}=zt,r=e.fromBytes(i),s=t.multiply(r);return{scalar:Rr(s.y)?r:e.neg(r),bytes:Lr(s)}}function Bo(i){const e=tr;if(!e.isValidNot0(i))throw new Error("invalid x: Fail if x â‰¥ p");const t=e.create(i*i),r=e.create(t*i+BigInt(7));let s=e.sqrt(r);Rr(s)||(s=e.neg(s));const f=zt.fromAffine({x:i,y:s});return f.assertValidity(),f}const Tn=En;function Oo(...i){return zt.Fn.create(Tn(nr("BIP0340/challenge",...i)))}function Po(i){return Hr(i).bytes}function Xa(i,e,t=Kt(32)){const{Fn:r}=zt,s=Be(i,void 0,"message"),{bytes:f,scalar:d}=Hr(e),g=Be(t,32,"auxRand"),y=r.toBytes(d^Tn(nr("BIP0340/aux",g))),w=nr("BIP0340/nonce",y,f,s),{bytes:C,scalar:_}=Hr(w),A=Oo(C,f,s),I=new Uint8Array(64);if(I.set(C,0),I.set(r.toBytes(r.create(_+A*d)),32),!Do(I,s,f))throw new Error("sign: Invalid signature produced");return I}function Do(i,e,t){const{Fp:r,Fn:s,BASE:f}=zt,d=Be(i,64,"signature"),g=Be(e,void 0,"message"),y=Be(t,32,"publicKey");try{const w=Bo(Tn(y)),C=Tn(d.subarray(0,32));if(!r.isValidNot0(C))return!1;const _=Tn(d.subarray(32,64));if(!s.isValidNot0(_))return!1;const A=Oo(s.toBytes(C),Lr(w),g),I=f.multiplyUnsafe(_).add(w.multiplyUnsafe(s.neg(A))),{x:S,y:R}=I.toAffine();return!(I.is0()||!Rr(R)||S!==C)}catch{return!1}}const rr=(()=>{const t=(r=Kt(48))=>mo(r,er.n);return{keygen:Co(t,Po),getPublicKey:Po,sign:Xa,verify:Do,Point:zt,utils:{randomSecretKey:t,taggedHash:nr,lift_x:Bo,pointToBytes:Lr},lengths:{secretKey:32,publicKey:32,publicKeyHasPrefix:!1,signature:64,seed:48}}})(),Ya=Uint8Array.from([7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8]),No=Uint8Array.from(new Array(16).fill(0).map((i,e)=>e)),Ja=No.map(i=>(9*i+5)%16),qo=(()=>{const t=[[No],[Ja]];for(let r=0;r<4;r++)for(let s of t)s.push(s[r].map(f=>Ya[f]));return t})(),Lo=qo[0],Ro=qo[1],Ho=[[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8],[12,13,11,15,6,9,9,7,12,15,11,13,7,8,7,7],[13,15,14,11,7,7,6,8,13,14,13,12,5,5,6,9],[14,11,12,14,8,6,5,5,15,12,15,14,9,9,8,6],[15,12,13,13,9,5,8,6,14,11,12,11,8,6,5,5]].map(i=>Uint8Array.from(i)),eu=Lo.map((i,e)=>i.map(t=>Ho[e][t])),tu=Ro.map((i,e)=>i.map(t=>Ho[e][t])),nu=Uint32Array.from([0,1518500249,1859775393,2400959708,2840853838]),ru=Uint32Array.from([1352829926,1548603684,1836072691,2053994217,0]);function Uo(i,e,t,r){return i===0?e^t^r:i===1?e&t|~e&r:i===2?(e|~t)^r:i===3?e&r|t&~r:e^(t|~r)}const ir=new Uint32Array(16);class iu extends Cr{h0=1732584193;h1=-271733879;h2=-1732584194;h3=271733878;h4=-1009589776;constructor(){super(64,20,8,!0)}get(){const{h0:e,h1:t,h2:r,h3:s,h4:f}=this;return[e,t,r,s,f]}set(e,t,r,s,f){this.h0=e|0,this.h1=t|0,this.h2=r|0,this.h3=s|0,this.h4=f|0}process(e,t){for(let I=0;I<16;I++,t+=4)ir[I]=e.getUint32(t,!0);let r=this.h0|0,s=r,f=this.h1|0,d=f,g=this.h2|0,y=g,w=this.h3|0,C=w,_=this.h4|0,A=_;for(let I=0;I<5;I++){const S=4-I,R=nu[I],K=ru[I],W=Lo[I],de=Ro[I],ue=eu[I],ce=tu[I];for(let ve=0;ve<16;ve++){const Ae=$n(r+Uo(I,f,g,w)+ir[W[ve]]+R,ue[ve])+_|0;r=_,_=w,w=$n(g,10)|0,g=f,f=Ae}for(let ve=0;ve<16;ve++){const Ae=$n(s+Uo(S,d,y,C)+ir[de[ve]]+K,ce[ve])+A|0;s=A,A=C,C=$n(y,10)|0,y=d,d=Ae}}this.set(this.h1+g+C|0,this.h2+w+A|0,this.h3+_+s|0,this.h4+r+d|0,this.h0+f+y|0)}roundClean(){It(ir)}destroy(){this.destroyed=!0,It(this.buffer),this.set(0,0,0,0,0)}}const ou=Er(()=>new iu);function Ur(i){return i instanceof Uint8Array||ArrayBuffer.isView(i)&&i.constructor.name==="Uint8Array"}function Fo(i,e){return Array.isArray(e)?e.length===0?!0:i?e.every(t=>typeof t=="string"):e.every(t=>Number.isSafeInteger(t)):!1}function su(i){if(typeof i!="function")throw new Error("function expected");return!0}function Fr(i,e){if(typeof e!="string")throw new Error(`${i}: string expected`);return!0}function jr(i){if(!Number.isSafeInteger(i))throw new Error(`invalid integer: ${i}`)}function Kr(i){if(!Array.isArray(i))throw new Error("array expected")}function jo(i,e){if(!Fo(!0,e))throw new Error(`${i}: array of strings expected`)}function au(i,e){if(!Fo(!1,e))throw new Error(`${i}: array of numbers expected`)}function Ko(...i){const e=f=>f,t=(f,d)=>g=>f(d(g)),r=i.map(f=>f.encode).reduceRight(t,e),s=i.map(f=>f.decode).reduce(t,e);return{encode:r,decode:s}}function uu(i){const e=typeof i=="string"?i.split(""):i,t=e.length;jo("alphabet",e);const r=new Map(e.map((s,f)=>[s,f]));return{encode:s=>(Kr(s),s.map(f=>{if(!Number.isSafeInteger(f)||f<0||f>=t)throw new Error(`alphabet.encode: digit index outside alphabet "${f}". Allowed: ${i}`);return e[f]})),decode:s=>(Kr(s),s.map(f=>{Fr("alphabet.decode",f);const d=r.get(f);if(d===void 0)throw new Error(`Unknown letter: "${f}". Allowed: ${i}`);return d}))}}function cu(i=""){return Fr("join",i),{encode:e=>(jo("join.decode",e),e.join(i)),decode:e=>(Fr("join.decode",e),e.split(i))}}function $o(i,e,t){if(e<2)throw new Error(`convertRadix: invalid from=${e}, base cannot be less than 2`);if(t<2)throw new Error(`convertRadix: invalid to=${t}, base cannot be less than 2`);if(Kr(i),!i.length)return[];let r=0;const s=[],f=Array.from(i,g=>{if(jr(g),g<0||g>=e)throw new Error(`invalid integer: ${g}`);return g}),d=f.length;for(;;){let g=0,y=!0;for(let w=r;w<d;w++){const C=f[w],_=e*g,A=_+C;if(!Number.isSafeInteger(A)||_/e!==g||A-C!==_)throw new Error("convertRadix: carry overflow");const I=A/t;g=A%t;const S=Math.floor(I);if(f[w]=S,!Number.isSafeInteger(S)||S*t+g!==A)throw new Error("convertRadix: carry overflow");if(y)S?y=!1:r=w;else continue}if(s.push(g),y)break}for(let g=0;g<i.length-1&&i[g]===0;g++)s.push(0);return s.reverse()}function fu(i){jr(i);const e=2**8;return{encode:t=>{if(!Ur(t))throw new Error("radix.encode input should be Uint8Array");return $o(Array.from(t),e,i)},decode:t=>(au("radix.decode",t),Uint8Array.from($o(t,i,e)))}}function lu(i,e){return jr(i),su(e),{encode(t){if(!Ur(t))throw new Error("checksum.encode: input should be Uint8Array");const r=e(t).slice(0,i),s=new Uint8Array(t.length+i);return s.set(t),s.set(r,t.length),s},decode(t){if(!Ur(t))throw new Error("checksum.decode: input should be Uint8Array");const r=t.slice(0,-i),s=t.slice(-i),f=e(r).slice(0,i);for(let d=0;d<i;d++)if(f[d]!==s[d])throw new Error("Invalid checksum");return r}}}const hu=(i=>Ko(fu(58),uu(i),cu("")))("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),du=i=>Ko(lu(4,e=>i(i(e))),hu);const _n=Pe.Point,{Fn:Sn}=_n,$r=du(je),pu=Uint8Array.from("Bitcoin seed".split(""),i=>i.charCodeAt(0)),Wr={private:76066276,public:76067358},zr=2147483648,gu=i=>ou(je(i)),yu=i=>nn(i).getUint32(0,!1),or=i=>{if(!Number.isSafeInteger(i)||i<0||i>2**32-1)throw new Error("invalid number, should be from 0 to 2**32-1, got "+i);const e=new Uint8Array(4);return nn(e).setUint32(0,i,!1),e};class Vt{get fingerprint(){if(!this.pubHash)throw new Error("No publicKey set!");return yu(this.pubHash)}get identifier(){return this.pubHash}get pubKeyHash(){return this.pubHash}get privateKey(){return this._privateKey||null}get publicKey(){return this._publicKey||null}get privateExtendedKey(){const e=this._privateKey;if(!e)throw new Error("No private key");return $r.encode(this.serialize(this.versions.private,Xe(Uint8Array.of(0),e)))}get publicExtendedKey(){if(!this._publicKey)throw new Error("No public key");return $r.encode(this.serialize(this.versions.public,this._publicKey))}static fromMasterSeed(e,t=Wr){if(Be(e),8*e.length<128||8*e.length>512)throw new Error("HDKey: seed length must be between 128 and 512 bits; 256 bits is advised, got "+e.length);const r=Cn(Yi,pu,e),s=r.slice(0,32),f=r.slice(32);return new Vt({versions:t,chainCode:f,privateKey:s})}static fromExtendedKey(e,t=Wr){const r=$r.decode(e),s=nn(r),f=s.getUint32(0,!1),d={versions:t,depth:r[4],parentFingerprint:s.getUint32(5,!1),index:s.getUint32(9,!1),chainCode:r.slice(13,45)},g=r.slice(45),y=g[0]===0;if(f!==t[y?"private":"public"])throw new Error("Version mismatch");return y?new Vt({...d,privateKey:g.slice(1)}):new Vt({...d,publicKey:g})}static fromJSON(e){return Vt.fromExtendedKey(e.xpriv)}versions;depth=0;index=0;chainCode=null;parentFingerprint=0;_privateKey;_publicKey;pubHash;constructor(e){if(!e||typeof e!="object")throw new Error("HDKey.constructor must not be called directly");if(this.versions=e.versions||Wr,this.depth=e.depth||0,this.chainCode=e.chainCode||null,this.index=e.index||0,this.parentFingerprint=e.parentFingerprint||0,!this.depth&&(this.parentFingerprint||this.index))throw new Error("HDKey: zero depth with non-zero index/parent fingerprint");if(this.depth>255)throw new Error("HDKey: depth exceeds the serializable value 255");if(e.publicKey&&e.privateKey)throw new Error("HDKey: publicKey and privateKey at same time.");if(e.privateKey){if(!Pe.utils.isValidSecretKey(e.privateKey))throw new Error("Invalid private key");this._privateKey=e.privateKey,this._publicKey=Pe.getPublicKey(e.privateKey,!0)}else if(e.publicKey)this._publicKey=_n.fromBytes(e.publicKey).toBytes(!0);else throw new Error("HDKey: no public or private key provided");this.pubHash=gu(this._publicKey)}derive(e){if(!/^[mM]'?/.test(e))throw new Error('Path must start with "m" or "M"');if(/^[mM]'?$/.test(e))return this;const t=e.replace(/^[mM]'?\//,"").split("/");let r=this;for(const s of t){const f=/^(\d+)('?)$/.exec(s),d=f&&f[1];if(!f||f.length!==3||typeof d!="string")throw new Error("invalid child index: "+s);let g=+d;if(!Number.isSafeInteger(g)||g>=zr)throw new Error("Invalid index");f[2]==="'"&&(g+=zr),r=r.deriveChild(g)}return r}deriveChild(e){if(!this._publicKey||!this.chainCode)throw new Error("No publicKey or chainCode set");let t=or(e);if(e>=zr){const y=this._privateKey;if(!y)throw new Error("Could not derive hardened child key");t=Xe(Uint8Array.of(0),y,t)}else t=Xe(this._publicKey,t);const r=Cn(Yi,this.chainCode,t),s=r.slice(0,32),f=r.slice(32);if(!Pe.utils.isValidSecretKey(s))throw new Error("Tweak bigger than curve order");const d={versions:this.versions,chainCode:f,depth:this.depth+1,parentFingerprint:this.fingerprint,index:e},g=Sn.fromBytes(s);try{if(this._privateKey){const y=Sn.create(Sn.fromBytes(this._privateKey)+g);if(!Sn.isValidNot0(y))throw new Error("The tweak was out of range or the resulted private key is invalid");d.privateKey=Sn.toBytes(y)}else{const y=_n.fromBytes(this._publicKey).add(_n.BASE.multiply(g));if(y.equals(_n.ZERO))throw new Error("The tweak was equal to negative P, which made the result key invalid");d.publicKey=y.toBytes(!0)}return new Vt(d)}catch{return this.deriveChild(e+1)}}sign(e){if(!this._privateKey)throw new Error("No privateKey set!");return Be(e,32),Pe.sign(e,this._privateKey,{prehash:!1})}verify(e,t){if(Be(e,32),Be(t,64),!this._publicKey)throw new Error("No publicKey set!");return Pe.verify(t,e,this._publicKey,{prehash:!1})}wipePrivateData(){return this._privateKey&&(this._privateKey.fill(0),this._privateKey=void 0),this}toJSON(){return{xpriv:this.privateExtendedKey,xpub:this.publicExtendedKey}}serialize(e,t){if(!this.chainCode)throw new Error("No chainCode set");return Be(t,33),Xe(or(e),new Uint8Array([this.depth]),or(this.parentFingerprint),or(this.index),this.chainCode,t)}}class An extends Error{constructor(e,t){super(e),this.status=t,this.name="HttpResponseError",Object.setPrototypeOf(this,An.prototype)}}class Vr extends Error{constructor(e){super(e),this.name="NetworkError",Object.setPrototypeOf(this,Vr.prototype)}}class Qr extends An{constructor(e,t){super(t||"Unknown mint operation error",400),this.code=e,this.name="MintOperationError",Object.setPrototypeOf(this,Qr.prototype)}}const ct={error(){},warn(){},info(){},debug(){},trace(){},log(){}};function sr(i,e=ct,t){throw e.error(i,t),new Error(i)}function Gr(i,e,t=ct,r){i&&sr(e,t,r)}function Wo(i,e,t=ct,r){i==null&&sr(e,t,r)}function In(i,e,t=ct,r){if(i)try{const s=i(e);s&&typeof s.then=="function"&&s.catch(f=>{try{t.warn("callback failed",{...r??{},error:f,cb:i.name??""})}catch{}})}catch(s){try{t.warn("callback failed",{...r??{},error:s,cb:i.name??""})}catch{}}}function mu(){const i=Date.now();return{elapsed:()=>Date.now()-i}}let wu={},zo=ct;function bu(i){zo=i}async function vu({endpoint:i,requestBody:e,headers:t,...r}){const s=e?JSON.stringify(e):void 0,f={Accept:"application/json, text/plain, */*",...s?{"Content-Type":"application/json"}:void 0,...t};let d;try{d=await fetch(i,{body:s,headers:f,...r})}catch(g){throw new Vr(g instanceof Error?g.message:"Network request failed")}if(!d.ok){let g;try{g=await d.json()}catch{g={error:"bad response"}}if(d.status===400&&"code"in g&&typeof g.code=="number"&&"detail"in g&&typeof g.detail=="string")throw new Qr(g.code,g.detail);let y="HTTP request failed";throw"error"in g&&typeof g.error=="string"?y=g.error:"detail"in g&&typeof g.detail=="string"&&(y=g.detail),new An(y,d.status)}try{return await d.json()}catch(g){throw zo.error("Failed to parse HTTP response",{err:g}),new An("bad response",d.status)}}async function xu(i){return await vu({...i,...wu})}let Zr;typeof WebSocket<"u"&&(Zr=WebSocket);function ku(){if(Zr===void 0)throw new Error("WebSocket implementation not initialized");return Zr}class qe{static fromHex(e){if(e=e.trim(),e.length===0)return new Uint8Array(0);if(e.length<2||e.length&1)throw new Error("Invalid hex string: odd length.");if((e.startsWith("0x")||e.startsWith("0X"))&&(e=e.slice(2)),!e.match(/^[0-9a-fA-F]*$/))throw new Error("Invalid hex string: contains non-hex characters");const t=e.match(/.{1,2}/g);if(!t)throw new Error("Invalid hex string");return new Uint8Array(t.map(r=>parseInt(r,16)))}static toHex(e){return Array.from(e,t=>t.toString(16).padStart(2,"0")).join("")}static fromString(e){return e=e.trim(),new TextEncoder().encode(e)}static toString(e){return new TextDecoder("utf-8").decode(e)}static concat(...e){const t=e.reduce((f,d)=>f+d.length,0),r=new Uint8Array(t);let s=0;for(const f of e)r.set(f,s),s+=f.length;return r}static alloc(e){return new Uint8Array(e)}static writeBigUint64BE(e){const t=new ArrayBuffer(8);return new DataView(t).setBigUint64(0,e,!1),new Uint8Array(t)}static toBase64(e){if(typeof Buffer<"u")return Buffer.from(e).toString("base64");if(e.length>32768){let t="";for(let r=0;r<e.length;r+=32768){const s=e.slice(r,r+32768);t+=btoa(String.fromCharCode(...s))}return t}return btoa(String.fromCharCode(...e))}static fromBase64(e){e=e.trim();let t=e.replace(/-/g,"+").replace(/_/g,"/");for(;t.length%4;)t+="=";return typeof Buffer<"u"?new Uint8Array(Buffer.from(t,"base64")):new Uint8Array([...atob(t)].map(r=>r.charCodeAt(0)))}static equals(e,t){if(e.length!==t.length)return!1;let r=0;for(let s=0;s<e.length;s++)r|=e[s]^t[s];return r===0}static compare(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){if(e[s]<t[s])return-1;if(e[s]>t[s])return 1}return e.length-t.length}}function Xr(i){return qe.toBase64(i).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function Vo(i){return qe.fromBase64(i)}function Eu(i){const e=qe.toString(qe.fromBase64(Cu(i)));return JSON.parse(e)}function Cu(i){return i.replace(/-/g,"+").replace(/_/g,"/").split("=")[0]}function Yr(i){if(typeof i!="string"||i.length===0)return!1;const e=/^[A-Za-z0-9\-_]+={0,2}$/,t=/^[A-Za-z0-9+/]+={0,2}$/;if(!e.test(i)&&!t.test(i))return!1;const r=i.replace(/-/g,"+").replace(/_/g,"/"),s=(4-r.length%4)%4;if(s>2)return!1;const f=r+"=".repeat(s);try{const d=qe.fromBase64(f),g=qe.toBase64(d),y=g.replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,""),w=r.replace(/=+$/,"");return g.replace(/=+$/,"")===w||y===w}catch{return!1}}function Tu(i){return typeof i=="number"||typeof i=="string"}function _u(i){const e=[];return Jr(i,e),new Uint8Array(e)}function Jr(i,e){if(i===null)e.push(246);else if(i===void 0)e.push(247);else if(typeof i=="boolean")e.push(i?245:244);else if(typeof i=="number")Mu(i,e);else if(typeof i=="string")Qo(i,e);else if(Array.isArray(i))Ou(i,e);else if(i instanceof Uint8Array)Bu(i,e);else if(typeof i=="object"&&i!==null&&!Array.isArray(i))Pu(i,e);else throw new Error("Unsupported type")}function Su(i,e){if(i<24)e.push(i);else if(i<256)e.push(24,i);else if(i<65536)e.push(25,i>>>8&255,i&255);else if(i<4294967296)e.push(26,i>>>24&255,i>>>16&255,i>>>8&255,i&255);else throw new Error("Unsupported integer size")}function Au(i,e){const t=-1-i;if(t<24)e.push(32|t);else if(t<256)e.push(56,t&255);else if(t<65536)e.push(57,t>>>8&255,t&255);else if(t<4294967296)e.push(58,t>>>24&255,t>>>16&255,t>>>8&255,t&255);else throw new Error("Unsupported integer size")}function Iu(i,e){const t=new ArrayBuffer(8),r=new DataView(t);r.setFloat64(0,i,!1),e.push(251);for(let s=0;s<8;s++)e.push(r.getUint8(s))}function Mu(i,e){Number.isInteger(i)?i>=0?Su(i,e):Au(i,e):Iu(i,e)}function Bu(i,e){const t=i.length;if(t<24)e.push(64+t);else if(t<256)e.push(88,t);else if(t<65536)e.push(89,t>>8&255,t&255);else if(t<4294967296)e.push(90,t>>>24&255,t>>>16&255,t>>>8&255,t&255);else throw new Error("Byte string too long to encode");for(let r=0;r<i.length;r++)e.push(i[r])}function Qo(i,e){const t=new TextEncoder().encode(i),r=t.length;if(r<24)e.push(96+r);else if(r<256)e.push(120,r);else if(r<65536)e.push(121,r>>>8&255,r&255);else if(r<4294967296)e.push(122,r>>>24&255,r>>>16&255,r>>>8&255,r&255);else throw new Error("String too long to encode");for(let s=0;s<t.length;s++)e.push(t[s])}function Ou(i,e){const t=i.length;if(t<24)e.push(128|t);else if(t<256)e.push(152,t);else if(t<65536)e.push(153,t>>>8&255,t&255);else throw new Error("Unsupported array length");for(const r of i)Jr(r,e)}function Pu(i,e){const t=Object.keys(i),r=t.length;if(r>=4294967296)throw new Error("Object has too many keys to encode");r<24?e.push(160|r):r<256?e.push(184,r):r<65536?e.push(185,r>>8&255,r&255):e.push(186,r>>24&255,r>>16&255,r>>8&255,r&255);for(const s of t)Qo(s,e),Jr(i[s],e)}function Du(i){const e=new DataView(i.buffer,i.byteOffset,i.byteLength);return ar(e,0).value}function ar(i,e){if(e>=i.byteLength)throw new Error("Unexpected end of data");const t=i.getUint8(e++),r=t>>5,s=t&31;switch(r){case 0:return Nu(i,e,s);case 1:return qu(i,e,s);case 2:return Lu(i,e,s);case 3:return Ru(i,e,s);case 4:return Hu(i,e,s);case 5:return Uu(i,e,s);case 7:return ju(i,e,s);default:throw new Error(`Unsupported major type: ${r}`)}}function Nt(i,e,t){if(e+t>i.byteLength)throw new Error("Unexpected end of data")}function un(i,e,t){if(t<24)return{value:t,offset:e};if(t===24)return Nt(i,e,1),{value:i.getUint8(e++),offset:e};if(t===25){Nt(i,e,2);const r=i.getUint16(e,!1);return e+=2,{value:r,offset:e}}if(t===26){Nt(i,e,4);const r=i.getUint32(e,!1);return e+=4,{value:r,offset:e}}if(t===27){Nt(i,e,8);const r=i.getUint32(e,!1),s=i.getUint32(e+4,!1);return e+=8,{value:r*2**32+s,offset:e}}throw new Error(`Unsupported length: ${t}`)}function Nu(i,e,t){const{value:r,offset:s}=un(i,e,t);return{value:r,offset:s}}function qu(i,e,t){const{value:r,offset:s}=un(i,e,t);return{value:-1-r,offset:s}}function Lu(i,e,t){const{value:r,offset:s}=un(i,e,t);if(s+r>i.byteLength)throw new Error("Byte string length exceeds data length");return{value:new Uint8Array(i.buffer,i.byteOffset+s,r),offset:s+r}}function Ru(i,e,t){const{value:r,offset:s}=un(i,e,t);if(s+r>i.byteLength)throw new Error("String length exceeds data length");const f=new Uint8Array(i.buffer,i.byteOffset+s,r);return{value:new TextDecoder().decode(f),offset:s+r}}function Hu(i,e,t){const{value:r,offset:s}=un(i,e,t),f=[];let d=s;for(let g=0;g<r;g++){const y=ar(i,d);f.push(y.value),d=y.offset}return{value:f,offset:d}}function Uu(i,e,t){const{value:r,offset:s}=un(i,e,t),f={};let d=s;for(let g=0;g<r;g++){const y=ar(i,d);if(!Tu(y.value))throw new Error("Invalid key type");const w=ar(i,y.offset);f[y.value]=w.value,d=w.offset}return{value:f,offset:d}}function Fu(i){const e=(i&31744)>>10,t=i&1023,r=i&32768?-1:1;return e===0?r*2**-14*(t/1024):e===31?t?NaN:r*(1/0):r*2**(e-15)*(1+t/1024)}function ju(i,e,t){if(t<24)switch(t){case 20:return{value:!1,offset:e};case 21:return{value:!0,offset:e};case 22:return{value:null,offset:e};case 23:return{value:void 0,offset:e};default:throw new Error(`Unknown simple value: ${t}`)}if(t===24)return Nt(i,e,1),{value:i.getUint8(e++),offset:e};if(t===25){Nt(i,e,2);const r=Fu(i.getUint16(e,!1));return e+=2,{value:r,offset:e}}if(t===26){Nt(i,e,4);const r=i.getFloat32(e,!1);return e+=4,{value:r,offset:e}}if(t===27){Nt(i,e,8);const r=i.getFloat64(e,!1);return e+=8,{value:r,offset:e}}throw new Error(`Unknown simple or float value: ${t}`)}const Ku=zi("Secp256k1_HashToCurve_Cashu_");function ur(i){const e=je(qe.concat(Ku,i)),t=new Uint32Array(1),r=2**16;for(let s=0;s<r;s++){const f=new Uint8Array(t.buffer),d=je(qe.concat(e,f));try{return cn(He(qe.concat(new Uint8Array([2]),d)))}catch{t[0]++}}throw new Error("No valid point found")}function $u(i){const e=i.map(t=>t.toHex(!1)).join("");return je(new TextEncoder().encode(e))}function cn(i){return Pe.Point.fromHex(i)}const Wu=i=>{let e;return/^[a-fA-F0-9]+$/.test(i)?e=Mn(i)%BigInt(2**31-1):e=cr(Vo(i))%BigInt(2**31-1),e};function zu(){return Pe.utils.randomSecretKey()}function ei(i,e){const t=ur(i);e||(e=Pe.Point.Fn.fromBytes(zu()));const r=Pe.Point.BASE.multiply(e);return{B_:t.add(r),r:e,secret:i}}function Vu(i,e,t){return i.subtract(t.multiply(e))}function Qu(i,e,t,r){const s=r,f=Vu(i.C_,e,s);return{id:i.id,amount:i.amount,secret:t,C:f}}const Gu=i=>({amount:i.amount,C:i.C.toHex(!0),id:i.id,secret:new TextDecoder().decode(i.secret),witness:JSON.stringify(i.witness)}),Zu=(i,e)=>{const t=je(new TextEncoder().encode(i)),r=typeof e=="string"?Ne(e):e,s=rr.sign(t,r);return He(s)},Xu=(i,e,t,r=!1)=>{try{const s=je(new TextEncoder().encode(e)),f=t.length===66?t.slice(2):t;return rr.verify(Ne(i),s,Ne(f))}catch(s){if(r)throw s}return!1};function ti(i){let e;try{typeof i=="string"?e=JSON.parse(i):e=i}catch{throw new Error("Can't parse secret")}if(!Array.isArray(e)||e.length!==2||typeof e[0]!="string"||typeof e[1]!="object"||e[0].trim().length===0||e[1]===null)throw new Error("Invalid NUT-10 secret");const[t,r]=e;if(typeof r.nonce!="string"||typeof r.data!="string")throw new Error("Invalid NUT-10 secret nonce / data");if(r.tags){if(!Array.isArray(r.tags))throw new Error("Invalid NUT-10 secret tags");if(r.tags.some(s=>!Array.isArray(s)||s.length===0||s.some(f=>typeof f!="string"||!f.length)))throw new Error("Invalid NUT-10 tag(s)")}return[t,{nonce:r.nonce,data:r.data,tags:r.tags}]}function Yu(i,e){const t=Array.isArray(i)?i:[i],r=ti(e),s=r[0];if(!t.includes(s))throw new Error(`Invalid secret kind: ${s} Allowed: ${t.join(", ")}`);return r}function Ju(i){return ti(i)[0]}function Go(i){return ti(i)[1]}function ec(i){const{data:e}=Go(i);return e}function tc(i){const{tags:e}=Go(i);return e??[]}function ni(i,e){const t=tc(i).find(r=>r[0]===e);if(!(!t||t.length<=1))return t.slice(1)}function Zo(i,e){const t=ni(i,e);return t&&t.length>0?t[0]:void 0}function nc(i,e){const t=Zo(i,e);if(t===void 0)return;const r=Number.parseInt(t,10);return Number.isFinite(r)?r:void 0}const Xo=zi("Cashu_P2BK_v1");function rc(i,e,t){if(!i.length)return{blinded:[],Ehex:""};t=t??Pe.utils.randomSecretKey();const r=Pe.Point.Fn.fromBytes(t),s=Pe.getPublicKey(t,!0),f=Ne(e);return{blinded:i.map((d,g)=>{const y=cn(d),w=Yo(y,r,f,g),C=y.add(Pe.Point.BASE.multiply(w));if(C.equals(Pe.Point.ZERO))throw new Error("Blinded key at infinity");return C.toHex(!0)}),Ehex:He(s)}}function ic(i,e,t,r){const s=Array.isArray(e)?e:[e],f=Array.isArray(t)?t:[t],d=new Set,g=Pe.Point.fromHex(i),y=Ne(r);for(const w of s){const C=Pe.Point.Fn.fromBytes(Ne(w)),_=Pe.getPublicKey(Ne(w),!0);f.forEach((A,I)=>{const S=Yo(g,C,y,I),R=Ne(A),K=oc(w,S,R,_);K&&d.add(K)})}return Array.from(d)}function oc(i,e,t,r){const s=Pe.Point.CURVE().n,f=typeof i=="string"?Mn(i):i,d=typeof e=="string"?Mn(e):e;if(f<=0n||f>=s)throw new Error("Invalid private key");if(d<=0n||d>=s)throw new Error("Invalid scalar r");if(r=r??Pe.Point.BASE.multiply(f).toBytes(!0),r.length!==33)throw new Error("naturalPub must be 33 bytes");const g=(f+d)%s,y=(s-f+d)%s;if(!t){if(g===0n)throw new Error("Derived secret key is zero");return ii(g)}if(t.length!==33)throw new Error("blindPubkey must be 33 bytes");const w=Pe.Point.fromHex(He(t)),C=Pe.Point.BASE.multiply(d),_=w.subtract(C);if(_.equals(Pe.Point.ZERO))return null;const A=_.toBytes(!0).slice(1),I=r.slice(1);if(!qe.equals(A,I))return null;const S=_.toBytes(!0)[0]&1,R=r[0]&1,K=S===R?g:y;if(K===0n)throw new Error("Derived secret key is zero");return ii(K)}function Yo(i,e,t,r){const s=i.multiply(e).toBytes(!0).slice(1),f=new Uint8Array([r&255]);let d=cr(je(qe.concat(Xo,s,t,f)));if((d===0n||d>=Pe.Point.CURVE().n)&&(d=cr(je(qe.concat(Xo,s,t,f,new Uint8Array([255])))),d===0n||d>=Pe.Point.CURVE().n))throw new Error("P2BK: tweak derivation failed");return d}function yt(i){return i instanceof Uint8Array&&(i=new TextDecoder().decode(i)),Yu(["P2PK","HTLC"],i)}function sc(i){try{const e=yt(i),t=uc(e),r=Jo(e),s=es(e);if(t==="ACTIVE"||t==="PERMANENT")return r;if(t==="EXPIRED"&&s.length){const f=[...r,...s];return Array.from(new Set(f))}}catch{}return[]}function Jo(i){const e=yt(i);let t="";Ju(e)==="P2PK"&&(t=ec(e));const r=ni(e,"pubkeys")??[],s=[t,...r].filter(Boolean);return Array.from(new Set(s))}function es(i){const e=yt(i);return ni(e,"refund")??[]}function ac(i){const e=yt(i),t=nc(e,"locktime");return t===void 0||!Number.isFinite(t)||t<=0?1/0:t}function uc(i,e=Math.floor(Date.now()/1e3)){const t=yt(i),r=ac(t);return Number.isFinite(r)?e<r?"ACTIVE":"EXPIRED":"PERMANENT"}function ri(i){const e=yt(i);return Zo(e,"sigflag")==="SIG_ALL"?"SIG_ALL":"SIG_INPUTS"}function cc(i){return ts(i)?.signatures??[]}function ts(i){if(!i)return;let e;try{e=typeof i=="string"?JSON.parse(i):i}catch(r){console.error("Failed to parse witness string:",r);return}const t={signatures:e.signatures??[]};return typeof e.preimage=="string"&&e.preimage.length>0&&(t.preimage=e.preimage),t}function ns(i,e,t=ct,r){const s=d=>typeof d=="string"?d:He(d),f=Array.isArray(e)?e.map(s):s(e);return i.map((d,g)=>{const y=lc(f,d);let w=d;for(const C of y)try{w=fc(w,C,r)}catch(_){const A=_ instanceof Error?_.message:"Unknown error";t.warn(`Proof #${g+1}: ${A}`)}return w})}function fc(i,e,t){const r=yt(i.secret);t=t??i.secret;const s=typeof e=="string"?Ne(e):e,f=He(rr.getPublicKey(s)),d=sc(r);if(!d.length||!d.some(C=>C.includes(f)))throw new Error(`Signature not required from [02|03]${f}`);if(cc(i.witness).some(C=>Xu(C,t,f)))throw new Error(`Proof already signed by [02|03]${f}`);const g=Zu(t,e),y=ts(i.witness),w={...y&&y.preimage!==void 0?{preimage:y.preimage}:{},signatures:[...y?.signatures??[],g]};return{...i,witness:w}}function lc(i,e){const t=Array.isArray(i)?i:[i],r=e?.p2pk_e;if(!r)return Array.from(new Set(t));const s=yt(e.secret),f=[...Jo(s),...es(s)],d=e.id;return ic(r,t,f,d)}function hc(i){if(i.length===0)throw new Error("No proofs");const e=yt(i[0].secret);if(ri(e)!=="SIG_ALL")throw new Error("First proof is not SIG_ALL");const t=e[1].data,r=JSON.stringify(e[1].tags??[]);for(let s=1;s<i.length;s++){const f=yt(i[s].secret);if(f[0]!==e[0])throw new Error(`Proof #${s+1} is not ${e[0]}`);if(ri(f)!=="SIG_ALL")throw new Error(`Proof #${s+1} is not SIG_ALL`);if(f[1].data!==t)throw new Error("SIG_ALL inputs must share identical Secret.data");if(JSON.stringify(f[1].tags??[])!==r)throw new Error("SIG_ALL inputs must share identical Secret.tags")}}function dc(i,e,t){const r=[];for(const s of i)r.push(s.secret,s.C);for(const s of e)r.push(String(s.blindedMessage.amount),s.blindedMessage.B_);return t&&r.push(t),r.join("")}function rs(i){return i.some(e=>{try{return ri(e.secret)==="SIG_ALL"}catch{return!1}})}function pc(i,e,t){const r=[];for(const s of i)r.push(s.secret,s.C);for(const s of e)r.push(String(s.blindedMessage.amount),s.blindedMessage.id,s.blindedMessage.B_);return t&&r.push(t),r.join("")}function gc(i,e,t){const r=[];for(const s of i)r.push(s.secret);for(const s of e)r.push(s.blindedMessage.B_);return t&&r.push(t),r.join("")}function yc(i,e){if(i.length!==e.length)return!1;for(let t=0;t<i.length;t++)if(i[t]!==e[t])return!1;return!0}const mc=(i,e,t,r)=>{const s=Pe.Point.Fn.fromBytes(i.s),f=Pe.Point.Fn.fromBytes(i.e),d=Pe.Point.BASE.multiply(s),g=r.multiply(f),y=e.multiply(s),w=t.multiply(f),C=d.subtract(g),_=y.subtract(w),A=$u([C,_,r,t]);return yc(A,i.e)},wc=(i,e,t,r)=>{if(e.r===void 0)throw new Error("verifyDLEQProof_reblind: Undefined blinding factor");const s=ur(i),f=t.add(r.multiply(e.r)),d=Pe.Point.BASE.multiply(e.r),g=s.add(d);return mc(e,g,f,r)},bc="m/129372'/0'",vc=(i,e,t)=>{const r=/^[a-fA-F0-9]+$/.test(e);if(!r&&Yr(e)||r&&e.startsWith("00"))return os(i,e,t,0);if(r&&e.startsWith("01"))return is(i,e,t,0);throw new Error(`Unrecognized keyset ID version ${e.slice(0,2)}`)},xc=(i,e,t)=>{const r=/^[a-fA-F0-9]+$/.test(e);if(!r&&Yr(e)||r&&e.startsWith("00"))return os(i,e,t,1);if(r&&e.startsWith("01"))return is(i,e,t,1);throw new Error(`Unrecognized keyset ID version ${e.slice(0,2)}`)},is=(i,e,t,r)=>{let s=qe.concat(qe.fromString("Cashu_KDF_HMAC_SHA256"),qe.fromHex(e),qe.writeBigUint64BE(BigInt(t)));switch(r){case 0:s=qe.concat(s,qe.fromHex("00"));break;case 1:s=qe.concat(s,qe.fromHex("01"))}return Cn(je,i,s)},os=(i,e,t,r)=>{const s=Vt.fromMasterSeed(i),f=Wu(e),d=`${bc}/${f}'/${t}'/${r}`,g=s.derive(d);if(g.privateKey===null)throw new Error("Could not derive private key");return g.privateKey};function kc(i,e){let t=i;for(const s of e)t+=s.B_;const r=new TextEncoder().encode(t);return je(r)}function Ec(i,e,t){const r=kc(e,t),s=Ne(i),f=rr.sign(r,s);return He(f)}function qt(i,e,t,r){if(t){const f=ls(t);if(i===0&&f===0)return t;const d=t.filter(y=>y>0),g=ls(d);if(g>i)throw new Error(`Split is greater than total amount: ${g} > ${i}`);if(d.some(y=>!as(y,e)))throw new Error("Provided amount preferences do not match the amounts of the mint keyset.");if(g===i)return d;t=d,i-=g}else t=[];const s=ss(e,"desc");if(!s||s.length===0)throw new Error("Cannot split amount, keyset is inactive or contains no keys");for(const f of s){if(f<=0)continue;const d=Math.floor(i/f);if(t.push(...Array(d).fill(f)),i-=f*d,i===0)break}if(i!==0)throw new Error(`Unable to split remaining amount: ${i}`);return r?t.sort((f,d)=>f-d):t}function Cc(i,e,t,r){const s=[],f=i.map(g=>g.amount);ss(t,"asc").forEach(g=>{const y=f.filter(C=>C===g).length,w=Math.max(r-y,0);for(let C=0;C<w&&!(s.reduce((_,A)=>_+A,0)+g>e);++C)s.push(g)});const d=e-s.reduce((g,y)=>g+y,0);return d&&qt(d,t).forEach(g=>{s.push(g)}),s.sort((g,y)=>g-y)}function ss(i,e="desc"){return e=="desc"?Object.keys(i).map(t=>parseInt(t)).sort((t,r)=>r-t):Object.keys(i).map(t=>parseInt(t)).sort((t,r)=>t-r)}function as(i,e){return i in e}function cr(i){return Mn(He(i))}function Mn(i){return BigInt(`0x${i}`)}function ii(i){return i.toString(16).padStart(64,"0")}function fn(i){return/^[a-f0-9]*$/i.test(i)}function Tc(i){return Array.isArray(i)?i.some(e=>!fn(e.id)):!fn(i.id)}function _c(i){return i.map(e=>{const t={...e};return t.id=t.id.slice(0,16),t})}function us(i,e){if(i.proofs.forEach(g=>{if(g.dleq&&g.dleq.r==null)throw new Error("Missing blinding factor in included DLEQ proof")}),Tc(i.proofs))throw new Error("can not encode to v4 token if proofs contain non-hex keyset id");i.proofs=_c(i.proofs);const t=Sc(i),r=_u(t),s="cashu",f="B",d=Xr(r);return s+f+d}function Sc(i){const e={},t=i.mint;for(let s=0;s<i.proofs.length;s++){const f=i.proofs[s];e[f.id]?e[f.id].push(f):e[f.id]=[f]}const r={m:t,u:i.unit||"sat",t:Object.keys(e).map(s=>({i:Ne(s),p:e[s].map(f=>({a:f.amount,s:f.secret,c:Ne(f.C),...f.dleq&&{d:{e:Ne(f.dleq.e),s:Ne(f.dleq.s),r:Ne(f.dleq.r??"00")}},...f.p2pk_e&&{pe:Ne(f.p2pk_e)},...f.witness&&{w:JSON.stringify(f.witness)}}))}))};return i.memo&&(r.d=i.memo),r}function Ac(i){const e=[];i.t.forEach(r=>r.p.forEach(s=>{e.push({secret:s.s,C:He(s.c),amount:s.a,id:He(r.i),...s.d&&{dleq:{r:He(s.d.r),s:He(s.d.s),e:He(s.d.e)}},...s.pe&&{p2pk_e:He(s.pe)},...s.w&&{witness:s.w}})}));const t={mint:i.m,proofs:e,unit:i.u||"sat"};return i.d&&(t.memo=i.d),t}function Ic(i,e){const t=(e??[]).map(f=>typeof f=="string"?f:f.id),r=hs(i),s=cs(r);return s.proofs=Dc(s.proofs,t),s}function Mc(i){i=hs(i);const e=cs(i);return{unit:e.unit||"sat",mint:e.mint,amount:Lt(e.proofs),...e.memo&&{memo:e.memo},incompleteProofs:e.proofs.map(t=>({secret:t.secret,C:t.C,amount:t.amount,...t.dleq&&{dleq:t.dleq},...t.witness&&{witness:t.witness}}))}}function cs(i){const e=i.slice(0,1),t=i.slice(1);if(e==="A"){const r=Eu(t);if(r.token.length>1)throw new Error("Multi entry token are not supported");const s=r.token[0],f={mint:s.mint,proofs:s.proofs,unit:r.unit||"sat"};return r.memo&&(f.memo=r.memo),f}else if(e==="B"){const r=Vo(t),s=Du(r);return Ac(s)}throw new Error("Token version is not supported")}function Bc(i,e,t,r=0,s=!1){if(s){const y=Object.entries(i).sort((C,_)=>+C[0]-+_[0]).map(([,C])=>C).reduce((C,_)=>C+_,""),w=je(qe.fromString(y));return qe.toBase64(w).slice(0,12)}let f=Object.entries(i).sort((y,w)=>+y[0]-+w[0]).map(([,y])=>Ne(y)).reduce((y,w)=>oi(y,w),new Uint8Array),d,g;switch(r){case 0:return d=je(f),g=qe.toHex(d).slice(0,14),"00"+g;case 1:if(!e)throw new Error("Cannot compute keyset ID version 01: unit is required.");return f=oi(f,qe.fromString("unit:"+e)),t&&(f=oi(f,qe.fromString("final_expiry:"+t.toString()))),d=je(f),g=qe.toHex(d),"01"+g;default:throw new Error(`Unrecognized keyset ID version: ${r}`)}}function oi(i,e){const t=new Uint8Array(i.length+e.length);return t.set(i),t.set(e,i.length),t}function mt(i){return typeof i=="object"}function ln(...i){return i.map(e=>e.replace(/(^\/+|\/+$)/g,"")).join("/")}function fs(i){return i.replace(/\/$/,"")}function Lt(i){return i.reduce((e,t)=>e+t.amount,0)}class Oc{get value(){return this._value}set value(e){this._value=e}get next(){return this._next}set next(e){this._next=e}constructor(e){this._value=e,this._next=null}}class Pc{get first(){return this._first}set first(e){this._first=e}get last(){return this._last}set last(e){this._last=e}get size(){return this._size}set size(e){this._size=e}constructor(){this._first=null,this._last=null,this._size=0}enqueue(e){const t=new Oc(e);return this._size===0||!this._last?(this._first=t,this._last=t):(this._last.next=t,this._last=t),this._size++,!0}dequeue(){if(this._size===0||!this._first)return null;const e=this._first;return this._first=e.next,e.next=null,this._size--,e.value}}function Dc(i,e){const t=(e??[]).map(s=>typeof s=="string"?s:s.id),r=[];for(const s of i){let f;try{f=Ne(s.id)}catch{r.push(s);continue}if(f[0]===0)r.push(s);else if(f[0]===1){if(!t)throw new Error("A short keyset ID v2 was encountered, but got no keysets to map it to.");let d=!1;for(const g of t)if(s.id===g.slice(0,s.id.length)){s.id=g,r.push(s),d=!0;break}if(!d)throw new Error(`Couldn't map short keyset ID ${s.id} to any known keysets of the current Mint`)}else throw new Error(`Unknown keyset ID version: ${f[0]}`)}return r}function Nc(i,e){if(i.dleq==null)return!1;const t={e:Ne(i.dleq.e),s:Ne(i.dleq.s),r:Mn(i.dleq.r??"00")};if(!as(i.amount,e.keys))throw new Error(`Undefined key for amount ${i.amount} in keyset ${e.id}`);const r=e.keys[i.amount];return wc(new TextEncoder().encode(i.secret),t,cn(i.C),cn(r))}function ls(i){return i.reduce((e,t)=>e+t,0)}function hs(i){return["web+cashu://","cashu://","cashu:","cashu"].forEach(e=>{i.startsWith(e)&&(i=i.slice(e.length))}),i}function qc(i){return/^ln[a-z]{2,}[1-9][0-9]*(?:[mun]|0p)?1/i.test(i)}class hn{constructor(){this.connectionMap=new Map}static getInstance(){return hn.instance||(hn.instance=new hn),hn.instance}getConnection(e,t){if(this.connectionMap.has(e))return this.connectionMap.get(e);const r=new Lc(e,t);return this.connectionMap.set(e,r),r}}class Lc{constructor(e,t){this.subListeners={},this.rpcListeners={},this.rpcId=0,this.onCloseCallbacks=[],this._WS=ku(),this.url=new URL(e),this.messageQueue=new Pc,this._logger=t??ct}connect(){return this.connectionPromise||(this.connectionPromise=new Promise((e,t)=>{try{this.ws=new this._WS(this.url.toString()),this.onCloseCallbacks=[]}catch(r){t(r instanceof Error?r:new Error(String(r)));return}this.ws.onopen=()=>{e()},this.ws.onerror=()=>{t(new Error("Failed to open WebSocket"))},this.ws.onmessage=r=>{this.messageQueue.enqueue(r.data),this.handlingInterval||(this.handlingInterval=setInterval(this.handleNextMessage.bind(this),0))},this.ws.onclose=r=>{this.connectionPromise=void 0,this.onCloseCallbacks.forEach(s=>s(r))}})),this.connectionPromise}sendRequest(e,t){if(this.ws?.readyState!==1){if(e==="unsubscribe")return;throw this._logger.error("Attempted sendRequest, but socket was not open"),new Error("Socket not open")}const r=this.rpcId;this.rpcId++;const s=JSON.stringify({jsonrpc:"2.0",method:e,params:t,id:r});this.ws?.send(s)}closeSubscription(e){this.ws?.send(JSON.stringify(["CLOSE",e]))}addSubListener(e,t){(this.subListeners[e]=this.subListeners[e]||[]).push(t)}addRpcListener(e,t,r){this.rpcListeners[r]={callback:e,errorCallback:t}}removeRpcListener(e){delete this.rpcListeners[e]}removeListener(e,t){if(this.subListeners[e]){if(this.subListeners[e].length===1){delete this.subListeners[e];return}this.subListeners[e]=this.subListeners[e].filter(r=>r!==t)}}async ensureConnection(){this.ws?.readyState!==1&&await this.connect()}handleNextMessage(){if(this.messageQueue.size===0){clearInterval(this.handlingInterval),this.handlingInterval=void 0;return}const e=this.messageQueue.dequeue();let t;try{if(t=JSON.parse(e),"result"in t&&t.id!=null)this.rpcListeners[t.id]&&(this.rpcListeners[t.id].callback(),this.removeRpcListener(t.id));else if("error"in t&&t.id!=null)this.rpcListeners[t.id]&&(this.rpcListeners[t.id].errorCallback(new Error(t.error.message)),this.removeRpcListener(t.id));else if("method"in t&&!("id"in t)){const r=t.params?.subId;if(!r)return;if(this.subListeners[r]?.length>0){const s=t;this.subListeners[r].forEach(f=>f(s.params?.payload))}}}catch(r){this._logger.error("Error doing handleNextMessage",{e:r});return}}createSubscription(e,t,r){if(this.ws?.readyState!==1)throw this._logger.error("Attempted createSubscription, but socket was not open"),new Error("Socket is not open");const s=(Math.random()+1).toString(36).substring(7);return this.addRpcListener(()=>{this.addSubListener(s,t)},r,this.rpcId),this.sendRequest("subscribe",{...e,subId:s}),this.rpcId++,s}cancelSubscription(e,t,r){this.removeListener(e,t),this.addRpcListener(()=>{this._logger.info("Unsubscribed {subId}",{subId:e})},r||(s=>this._logger.error("Unsubscribe failed",{e:s})),this.rpcId),this.sendRequest("unsubscribe",{subId:e})}get activeSubscriptions(){return Object.keys(this.subListeners)}close(){this.ws&&this.ws?.close()}onClose(e){this.onCloseCallbacks.push(e)}}const si={UNPAID:"UNPAID",PAID:"PAID"},Bn={UNPAID:"UNPAID",PENDING:"PENDING",PAID:"PAID"},ai={UNSPENT:"UNSPENT",PENDING:"PENDING",SPENT:"SPENT"};function ui(i,e){return i.state||(e.warn("Field 'state' not found in Melt quote response. Update NUT-05 of mint: https://github.com/cashubtc/nuts/pull/136)"),typeof i.paid=="boolean"&&(i.state=i.paid?Bn.PAID:Bn.UNPAID)),i}function ds(i,e){return i.state||(e.warn("Field 'state' not found in Mint quote response. Update NUT-04 of mint: https://github.com/cashubtc/nuts/pull/141)"),typeof i.paid=="boolean"&&(i.state=i.paid?si.PAID:si.UNPAID)),i}function Rc(i,e){return Array.isArray(i?.contact)&&i?.contact.length>0&&(i.contact=i.contact.map(t=>Array.isArray(t)&&t.length===2&&typeof t[0]=="string"&&typeof t[1]=="string"?(e.warn("Mint returned deprecated 'contact' field: Update NUT-06: https://github.com/cashubtc/nuts/pull/117"),{method:t[0],info:t[1]}):t)),i}class ci{constructor(e){this.REGEX_METACHAR=/[\\^$.*+?()[\]{}|]/,this._mintInfo=e;const t=this.toEndpoints(e?.nuts?.[22]?.protected_endpoints);this._protected22=this.buildIndex(t);const r=this.toEndpoints(e?.nuts?.[21]?.protected_endpoints);this._protected21=this.buildIndex(r)}isSupported(e){switch(e){case 4:case 5:return this.checkMintMelt(e);case 7:case 8:case 9:case 10:case 11:case 12:case 14:case 20:return this.checkGenericNut(e);case 17:return this.checkNut17();case 15:return this.checkNut15();default:throw new Error("nut is not supported by cashu-ts")}}requiresBlindAuthToken(e,t){return this.matchesProtected(this._protected22,e,t)}requiresClearAuthToken(e,t){return this.matchesProtected(this._protected21,e,t)}matchesProtected(e,t,r){if(!e)return!1;const s=`${t} ${r}`,f=e.cache[s];if(typeof f=="boolean")return f;const d=e.exact.some(w=>w.method===t&&w.path===r),g=d?!1:e.regex.some(w=>w.method===t&&w.regex.test(r)),y=d||g;return e.cache[s]=y,y}checkGenericNut(e){return this._mintInfo.nuts[e]?.supported?{supported:!0}:{supported:!1}}checkMintMelt(e){const t=this._mintInfo.nuts[e];return t&&t.methods.length>0&&!t.disabled?{disabled:!1,params:t.methods}:{disabled:!0,params:t?.methods??[]}}checkNut17(){return this._mintInfo.nuts[17]&&this._mintInfo.nuts[17].supported.length>0?{supported:!0,params:this._mintInfo.nuts[17].supported}:{supported:!1}}checkNut15(){return this._mintInfo.nuts[15]&&this._mintInfo.nuts[15].methods.length>0?{supported:!0,params:this._mintInfo.nuts[15].methods}:{supported:!1}}toEndpoints(e){if(!Array.isArray(e))return[];const t=[];for(const r of e)if(r&&typeof r=="object"){const s=r,f=s.method,d=s.path;if(typeof f=="string"&&typeof d=="string"){const g=f.toUpperCase();(g==="GET"||g==="POST")&&t.push({method:g,path:d})}}return t}buildIndex(e){if(!e||e.length===0)return;const t=[],r=[],s=this.REGEX_METACHAR;for(const f of e){if(f.path.startsWith("^")||f.path.endsWith("$")||s.test(f.path))try{r.push({method:f.method,regex:new RegExp(f.path)});continue}catch{}t.push({method:f.method,path:f.path})}return{cache:{},exact:t,regex:r}}get cache(){return this._mintInfo}get contact(){return this._mintInfo.contact}get description(){return this._mintInfo.description}get description_long(){return this._mintInfo.description_long}get name(){return this._mintInfo.name}get pubkey(){return this._mintInfo.pubkey}get nuts(){return this._mintInfo.nuts}get version(){return this._mintInfo.version}get motd(){return this._mintInfo.motd}get supportsBolt12Description(){return this.supportsNut04Description("bolt12")}supportsNut04Description(e,t){return this._mintInfo.nuts[4]?.methods.some(r=>r.method===e&&(t?r.unit===t:!0)&&(r.options?.description===!0||r.description===!0))}supportsAmountless(e="bolt11",t="sat"){const r=this._mintInfo?.nuts?.[5]?.methods??[];return Array.isArray(r)?r.some(s=>s.method===e&&s.unit===t&&s.options?.amountless===!0):!1}}class fi{constructor(e,t){this.tokenListeners=[],this.discoveryUrl=e,this.logger=t?.logger??ct,this.clientId=t?.clientId??"cashu-client",this.scope=t?.scope??"openid",this.onTokens=t?.onTokens}static fromMintInfo(e,t){const r=e?.nuts?.["21"];if(!r?.openid_discovery)throw new Error("OIDCAuth: mint does not advertise NUT-21 openid_discovery");const s=t?.clientId??r.client_id??"cashu-client";return new fi(r.openid_discovery,{...t,clientId:s})}setClient(e){this.clientId=e}setScope(e){this.scope=e??"openid"}addTokenListener(e){this.tokenListeners.push(e)}async loadConfig(){if(this.config)return this.config;const e=await fetch(this.discoveryUrl,{method:"GET",headers:{Accept:"application/json"}}),t=await e.text();let r;try{r=t?JSON.parse(t):void 0}catch(f){this.logger.warn("OIDCAuth: bad discovery JSON",{err:f})}if(!e.ok||!r)throw new Error("OIDCAuth: invalid discovery document");const s=r;if(typeof s.token_endpoint!="string"||s.token_endpoint.length===0)throw new Error("OIDCAuth: invalid discovery document, missing token_endpoint");return this.config=s,s}generatePKCE(){const e=Kt(48),t=Xr(e),r=qe.fromString(t),s=je(r),f=Xr(s);return{verifier:t,challenge:f}}async buildAuthCodeUrl(e){const t=await this.loadConfig(),r=e.scope??this.scope,s=new URLSearchParams({response_type:"code",client_id:this.clientId,redirect_uri:e.redirectUri,scope:r,code_challenge_method:e.codeChallengeMethod??"S256",code_challenge:e.codeChallenge});if(e.state&&s.set("state",e.state),!t.authorization_endpoint)throw new Error("OIDCAuth: discovery lacks authorization_endpoint");return`${t.authorization_endpoint}?${s.toString()}`}async exchangeAuthCode(e){const t=await this.loadConfig(),r=this.toForm({grant_type:"authorization_code",code:e.code,redirect_uri:e.redirectUri,client_id:this.clientId,code_verifier:e.codeVerifier}),s=await this.postFormStrict(t.token_endpoint,r);return this.handleTokens(s),s}async deviceStart(){const e=(await this.loadConfig()).device_authorization_endpoint;if(!e)throw new Error("OIDCAuth: provider lacks device_authorization_endpoint");const t=this.toForm({client_id:this.clientId,scope:this.scope});return this.postFormStrict(e,t)}async devicePoll(e,t=5){const r=await this.loadConfig();let s=Math.max(1,t);for(;;){await this.sleep(s*1e3);const f=this.toForm({grant_type:"urn:ietf:params:oauth:grant-type:device_code",device_code:e,client_id:this.clientId}),d=await this.postFormLoose(r.token_endpoint,f);if(d.access_token)return this.handleTokens(d),d;const g=(d.error??"").toString();if(g==="authorization_pending")continue;if(g==="slow_down"){s=Math.max(s+5,s*2);continue}const y=d.error_description||g||"device authorization failed";throw new Error(`OIDCAuth: ${y}`)}}async startDeviceAuth(e=5){const t=await this.deviceStart(),r=Math.max(t.interval??1,e);let s=!1;return{...t,poll:async()=>{const f=await this.loadConfig();let d=Math.max(1,r);for(;;){if(s)throw new Error("OIDCAuth: device polling cancelled");await this.sleep(d*1e3);const g=this.toForm({grant_type:"urn:ietf:params:oauth:grant-type:device_code",device_code:t.device_code,client_id:this.clientId}),y=await this.postFormLoose(f.token_endpoint,g);if(y.access_token)return this.handleTokens(y),y;const w=(y.error??"").toString();if(w==="authorization_pending")continue;if(w==="slow_down"){d=Math.max(d+5,d*2);continue}const C=y.error_description||w||"device authorization failed";throw new Error(`OIDCAuth: ${C}`)}},cancel:()=>{s=!0}}}async refresh(e){const t=await this.loadConfig(),r=this.toForm({grant_type:"refresh_token",refresh_token:e,client_id:this.clientId}),s=await this.postFormStrict(t.token_endpoint,r);return this.handleTokens(s),s}async passwordGrant(e,t){const r=await this.loadConfig(),s=this.toForm({grant_type:"password",client_id:this.clientId,username:e,password:t,scope:this.scope}),f=await this.postFormStrict(r.token_endpoint,s);return this.handleTokens(f),f}handleTokens(e){if(!e.access_token){const t=e.error_description||e.error||"token response missing access_token";throw new Error(`OIDCAuth: ${t}`)}queueMicrotask(()=>In(this.onTokens,e,this.logger,{where:"OIDCAuth.handleTokens"}));for(const t of this.tokenListeners)queueMicrotask(()=>In(t,e,this.logger,{where:"OIDCAuth.handleTokens.listener"}))}toForm(e){const t=r=>encodeURIComponent(r).replace(/%20/g,"+");return Object.entries(e).map(([r,s])=>`${t(r)}=${t(s)}`).join("&")}async postFormStrict(e,t){try{this.logger.debug("OIDCAuth Request",{formBody:t});const r=await fetch(e,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},body:t}),s=await r.text();let f;try{f=s?JSON.parse(s):void 0}catch(d){this.logger.warn("OIDCAuth: bad JSON (strict)",{err:d})}if(!r.ok){const d=f??{},g=d.error_description||d.error||`HTTP ${r.status}`;throw new Error(`OIDCAuth: ${g}`)}return this.logger.debug("OIDCAuth Response",{json:f}),f??{}}catch(r){throw this.logger.error("OIDCAuth: postFormStrict failed",{err:r}),r}}async postFormLoose(e,t){try{this.logger.debug("OIDCAuth Request",{formBody:t});const r=await(await fetch(e,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},body:t})).text();let s;try{s=r?JSON.parse(r):void 0}catch(f){this.logger.warn("OIDCAuth: bad JSON (loose)",{err:f})}return this.logger.debug("OIDCAuth Response",{json:s}),s??{}}catch(r){return this.logger.error("OIDCAuth: postFormLoose network error",{err:r}),{error:"network_error",error_description:String(r)}}}sleep(e){return new Promise(t=>setTimeout(t,e))}}class ps{constructor(e,t){this._mintUrl=fs(e),this._request=t?.customRequest??xu,this._authProvider=t?.authProvider,this._logger=t?.logger??ct,bu(this._logger)}get mintUrl(){return this._mintUrl}async oidcAuth(e){const t=(await this.getLazyMintInfo()).nuts[21];if(!t?.openid_discovery)throw new Error("Mint: no NUT-21 openid_discovery");return new fi(t.openid_discovery,{...e,clientId:e?.clientId??t.client_id??"cashu-client"})}async getInfo(e){const t=await(e??this._request)({endpoint:ln(this._mintUrl,"/v1/info")});return Rc(t,this._logger)}async getLazyMintInfo(){if(this._mintInfo)return this._mintInfo;const e=await this.getInfo();return this._mintInfo=new ci(e),this._mintInfo}async swap(e,t){const r=await this.requestWithAuth("POST","/v1/swap",{requestBody:e},t);if(!mt(r)||!Array.isArray(r?.signatures))throw this._logger.error("Invalid response from mint...",{data:r,op:"swap"}),new Error("Invalid response from mint");return r}async createMintQuoteBolt11(e,t){const r=await this.requestWithAuth("POST","/v1/mint/quote/bolt11",{requestBody:e},t);return ds(r,this._logger)}async createMintQuoteBolt12(e,t){return await this.requestWithAuth("POST","/v1/mint/quote/bolt12",{requestBody:e},t)}async checkMintQuoteBolt11(e,t){const r=await this.requestWithAuth("GET",`/v1/mint/quote/bolt11/${e}`,{},t);return ds(r,this._logger)}async checkMintQuoteBolt12(e,t){return await this.requestWithAuth("GET",`/v1/mint/quote/bolt12/${e}`,{},t)}async mintBolt11(e,t){const r=await this.requestWithAuth("POST","/v1/mint/bolt11",{requestBody:e},t);if(!mt(r)||!Array.isArray(r?.signatures))throw this._logger.error("Invalid response from mint...",{data:r,op:"mintBolt11"}),new Error("Invalid response from mint");return r}async mintBolt12(e,t){const r=await this.requestWithAuth("POST","/v1/mint/bolt12",{requestBody:e},t);if(!mt(r)||!Array.isArray(r?.signatures))throw this._logger.error("Invalid response from mint...",{data:r,op:"mintBolt12"}),new Error("Invalid response from mint");return r}async createMeltQuoteBolt11(e,t){const r=await this.requestWithAuth("POST","/v1/melt/quote/bolt11",{requestBody:e},t),s=ui(r,this._logger);if(!mt(s)||typeof s?.amount!="number"||typeof s?.fee_reserve!="number"||typeof s?.quote!="string")throw this._logger.error("Invalid response from mint...",{data:s,op:"createMeltQuoteBolt11"}),new Error("Invalid response from mint");return s}async createMeltQuoteBolt12(e,t){return await this.requestWithAuth("POST","/v1/melt/quote/bolt12",{requestBody:e},t)}async checkMeltQuoteBolt11(e,t){const r=await this.requestWithAuth("GET",`/v1/melt/quote/bolt11/${e}`,{},t),s=ui(r,this._logger);if(!mt(s)||typeof s?.amount!="number"||typeof s?.fee_reserve!="number"||typeof s?.quote!="string"||typeof s?.state!="string"||!Object.values(Bn).includes(s.state))throw this._logger.error("Invalid response from mint...",{data:s,op:"checkMeltQuoteBolt11"}),new Error("Invalid response from mint");return s}async checkMeltQuoteBolt12(e,t){return await this.requestWithAuth("GET",`/v1/melt/quote/bolt12/${e}`,{},t)}async melt(e,t,r){const s={...r?.preferAsync?{Prefer:"respond-async"}:{}};Gr(!this.isValidMethodString(e),`Invalid melt method: ${e}`,this._logger);const f=await this.requestWithAuth("POST",`/v1/melt/${e}`,{requestBody:t,headers:s},r?.customRequest);if(!mt(f))throw this._logger.error("Invalid response from mint...",{data:f,op:"melt"}),new Error("Invalid response from mint");return f}async meltBolt11(e,t){const r=await this.melt("bolt11",e,t),s=ui(r,this._logger);if(!mt(s)||typeof s?.state!="string"||!Object.values(Bn).includes(s.state))throw this._logger.error("Invalid response from mint...",{data:s,op:"meltBolt11"}),new Error("Invalid response from mint");return s}async meltBolt12(e,t){return this.melt("bolt12",e,t)}async check(e,t){const r=await this.requestWithAuth("POST","/v1/checkstate",{requestBody:e},t);if(!mt(r)||!Array.isArray(r?.states))throw this._logger.error("Invalid response from mint...",{data:r,op:"check"}),new Error("Invalid response from mint");return r}async getKeys(e,t,r){const s=t||this._mintUrl;e&&(e=e.replace(/\//g,"_").replace(/\+/g,"-"));const f=await(r??this._request)({endpoint:e?ln(s,"/v1/keys",e):ln(s,"/v1/keys")});if(!mt(f)||!Array.isArray(f.keysets))throw this._logger.error("Invalid response from mint...",{data:f,op:"getKeys"}),new Error("Invalid response from mint");return f}async getKeySets(e){return(e??this._request)({endpoint:ln(this._mintUrl,"/v1/keysets")})}async restore(e,t){const r=await(t??this._request)({endpoint:ln(this._mintUrl,"/v1/restore"),method:"POST",requestBody:e});if(!mt(r)||!Array.isArray(r?.outputs)||!Array.isArray(r?.signatures))throw this._logger.error("Invalid response from mint...",{data:r,op:"restore"}),new Error("Invalid response from mint");return r}async connectWebSocket(){if(this.ws)await this.ws.ensureConnection();else{const e=new URL(this._mintUrl),t="v1/ws";e.pathname&&(e.pathname.endsWith("/")?e.pathname+=t:e.pathname+="/"+t),this.ws=hn.getInstance().getConnection(`${e.protocol==="https:"?"wss":"ws"}://${e.host}${e.pathname}`);try{await this.ws.connect()}catch(r){throw this._logger.error("Failed to connect to WebSocket...",{e:r}),new Error("Failed to connect to WebSocket...")}}}disconnectWebSocket(){this.ws&&this.ws.close()}get webSocketConnection(){return this.ws}async handleClearAuth(e,t){if(!(!this._authProvider||!(await this.getLazyMintInfo()).requiresClearAuthToken(e,t)))return this._logger.error("Clear Authentication Token...",{cat:this._authProvider.getCAT()}),this._authProvider.getCAT()}async handleBlindAuth(e,t){if(!this._authProvider||!(await this.getLazyMintInfo()).requiresBlindAuthToken(e,t))return;const r=await this._authProvider.getBlindAuthToken({method:e,path:t});return this._logger.error("Blind Authentication Token...",{bat:r}),r}async requestWithAuth(e,t,r={},s){const f=s??this._request,d=await this.handleBlindAuth(e,t),g=await this.handleClearAuth(e,t),y={...r.headers??{},...d?{"Blind-auth":d}:{},...g?{"Clear-auth":g}:{}};return f({...r,endpoint:ln(this._mintUrl,t),method:e,headers:y})}isValidMethodString(e){return!!(typeof e=="string"&&/^[a-z0-9_-]+$/.test(e))}}class On{constructor(e,t,r,s,f){this._keys={},this._id=e,this._unit=t,this._active=r,this._input_fee_ppk=s,this._final_expiry=f}get id(){return this._id}get unit(){return this._unit}get isActive(){return this._active}get fee(){return this._input_fee_ppk??0}get expiry(){return this._final_expiry}get hasKeys(){return Object.keys(this._keys).length>0}get hasHexId(){return fn(this._id)}get keys(){return this._keys}set keys(e){this._keys=e}get active(){return this.isActive}get input_fee_ppk(){return this.fee}get final_expiry(){return this.expiry}toMintKeyset(){return{id:this._id,unit:this._unit,active:this._active,input_fee_ppk:this._input_fee_ppk,final_expiry:this._final_expiry}}toMintKeys(){return this.hasKeys?{id:this._id,unit:this._unit,keys:this._keys}:null}verify(){return this.hasKeys?On.verifyKeysetId({id:this._id,unit:this._unit,final_expiry:this._final_expiry,keys:this._keys}):!1}static verifyKeysetId(e){if(!e.keys||Object.keys(e.keys).length===0)return!1;const t=Yr(e.id)&&!fn(e.id),r=fn(e.id)?Ne(e.id)[0]:0;return Bc(e.keys,e.unit,e.final_expiry,r,t)===e.id}static fromMintApi(e,t){const r=new On(e.id,e.unit,e.active,e.input_fee_ppk,e.final_expiry);if(t){if(t.id!==e.id)throw new Error(`Mismatched keyset ids: meta=${e.id}, keys=${t.id}`);if(t.unit!==e.unit)throw new Error(`Mismatched keyset units: meta=${e.unit}, keys=${t.unit}`);if(t.final_expiry!==void 0&&e.final_expiry!==void 0&&t.final_expiry!==e.final_expiry)throw new Error(`Mismatched keyset expiry for id=${e.id}`);r.keys=t.keys}return r}}class Qt{constructor(e,t,r,s){if(this.keysets={},this.mint=typeof e=="string"?new ps(e):e,this.unit=t,r&&s){const f=Array.isArray(s)?s:[s];this.buildKeychain(r,f),this.getCheapestKeyset()}}static fromCache(e,t){const r=new Qt(e,t.unit);return r.loadFromCache(t),r}static mintToCacheDTO(e,t,r,s){const f=new Map(s.map(d=>[d.id,d]));return{keysets:r.map(d=>{const g=f.get(d.id),y={...d};return g&&(y.keys=g.keys),y}),unit:e,mintUrl:t}}static cacheToMintDTO(e){const t=e.keysets.map(s=>({id:s.id,unit:s.unit,active:s.active,input_fee_ppk:s.input_fee_ppk,final_expiry:s.final_expiry})),r=e.keysets.filter(s=>!!s.keys).map(s=>({id:s.id,unit:s.unit,keys:s.keys,final_expiry:s.final_expiry}));return{keysets:t,keys:r}}async init(e){if(Object.keys(this.keysets).length>0&&!e)return;const[t,r]=await Promise.all([this.mint.getKeySets(),this.mint.getKeys()]);this.buildKeychain(t.keysets,r.keysets),this.getCheapestKeyset()}loadFromCache(e){if(e.unit!==this.unit)throw new Error(`KeyChain unit mismatch in cache, expected '${this.unit}', got '${e.unit}' from ${e.mintUrl}`);const{keysets:t,keys:r}=Qt.cacheToMintDTO(e);this.buildKeychain(t,r),this.getCheapestKeyset()}buildKeychain(e,t){this.keysets={};const r=e.filter(f=>f.unit===this.unit);if(!r.length)throw new Error(`No Keysets found for unit: ${this.unit}`);const s=new Map(t.filter(f=>f.unit===this.unit).map(f=>[f.id,f]));for(const f of r){let d;if(f.active&&fn(f.id)){const g=s.get(f.id);d=On.fromMintApi(f,g)}else d=On.fromMintApi(f);if(d.hasKeys&&!d.verify())throw new Error(`Keyset verification failed for ID ${d.id}`);this.keysets[d.id]=d}}getKeyset(e){const t=e?this.keysets[e]:this.getCheapestKeyset();if(!t)throw new Error(`Keyset '${e}' not found`);return t}getCheapestKeyset(){if(Object.keys(this.keysets).length===0)throw new Error("KeyChain not initialized");const e=Object.values(this.keysets).filter(t=>t.isActive&&t.hasHexId&&t.hasKeys);if(e.length===0)throw new Error("No active keyset found");return e.sort((t,r)=>t.fee-r.fee)[0]}getKeysets(){if(Object.keys(this.keysets).length===0)throw new Error("KeyChain not initialized");return Object.values(this.keysets)}getAllKeys(){return this.getKeysets().map(e=>e.toMintKeys()).filter(e=>e!==null)}getAllKeysetIds(){return this.getKeysets().map(e=>e.id)}get cache(){const e=this.getKeysets(),t=e.map(s=>s.toMintKeyset()),r=e.map(s=>s.toMintKeys()).filter(s=>s!==null);return Qt.mintToCacheDTO(this.unit,this.mint.mintUrl,t,r)}getCache(){const e=this.cache,{keysets:t,keys:r}=Qt.cacheToMintDTO(e);return{keysets:t,keys:r,unit:e.unit,mintUrl:e.mintUrl}}}class li{constructor(e,t,r){this.amount=e,this.B_=t,this.id=r}getSerializedBlindedMessage(){return{amount:this.amount,B_:this.B_.toHex(!0),id:this.id}}}const Hc=new Set(["locktime","pubkeys","n_sigs","refund","n_sigs_refund"]);function Uc(i){if(!i||typeof i!="string")throw new Error("tag key must be a non empty string");if(Hc.has(i))throw new Error(`additionalTags must not use reserved key "${i}"`)}const gs=1024,hi=new WeakMap;function Fc(i,e){e&&hi.set(i,e)}function jc(i){const e=hi.get(i);if(e)return hi.delete(i),e}class ft{constructor(e,t,r){this.secret=r,this.blindingFactor=t,this.blindedMessage=e}toProof(e,t){let r;e.dleq&&(r={s:Ne(e.dleq.s),e:Ne(e.dleq.e),r:this.blindingFactor});const s={id:e.id,amount:e.amount,C_:cn(e.C_)},f=cn(t.keys[e.amount]),d=Qu(s,this.blindingFactor,this.secret,f),g={...Gu(d),...r&&{dleq:{s:He(r.s),e:He(r.e),r:ii(r.r??BigInt(0))}}},y=jc(this);return y&&(g.p2pk_e=y),g}static createP2PKData(e,t,r,s){return qt(t,r.keys,s).map(f=>this.createSingleP2PKData(e,f,r.id))}static createSingleP2PKData(e,t,r){const s=Array.isArray(e.pubkey)?e.pubkey:[e.pubkey],f=e.refundKeys??[],d=Math.max(1,Math.min(e.requiredSignatures??1,s.length)),g=Math.max(1,Math.min(e.requiredRefundSignatures??1,f.length||1));if(s.length===0)throw new Error("P2PK requires at least one pubkey");const y=typeof e.hashlock=="string"&&e.hashlock.length>0;let w=y?e.hashlock:s[0],C=y?s:s.slice(1),_=f,A;if(e.blindKeys){const Ae=[...s,...f],{blinded:u,Ehex:J}=rc(Ae,r);y?C=u.slice(0,s.length):(w=u[0],C=u.slice(1,s.length)),_=u.slice(s.length),A=J}const I=[],S=e.locktime??NaN;if(Number.isSafeInteger(S)&&S>=0&&I.push(["locktime",String(S)]),C.length>0&&(I.push(["pubkeys",...C]),d>1&&I.push(["n_sigs",String(d)])),_.length>0&&(I.push(["refund",..._]),g>1&&I.push(["n_sigs_refund",String(g)])),e.sigFlag=="SIG_ALL"&&I.push(["sigflag","SIG_ALL"]),e.additionalTags?.length){const Ae=e.additionalTags.map(([u,...J])=>(Uc(u),[u,...J.map(String)]));I.push(...Ae)}const R=[y?"HTLC":"P2PK",{nonce:He(Kt(32)),data:w,tags:I}],K=JSON.stringify(R),W=[...K].length;if(W>gs)throw new Error(`Secret too long (${W} characters), maximum is ${gs}`);const de=new TextEncoder().encode(K),{r:ue,B_:ce}=ei(de),ve=new ft(new li(t,ce,r).getSerializedBlindedMessage(),ue,de);return e.blindKeys&&A&&Fc(ve,A),ve}static createRandomData(e,t,r){return qt(e,t.keys,r).map(s=>this.createSingleRandomData(s,t.id))}static createSingleRandomData(e,t){const r=He(Kt(32)),s=new TextEncoder().encode(r),{r:f,B_:d}=ei(s);return new ft(new li(e,d,t).getSerializedBlindedMessage(),f,s)}static createDeterministicData(e,t,r,s,f){return qt(e,s.keys,f).map((d,g)=>this.createSingleDeterministicData(d,t,r+g,s.id))}static createSingleDeterministicData(e,t,r,s){const f=vc(t,s,r),d=He(f),g=new TextEncoder().encode(d),y=cr(xc(t,s,r)),{r:w,B_:C}=ei(g,y);return new ft(new li(e,C,s).getSerializedBlindedMessage(),w,g)}static sumOutputAmounts(e){return e.reduce((t,r)=>t+r.blindedMessage.amount,0)}}const Kc=(i,e,t,r=!1,s=!1,f=ct)=>{const d=mu();let g=null,y=1/0,w=0,C=0;const _=u=>{try{return t.getKeyset(u.id).fee}catch(J){sr(`Could not get fee. No keyset found for keyset id: ${u.id}`,f,{error:J,keychain:t.getKeysets()})}},A=(u,J)=>u-(r?Math.ceil(J/1e3):0),I=u=>{const J=[...u];for(let B=J.length-1;B>0;B--){const L=Math.floor(Math.random()*(B+1));[J[B],J[L]]=[J[L],J[B]]}return J},S=(u,J,B)=>{let L=0,pe=u.length-1,oe=null;for(;L<=pe;){const P=Math.floor((L+pe)/2),z=u[P].exFee;(B?z<=J:z>=J)?(oe=P,B?L=P+1:pe=P-1):B?pe=P-1:L=P+1}return B?oe:L<u.length?L:null},R=(u,J)=>{const B=J.exFee;let L=0,pe=u.length;for(;L<pe;){const oe=Math.floor((L+pe)/2);u[oe].exFee<B?L=oe+1:pe=oe}u.splice(L,0,J)},K=(u,J)=>A(u,J)<e?1/0:u+J/1e3-e;let W=0,de=0;const ue=i.map(u=>{const J=_(u),B=r?u.amount-J/1e3:u.amount,L={proof:u,exFee:B,ppkfee:J};return(!r||B>0)&&(W+=u.amount,de+=J),L});let ce=r?ue.filter(u=>u.exFee>0):ue;if(ce.sort((u,J)=>u.exFee-J.exFee),ce.length>0){let u;if(s){const J=S(ce,e,!0);u=J!==null?J+1:0}else{const J=S(ce,e,!1);if(J!==null){const B=ce[J].exFee,L=S(ce,B,!0);Wo(L,"Unexpected null rightIndex in binary search",f),u=L+1}else u=ce.length}for(let J=u;J<ce.length;J++)W-=ce[J].proof.amount,de-=ce[J].ppkfee;ce=ce.slice(0,u)}const ve=A(W,de);if(e<=0||e>ve)return{keep:i,send:[]};const Ae=Math.min(Math.ceil(e*(1+0/100)),e+0,ve);for(let u=0;u<60;u++){const J=[];let B=0,L=0;for(const H of I(ce)){const Z=B+H.proof.amount,D=L+H.ppkfee,F=A(Z,D);if(s&&F>e||(J.push(H),B=Z,L=D,F>=e))break}const pe=new Set(J),oe=ce.filter(H=>!pe.has(H)),P=I(Array.from({length:J.length},(H,Z)=>Z)).slice(0,5e3);for(const H of P){const Z=A(B,L);if(Z===e||!s&&Z>=e&&Z<=Ae)break;const D=J[H],F=B-D.proof.amount,V=L-D.ppkfee,k=A(F,V),b=e-k,$=S(oe,b,s);if($!==null){const G=oe[$];(!s||G.exFee>D.exFee)&&(b>=0||G.exFee<=D.exFee)&&(J[H]=G,B=F+G.proof.amount,L=V+G.ppkfee,oe.splice($,1),R(oe,D))}}const z=K(B,L);if(z<y){f.debug(`selectProofsToSend: best solution found in trial #${u} - amount: ${B}, delta: ${z}`),g=[...J].sort((Z,D)=>D.exFee-Z.exFee),y=z,w=B,C=L;const H=[...g];for(;H.length>1&&y>0;){const Z=H.pop(),D=B-Z.proof.amount,F=L-Z.ppkfee,V=K(D,F);if(V==1/0)break;V<y&&(g=[...H],y=V,w=D,C=F,B=D,L=F)}}if(g&&y<1/0){const H=A(w,C);if(H===e||!s&&H>=e&&H<=Ae)break}if(d.elapsed()>1e3){Gr(s,"Proof selection took too long. Try again with a smaller proof set.",f),f.warn("Proof selection took too long. Returning best selection so far.");break}}if(g&&y<1/0){const u=g.map(L=>L.proof),J=new Set(u),B=i.filter(L=>!J.has(L));return f.info(`Proof selection took ${d.elapsed()}ms`),{keep:B,send:u}}return{keep:i,send:[]}};class $c{constructor(e){if(this.next=new Map,this.locks=new Map,e)for(const[t,r]of Object.entries(e))this.next.set(t,r)}async withLock(e,t){const r=this.locks.get(e)??Promise.resolve();let s;const f=new Promise(g=>s=g),d=r.then(()=>f);this.locks.set(e,d);try{return await r,await t()}finally{s(),this.locks.get(e)===d&&this.locks.delete(e)}}async reserve(e,t){if(t<0)throw new Error("reserve called with negative count");return this.withLock(e,()=>{const r=this.next.get(e)??0;return t===0?{start:r,count:0}:(this.next.set(e,r+t),{start:r,count:t})})}async advanceToAtLeast(e,t){await this.withLock(e,()=>{const r=this.next.get(e)??0;t>r&&this.next.set(e,t)})}async setNext(e,t){await this.withLock(e,()=>{if(t<0)throw new Error("setNext: negative next not allowed");this.next.set(e,t)})}snapshot(){return Promise.resolve(Object.fromEntries(this.next.entries()))}}class Wc{constructor(e){this.wallet=e}send(e,t){return new zc(this.wallet,e,t)}receive(e){return new Vc(this.wallet,e)}mintBolt11(e,t){return new ys(this.wallet,"bolt11",e,t)}mintBolt12(e,t){return new ys(this.wallet,"bolt12",e,t)}meltBolt11(e,t){return new ms(this.wallet,"bolt11",e,t)}meltBolt12(e,t){return new ms(this.wallet,"bolt12",e,t)}}class zc{constructor(e,t,r){this.wallet=e,this.amount=t,this.proofs=r,this.config={}}asRandom(e){return this.sendOT={type:"random",denominations:e},this}asDeterministic(e=0,t){return this.sendOT={type:"deterministic",counter:e,denominations:t},this}asP2PK(e,t){return this.sendOT={type:"p2pk",options:e,denominations:t},this}asFactory(e,t){return this.sendOT={type:"factory",factory:e,denominations:t},this}asCustom(e){return this.sendOT={type:"custom",data:e},this}keepAsRandom(e){return this.keepOT={type:"random",denominations:e},this}keepAsDeterministic(e=0,t){return this.keepOT={type:"deterministic",counter:e,denominations:t},this}keepAsP2PK(e,t){return this.keepOT={type:"p2pk",options:e,denominations:t},this}keepAsFactory(e,t){return this.keepOT={type:"factory",factory:e,denominations:t},this}keepAsCustom(e){return this.keepOT={type:"custom",data:e},this}includeFees(e=!0){return this.config.includeFees=e,this}keyset(e){return this.config.keysetId=e,this}privkey(e){return this.config.privkey=e,this}proofsWeHave(e){return this.config.proofsWeHave=e,this}onCountersReserved(e){return this.config.onCountersReserved=e,this}offlineExactOnly(e=!1){return this.offlineExact={requireDleq:e},this}offlineCloseMatch(e=!1){return this.offlineClose={requireDleq:e},this}async prepare(){const e={send:this.sendOT??this.wallet.defaultOutputType(),...this.keepOT?{keep:this.keepOT}:{}};return this.wallet.prepareSwapToSend(this.amount,this.proofs,this.config,e)}async run(){if((this.offlineExact||this.offlineClose)&&(this.sendOT||this.keepOT))throw new Error("Offline selection cannot be combined with custom output types. Remove send/keep output configuration, or use an online swap.");if(this.offlineExact)return this.config.privkey&&(this.proofs=this.wallet.signP2PKProofs(this.proofs,this.config.privkey)),this.wallet.sendOffline(this.amount,this.proofs,{includeFees:this.config.includeFees,exactMatch:!0,requireDleq:this.offlineExact.requireDleq});if(this.offlineClose)return this.config.privkey&&(this.proofs=this.wallet.signP2PKProofs(this.proofs,this.config.privkey)),this.wallet.sendOffline(this.amount,this.proofs,{includeFees:this.config.includeFees,exactMatch:!1,requireDleq:this.offlineClose.requireDleq});const e={send:this.sendOT??this.wallet.defaultOutputType(),...this.keepOT?{keep:this.keepOT}:{}};return this.wallet.send(this.amount,this.proofs,this.config,e)}}class Vc{constructor(e,t){this.wallet=e,this.token=t,this.config={}}asRandom(e){return this.outputType={type:"random",denominations:e},this}asDeterministic(e=0,t){return this.outputType={type:"deterministic",counter:e,denominations:t},this}asP2PK(e,t){return this.outputType={type:"p2pk",options:e,denominations:t},this}asFactory(e,t){return this.outputType={type:"factory",factory:e,denominations:t},this}asCustom(e){return this.outputType={type:"custom",data:e},this}keyset(e){return this.config.keysetId=e,this}requireDleq(e=!0){return this.config.requireDleq=e,this}privkey(e){return this.config.privkey=e,this}proofsWeHave(e){return this.config.proofsWeHave=e,this}onCountersReserved(e){return this.config.onCountersReserved=e,this}async prepare(){return this.wallet.prepareSwapToReceive(this.token,this.config,this.outputType)}async run(){return this.wallet.receive(this.token,this.config,this.outputType)}}class ys{constructor(e,t,r,s){this.wallet=e,this.method=t,this.amount=r,this.quote=s,this.config={},this._hasPrivkey}asRandom(e){return this.outputType={type:"random",denominations:e},this}asDeterministic(e=0,t){return this.outputType={type:"deterministic",counter:e,denominations:t},this}asP2PK(e,t){return this.outputType={type:"p2pk",options:e,denominations:t},this}asFactory(e,t){return this.outputType={type:"factory",factory:e,denominations:t},this}asCustom(e){return this.outputType={type:"custom",data:e},this}keyset(e){return this.config.keysetId=e,this}privkey(e){return this.config.privkey=e,this}proofsWeHave(e){return this.config.proofsWeHave=e,this}onCountersReserved(e){return this.config.onCountersReserved=e,this}async run(){if(this.method==="bolt11"){const t=this.quote;if(typeof t!="string"&&t.pubkey&&!this.config.privkey)throw new Error("privkey is required for locked BOLT11 mint quotes");return this.wallet.mintProofsBolt11(this.amount,t,this.config,this.outputType)}const e=this.quote;if(!this.config.privkey)throw new Error("privkey is required for BOLT12 mint quotes");return this.wallet.mintProofsBolt12(this.amount,e,this.config.privkey,this.config,this.outputType)}}class ms{constructor(e,t,r,s){this.wallet=e,this.method=t,this.quote=r,this.proofs=s,this.config={}}asRandom(e){return this.outputType={type:"random",denominations:e},this}asDeterministic(e=0,t){return this.outputType={type:"deterministic",counter:e,denominations:t},this}asP2PK(e,t){return this.outputType={type:"p2pk",options:e,denominations:t},this}asFactory(e,t){return this.outputType={type:"factory",factory:e,denominations:t},this}asCustom(e){return this.outputType={type:"custom",data:e},this}keyset(e){return this.config.keysetId=e,this}privkey(e){return this.config.privkey=e,this}onCountersReserved(e){return this.config.onCountersReserved=e,this}onChangeOutputsCreated(e){return this.config.onChangeOutputsCreated=e,this}async prepare(){return await this.wallet.prepareMelt(this.method,this.quote,this.proofs,this.config,this.outputType)}async run(){const e=await this.wallet.prepareMelt(this.method,this.quote,this.proofs,this.config,this.outputType);return this.wallet.completeMelt(e,this.config.privkey)}}function Qc(i){const e=new WeakSet;try{return JSON.stringify(i,(t,r)=>{if(typeof r=="object"&&r!==null){if(e.has(r))return"[Circular]";e.add(r)}return r})}catch{return Object.prototype.toString.call(i)}}function ws(i){if(i instanceof Error)return i;const e=typeof i=="string"?i:Qc(i),t=new Error(e);return t.cause=i,t}function bs(){const i=new Error("Aborted");return Object.defineProperty(i,"name",{value:"AbortError"}),i}function dn(i){i&&Promise.resolve(i).then(e=>{try{e()}catch{}}).catch(()=>{})}class Gc{constructor(e){this.wallet=e,this.countersReservedHandlers=new Set,this.meltBlanksHandlers=new Set}withAbort(e,t){if(!e)return t;if(e.aborted)return t(),()=>{};const r=()=>t();return e.addEventListener("abort",r,{once:!0}),()=>{e.removeEventListener("abort",r),t()}}waitUntilPaid(e,t,r,s="Timeout waiting for paid"){return new Promise((f,d)=>{let g=null,y=null;const w=_=>{dn(g),y&&(clearTimeout(y),y=null),r?.signal&&r.signal.removeEventListener("abort",C),_&&d(ws(_))},C=()=>w(bs());if(r?.signal){if(r.signal.aborted)return C();r.signal.addEventListener("abort",C,{once:!0})}r?.timeoutMs&&r.timeoutMs>0&&(y=setTimeout(()=>w(new Error(s)),r.timeoutMs)),g=e(t,_=>{w(),f(_)},_=>w(_),{signal:r?.signal})})}countersReserved(e,t){this.countersReservedHandlers.add(e);const r=()=>this.countersReservedHandlers.delete(e);return this.withAbort(t?.signal,r)}_emitCountersReserved(e){for(const t of this.countersReservedHandlers)In(t,e,this.wallet.logger,{event:"countersReserved"})}meltBlanksCreated(e,t){this.meltBlanksHandlers.add(e);const r=()=>this.meltBlanksHandlers.delete(e);return this.withAbort(t?.signal,r)}_emitMeltBlanksCreated(e){for(const t of this.meltBlanksHandlers)In(t,e,this.wallet.logger,{event:"meltBlanksCreated"})}async mintQuoteUpdates(e,t,r,s){await this.wallet.mint.connectWebSocket();const f=this.wallet.mint.webSocketConnection;if(!f)throw new Error("Failed to establish WebSocket connection.");const d=Array.from(new Set(e)),g=f.createSubscription({kind:"bolt11_mint_quote",filters:d},t,r),y=()=>f.cancelSubscription(g,t);return this.withAbort(s?.signal,y)}async mintQuotePaid(e,t,r,s){return this.mintQuoteUpdates([e],f=>{f.state===si.PAID&&t(f)},r,s)}async meltQuoteUpdates(e,t,r,s){await this.wallet.mint.connectWebSocket();const f=this.wallet.mint.webSocketConnection;if(!f)throw new Error("Failed to establish WebSocket connection.");const d=Array.from(new Set(e)),g=f.createSubscription({kind:"bolt11_melt_quote",filters:d},t,r),y=()=>f.cancelSubscription(g,t);return this.withAbort(s?.signal,y)}async meltQuotePaid(e,t,r,s){return this.meltQuoteUpdates([e],f=>{f.state===Bn.PAID&&t(f)},r,s)}async proofStateUpdates(e,t,r,s){await this.wallet.mint.connectWebSocket();const f=this.wallet.mint.webSocketConnection;if(!f)throw new Error("Failed to establish WebSocket connection.");const d=new TextEncoder,g={};for(const A of e){const I=ur(d.encode(A.secret)).toHex(!0);g[I]=A}const y=Object.keys(g),w=A=>{t({...A,proof:g[A.Y]})},C=f.createSubscription({kind:"proof_state",filters:y},w,r),_=()=>f.cancelSubscription(C,w);return this.withAbort(s?.signal,_)}onceMintPaid(e,t){return this.waitUntilPaid(this.mintQuotePaid.bind(this),e,t,"Timeout waiting for mint paid")}onceAnyMintPaid(e,t){return new Promise((r,s)=>{const f=Array.from(new Set(e)),d=new Map;let g=null,y=null,w=!1;const C=A=>{for(const I of d.values())dn(I);d.clear(),g&&(clearTimeout(g),g=null),t?.signal&&t.signal.removeEventListener("abort",_),A&&s(ws(A))},_=()=>C(bs());if(t?.signal){if(t.signal.aborted)return _();t.signal.addEventListener("abort",_,{once:!0})}if(t?.timeoutMs&&t.timeoutMs>0&&(g=setTimeout(()=>C(new Error("Timeout waiting for any mint paid")),t.timeoutMs)),f.length===0)return C(new Error("No quote ids provided"));for(const A of f){const I=this.mintQuotePaid(A,S=>{C(),r({id:A,quote:S})},S=>{if(t?.failOnError){C(S);return}y=S;const R=d.get(A);R&&(dn(R),d.delete(A)),w&&d.size===0&&C(y??new Error("No subscriptions remaining"))});d.set(A,I)}w=!0})}onceMeltPaid(e,t){return this.waitUntilPaid(this.meltQuotePaid.bind(this),e,t,"Timeout waiting for melt paid")}proofStatesStream(e,t){return(async function*(){const r=[];let s=!1,f=null;const d=t?.maxBuffer&&t.maxBuffer>0?t.maxBuffer:1/0,g=t?.drop??"oldest",y=()=>{const A=f;f=null,A&&A()},w=A=>{if(r.length>=d)if(g==="oldest"){const I=r.shift();if(I!==void 0)try{t?.onDrop?.(I)}catch{}r.push(A)}else{try{t?.onDrop?.(A)}catch{}return}else r.push(A);y()},C=this.proofStateUpdates(e,A=>{w(A)},()=>{s=!0,y()},{signal:t?.signal}),_=()=>{s=!0,y()};try{for(t?.signal&&(t.signal.aborted?_():t.signal.addEventListener("abort",_,{once:!0}));!s||r.length;){for(;r.length;)yield r.shift();if(s)break;await new Promise(A=>f=A)}}finally{dn(C),t?.signal&&t.signal.removeEventListener("abort",_)}}).call(this)}group(){const e=[];let t=!1;const r=(()=>{if(!t)for(t=!0;e.length;)dn(e.pop())});return r.add=s=>t?(dn(s),s):(e.push(s),s),Object.defineProperty(r,"cancelled",{get:()=>t,enumerable:!0}),r}}class Zc{constructor(e){this.src=e}async peekNext(e){return(await this.src.reserve(e,0)).start}async advanceToAtLeast(e,t){await this.src.advanceToAtLeast(e,t)}async setNext(e,t){if(typeof this.src.setNext=="function"){await this.src.setNext(e,t);return}throw new Error("CounterSource does not support setNext()")}async snapshot(){if(typeof this.src.snapshot=="function")return await this.src.snapshot();throw new Error("CounterSource does not support snapshot()")}}const di="__PENDING__";class pi{constructor(e,t){if(this._seed=void 0,this._unit="sat",this._mintInfo=void 0,this._denominationTarget=3,this._secretsPolicy="auto",this._boundKeysetId=di,this.swap=this.send.bind(this),this.ops=new Wc(this),this.on=new Gc(this),this._logger=t?.logger??ct,this._selectProofs=t?.selectProofs??Kc,this.mint=typeof e=="string"?new ps(e,{authProvider:t?.authProvider,logger:this._logger}):e,this._unit=t?.unit??this._unit,this._boundKeysetId=t?.keysetId??this._boundKeysetId,t?.bip39seed&&(this.failIf(!(t.bip39seed instanceof Uint8Array),"bip39seed must be a valid Uint8Array",{bip39seed:t.bip39seed}),this._seed=t.bip39seed),this._secretsPolicy=t?.secretsPolicy??this._secretsPolicy,t?.counterSource?this._counterSource=t.counterSource:this._counterSource=new $c(t?.counterInit),this.counters=new Zc(this._counterSource),this._keyChain=new Qt(this.mint,this._unit),this._denominationTarget=t?.denominationTarget??this._denominationTarget,t?.keysets&&t?.keys&&t?.mintInfo){const r=Array.isArray(t.keys)?t.keys:[t.keys],s=Qt.mintToCacheDTO(this._unit,this.mint.mintUrl,t.keysets,r);this.loadMintFromCache(t.mintInfo,s)}}fail(e,t){return sr(e,this._logger,t)}failIf(e,t,r){return Gr(e,t,this._logger,r)}failIfNullish(e,t,r){return Wo(e,t,this._logger,r)}safeCallback(e,t,r){In(e,t,this._logger,r)}assertAmount(e,t){this.failIf(typeof e!="number"||!Number.isInteger(e)||e<=0,"Amount must be a positive integer",{op:t,amount:e}),this.failIf(!Number.isSafeInteger(e),"Amount must be a safe integer",{op:t,amount:e})}async loadMint(e){const t=[];(!this._mintInfo||e)&&t.push(this.mint.getInfo().then(r=>(this._mintInfo=new ci(r),null))),t.push(this._keyChain.init(e).then(()=>null)),await Promise.all(t),this.finishInit()}loadMintFromCache(e,t){this._mintInfo=new ci(e),this._keyChain.loadFromCache(t),this.finishInit()}finishInit(){const e=this._keyChain.getCheapestKeyset().id;if(this._logger.debug("KeyChain",{keychain:this._keyChain.cache}),this._boundKeysetId===di)this._boundKeysetId=e;else{const t=this._keyChain.getKeyset(this._boundKeysetId);this.failIf(!t.hasKeys,"Wallet keyset has no keys",{keyset:t.id})}this.getMintInfo()}get keyChain(){return this._keyChain}get unit(){return this._unit}getMintInfo(){return this.failIfNullish(this._mintInfo,"Mint info not initialized; call loadMint or loadMintFromCache first"),this._mintInfo}get keysetId(){return this.failIf(this._boundKeysetId===di,"Wallet not initialised, call loadMint or loadMintFromCache first"),this._boundKeysetId}getKeyset(e){const t=this._keyChain.getKeyset(e??this.keysetId);return this.failIf(t.unit!==this._unit,"Keyset unit does not match wallet unit",{keyset:t.id,unit:t.unit,walletUnit:this._unit}),this.failIf(!t.hasKeys,"Keyset has no keys loaded",{keyset:t.id}),t}get logger(){return this._logger}async reserveFor(e,t){return t<=0?{start:0,count:0}:this._counterSource.reserve(e,t)}countersNeeded(e){return e.type!=="deterministic"||e.counter!==0?0:(e.denominations??[]).length}async addCountersToOutputTypes(e,...t){const r=t.reduce((y,w)=>y+this.countersNeeded(w),0);if(r===0)return{outputTypes:t};const s=await this.reserveFor(e,r);let f=s.start;const d=t.map(y=>{if(y.type==="deterministic"&&y.counter===0){const w=(y.denominations??[]).length;if(w>0){const C={...y,counter:f};return f+=w,C}}return y}),g={keysetId:e,start:s.start,count:s.count,next:s.start+s.count};return this.on._emitCountersReserved(g),{outputTypes:d,used:g}}bindKeyset(e){const t=this._keyChain.getKeyset(e);this.failIf(t.unit!==this._unit,"Keyset unit does not match wallet unit",{keyset:t.id,unit:t.unit,walletUnit:this._unit}),this.failIf(!t.hasKeys,"Keyset has no keys loaded",{keyset:t.id}),this._boundKeysetId=t.id,this._logger.debug("Wallet bound to keyset",{keysetId:t.id,unit:t.unit,feePPK:t.fee})}withKeyset(e,t){const r=new pi(this.mint,{keysetId:e,bip39seed:this._seed,secretsPolicy:this._secretsPolicy,logger:this._logger,counterSource:t?.counterSource??this._counterSource});return r.loadMintFromCache(this.getMintInfo().cache,this._keyChain.cache),r}defaultOutputType(){return this._secretsPolicy==="random"?{type:"random"}:this._secretsPolicy==="deterministic"?(this.failIfNullish(this._seed,"Deterministic policy requires a seed"),{type:"deterministic",counter:0}):this._seed?{type:"deterministic",counter:0}:{type:"random"}}configureOutputs(e,t,r,s=!1,f=[]){let d=e;if(r.type==="custom"){this.failIf(s,"The custom OutputType does not support automatic fee inclusion");const y=ft.sumOutputAmounts(r.data);return this.failIf(y!==e,`Custom output data total (${y}) does not match amount (${e})`),r}let g=r.denominations??[];if(g.length===0&&f.length>0&&(g=Cc(f,d,t.keys,this._denominationTarget)),g=qt(d,t.keys,g),s){let y=this.getFeesForKeyset(g.length,t.id),w=qt(y,t.keys);for(;this.getFeesForKeyset(g.length+w.length,t.id)>y;)y++,w=qt(y,t.keys);d+=y,g=[...g,...w]}return{...r,denominations:g}}preparedTotal(e){return e.type==="custom"?ft.sumOutputAmounts(e.data):(e.denominations??[]).reduce((t,r)=>t+r,0)}createOutputData(e,t,r){if(this.failIf(e<0,"Amount was negative",{amount:e}),r.type!="custom"&&r.denominations&&r.denominations.length>0){const f=r.denominations.reduce((d,g)=>d+g,0);this.failIf(f!==e,"Denominations do not sum to the expected amount",{splitSum:f,expected:e})}let s;switch(r.type){case"random":s=ft.createRandomData(e,t,r.denominations);break;case"deterministic":this.failIfNullish(this._seed,"Deterministic outputs require a seed configured in the wallet"),s=ft.createDeterministicData(e,this._seed,r.counter,t,r.denominations);break;case"p2pk":s=ft.createP2PKData(r.options,e,t,r.denominations);break;case"factory":{s=qt(e,t.keys,r.denominations).map(f=>r.factory(f,t));break}case"custom":{s=r.data;const f=ft.sumOutputAmounts(s);this.failIf(f!==e,`Custom output data total (${f}) does not match amount (${e})`);break}default:this.fail("Invalid OutputType")}return s}createSwapTransaction(e,t,r=[]){e=this._prepareInputsForMint(e);const s=[...t,...r],f=s.map((C,_)=>_);rs(e)||f.sort((C,_)=>s[C].blindedMessage.amount-s[_].blindedMessage.amount);const d=[...Array.from({length:t.length},()=>!0),...Array.from({length:r.length},()=>!1)],g=f.map(C=>s[C]),y=f.map(C=>d[C]),w=g.map(C=>C.blindedMessage);return this._logger.debug("createSwapTransaction:",{indices:f,sortedKeepVector:y}),{payload:{inputs:e,outputs:w},outputData:g,keepVector:y,sortedIndices:f}}async receive(e,t,r){const s=await this.prepareSwapToReceive(e,t,r),{keep:f}=await this.completeSwap(s,t?.privkey);return f}async prepareSwapToReceive(e,t,r){const{keysetId:s,requireDleq:f,proofsWeHave:d,onCountersReserved:g}=t||{};r=r??this.defaultOutputType();const y=typeof e=="string"?this.decodeToken(e):e,w=fs(y.mint);this.failIf(w!==this.mint.mintUrl,"Token belongs to a different mint",{token:w,wallet:this.mint.mintUrl}),this.failIf(y.unit!==this._unit,"Token is not in wallet unit",{token:y.unit,wallet:this._unit});let C=[];({proofs:C}=y);const _=Lt(C);this.failIf(_===0,"Token contains no proofs",{proofs:C});const A=this.getKeyset(s);if(f)for(const de of C){const ue=this._keyChain.getKeyset(de.id);Nc(de,ue)||this.fail("Token contains proofs with invalid or missing DLEQ")}const I=this.getFeesForProofs(C),S=_-I;let R=this.configureOutputs(S,A,r,!1,d);const K=await this.addCountersToOutputTypes(A.id,R);[R]=K.outputTypes,K.used&&this.safeCallback(g,K.used,{op:"receive"}),this._logger.debug("receive counter",{counter:K.used,receiveOT:R});const W=this.createOutputData(this.preparedTotal(R),A,R);return{amount:S,fees:I,keysetId:A.id,inputs:C,keepOutputs:W}}sendOffline(e,t,r){this.assertAmount(e,"sendOffline");const{requireDleq:s=!1,includeFees:f=!1,exactMatch:d=!0}=r||{};s&&(t=t.filter(C=>C.dleq!=null)),this.failIf(Lt(t)<e,"Not enough funds available to send");const{keep:g,send:y}=this.selectProofsToSend(t,e,f,d),w=this._prepareInputsForMint(y,s);return{keep:g,send:w}}async send(e,t,r,s){this.assertAmount(e,"send");const{keysetId:f,includeFees:d=!1}=r||{};s=s??{send:this.defaultOutputType(),keep:this.defaultOutputType()};try{const y=this.defaultOutputType().type==="deterministic",w=I=>!I||I.type==="random"&&(!I.denominations||I.denominations.length===0);if(f||y||!w(s.send)||s.keep&&!w(s.keep)){const I=[];throw f&&I.push("keysetId override"),y&&I.push("wallet default is deterministic"),w(s.send)||I.push("non-default send output type"),s.keep&&!w(s.keep)&&I.push("non-default keep output type"),new Error(`Options require a swap: ${I.join(", ")}`)}const{keep:C,send:_}=this.sendOffline(e,t,{includeFees:d,exactMatch:!0,requireDleq:!1}),A=d?this.getFeesForProofs(_):0;if(Lt(_)===e+A)return this._logger.info("Successful exactMatch offline selection!"),{keep:C,send:_}}catch(y){const w=y instanceof Error?y.message:"Unknown error";this._logger.debug("ExactMatch offline selection failed.",{e:w})}const g=await this.prepareSwapToSend(e,t,r,s);return await this.completeSwap(g,r?.privkey)}async prepareSwapToSend(e,t,r,s){const{keysetId:f,includeFees:d=!1,onCountersReserved:g}=r||{};s=s??{send:this.defaultOutputType(),keep:this.defaultOutputType()};const y=this.getKeyset(f);let w=this.configureOutputs(e,y,s.send??this.defaultOutputType(),d);const C=this.preparedTotal(w),{keep:_,send:A}=this.selectProofsToSend(t,C,!0);if(A.length===0)throw new Error("Not enough funds available to send");const I=Lt(A),S=this.getFeesForProofs(A),R=I-S-C;this.failIf(R<0,"Not enough funds available for swap",{selectedSum:I,swapFee:S,sendAmount:C,changeAmount:R});let K=this.configureOutputs(R,y,s.keep??this.defaultOutputType(),!1,r?.proofsWeHave);const W=this.preparedTotal(K),de=await this.addCountersToOutputTypes(y.id,w,K);[w,K]=de.outputTypes,de.used&&this.safeCallback(g,de.used,{op:"send"}),this._logger.debug("send counters",{counter:de.used,sendOT:w,keepOT:K});const ue=this.createOutputData(C,y,w),ce=this.createOutputData(W,y,K);return{amount:e,fees:S,keysetId:y.id,inputs:A,sendOutputs:ue,keepOutputs:ce,unselectedProofs:_}}async completeSwap(e,t){const r=e?.keepOutputs?e.keepOutputs:[],s=e.sendOutputs?e.sendOutputs:[],f=e.unselectedProofs?e.unselectedProofs:[];t&&(e.inputs=this.signP2PKProofs(e.inputs,t,[...r,...s]));const d=this.createSwapTransaction(e.inputs,r,s),{signatures:g}=await this.mint.swap(d.payload),y=this.getKeyset(e.keysetId),w=d.outputData.map((S,R)=>S.toProof(g[R],y)),C=Array(w.length),_=Array(d.keepVector.length);d.sortedIndices.forEach((S,R)=>{_[S]=d.keepVector[R],C[S]=w[R]});const A=[],I=[];return C.forEach((S,R)=>{_[R]?A.push(S):I.push(S)}),this._logger.debug("SEND COMPLETED",{unselectedProofs:f.map(S=>S.amount),keepProofs:A.map(S=>S.amount),sendProofs:I.map(S=>S.amount)}),{keep:[...A,...f],send:I}}selectProofsToSend(e,t,r=!1,s=!1){this.assertAmount(t,"selectProofsToSend");const{keep:f,send:d}=this._selectProofs(e,t,this._keyChain,r,s);return{keep:f,send:d}}signP2PKProofs(e,t,r,s){if(!rs(e))return ns(e,t,this._logger);this.failIfNullish(r,"OutputData is required for SIG_ALL proof signing."),hc(e);const[f,...d]=e;let g=f;const y=[gc(e,r,s),pc(e,r,s),dc(e,r,s)];for(const w of y)g=ns([g],t,this._logger,w)[0];return[g,...d]}getFeesForProofs(e){const t=e.reduce((r,s)=>r+this.getProofFeePPK(s),0);return Math.ceil(t/1e3)}getProofFeePPK(e){try{return this._keyChain.getKeyset(e.id).fee}catch(t){this.fail(`Could not get fee. No keyset found for keyset id: ${e.id}`,{e:t,keychain:this._keyChain.getKeysets()})}}getFeesForKeyset(e,t){try{const r=this._keyChain.getKeyset(t).fee;return Math.floor(Math.max((e*r+999)/1e3,0))}catch(r){this.fail(`No keyset found with ID ${t}`,{e:r})}}_prepareInputsForMint(e,t=!1){return e.map(r=>{const s=r.witness&&typeof r.witness!="string"?JSON.stringify(r.witness):r.witness,{dleq:f,p2pk_e:d,...g}=r;return t&&f?{...g,dleq:f,witness:s}:{...g,witness:s}})}decodeToken(e){const t=this._keyChain.getAllKeysetIds();return Ic(e,t)}async batchRestore(e=300,t=100,r=0,s){const f=Math.ceil(e/t),d=[];let g,y=0;for(;y<f;){const w=await this.restore(r,t,{keysetId:s});w.proofs.length>0?(y=0,d.push(...w.proofs),g=w.lastCounterWithSignature):y++,r+=t}return{proofs:d,lastCounterWithSignature:g}}async restore(e,t,r){const{keysetId:s}=r||{},f=this.getKeyset(s);this.failIfNullish(this._seed,"Cashu Wallet must be initialized with a seed to use restore");const d=Array(t).fill(0),g=ft.createDeterministicData(0,this._seed,e,f,d),{outputs:y,signatures:w}=await this.mint.restore({outputs:g.map(I=>I.blindedMessage)}),C={};y.forEach((I,S)=>C[I.B_]=w[S]);const _=[];let A;for(let I=0;I<g.length;I++){const S=C[g[I].blindedMessage.B_];S&&(A=e+I,g[I].blindedMessage.amount=S.amount,_.push(g[I].toProof(S,f)))}return{proofs:_,lastCounterWithSignature:A}}async createMintQuote(e,t){return this.createMintQuoteBolt11(e,t)}async createMintQuoteBolt11(e,t){this.assertAmount(e,"createMintQuoteBolt11"),t&&(this.getMintInfo().supportsNut04Description("bolt11",this._unit)||this.fail("Mint does not support description for bolt11"));const r={unit:this._unit,amount:e,description:t},s=await this.mint.createMintQuoteBolt11(r);return{...s,amount:s.amount||e,unit:s.unit||this._unit}}async createLockedMintQuote(e,t,r){this.assertAmount(e,"createLockedMintQuote");const{supported:s}=this.getMintInfo().isSupported(20);this.failIf(!s,"Mint does not support NUT-20");const f={unit:this._unit,amount:e,description:r,pubkey:t},d=await this.mint.createMintQuoteBolt11(f);this.failIf(typeof d.pubkey!="string","Mint returned unlocked mint quote");const g=d.pubkey;return{...d,pubkey:g,amount:d.amount||e,unit:d.unit||this._unit}}async createMintQuoteBolt12(e,t){const r=this.getMintInfo();t?.description&&!r.supportsNut04Description("bolt12",this._unit)&&this.fail("Mint does not support description for bolt12");const s={pubkey:e,unit:this._unit,amount:t?.amount,description:t?.description};return this.mint.createMintQuoteBolt12(s)}async checkMintQuote(e){return this.checkMintQuoteBolt11(e)}async checkMintQuoteBolt11(e){const t=typeof e=="string"?e:e.quote,r=await this.mint.checkMintQuoteBolt11(t);return typeof e=="string"?r:{...r,amount:r.amount||e.amount,unit:r.unit||e.unit}}async checkMintQuoteBolt12(e){return this.mint.checkMintQuoteBolt12(e)}async mintProofs(e,t,r,s){return this._mintProofs("bolt11",e,t,r,s)}async mintProofsBolt11(e,t,r,s){return this._mintProofs("bolt11",e,t,r,s)}async mintProofsBolt12(e,t,r,s,f){return this._mintProofs("bolt12",e,t,{...s,privkey:r},f)}async _mintProofs(e,t,r,s,f){this.assertAmount(t,`_mintProofs: ${e}`),f=f??this.defaultOutputType();const{privkey:d,keysetId:g,proofsWeHave:y,onCountersReserved:w}=s??{},C=this.getKeyset(g);let _=this.configureOutputs(t,C,f,!1,y);const A=this.preparedTotal(_),I=await this.addCountersToOutputTypes(C.id,_);[_]=I.outputTypes,I.used&&this.safeCallback(w,I.used,{op:"mintProofs"}),this._logger.debug("mint counter",{counter:I.used,mintOT:_});const S=this.createOutputData(A,C,_),R=S.map(de=>de.blindedMessage),K={outputs:R,quote:typeof r=="string"?r:r.quote};if(typeof r!="string"&&r.pubkey){this.failIf(!d,"Can not sign locked quote without private key");const de=Ec(d,r.quote,R);K.signature=de}let W;return e==="bolt12"?{signatures:W}=await this.mint.mintBolt12(K):{signatures:W}=await this.mint.mintBolt11(K),this.failIf(W.length!==S.length,`Mint returned ${W.length} signatures, expected ${S.length}`),this._logger.debug("MINT COMPLETED",{amounts:S.map(de=>de.blindedMessage.amount)}),S.map((de,ue)=>de.toProof(W[ue],C))}async createMeltQuote(e,t){return this.createMeltQuoteBolt11(e,t)}async createMeltQuoteBolt11(e,t){t!==void 0&&(this.failIf(qc(e),"amountMsat supplied but invoice already contains an amount. Leave amountMsat undefined for non-zero invoices."),this.assertAmount(t,"createMeltQuoteBolt11"));const r=this._mintInfo?.supportsAmountless?.("bolt11",this._unit)??!1,s={unit:this._unit,request:e,...r&&t!==void 0?{options:{amountless:{amount_msat:t}}}:{}},f=await this.mint.createMeltQuoteBolt11(s);return{...f,unit:f.unit||this._unit,request:f.request||e}}async createMeltQuoteBolt12(e,t){return this.mint.createMeltQuoteBolt12({unit:this._unit,request:e,options:t?{amountless:{amount_msat:t}}:void 0})}async createMultiPathMeltQuote(e,t){this.assertAmount(t,"createMultiPathMeltQuote");const{supported:r,params:s}=this.getMintInfo().isSupported(15);this.failIf(!r,"Mint does not support NUT-15"),this.failIf(!s?.some(d=>d.method==="bolt11"&&d.unit===this._unit),`Mint does not support MPP for bolt11 and ${this._unit}`);const f={unit:this._unit,request:e,options:{mpp:{amount:t}}};return{...await this.mint.createMeltQuoteBolt11(f),request:e,unit:this._unit}}async checkMeltQuote(e){return this.checkMeltQuoteBolt11(e)}async checkMeltQuoteBolt11(e){const t=typeof e=="string"?e:e.quote,r=await this.mint.checkMeltQuoteBolt11(t);return typeof e=="string"?r:{...r,request:e.request,unit:e.unit}}async checkMeltQuoteBolt12(e){return this.mint.checkMeltQuoteBolt12(e)}async meltProofs(e,t,r,s){return this.meltProofsBolt11(e,t,r,s)}async meltProofsBolt11(e,t,r,s){const f=await this.prepareMelt("bolt11",e,t,r,s),d=typeof r?.onChangeOutputsCreated=="function";return this.completeMelt(f,r?.privkey,d)}async meltProofsBolt12(e,t,r,s){const f=await this.prepareMelt("bolt12",e,t,r,s),d=typeof r?.onChangeOutputsCreated=="function";return this.completeMelt(f,r?.privkey,d)}async prepareMelt(e,t,r,s,f){f=f??this.defaultOutputType();const{keysetId:d,onChangeOutputsCreated:g,onCountersReserved:y}=s||{},w=this.getKeyset(d),C=Lt(r),_=C-t.amount;let A=[];if(this.failIf(_<0,"Not enough proofs to cover amount + fee reserve",{sendAmount:C,quoteAmount:t.amount}),_>0){let S=Math.ceil(Math.log2(_))||1;S<0&&(S=0);const R=S?new Array(S).fill(0):[];this._logger.debug("Creating NUT-08 blanks for fee reserve",{feeReserve:_,denominations:R}),f.type==="custom"&&this.fail("Custom OutputType not supported for melt change (must be 0-sat blanks)");let K={...f,denominations:R};const W=await this.addCountersToOutputTypes(w.id,K);[K]=W.outputTypes,W.used&&this.safeCallback(y,W.used,{op:"meltProofs"}),this._logger.debug("melt counter",{counter:W.used,meltOT:K}),A=this.createOutputData(0,w,K)}const I={method:e,inputs:r,outputData:A,keysetId:w.id,quote:t};if(A.length>0){const S={method:e,payload:{quote:t.quote,inputs:r,outputs:A.map(R=>R.blindedMessage)},outputData:A,keyset:w,quote:t};this.safeCallback(g,S,{op:"meltProofs"}),this.on._emitMeltBlanksCreated(S)}return I}async completeMelt(e,t,r){e=this.maybeConvertMeltBlanks(e);let s=e.inputs;const f=e.outputData.map(_=>_.blindedMessage),d=e.quote.quote,g=this.getKeyset(e.keysetId);t&&(s=this.signP2PKProofs(s,t,e.outputData,d)),s=this._prepareInputsForMint(s);const y={quote:d,inputs:s,outputs:f},w=e.method==="bolt11"?await this.mint.meltBolt11(y,{preferAsync:r}):await this.mint.melt(e.method,y,{preferAsync:r});this.failIf((w.change?.length??0)>e.outputData.length,`Mint returned ${w.change?.length??0} signatures, but only ${e.outputData.length} blanks were provided`);const C=w.change?.map((_,A)=>e.outputData[A].toProof(_,g))??[];return r?this._logger.debug("ASYNC MELT REQUESTED",w):this._logger.debug("MELT COMPLETED",{changeAmounts:C.map(_=>_.amount)}),{quote:{...e.quote,...w},change:C}}maybeConvertMeltBlanks(e){if(!("payload"in e))return e;this._logger.warn("MeltBlanks objects and the meltBlanksCreated / onChangeOutputsCreated events are deprecated. Please use wallet.prepareMelt() to create a MeltPreview instead.");const{method:t,payload:r,outputData:s,keyset:f,quote:d}=e;return{method:t,inputs:r.inputs,outputData:s,keysetId:f.id,quote:d}}async checkProofsStates(e){const t=new TextEncoder,r=e.map(d=>ur(t.encode(d.secret)).toHex(!0)),s=100,f=[];for(let d=0;d<r.length;d+=s){const g=r.slice(d,d+s),{states:y}=await this.mint.check({Ys:g}),w={};y.forEach(C=>{w[C.Y]=C});for(let C=0;C<g.length;C++){const _=w[g[C]];this.failIfNullish(_,"Could not find state for proof with Y: "+g[C]),f.push(_)}}return f}async groupProofsByState(e){const t=await this.checkProofsStates(e),r={unspent:[],pending:[],spent:[]};for(let s=0;s<t.length;s++){const f=e[s];switch(t[s].state){case ai.UNSPENT:r.unspent.push(f);break;case ai.PENDING:r.pending.push(f);break;case ai.SPENT:r.spent.push(f);break}}return r}}var gi={};(function i(e,t,r,s){var f=!!(e.Worker&&e.Blob&&e.Promise&&e.OffscreenCanvas&&e.OffscreenCanvasRenderingContext2D&&e.HTMLCanvasElement&&e.HTMLCanvasElement.prototype.transferControlToOffscreen&&e.URL&&e.URL.createObjectURL),d=typeof Path2D=="function"&&typeof DOMMatrix=="function",g=(function(){if(!e.OffscreenCanvas)return!1;try{var k=new OffscreenCanvas(1,1),b=k.getContext("2d");b.fillRect(0,0,1,1);var $=k.transferToImageBitmap();b.createPattern($,"no-repeat")}catch{return!1}return!0})();function y(){}function w(k){var b=t.exports.Promise,$=b!==void 0?b:e.Promise;return typeof $=="function"?new $(k):(k(y,y),null)}var C=(function(k,b){return{transform:function($){if(k)return $;if(b.has($))return b.get($);var G=new OffscreenCanvas($.width,$.height),ee=G.getContext("2d");return ee.drawImage($,0,0),b.set($,G),G},clear:function(){b.clear()}}})(g,new Map),_=(function(){var k=Math.floor(16.666666666666668),b,$,G={},ee=0;return typeof requestAnimationFrame=="function"&&typeof cancelAnimationFrame=="function"?(b=function(X){var ie=Math.random();return G[ie]=requestAnimationFrame(function te(le){ee===le||ee+k-1<le?(ee=le,delete G[ie],X()):G[ie]=requestAnimationFrame(te)}),ie},$=function(X){G[X]&&cancelAnimationFrame(G[X])}):(b=function(X){return setTimeout(X,k)},$=function(X){return clearTimeout(X)}),{frame:b,cancel:$}})(),A=(function(){var k,b,$={};function G(ee){function X(ie,te){ee.postMessage({options:ie||{},callback:te})}ee.init=function(te){var le=te.transferControlToOffscreen();ee.postMessage({canvas:le},[le])},ee.fire=function(te,le,fe){if(b)return X(te,null),b;var he=Math.random().toString(36).slice(2);return b=w(function(ke){function Ee(Oe){Oe.data.callback===he&&(delete $[he],ee.removeEventListener("message",Ee),b=null,C.clear(),fe(),ke())}ee.addEventListener("message",Ee),X(te,he),$[he]=Ee.bind(null,{data:{callback:he}})}),b},ee.reset=function(){ee.postMessage({reset:!0});for(var te in $)$[te](),delete $[te]}}return function(){if(k)return k;if(!r&&f){var ee=["var CONFETTI, SIZE = {}, module = {};","("+i.toString()+")(this, module, true, SIZE);","onmessage = function(msg) {","  if (msg.data.options) {","    CONFETTI(msg.data.options).then(function () {","      if (msg.data.callback) {","        postMessage({ callback: msg.data.callback });","      }","    });","  } else if (msg.data.reset) {","    CONFETTI && CONFETTI.reset();","  } else if (msg.data.resize) {","    SIZE.width = msg.data.resize.width;","    SIZE.height = msg.data.resize.height;","  } else if (msg.data.canvas) {","    SIZE.width = msg.data.canvas.width;","    SIZE.height = msg.data.canvas.height;","    CONFETTI = module.exports.create(msg.data.canvas);","  }","}"].join(`
`);try{k=new Worker(URL.createObjectURL(new Blob([ee])))}catch(X){return typeof console<"u"&&typeof console.warn=="function"&&console.warn("ðŸŽŠ Could not load worker",X),null}G(k)}return k}})(),I={particleCount:50,angle:90,spread:45,startVelocity:45,decay:.9,gravity:1,drift:0,ticks:200,x:.5,y:.5,shapes:["square","circle"],zIndex:100,colors:["#26ccff","#a25afd","#ff5e7e","#88ff5a","#fcff42","#ffa62d","#ff36ff"],disableForReducedMotion:!1,scalar:1};function S(k,b){return b?b(k):k}function R(k){return k!=null}function K(k,b,$){return S(k&&R(k[b])?k[b]:I[b],$)}function W(k){return k<0?0:Math.floor(k)}function de(k,b){return Math.floor(Math.random()*(b-k))+k}function ue(k){return parseInt(k,16)}function ce(k){return k.map(ve)}function ve(k){var b=String(k).replace(/[^0-9a-f]/gi,"");return b.length<6&&(b=b[0]+b[0]+b[1]+b[1]+b[2]+b[2]),{r:ue(b.substring(0,2)),g:ue(b.substring(2,4)),b:ue(b.substring(4,6))}}function Ae(k){var b=K(k,"origin",Object);return b.x=K(b,"x",Number),b.y=K(b,"y",Number),b}function u(k){k.width=document.documentElement.clientWidth,k.height=document.documentElement.clientHeight}function J(k){var b=k.getBoundingClientRect();k.width=b.width,k.height=b.height}function B(k){var b=document.createElement("canvas");return b.style.position="fixed",b.style.top="0px",b.style.left="0px",b.style.pointerEvents="none",b.style.zIndex=k,b}function L(k,b,$,G,ee,X,ie,te,le){k.save(),k.translate(b,$),k.rotate(X),k.scale(G,ee),k.arc(0,0,1,ie,te,le),k.restore()}function pe(k){var b=k.angle*(Math.PI/180),$=k.spread*(Math.PI/180);return{x:k.x,y:k.y,wobble:Math.random()*10,wobbleSpeed:Math.min(.11,Math.random()*.1+.05),velocity:k.startVelocity*.5+Math.random()*k.startVelocity,angle2D:-b+(.5*$-Math.random()*$),tiltAngle:(Math.random()*(.75-.25)+.25)*Math.PI,color:k.color,shape:k.shape,tick:0,totalTicks:k.ticks,decay:k.decay,drift:k.drift,random:Math.random()+2,tiltSin:0,tiltCos:0,wobbleX:0,wobbleY:0,gravity:k.gravity*3,ovalScalar:.6,scalar:k.scalar,flat:k.flat}}function oe(k,b){b.x+=Math.cos(b.angle2D)*b.velocity+b.drift,b.y+=Math.sin(b.angle2D)*b.velocity+b.gravity,b.velocity*=b.decay,b.flat?(b.wobble=0,b.wobbleX=b.x+10*b.scalar,b.wobbleY=b.y+10*b.scalar,b.tiltSin=0,b.tiltCos=0,b.random=1):(b.wobble+=b.wobbleSpeed,b.wobbleX=b.x+10*b.scalar*Math.cos(b.wobble),b.wobbleY=b.y+10*b.scalar*Math.sin(b.wobble),b.tiltAngle+=.1,b.tiltSin=Math.sin(b.tiltAngle),b.tiltCos=Math.cos(b.tiltAngle),b.random=Math.random()+2);var $=b.tick++/b.totalTicks,G=b.x+b.random*b.tiltCos,ee=b.y+b.random*b.tiltSin,X=b.wobbleX+b.random*b.tiltCos,ie=b.wobbleY+b.random*b.tiltSin;if(k.fillStyle="rgba("+b.color.r+", "+b.color.g+", "+b.color.b+", "+(1-$)+")",k.beginPath(),d&&b.shape.type==="path"&&typeof b.shape.path=="string"&&Array.isArray(b.shape.matrix))k.fill(D(b.shape.path,b.shape.matrix,b.x,b.y,Math.abs(X-G)*.1,Math.abs(ie-ee)*.1,Math.PI/10*b.wobble));else if(b.shape.type==="bitmap"){var te=Math.PI/10*b.wobble,le=Math.abs(X-G)*.1,fe=Math.abs(ie-ee)*.1,he=b.shape.bitmap.width*b.scalar,ke=b.shape.bitmap.height*b.scalar,Ee=new DOMMatrix([Math.cos(te)*le,Math.sin(te)*le,-Math.sin(te)*fe,Math.cos(te)*fe,b.x,b.y]);Ee.multiplySelf(new DOMMatrix(b.shape.matrix));var Oe=k.createPattern(C.transform(b.shape.bitmap),"no-repeat");Oe.setTransform(Ee),k.globalAlpha=1-$,k.fillStyle=Oe,k.fillRect(b.x-he/2,b.y-ke/2,he,ke),k.globalAlpha=1}else if(b.shape==="circle")k.ellipse?k.ellipse(b.x,b.y,Math.abs(X-G)*b.ovalScalar,Math.abs(ie-ee)*b.ovalScalar,Math.PI/10*b.wobble,0,2*Math.PI):L(k,b.x,b.y,Math.abs(X-G)*b.ovalScalar,Math.abs(ie-ee)*b.ovalScalar,Math.PI/10*b.wobble,0,2*Math.PI);else if(b.shape==="star")for(var Ce=Math.PI/2*3,Ke=4*b.scalar,$e=8*b.scalar,ye=b.x,Re=b.y,lt=5,Je=Math.PI/lt;lt--;)ye=b.x+Math.cos(Ce)*$e,Re=b.y+Math.sin(Ce)*$e,k.lineTo(ye,Re),Ce+=Je,ye=b.x+Math.cos(Ce)*Ke,Re=b.y+Math.sin(Ce)*Ke,k.lineTo(ye,Re),Ce+=Je;else k.moveTo(Math.floor(b.x),Math.floor(b.y)),k.lineTo(Math.floor(b.wobbleX),Math.floor(ee)),k.lineTo(Math.floor(X),Math.floor(ie)),k.lineTo(Math.floor(G),Math.floor(b.wobbleY));return k.closePath(),k.fill(),b.tick<b.totalTicks}function P(k,b,$,G,ee){var X=b.slice(),ie=k.getContext("2d"),te,le,fe=w(function(he){function ke(){te=le=null,ie.clearRect(0,0,G.width,G.height),C.clear(),ee(),he()}function Ee(){r&&!(G.width===s.width&&G.height===s.height)&&(G.width=k.width=s.width,G.height=k.height=s.height),!G.width&&!G.height&&($(k),G.width=k.width,G.height=k.height),ie.clearRect(0,0,G.width,G.height),X=X.filter(function(Oe){return oe(ie,Oe)}),X.length?te=_.frame(Ee):ke()}te=_.frame(Ee),le=ke});return{addFettis:function(he){return X=X.concat(he),fe},canvas:k,promise:fe,reset:function(){te&&_.cancel(te),le&&le()}}}function z(k,b){var $=!k,G=!!K(b||{},"resize"),ee=!1,X=K(b,"disableForReducedMotion",Boolean),ie=f&&!!K(b||{},"useWorker"),te=ie?A():null,le=$?u:J,fe=k&&te?!!k.__confetti_initialized:!1,he=typeof matchMedia=="function"&&matchMedia("(prefers-reduced-motion)").matches,ke;function Ee(Ce,Ke,$e){for(var ye=K(Ce,"particleCount",W),Re=K(Ce,"angle",Number),lt=K(Ce,"spread",Number),Je=K(Ce,"startVelocity",Number),bi=K(Ce,"decay",Number),it=K(Ce,"gravity",Number),Gt=K(Ce,"drift",Number),Rt=K(Ce,"colors",ce),ae=K(Ce,"ticks",Number),We=K(Ce,"shapes"),vi=K(Ce,"scalar"),xi=!!K(Ce,"flat"),hr=Ae(Ce),Dn=ye,pn=[],Zt=k.width*hr.x,ht=k.height*hr.y;Dn--;)pn.push(pe({x:Zt,y:ht,angle:Re,spread:lt,startVelocity:Je,color:Rt[Dn%Rt.length],shape:We[de(0,We.length)],ticks:ae,decay:bi,gravity:it,drift:Gt,scalar:vi,flat:xi}));return ke?ke.addFettis(pn):(ke=P(k,pn,le,Ke,$e),ke.promise)}function Oe(Ce){var Ke=X||K(Ce,"disableForReducedMotion",Boolean),$e=K(Ce,"zIndex",Number);if(Ke&&he)return w(function(Je){Je()});$&&ke?k=ke.canvas:$&&!k&&(k=B($e),document.body.appendChild(k)),G&&!fe&&le(k);var ye={width:k.width,height:k.height};te&&!fe&&te.init(k),fe=!0,te&&(k.__confetti_initialized=!0);function Re(){if(te){var Je={getBoundingClientRect:function(){if(!$)return k.getBoundingClientRect()}};le(Je),te.postMessage({resize:{width:Je.width,height:Je.height}});return}ye.width=ye.height=null}function lt(){ke=null,G&&(ee=!1,e.removeEventListener("resize",Re)),$&&k&&(document.body.contains(k)&&document.body.removeChild(k),k=null,fe=!1)}return G&&!ee&&(ee=!0,e.addEventListener("resize",Re,!1)),te?te.fire(Ce,ye,lt):Ee(Ce,ye,lt)}return Oe.reset=function(){te&&te.reset(),ke&&ke.reset()},Oe}var H;function Z(){return H||(H=z(null,{useWorker:!0,resize:!0})),H}function D(k,b,$,G,ee,X,ie){var te=new Path2D(k),le=new Path2D;le.addPath(te,new DOMMatrix(b));var fe=new Path2D;return fe.addPath(le,new DOMMatrix([Math.cos(ie)*ee,Math.sin(ie)*ee,-Math.sin(ie)*X,Math.cos(ie)*X,$,G])),fe}function F(k){if(!d)throw new Error("path confetti are not supported in this browser");var b,$;typeof k=="string"?b=k:(b=k.path,$=k.matrix);var G=new Path2D(b),ee=document.createElement("canvas"),X=ee.getContext("2d");if(!$){for(var ie=1e3,te=ie,le=ie,fe=0,he=0,ke,Ee,Oe=0;Oe<ie;Oe+=2)for(var Ce=0;Ce<ie;Ce+=2)X.isPointInPath(G,Oe,Ce,"nonzero")&&(te=Math.min(te,Oe),le=Math.min(le,Ce),fe=Math.max(fe,Oe),he=Math.max(he,Ce));ke=fe-te,Ee=he-le;var Ke=10,$e=Math.min(Ke/ke,Ke/Ee);$=[$e,0,0,$e,-Math.round(ke/2+te)*$e,-Math.round(Ee/2+le)*$e]}return{type:"path",path:b,matrix:$}}function V(k){var b,$=1,G="#000000",ee='"Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji", "EmojiOne Color", "Android Emoji", "Twemoji Mozilla", "system emoji", sans-serif';typeof k=="string"?b=k:(b=k.text,$="scalar"in k?k.scalar:$,ee="fontFamily"in k?k.fontFamily:ee,G="color"in k?k.color:G);var X=10*$,ie=""+X+"px "+ee,te=new OffscreenCanvas(X,X),le=te.getContext("2d");le.font=ie;var fe=le.measureText(b),he=Math.ceil(fe.actualBoundingBoxRight+fe.actualBoundingBoxLeft),ke=Math.ceil(fe.actualBoundingBoxAscent+fe.actualBoundingBoxDescent),Ee=2,Oe=fe.actualBoundingBoxLeft+Ee,Ce=fe.actualBoundingBoxAscent+Ee;he+=Ee+Ee,ke+=Ee+Ee,te=new OffscreenCanvas(he,ke),le=te.getContext("2d"),le.font=ie,le.fillStyle=G,le.fillText(b,Oe,Ce);var Ke=1/$;return{type:"bitmap",bitmap:te.transferToImageBitmap(),matrix:[Ke,0,0,Ke,-he*Ke/2,-ke*Ke/2]}}t.exports=function(){return Z().apply(this,arguments)},t.exports.reset=function(){Z().reset()},t.exports.create=z,t.exports.shapeFromPath=F,t.exports.shapeFromText=V})((function(){return typeof window<"u"?window:typeof self<"u"?self:this||{}})(),gi,!1);const yi=gi.exports;gi.exports.create;function Xc(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var mi={exports:{}},fr={exports:{}};var Yc=fr.exports,vs;function Jc(){return vs||(vs=1,(function(i){(function(e,t){i.exports=e.document?t(e,!0):function(r){if(!r.document)throw new Error("jQuery requires a window with a document");return t(r)}})(typeof window<"u"?window:Yc,function(e,t){var r=[],s=Object.getPrototypeOf,f=r.slice,d=r.flat?function(n){return r.flat.call(n)}:function(n){return r.concat.apply([],n)},g=r.push,y=r.indexOf,w={},C=w.toString,_=w.hasOwnProperty,A=_.toString,I=A.call(Object),S={},R=function(o){return typeof o=="function"&&typeof o.nodeType!="number"&&typeof o.item!="function"},K=function(o){return o!=null&&o===o.window},W=e.document,de={type:!0,src:!0,nonce:!0,noModule:!0};function ue(n,o,a){a=a||W;var c,l,h=a.createElement("script");if(h.text=n,o)for(c in de)l=o[c]||o.getAttribute&&o.getAttribute(c),l&&h.setAttribute(c,l);a.head.appendChild(h).parentNode.removeChild(h)}function ce(n){return n==null?n+"":typeof n=="object"||typeof n=="function"?w[C.call(n)]||"object":typeof n}var ve="3.7.1",Ae=/HTML$/i,u=function(n,o){return new u.fn.init(n,o)};u.fn=u.prototype={jquery:ve,constructor:u,length:0,toArray:function(){return f.call(this)},get:function(n){return n==null?f.call(this):n<0?this[n+this.length]:this[n]},pushStack:function(n){var o=u.merge(this.constructor(),n);return o.prevObject=this,o},each:function(n){return u.each(this,n)},map:function(n){return this.pushStack(u.map(this,function(o,a){return n.call(o,a,o)}))},slice:function(){return this.pushStack(f.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(u.grep(this,function(n,o){return(o+1)%2}))},odd:function(){return this.pushStack(u.grep(this,function(n,o){return o%2}))},eq:function(n){var o=this.length,a=+n+(n<0?o:0);return this.pushStack(a>=0&&a<o?[this[a]]:[])},end:function(){return this.prevObject||this.constructor()},push:g,sort:r.sort,splice:r.splice},u.extend=u.fn.extend=function(){var n,o,a,c,l,h,p=arguments[0]||{},x=1,v=arguments.length,T=!1;for(typeof p=="boolean"&&(T=p,p=arguments[x]||{},x++),typeof p!="object"&&!R(p)&&(p={}),x===v&&(p=this,x--);x<v;x++)if((n=arguments[x])!=null)for(o in n)c=n[o],!(o==="__proto__"||p===c)&&(T&&c&&(u.isPlainObject(c)||(l=Array.isArray(c)))?(a=p[o],l&&!Array.isArray(a)?h=[]:!l&&!u.isPlainObject(a)?h={}:h=a,l=!1,p[o]=u.extend(T,h,c)):c!==void 0&&(p[o]=c));return p},u.extend({expando:"jQuery"+(ve+Math.random()).replace(/\D/g,""),isReady:!0,error:function(n){throw new Error(n)},noop:function(){},isPlainObject:function(n){var o,a;return!n||C.call(n)!=="[object Object]"?!1:(o=s(n),o?(a=_.call(o,"constructor")&&o.constructor,typeof a=="function"&&A.call(a)===I):!0)},isEmptyObject:function(n){var o;for(o in n)return!1;return!0},globalEval:function(n,o,a){ue(n,{nonce:o&&o.nonce},a)},each:function(n,o){var a,c=0;if(J(n))for(a=n.length;c<a&&o.call(n[c],c,n[c])!==!1;c++);else for(c in n)if(o.call(n[c],c,n[c])===!1)break;return n},text:function(n){var o,a="",c=0,l=n.nodeType;if(!l)for(;o=n[c++];)a+=u.text(o);return l===1||l===11?n.textContent:l===9?n.documentElement.textContent:l===3||l===4?n.nodeValue:a},makeArray:function(n,o){var a=o||[];return n!=null&&(J(Object(n))?u.merge(a,typeof n=="string"?[n]:n):g.call(a,n)),a},inArray:function(n,o,a){return o==null?-1:y.call(o,n,a)},isXMLDoc:function(n){var o=n&&n.namespaceURI,a=n&&(n.ownerDocument||n).documentElement;return!Ae.test(o||a&&a.nodeName||"HTML")},merge:function(n,o){for(var a=+o.length,c=0,l=n.length;c<a;c++)n[l++]=o[c];return n.length=l,n},grep:function(n,o,a){for(var c,l=[],h=0,p=n.length,x=!a;h<p;h++)c=!o(n[h],h),c!==x&&l.push(n[h]);return l},map:function(n,o,a){var c,l,h=0,p=[];if(J(n))for(c=n.length;h<c;h++)l=o(n[h],h,a),l!=null&&p.push(l);else for(h in n)l=o(n[h],h,a),l!=null&&p.push(l);return d(p)},guid:1,support:S}),typeof Symbol=="function"&&(u.fn[Symbol.iterator]=r[Symbol.iterator]),u.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(n,o){w["[object "+o+"]"]=o.toLowerCase()});function J(n){var o=!!n&&"length"in n&&n.length,a=ce(n);return R(n)||K(n)?!1:a==="array"||o===0||typeof o=="number"&&o>0&&o-1 in n}function B(n,o){return n.nodeName&&n.nodeName.toLowerCase()===o.toLowerCase()}var L=r.pop,pe=r.sort,oe=r.splice,P="[\\x20\\t\\r\\n\\f]",z=new RegExp("^"+P+"+|((?:^|[^\\\\])(?:\\\\.)*)"+P+"+$","g");u.contains=function(n,o){var a=o&&o.parentNode;return n===a||!!(a&&a.nodeType===1&&(n.contains?n.contains(a):n.compareDocumentPosition&&n.compareDocumentPosition(a)&16))};var H=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\x80-\uFFFF\w-]/g;function Z(n,o){return o?n==="\0"?"ï¿½":n.slice(0,-1)+"\\"+n.charCodeAt(n.length-1).toString(16)+" ":"\\"+n}u.escapeSelector=function(n){return(n+"").replace(H,Z)};var D=W,F=g;(function(){var n,o,a,c,l,h=F,p,x,v,T,q,j=u.expando,O=0,Q=0,we=wr(),Ie=wr(),xe=wr(),ze=wr(),Fe=function(m,E){return m===E&&(l=!0),0},bt="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",vt="(?:\\\\[\\da-fA-F]{1,6}"+P+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",Se="\\["+P+"*("+vt+")(?:"+P+"*([*^$|!~]?=)"+P+`*(?:'((?:\\\\.|[^\\\\'])*)'|"((?:\\\\.|[^\\\\"])*)"|(`+vt+"))|)"+P+"*\\]",en=":("+vt+`)(?:\\((('((?:\\\\.|[^\\\\'])*)'|"((?:\\\\.|[^\\\\"])*)")|((?:\\\\.|[^\\\\()[\\]]|`+Se+")*)|.*)\\)|)",Me=new RegExp(P+"+","g"),Ue=new RegExp("^"+P+"*,"+P+"*"),Un=new RegExp("^"+P+"*([>+~]|"+P+")"+P+"*"),qi=new RegExp(P+"|>"),xt=new RegExp(en),Fn=new RegExp("^"+vt+"$"),kt={ID:new RegExp("^#("+vt+")"),CLASS:new RegExp("^\\.("+vt+")"),TAG:new RegExp("^("+vt+"|[*])"),ATTR:new RegExp("^"+Se),PSEUDO:new RegExp("^"+en),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+P+"*(even|odd|(([+-]|)(\\d*)n|)"+P+"*(?:([+-]|)"+P+"*(\\d+)|))"+P+"*\\)|)","i"),bool:new RegExp("^(?:"+bt+")$","i"),needsContext:new RegExp("^"+P+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+P+"*((?:-\\d)?\\d*)"+P+"*\\)|)(?=[^-]|$)","i")},Ht=/^(?:input|select|textarea|button)$/i,Ut=/^h\d$/i,st=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,Li=/[+~]/,St=new RegExp("\\\\[\\da-fA-F]{1,6}"+P+"?|\\\\([^\\r\\n\\f])","g"),At=function(m,E){var M="0x"+m.slice(1)-65536;return E||(M<0?String.fromCharCode(M+65536):String.fromCharCode(M>>10|55296,M&1023|56320))},Kf=function(){Ft()},$f=vr(function(m){return m.disabled===!0&&B(m,"fieldset")},{dir:"parentNode",next:"legend"});function Wf(){try{return p.activeElement}catch{}}try{h.apply(r=f.call(D.childNodes),D.childNodes),r[D.childNodes.length].nodeType}catch{h={apply:function(E,M){F.apply(E,f.call(M))},call:function(E){F.apply(E,f.call(arguments,1))}}}function De(m,E,M,N){var U,Y,ne,se,re,Te,me,be=E&&E.ownerDocument,_e=E?E.nodeType:9;if(M=M||[],typeof m!="string"||!m||_e!==1&&_e!==9&&_e!==11)return M;if(!N&&(Ft(E),E=E||p,v)){if(_e!==11&&(re=st.exec(m)))if(U=re[1]){if(_e===9)if(ne=E.getElementById(U)){if(ne.id===U)return h.call(M,ne),M}else return M;else if(be&&(ne=be.getElementById(U))&&De.contains(E,ne)&&ne.id===U)return h.call(M,ne),M}else{if(re[2])return h.apply(M,E.getElementsByTagName(m)),M;if((U=re[3])&&E.getElementsByClassName)return h.apply(M,E.getElementsByClassName(U)),M}if(!ze[m+" "]&&(!T||!T.test(m))){if(me=m,be=E,_e===1&&(qi.test(m)||Un.test(m))){for(be=Li.test(m)&&Ri(E.parentNode)||E,(be!=E||!S.scope)&&((se=E.getAttribute("id"))?se=u.escapeSelector(se):E.setAttribute("id",se=j)),Te=jn(m),Y=Te.length;Y--;)Te[Y]=(se?"#"+se:":scope")+" "+br(Te[Y]);me=Te.join(",")}try{return h.apply(M,be.querySelectorAll(me)),M}catch{ze(m,!0)}finally{se===j&&E.removeAttribute("id")}}}return ra(m.replace(z,"$1"),E,M,N)}function wr(){var m=[];function E(M,N){return m.push(M+" ")>o.cacheLength&&delete E[m.shift()],E[M+" "]=N}return E}function pt(m){return m[j]=!0,m}function xn(m){var E=p.createElement("fieldset");try{return!!m(E)}catch{return!1}finally{E.parentNode&&E.parentNode.removeChild(E),E=null}}function zf(m){return function(E){return B(E,"input")&&E.type===m}}function Vf(m){return function(E){return(B(E,"input")||B(E,"button"))&&E.type===m}}function ta(m){return function(E){return"form"in E?E.parentNode&&E.disabled===!1?"label"in E?"label"in E.parentNode?E.parentNode.disabled===m:E.disabled===m:E.isDisabled===m||E.isDisabled!==!m&&$f(E)===m:E.disabled===m:"label"in E?E.disabled===m:!1}}function tn(m){return pt(function(E){return E=+E,pt(function(M,N){for(var U,Y=m([],M.length,E),ne=Y.length;ne--;)M[U=Y[ne]]&&(M[U]=!(N[U]=M[U]))})})}function Ri(m){return m&&typeof m.getElementsByTagName<"u"&&m}function Ft(m){var E,M=m?m.ownerDocument||m:D;return M==p||M.nodeType!==9||!M.documentElement||(p=M,x=p.documentElement,v=!u.isXMLDoc(p),q=x.matches||x.webkitMatchesSelector||x.msMatchesSelector,x.msMatchesSelector&&D!=p&&(E=p.defaultView)&&E.top!==E&&E.addEventListener("unload",Kf),S.getById=xn(function(N){return x.appendChild(N).id=u.expando,!p.getElementsByName||!p.getElementsByName(u.expando).length}),S.disconnectedMatch=xn(function(N){return q.call(N,"*")}),S.scope=xn(function(){return p.querySelectorAll(":scope")}),S.cssHas=xn(function(){try{return p.querySelector(":has(*,:jqfake)"),!1}catch{return!0}}),S.getById?(o.filter.ID=function(N){var U=N.replace(St,At);return function(Y){return Y.getAttribute("id")===U}},o.find.ID=function(N,U){if(typeof U.getElementById<"u"&&v){var Y=U.getElementById(N);return Y?[Y]:[]}}):(o.filter.ID=function(N){var U=N.replace(St,At);return function(Y){var ne=typeof Y.getAttributeNode<"u"&&Y.getAttributeNode("id");return ne&&ne.value===U}},o.find.ID=function(N,U){if(typeof U.getElementById<"u"&&v){var Y,ne,se,re=U.getElementById(N);if(re){if(Y=re.getAttributeNode("id"),Y&&Y.value===N)return[re];for(se=U.getElementsByName(N),ne=0;re=se[ne++];)if(Y=re.getAttributeNode("id"),Y&&Y.value===N)return[re]}return[]}}),o.find.TAG=function(N,U){return typeof U.getElementsByTagName<"u"?U.getElementsByTagName(N):U.querySelectorAll(N)},o.find.CLASS=function(N,U){if(typeof U.getElementsByClassName<"u"&&v)return U.getElementsByClassName(N)},T=[],xn(function(N){var U;x.appendChild(N).innerHTML="<a id='"+j+"' href='' disabled='disabled'></a><select id='"+j+"-\r\\' disabled='disabled'><option selected=''></option></select>",N.querySelectorAll("[selected]").length||T.push("\\["+P+"*(?:value|"+bt+")"),N.querySelectorAll("[id~="+j+"-]").length||T.push("~="),N.querySelectorAll("a#"+j+"+*").length||T.push(".#.+[+~]"),N.querySelectorAll(":checked").length||T.push(":checked"),U=p.createElement("input"),U.setAttribute("type","hidden"),N.appendChild(U).setAttribute("name","D"),x.appendChild(N).disabled=!0,N.querySelectorAll(":disabled").length!==2&&T.push(":enabled",":disabled"),U=p.createElement("input"),U.setAttribute("name",""),N.appendChild(U),N.querySelectorAll("[name='']").length||T.push("\\["+P+"*name"+P+"*="+P+`*(?:''|"")`)}),S.cssHas||T.push(":has"),T=T.length&&new RegExp(T.join("|")),Fe=function(N,U){if(N===U)return l=!0,0;var Y=!N.compareDocumentPosition-!U.compareDocumentPosition;return Y||(Y=(N.ownerDocument||N)==(U.ownerDocument||U)?N.compareDocumentPosition(U):1,Y&1||!S.sortDetached&&U.compareDocumentPosition(N)===Y?N===p||N.ownerDocument==D&&De.contains(D,N)?-1:U===p||U.ownerDocument==D&&De.contains(D,U)?1:c?y.call(c,N)-y.call(c,U):0:Y&4?-1:1)}),p}De.matches=function(m,E){return De(m,null,null,E)},De.matchesSelector=function(m,E){if(Ft(m),v&&!ze[E+" "]&&(!T||!T.test(E)))try{var M=q.call(m,E);if(M||S.disconnectedMatch||m.document&&m.document.nodeType!==11)return M}catch{ze(E,!0)}return De(E,p,null,[m]).length>0},De.contains=function(m,E){return(m.ownerDocument||m)!=p&&Ft(m),u.contains(m,E)},De.attr=function(m,E){(m.ownerDocument||m)!=p&&Ft(m);var M=o.attrHandle[E.toLowerCase()],N=M&&_.call(o.attrHandle,E.toLowerCase())?M(m,E,!v):void 0;return N!==void 0?N:m.getAttribute(E)},De.error=function(m){throw new Error("Syntax error, unrecognized expression: "+m)},u.uniqueSort=function(m){var E,M=[],N=0,U=0;if(l=!S.sortStable,c=!S.sortStable&&f.call(m,0),pe.call(m,Fe),l){for(;E=m[U++];)E===m[U]&&(N=M.push(U));for(;N--;)oe.call(m,M[N],1)}return c=null,m},u.fn.uniqueSort=function(){return this.pushStack(u.uniqueSort(f.apply(this)))},o=u.expr={cacheLength:50,createPseudo:pt,match:kt,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(m){return m[1]=m[1].replace(St,At),m[3]=(m[3]||m[4]||m[5]||"").replace(St,At),m[2]==="~="&&(m[3]=" "+m[3]+" "),m.slice(0,4)},CHILD:function(m){return m[1]=m[1].toLowerCase(),m[1].slice(0,3)==="nth"?(m[3]||De.error(m[0]),m[4]=+(m[4]?m[5]+(m[6]||1):2*(m[3]==="even"||m[3]==="odd")),m[5]=+(m[7]+m[8]||m[3]==="odd")):m[3]&&De.error(m[0]),m},PSEUDO:function(m){var E,M=!m[6]&&m[2];return kt.CHILD.test(m[0])?null:(m[3]?m[2]=m[4]||m[5]||"":M&&xt.test(M)&&(E=jn(M,!0))&&(E=M.indexOf(")",M.length-E)-M.length)&&(m[0]=m[0].slice(0,E),m[2]=M.slice(0,E)),m.slice(0,3))}},filter:{TAG:function(m){var E=m.replace(St,At).toLowerCase();return m==="*"?function(){return!0}:function(M){return B(M,E)}},CLASS:function(m){var E=we[m+" "];return E||(E=new RegExp("(^|"+P+")"+m+"("+P+"|$)"))&&we(m,function(M){return E.test(typeof M.className=="string"&&M.className||typeof M.getAttribute<"u"&&M.getAttribute("class")||"")})},ATTR:function(m,E,M){return function(N){var U=De.attr(N,m);return U==null?E==="!=":E?(U+="",E==="="?U===M:E==="!="?U!==M:E==="^="?M&&U.indexOf(M)===0:E==="*="?M&&U.indexOf(M)>-1:E==="$="?M&&U.slice(-M.length)===M:E==="~="?(" "+U.replace(Me," ")+" ").indexOf(M)>-1:E==="|="?U===M||U.slice(0,M.length+1)===M+"-":!1):!0}},CHILD:function(m,E,M,N,U){var Y=m.slice(0,3)!=="nth",ne=m.slice(-4)!=="last",se=E==="of-type";return N===1&&U===0?function(re){return!!re.parentNode}:function(re,Te,me){var be,_e,ge,Le,nt,Qe=Y!==ne?"nextSibling":"previousSibling",at=re.parentNode,Et=se&&re.nodeName.toLowerCase(),kn=!me&&!se,Ze=!1;if(at){if(Y){for(;Qe;){for(ge=re;ge=ge[Qe];)if(se?B(ge,Et):ge.nodeType===1)return!1;nt=Qe=m==="only"&&!nt&&"nextSibling"}return!0}if(nt=[ne?at.firstChild:at.lastChild],ne&&kn){for(_e=at[j]||(at[j]={}),be=_e[m]||[],Le=be[0]===O&&be[1],Ze=Le&&be[2],ge=Le&&at.childNodes[Le];ge=++Le&&ge&&ge[Qe]||(Ze=Le=0)||nt.pop();)if(ge.nodeType===1&&++Ze&&ge===re){_e[m]=[O,Le,Ze];break}}else if(kn&&(_e=re[j]||(re[j]={}),be=_e[m]||[],Le=be[0]===O&&be[1],Ze=Le),Ze===!1)for(;(ge=++Le&&ge&&ge[Qe]||(Ze=Le=0)||nt.pop())&&!((se?B(ge,Et):ge.nodeType===1)&&++Ze&&(kn&&(_e=ge[j]||(ge[j]={}),_e[m]=[O,Ze]),ge===re)););return Ze-=U,Ze===N||Ze%N===0&&Ze/N>=0}}},PSEUDO:function(m,E){var M,N=o.pseudos[m]||o.setFilters[m.toLowerCase()]||De.error("unsupported pseudo: "+m);return N[j]?N(E):N.length>1?(M=[m,m,"",E],o.setFilters.hasOwnProperty(m.toLowerCase())?pt(function(U,Y){for(var ne,se=N(U,E),re=se.length;re--;)ne=y.call(U,se[re]),U[ne]=!(Y[ne]=se[re])}):function(U){return N(U,0,M)}):N}},pseudos:{not:pt(function(m){var E=[],M=[],N=ji(m.replace(z,"$1"));return N[j]?pt(function(U,Y,ne,se){for(var re,Te=N(U,null,se,[]),me=U.length;me--;)(re=Te[me])&&(U[me]=!(Y[me]=re))}):function(U,Y,ne){return E[0]=U,N(E,null,ne,M),E[0]=null,!M.pop()}}),has:pt(function(m){return function(E){return De(m,E).length>0}}),contains:pt(function(m){return m=m.replace(St,At),function(E){return(E.textContent||u.text(E)).indexOf(m)>-1}}),lang:pt(function(m){return Fn.test(m||"")||De.error("unsupported lang: "+m),m=m.replace(St,At).toLowerCase(),function(E){var M;do if(M=v?E.lang:E.getAttribute("xml:lang")||E.getAttribute("lang"))return M=M.toLowerCase(),M===m||M.indexOf(m+"-")===0;while((E=E.parentNode)&&E.nodeType===1);return!1}}),target:function(m){var E=e.location&&e.location.hash;return E&&E.slice(1)===m.id},root:function(m){return m===x},focus:function(m){return m===Wf()&&p.hasFocus()&&!!(m.type||m.href||~m.tabIndex)},enabled:ta(!1),disabled:ta(!0),checked:function(m){return B(m,"input")&&!!m.checked||B(m,"option")&&!!m.selected},selected:function(m){return m.parentNode&&m.parentNode.selectedIndex,m.selected===!0},empty:function(m){for(m=m.firstChild;m;m=m.nextSibling)if(m.nodeType<6)return!1;return!0},parent:function(m){return!o.pseudos.empty(m)},header:function(m){return Ut.test(m.nodeName)},input:function(m){return Ht.test(m.nodeName)},button:function(m){return B(m,"input")&&m.type==="button"||B(m,"button")},text:function(m){var E;return B(m,"input")&&m.type==="text"&&((E=m.getAttribute("type"))==null||E.toLowerCase()==="text")},first:tn(function(){return[0]}),last:tn(function(m,E){return[E-1]}),eq:tn(function(m,E,M){return[M<0?M+E:M]}),even:tn(function(m,E){for(var M=0;M<E;M+=2)m.push(M);return m}),odd:tn(function(m,E){for(var M=1;M<E;M+=2)m.push(M);return m}),lt:tn(function(m,E,M){var N;for(M<0?N=M+E:M>E?N=E:N=M;--N>=0;)m.push(N);return m}),gt:tn(function(m,E,M){for(var N=M<0?M+E:M;++N<E;)m.push(N);return m})}},o.pseudos.nth=o.pseudos.eq;for(n in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})o.pseudos[n]=zf(n);for(n in{submit:!0,reset:!0})o.pseudos[n]=Vf(n);function na(){}na.prototype=o.filters=o.pseudos,o.setFilters=new na;function jn(m,E){var M,N,U,Y,ne,se,re,Te=Ie[m+" "];if(Te)return E?0:Te.slice(0);for(ne=m,se=[],re=o.preFilter;ne;){(!M||(N=Ue.exec(ne)))&&(N&&(ne=ne.slice(N[0].length)||ne),se.push(U=[])),M=!1,(N=Un.exec(ne))&&(M=N.shift(),U.push({value:M,type:N[0].replace(z," ")}),ne=ne.slice(M.length));for(Y in o.filter)(N=kt[Y].exec(ne))&&(!re[Y]||(N=re[Y](N)))&&(M=N.shift(),U.push({value:M,type:Y,matches:N}),ne=ne.slice(M.length));if(!M)break}return E?ne.length:ne?De.error(m):Ie(m,se).slice(0)}function br(m){for(var E=0,M=m.length,N="";E<M;E++)N+=m[E].value;return N}function vr(m,E,M){var N=E.dir,U=E.next,Y=U||N,ne=M&&Y==="parentNode",se=Q++;return E.first?function(re,Te,me){for(;re=re[N];)if(re.nodeType===1||ne)return m(re,Te,me);return!1}:function(re,Te,me){var be,_e,ge=[O,se];if(me){for(;re=re[N];)if((re.nodeType===1||ne)&&m(re,Te,me))return!0}else for(;re=re[N];)if(re.nodeType===1||ne)if(_e=re[j]||(re[j]={}),U&&B(re,U))re=re[N]||re;else{if((be=_e[Y])&&be[0]===O&&be[1]===se)return ge[2]=be[2];if(_e[Y]=ge,ge[2]=m(re,Te,me))return!0}return!1}}function Hi(m){return m.length>1?function(E,M,N){for(var U=m.length;U--;)if(!m[U](E,M,N))return!1;return!0}:m[0]}function Qf(m,E,M){for(var N=0,U=E.length;N<U;N++)De(m,E[N],M);return M}function xr(m,E,M,N,U){for(var Y,ne=[],se=0,re=m.length,Te=E!=null;se<re;se++)(Y=m[se])&&(!M||M(Y,N,U))&&(ne.push(Y),Te&&E.push(se));return ne}function Ui(m,E,M,N,U,Y){return N&&!N[j]&&(N=Ui(N)),U&&!U[j]&&(U=Ui(U,Y)),pt(function(ne,se,re,Te){var me,be,_e,ge,Le=[],nt=[],Qe=se.length,at=ne||Qf(E||"*",re.nodeType?[re]:re,[]),Et=m&&(ne||!E)?xr(at,Le,m,re,Te):at;if(M?(ge=U||(ne?m:Qe||N)?[]:se,M(Et,ge,re,Te)):ge=Et,N)for(me=xr(ge,nt),N(me,[],re,Te),be=me.length;be--;)(_e=me[be])&&(ge[nt[be]]=!(Et[nt[be]]=_e));if(ne){if(U||m){if(U){for(me=[],be=ge.length;be--;)(_e=ge[be])&&me.push(Et[be]=_e);U(null,ge=[],me,Te)}for(be=ge.length;be--;)(_e=ge[be])&&(me=U?y.call(ne,_e):Le[be])>-1&&(ne[me]=!(se[me]=_e))}}else ge=xr(ge===se?ge.splice(Qe,ge.length):ge),U?U(null,se,ge,Te):h.apply(se,ge)})}function Fi(m){for(var E,M,N,U=m.length,Y=o.relative[m[0].type],ne=Y||o.relative[" "],se=Y?1:0,re=vr(function(be){return be===E},ne,!0),Te=vr(function(be){return y.call(E,be)>-1},ne,!0),me=[function(be,_e,ge){var Le=!Y&&(ge||_e!=a)||((E=_e).nodeType?re(be,_e,ge):Te(be,_e,ge));return E=null,Le}];se<U;se++)if(M=o.relative[m[se].type])me=[vr(Hi(me),M)];else{if(M=o.filter[m[se].type].apply(null,m[se].matches),M[j]){for(N=++se;N<U&&!o.relative[m[N].type];N++);return Ui(se>1&&Hi(me),se>1&&br(m.slice(0,se-1).concat({value:m[se-2].type===" "?"*":""})).replace(z,"$1"),M,se<N&&Fi(m.slice(se,N)),N<U&&Fi(m=m.slice(N)),N<U&&br(m))}me.push(M)}return Hi(me)}function Gf(m,E){var M=E.length>0,N=m.length>0,U=function(Y,ne,se,re,Te){var me,be,_e,ge=0,Le="0",nt=Y&&[],Qe=[],at=a,Et=Y||N&&o.find.TAG("*",Te),kn=O+=at==null?1:Math.random()||.1,Ze=Et.length;for(Te&&(a=ne==p||ne||Te);Le!==Ze&&(me=Et[Le])!=null;Le++){if(N&&me){for(be=0,!ne&&me.ownerDocument!=p&&(Ft(me),se=!v);_e=m[be++];)if(_e(me,ne||p,se)){h.call(re,me);break}Te&&(O=kn)}M&&((me=!_e&&me)&&ge--,Y&&nt.push(me))}if(ge+=Le,M&&Le!==ge){for(be=0;_e=E[be++];)_e(nt,Qe,ne,se);if(Y){if(ge>0)for(;Le--;)nt[Le]||Qe[Le]||(Qe[Le]=L.call(re));Qe=xr(Qe)}h.apply(re,Qe),Te&&!Y&&Qe.length>0&&ge+E.length>1&&u.uniqueSort(re)}return Te&&(O=kn,a=at),nt};return M?pt(U):U}function ji(m,E){var M,N=[],U=[],Y=xe[m+" "];if(!Y){for(E||(E=jn(m)),M=E.length;M--;)Y=Fi(E[M]),Y[j]?N.push(Y):U.push(Y);Y=xe(m,Gf(U,N)),Y.selector=m}return Y}function ra(m,E,M,N){var U,Y,ne,se,re,Te=typeof m=="function"&&m,me=!N&&jn(m=Te.selector||m);if(M=M||[],me.length===1){if(Y=me[0]=me[0].slice(0),Y.length>2&&(ne=Y[0]).type==="ID"&&E.nodeType===9&&v&&o.relative[Y[1].type]){if(E=(o.find.ID(ne.matches[0].replace(St,At),E)||[])[0],E)Te&&(E=E.parentNode);else return M;m=m.slice(Y.shift().value.length)}for(U=kt.needsContext.test(m)?0:Y.length;U--&&(ne=Y[U],!o.relative[se=ne.type]);)if((re=o.find[se])&&(N=re(ne.matches[0].replace(St,At),Li.test(Y[0].type)&&Ri(E.parentNode)||E))){if(Y.splice(U,1),m=N.length&&br(Y),!m)return h.apply(M,N),M;break}}return(Te||ji(m,me))(N,E,!v,M,!E||Li.test(m)&&Ri(E.parentNode)||E),M}S.sortStable=j.split("").sort(Fe).join("")===j,Ft(),S.sortDetached=xn(function(m){return m.compareDocumentPosition(p.createElement("fieldset"))&1}),u.find=De,u.expr[":"]=u.expr.pseudos,u.unique=u.uniqueSort,De.compile=ji,De.select=ra,De.setDocument=Ft,De.tokenize=jn,De.escape=u.escapeSelector,De.getText=u.text,De.isXML=u.isXMLDoc,De.selectors=u.expr,De.support=u.support,De.uniqueSort=u.uniqueSort})();var V=function(n,o,a){for(var c=[],l=a!==void 0;(n=n[o])&&n.nodeType!==9;)if(n.nodeType===1){if(l&&u(n).is(a))break;c.push(n)}return c},k=function(n,o){for(var a=[];n;n=n.nextSibling)n.nodeType===1&&n!==o&&a.push(n);return a},b=u.expr.match.needsContext,$=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function G(n,o,a){return R(o)?u.grep(n,function(c,l){return!!o.call(c,l,c)!==a}):o.nodeType?u.grep(n,function(c){return c===o!==a}):typeof o!="string"?u.grep(n,function(c){return y.call(o,c)>-1!==a}):u.filter(o,n,a)}u.filter=function(n,o,a){var c=o[0];return a&&(n=":not("+n+")"),o.length===1&&c.nodeType===1?u.find.matchesSelector(c,n)?[c]:[]:u.find.matches(n,u.grep(o,function(l){return l.nodeType===1}))},u.fn.extend({find:function(n){var o,a,c=this.length,l=this;if(typeof n!="string")return this.pushStack(u(n).filter(function(){for(o=0;o<c;o++)if(u.contains(l[o],this))return!0}));for(a=this.pushStack([]),o=0;o<c;o++)u.find(n,l[o],a);return c>1?u.uniqueSort(a):a},filter:function(n){return this.pushStack(G(this,n||[],!1))},not:function(n){return this.pushStack(G(this,n||[],!0))},is:function(n){return!!G(this,typeof n=="string"&&b.test(n)?u(n):n||[],!1).length}});var ee,X=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/,ie=u.fn.init=function(n,o,a){var c,l;if(!n)return this;if(a=a||ee,typeof n=="string")if(n[0]==="<"&&n[n.length-1]===">"&&n.length>=3?c=[null,n,null]:c=X.exec(n),c&&(c[1]||!o))if(c[1]){if(o=o instanceof u?o[0]:o,u.merge(this,u.parseHTML(c[1],o&&o.nodeType?o.ownerDocument||o:W,!0)),$.test(c[1])&&u.isPlainObject(o))for(c in o)R(this[c])?this[c](o[c]):this.attr(c,o[c]);return this}else return l=W.getElementById(c[2]),l&&(this[0]=l,this.length=1),this;else return!o||o.jquery?(o||a).find(n):this.constructor(o).find(n);else{if(n.nodeType)return this[0]=n,this.length=1,this;if(R(n))return a.ready!==void 0?a.ready(n):n(u)}return u.makeArray(n,this)};ie.prototype=u.fn,ee=u(W);var te=/^(?:parents|prev(?:Until|All))/,le={children:!0,contents:!0,next:!0,prev:!0};u.fn.extend({has:function(n){var o=u(n,this),a=o.length;return this.filter(function(){for(var c=0;c<a;c++)if(u.contains(this,o[c]))return!0})},closest:function(n,o){var a,c=0,l=this.length,h=[],p=typeof n!="string"&&u(n);if(!b.test(n)){for(;c<l;c++)for(a=this[c];a&&a!==o;a=a.parentNode)if(a.nodeType<11&&(p?p.index(a)>-1:a.nodeType===1&&u.find.matchesSelector(a,n))){h.push(a);break}}return this.pushStack(h.length>1?u.uniqueSort(h):h)},index:function(n){return n?typeof n=="string"?y.call(u(n),this[0]):y.call(this,n.jquery?n[0]:n):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(n,o){return this.pushStack(u.uniqueSort(u.merge(this.get(),u(n,o))))},addBack:function(n){return this.add(n==null?this.prevObject:this.prevObject.filter(n))}});function fe(n,o){for(;(n=n[o])&&n.nodeType!==1;);return n}u.each({parent:function(n){var o=n.parentNode;return o&&o.nodeType!==11?o:null},parents:function(n){return V(n,"parentNode")},parentsUntil:function(n,o,a){return V(n,"parentNode",a)},next:function(n){return fe(n,"nextSibling")},prev:function(n){return fe(n,"previousSibling")},nextAll:function(n){return V(n,"nextSibling")},prevAll:function(n){return V(n,"previousSibling")},nextUntil:function(n,o,a){return V(n,"nextSibling",a)},prevUntil:function(n,o,a){return V(n,"previousSibling",a)},siblings:function(n){return k((n.parentNode||{}).firstChild,n)},children:function(n){return k(n.firstChild)},contents:function(n){return n.contentDocument!=null&&s(n.contentDocument)?n.contentDocument:(B(n,"template")&&(n=n.content||n),u.merge([],n.childNodes))}},function(n,o){u.fn[n]=function(a,c){var l=u.map(this,o,a);return n.slice(-5)!=="Until"&&(c=a),c&&typeof c=="string"&&(l=u.filter(c,l)),this.length>1&&(le[n]||u.uniqueSort(l),te.test(n)&&l.reverse()),this.pushStack(l)}});var he=/[^\x20\t\r\n\f]+/g;function ke(n){var o={};return u.each(n.match(he)||[],function(a,c){o[c]=!0}),o}u.Callbacks=function(n){n=typeof n=="string"?ke(n):u.extend({},n);var o,a,c,l,h=[],p=[],x=-1,v=function(){for(l=l||n.once,c=o=!0;p.length;x=-1)for(a=p.shift();++x<h.length;)h[x].apply(a[0],a[1])===!1&&n.stopOnFalse&&(x=h.length,a=!1);n.memory||(a=!1),o=!1,l&&(a?h=[]:h="")},T={add:function(){return h&&(a&&!o&&(x=h.length-1,p.push(a)),(function q(j){u.each(j,function(O,Q){R(Q)?(!n.unique||!T.has(Q))&&h.push(Q):Q&&Q.length&&ce(Q)!=="string"&&q(Q)})})(arguments),a&&!o&&v()),this},remove:function(){return u.each(arguments,function(q,j){for(var O;(O=u.inArray(j,h,O))>-1;)h.splice(O,1),O<=x&&x--}),this},has:function(q){return q?u.inArray(q,h)>-1:h.length>0},empty:function(){return h&&(h=[]),this},disable:function(){return l=p=[],h=a="",this},disabled:function(){return!h},lock:function(){return l=p=[],!a&&!o&&(h=a=""),this},locked:function(){return!!l},fireWith:function(q,j){return l||(j=j||[],j=[q,j.slice?j.slice():j],p.push(j),o||v()),this},fire:function(){return T.fireWith(this,arguments),this},fired:function(){return!!c}};return T};function Ee(n){return n}function Oe(n){throw n}function Ce(n,o,a,c){var l;try{n&&R(l=n.promise)?l.call(n).done(o).fail(a):n&&R(l=n.then)?l.call(n,o,a):o.apply(void 0,[n].slice(c))}catch(h){a.apply(void 0,[h])}}u.extend({Deferred:function(n){var o=[["notify","progress",u.Callbacks("memory"),u.Callbacks("memory"),2],["resolve","done",u.Callbacks("once memory"),u.Callbacks("once memory"),0,"resolved"],["reject","fail",u.Callbacks("once memory"),u.Callbacks("once memory"),1,"rejected"]],a="pending",c={state:function(){return a},always:function(){return l.done(arguments).fail(arguments),this},catch:function(h){return c.then(null,h)},pipe:function(){var h=arguments;return u.Deferred(function(p){u.each(o,function(x,v){var T=R(h[v[4]])&&h[v[4]];l[v[1]](function(){var q=T&&T.apply(this,arguments);q&&R(q.promise)?q.promise().progress(p.notify).done(p.resolve).fail(p.reject):p[v[0]+"With"](this,T?[q]:arguments)})}),h=null}).promise()},then:function(h,p,x){var v=0;function T(q,j,O,Q){return function(){var we=this,Ie=arguments,xe=function(){var Fe,bt;if(!(q<v)){if(Fe=O.apply(we,Ie),Fe===j.promise())throw new TypeError("Thenable self-resolution");bt=Fe&&(typeof Fe=="object"||typeof Fe=="function")&&Fe.then,R(bt)?Q?bt.call(Fe,T(v,j,Ee,Q),T(v,j,Oe,Q)):(v++,bt.call(Fe,T(v,j,Ee,Q),T(v,j,Oe,Q),T(v,j,Ee,j.notifyWith))):(O!==Ee&&(we=void 0,Ie=[Fe]),(Q||j.resolveWith)(we,Ie))}},ze=Q?xe:function(){try{xe()}catch(Fe){u.Deferred.exceptionHook&&u.Deferred.exceptionHook(Fe,ze.error),q+1>=v&&(O!==Oe&&(we=void 0,Ie=[Fe]),j.rejectWith(we,Ie))}};q?ze():(u.Deferred.getErrorHook?ze.error=u.Deferred.getErrorHook():u.Deferred.getStackHook&&(ze.error=u.Deferred.getStackHook()),e.setTimeout(ze))}}return u.Deferred(function(q){o[0][3].add(T(0,q,R(x)?x:Ee,q.notifyWith)),o[1][3].add(T(0,q,R(h)?h:Ee)),o[2][3].add(T(0,q,R(p)?p:Oe))}).promise()},promise:function(h){return h!=null?u.extend(h,c):c}},l={};return u.each(o,function(h,p){var x=p[2],v=p[5];c[p[1]]=x.add,v&&x.add(function(){a=v},o[3-h][2].disable,o[3-h][3].disable,o[0][2].lock,o[0][3].lock),x.add(p[3].fire),l[p[0]]=function(){return l[p[0]+"With"](this===l?void 0:this,arguments),this},l[p[0]+"With"]=x.fireWith}),c.promise(l),n&&n.call(l,l),l},when:function(n){var o=arguments.length,a=o,c=Array(a),l=f.call(arguments),h=u.Deferred(),p=function(x){return function(v){c[x]=this,l[x]=arguments.length>1?f.call(arguments):v,--o||h.resolveWith(c,l)}};if(o<=1&&(Ce(n,h.done(p(a)).resolve,h.reject,!o),h.state()==="pending"||R(l[a]&&l[a].then)))return h.then();for(;a--;)Ce(l[a],p(a),h.reject);return h.promise()}});var Ke=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;u.Deferred.exceptionHook=function(n,o){e.console&&e.console.warn&&n&&Ke.test(n.name)&&e.console.warn("jQuery.Deferred exception: "+n.message,n.stack,o)},u.readyException=function(n){e.setTimeout(function(){throw n})};var $e=u.Deferred();u.fn.ready=function(n){return $e.then(n).catch(function(o){u.readyException(o)}),this},u.extend({isReady:!1,readyWait:1,ready:function(n){(n===!0?--u.readyWait:u.isReady)||(u.isReady=!0,!(n!==!0&&--u.readyWait>0)&&$e.resolveWith(W,[u]))}}),u.ready.then=$e.then;function ye(){W.removeEventListener("DOMContentLoaded",ye),e.removeEventListener("load",ye),u.ready()}W.readyState==="complete"||W.readyState!=="loading"&&!W.documentElement.doScroll?e.setTimeout(u.ready):(W.addEventListener("DOMContentLoaded",ye),e.addEventListener("load",ye));var Re=function(n,o,a,c,l,h,p){var x=0,v=n.length,T=a==null;if(ce(a)==="object"){l=!0;for(x in a)Re(n,o,x,a[x],!0,h,p)}else if(c!==void 0&&(l=!0,R(c)||(p=!0),T&&(p?(o.call(n,c),o=null):(T=o,o=function(q,j,O){return T.call(u(q),O)})),o))for(;x<v;x++)o(n[x],a,p?c:c.call(n[x],x,o(n[x],a)));return l?n:T?o.call(n):v?o(n[0],a):h},lt=/^-ms-/,Je=/-([a-z])/g;function bi(n,o){return o.toUpperCase()}function it(n){return n.replace(lt,"ms-").replace(Je,bi)}var Gt=function(n){return n.nodeType===1||n.nodeType===9||!+n.nodeType};function Rt(){this.expando=u.expando+Rt.uid++}Rt.uid=1,Rt.prototype={cache:function(n){var o=n[this.expando];return o||(o={},Gt(n)&&(n.nodeType?n[this.expando]=o:Object.defineProperty(n,this.expando,{value:o,configurable:!0}))),o},set:function(n,o,a){var c,l=this.cache(n);if(typeof o=="string")l[it(o)]=a;else for(c in o)l[it(c)]=o[c];return l},get:function(n,o){return o===void 0?this.cache(n):n[this.expando]&&n[this.expando][it(o)]},access:function(n,o,a){return o===void 0||o&&typeof o=="string"&&a===void 0?this.get(n,o):(this.set(n,o,a),a!==void 0?a:o)},remove:function(n,o){var a,c=n[this.expando];if(c!==void 0){if(o!==void 0)for(Array.isArray(o)?o=o.map(it):(o=it(o),o=o in c?[o]:o.match(he)||[]),a=o.length;a--;)delete c[o[a]];(o===void 0||u.isEmptyObject(c))&&(n.nodeType?n[this.expando]=void 0:delete n[this.expando])}},hasData:function(n){var o=n[this.expando];return o!==void 0&&!u.isEmptyObject(o)}};var ae=new Rt,We=new Rt,vi=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,xi=/[A-Z]/g;function hr(n){return n==="true"?!0:n==="false"?!1:n==="null"?null:n===+n+""?+n:vi.test(n)?JSON.parse(n):n}function Dn(n,o,a){var c;if(a===void 0&&n.nodeType===1)if(c="data-"+o.replace(xi,"-$&").toLowerCase(),a=n.getAttribute(c),typeof a=="string"){try{a=hr(a)}catch{}We.set(n,o,a)}else a=void 0;return a}u.extend({hasData:function(n){return We.hasData(n)||ae.hasData(n)},data:function(n,o,a){return We.access(n,o,a)},removeData:function(n,o){We.remove(n,o)},_data:function(n,o,a){return ae.access(n,o,a)},_removeData:function(n,o){ae.remove(n,o)}}),u.fn.extend({data:function(n,o){var a,c,l,h=this[0],p=h&&h.attributes;if(n===void 0){if(this.length&&(l=We.get(h),h.nodeType===1&&!ae.get(h,"hasDataAttrs"))){for(a=p.length;a--;)p[a]&&(c=p[a].name,c.indexOf("data-")===0&&(c=it(c.slice(5)),Dn(h,c,l[c])));ae.set(h,"hasDataAttrs",!0)}return l}return typeof n=="object"?this.each(function(){We.set(this,n)}):Re(this,function(x){var v;if(h&&x===void 0)return v=We.get(h,n),v!==void 0||(v=Dn(h,n),v!==void 0)?v:void 0;this.each(function(){We.set(this,n,x)})},null,o,arguments.length>1,null,!0)},removeData:function(n){return this.each(function(){We.remove(this,n)})}}),u.extend({queue:function(n,o,a){var c;if(n)return o=(o||"fx")+"queue",c=ae.get(n,o),a&&(!c||Array.isArray(a)?c=ae.access(n,o,u.makeArray(a)):c.push(a)),c||[]},dequeue:function(n,o){o=o||"fx";var a=u.queue(n,o),c=a.length,l=a.shift(),h=u._queueHooks(n,o),p=function(){u.dequeue(n,o)};l==="inprogress"&&(l=a.shift(),c--),l&&(o==="fx"&&a.unshift("inprogress"),delete h.stop,l.call(n,p,h)),!c&&h&&h.empty.fire()},_queueHooks:function(n,o){var a=o+"queueHooks";return ae.get(n,a)||ae.access(n,a,{empty:u.Callbacks("once memory").add(function(){ae.remove(n,[o+"queue",a])})})}}),u.fn.extend({queue:function(n,o){var a=2;return typeof n!="string"&&(o=n,n="fx",a--),arguments.length<a?u.queue(this[0],n):o===void 0?this:this.each(function(){var c=u.queue(this,n,o);u._queueHooks(this,n),n==="fx"&&c[0]!=="inprogress"&&u.dequeue(this,n)})},dequeue:function(n){return this.each(function(){u.dequeue(this,n)})},clearQueue:function(n){return this.queue(n||"fx",[])},promise:function(n,o){var a,c=1,l=u.Deferred(),h=this,p=this.length,x=function(){--c||l.resolveWith(h,[h])};for(typeof n!="string"&&(o=n,n=void 0),n=n||"fx";p--;)a=ae.get(h[p],n+"queueHooks"),a&&a.empty&&(c++,a.empty.add(x));return x(),l.promise(o)}});var pn=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,Zt=new RegExp("^(?:([+-])=|)("+pn+")([a-z%]*)$","i"),ht=["Top","Right","Bottom","Left"],Xt=W.documentElement,gn=function(n){return u.contains(n.ownerDocument,n)},af={composed:!0};Xt.getRootNode&&(gn=function(n){return u.contains(n.ownerDocument,n)||n.getRootNode(af)===n.ownerDocument});var dr=function(n,o){return n=o||n,n.style.display==="none"||n.style.display===""&&gn(n)&&u.css(n,"display")==="none"};function _s(n,o,a,c){var l,h,p=20,x=c?function(){return c.cur()}:function(){return u.css(n,o,"")},v=x(),T=a&&a[3]||(u.cssNumber[o]?"":"px"),q=n.nodeType&&(u.cssNumber[o]||T!=="px"&&+v)&&Zt.exec(u.css(n,o));if(q&&q[3]!==T){for(v=v/2,T=T||q[3],q=+v||1;p--;)u.style(n,o,q+T),(1-h)*(1-(h=x()/v||.5))<=0&&(p=0),q=q/h;q=q*2,u.style(n,o,q+T),a=a||[]}return a&&(q=+q||+v||0,l=a[1]?q+(a[1]+1)*a[2]:+a[2],c&&(c.unit=T,c.start=q,c.end=l)),l}var Ss={};function uf(n){var o,a=n.ownerDocument,c=n.nodeName,l=Ss[c];return l||(o=a.body.appendChild(a.createElement(c)),l=u.css(o,"display"),o.parentNode.removeChild(o),l==="none"&&(l="block"),Ss[c]=l,l)}function yn(n,o){for(var a,c,l=[],h=0,p=n.length;h<p;h++)c=n[h],c.style&&(a=c.style.display,o?(a==="none"&&(l[h]=ae.get(c,"display")||null,l[h]||(c.style.display="")),c.style.display===""&&dr(c)&&(l[h]=uf(c))):a!=="none"&&(l[h]="none",ae.set(c,"display",a)));for(h=0;h<p;h++)l[h]!=null&&(n[h].style.display=l[h]);return n}u.fn.extend({show:function(){return yn(this,!0)},hide:function(){return yn(this)},toggle:function(n){return typeof n=="boolean"?n?this.show():this.hide():this.each(function(){dr(this)?u(this).show():u(this).hide()})}});var Nn=/^(?:checkbox|radio)$/i,As=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,Is=/^$|^module$|\/(?:java|ecma)script/i;(function(){var n=W.createDocumentFragment(),o=n.appendChild(W.createElement("div")),a=W.createElement("input");a.setAttribute("type","radio"),a.setAttribute("checked","checked"),a.setAttribute("name","t"),o.appendChild(a),S.checkClone=o.cloneNode(!0).cloneNode(!0).lastChild.checked,o.innerHTML="<textarea>x</textarea>",S.noCloneChecked=!!o.cloneNode(!0).lastChild.defaultValue,o.innerHTML="<option></option>",S.option=!!o.lastChild})();var ot={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};ot.tbody=ot.tfoot=ot.colgroup=ot.caption=ot.thead,ot.th=ot.td,S.option||(ot.optgroup=ot.option=[1,"<select multiple='multiple'>","</select>"]);function et(n,o){var a;return typeof n.getElementsByTagName<"u"?a=n.getElementsByTagName(o||"*"):typeof n.querySelectorAll<"u"?a=n.querySelectorAll(o||"*"):a=[],o===void 0||o&&B(n,o)?u.merge([n],a):a}function ki(n,o){for(var a=0,c=n.length;a<c;a++)ae.set(n[a],"globalEval",!o||ae.get(o[a],"globalEval"))}var cf=/<|&#?\w+;/;function Ms(n,o,a,c,l){for(var h,p,x,v,T,q,j=o.createDocumentFragment(),O=[],Q=0,we=n.length;Q<we;Q++)if(h=n[Q],h||h===0)if(ce(h)==="object")u.merge(O,h.nodeType?[h]:h);else if(!cf.test(h))O.push(o.createTextNode(h));else{for(p=p||j.appendChild(o.createElement("div")),x=(As.exec(h)||["",""])[1].toLowerCase(),v=ot[x]||ot._default,p.innerHTML=v[1]+u.htmlPrefilter(h)+v[2],q=v[0];q--;)p=p.lastChild;u.merge(O,p.childNodes),p=j.firstChild,p.textContent=""}for(j.textContent="",Q=0;h=O[Q++];){if(c&&u.inArray(h,c)>-1){l&&l.push(h);continue}if(T=gn(h),p=et(j.appendChild(h),"script"),T&&ki(p),a)for(q=0;h=p[q++];)Is.test(h.type||"")&&a.push(h)}return j}var Bs=/^([^.]*)(?:\.(.+)|)/;function mn(){return!0}function wn(){return!1}function Ei(n,o,a,c,l,h){var p,x;if(typeof o=="object"){typeof a!="string"&&(c=c||a,a=void 0);for(x in o)Ei(n,x,a,c,o[x],h);return n}if(c==null&&l==null?(l=a,c=a=void 0):l==null&&(typeof a=="string"?(l=c,c=void 0):(l=c,c=a,a=void 0)),l===!1)l=wn;else if(!l)return n;return h===1&&(p=l,l=function(v){return u().off(v),p.apply(this,arguments)},l.guid=p.guid||(p.guid=u.guid++)),n.each(function(){u.event.add(this,o,l,c,a)})}u.event={global:{},add:function(n,o,a,c,l){var h,p,x,v,T,q,j,O,Q,we,Ie,xe=ae.get(n);if(Gt(n))for(a.handler&&(h=a,a=h.handler,l=h.selector),l&&u.find.matchesSelector(Xt,l),a.guid||(a.guid=u.guid++),(v=xe.events)||(v=xe.events=Object.create(null)),(p=xe.handle)||(p=xe.handle=function(ze){return typeof u<"u"&&u.event.triggered!==ze.type?u.event.dispatch.apply(n,arguments):void 0}),o=(o||"").match(he)||[""],T=o.length;T--;)x=Bs.exec(o[T])||[],Q=Ie=x[1],we=(x[2]||"").split(".").sort(),Q&&(j=u.event.special[Q]||{},Q=(l?j.delegateType:j.bindType)||Q,j=u.event.special[Q]||{},q=u.extend({type:Q,origType:Ie,data:c,handler:a,guid:a.guid,selector:l,needsContext:l&&u.expr.match.needsContext.test(l),namespace:we.join(".")},h),(O=v[Q])||(O=v[Q]=[],O.delegateCount=0,(!j.setup||j.setup.call(n,c,we,p)===!1)&&n.addEventListener&&n.addEventListener(Q,p)),j.add&&(j.add.call(n,q),q.handler.guid||(q.handler.guid=a.guid)),l?O.splice(O.delegateCount++,0,q):O.push(q),u.event.global[Q]=!0)},remove:function(n,o,a,c,l){var h,p,x,v,T,q,j,O,Q,we,Ie,xe=ae.hasData(n)&&ae.get(n);if(!(!xe||!(v=xe.events))){for(o=(o||"").match(he)||[""],T=o.length;T--;){if(x=Bs.exec(o[T])||[],Q=Ie=x[1],we=(x[2]||"").split(".").sort(),!Q){for(Q in v)u.event.remove(n,Q+o[T],a,c,!0);continue}for(j=u.event.special[Q]||{},Q=(c?j.delegateType:j.bindType)||Q,O=v[Q]||[],x=x[2]&&new RegExp("(^|\\.)"+we.join("\\.(?:.*\\.|)")+"(\\.|$)"),p=h=O.length;h--;)q=O[h],(l||Ie===q.origType)&&(!a||a.guid===q.guid)&&(!x||x.test(q.namespace))&&(!c||c===q.selector||c==="**"&&q.selector)&&(O.splice(h,1),q.selector&&O.delegateCount--,j.remove&&j.remove.call(n,q));p&&!O.length&&((!j.teardown||j.teardown.call(n,we,xe.handle)===!1)&&u.removeEvent(n,Q,xe.handle),delete v[Q])}u.isEmptyObject(v)&&ae.remove(n,"handle events")}},dispatch:function(n){var o,a,c,l,h,p,x=new Array(arguments.length),v=u.event.fix(n),T=(ae.get(this,"events")||Object.create(null))[v.type]||[],q=u.event.special[v.type]||{};for(x[0]=v,o=1;o<arguments.length;o++)x[o]=arguments[o];if(v.delegateTarget=this,!(q.preDispatch&&q.preDispatch.call(this,v)===!1)){for(p=u.event.handlers.call(this,v,T),o=0;(l=p[o++])&&!v.isPropagationStopped();)for(v.currentTarget=l.elem,a=0;(h=l.handlers[a++])&&!v.isImmediatePropagationStopped();)(!v.rnamespace||h.namespace===!1||v.rnamespace.test(h.namespace))&&(v.handleObj=h,v.data=h.data,c=((u.event.special[h.origType]||{}).handle||h.handler).apply(l.elem,x),c!==void 0&&(v.result=c)===!1&&(v.preventDefault(),v.stopPropagation()));return q.postDispatch&&q.postDispatch.call(this,v),v.result}},handlers:function(n,o){var a,c,l,h,p,x=[],v=o.delegateCount,T=n.target;if(v&&T.nodeType&&!(n.type==="click"&&n.button>=1)){for(;T!==this;T=T.parentNode||this)if(T.nodeType===1&&!(n.type==="click"&&T.disabled===!0)){for(h=[],p={},a=0;a<v;a++)c=o[a],l=c.selector+" ",p[l]===void 0&&(p[l]=c.needsContext?u(l,this).index(T)>-1:u.find(l,this,null,[T]).length),p[l]&&h.push(c);h.length&&x.push({elem:T,handlers:h})}}return T=this,v<o.length&&x.push({elem:T,handlers:o.slice(v)}),x},addProp:function(n,o){Object.defineProperty(u.Event.prototype,n,{enumerable:!0,configurable:!0,get:R(o)?function(){if(this.originalEvent)return o(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[n]},set:function(a){Object.defineProperty(this,n,{enumerable:!0,configurable:!0,writable:!0,value:a})}})},fix:function(n){return n[u.expando]?n:new u.Event(n)},special:{load:{noBubble:!0},click:{setup:function(n){var o=this||n;return Nn.test(o.type)&&o.click&&B(o,"input")&&pr(o,"click",!0),!1},trigger:function(n){var o=this||n;return Nn.test(o.type)&&o.click&&B(o,"input")&&pr(o,"click"),!0},_default:function(n){var o=n.target;return Nn.test(o.type)&&o.click&&B(o,"input")&&ae.get(o,"click")||B(o,"a")}},beforeunload:{postDispatch:function(n){n.result!==void 0&&n.originalEvent&&(n.originalEvent.returnValue=n.result)}}}};function pr(n,o,a){if(!a){ae.get(n,o)===void 0&&u.event.add(n,o,mn);return}ae.set(n,o,!1),u.event.add(n,o,{namespace:!1,handler:function(c){var l,h=ae.get(this,o);if(c.isTrigger&1&&this[o]){if(h)(u.event.special[o]||{}).delegateType&&c.stopPropagation();else if(h=f.call(arguments),ae.set(this,o,h),this[o](),l=ae.get(this,o),ae.set(this,o,!1),h!==l)return c.stopImmediatePropagation(),c.preventDefault(),l}else h&&(ae.set(this,o,u.event.trigger(h[0],h.slice(1),this)),c.stopPropagation(),c.isImmediatePropagationStopped=mn)}})}u.removeEvent=function(n,o,a){n.removeEventListener&&n.removeEventListener(o,a)},u.Event=function(n,o){if(!(this instanceof u.Event))return new u.Event(n,o);n&&n.type?(this.originalEvent=n,this.type=n.type,this.isDefaultPrevented=n.defaultPrevented||n.defaultPrevented===void 0&&n.returnValue===!1?mn:wn,this.target=n.target&&n.target.nodeType===3?n.target.parentNode:n.target,this.currentTarget=n.currentTarget,this.relatedTarget=n.relatedTarget):this.type=n,o&&u.extend(this,o),this.timeStamp=n&&n.timeStamp||Date.now(),this[u.expando]=!0},u.Event.prototype={constructor:u.Event,isDefaultPrevented:wn,isPropagationStopped:wn,isImmediatePropagationStopped:wn,isSimulated:!1,preventDefault:function(){var n=this.originalEvent;this.isDefaultPrevented=mn,n&&!this.isSimulated&&n.preventDefault()},stopPropagation:function(){var n=this.originalEvent;this.isPropagationStopped=mn,n&&!this.isSimulated&&n.stopPropagation()},stopImmediatePropagation:function(){var n=this.originalEvent;this.isImmediatePropagationStopped=mn,n&&!this.isSimulated&&n.stopImmediatePropagation(),this.stopPropagation()}},u.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},u.event.addProp),u.each({focus:"focusin",blur:"focusout"},function(n,o){function a(c){if(W.documentMode){var l=ae.get(this,"handle"),h=u.event.fix(c);h.type=c.type==="focusin"?"focus":"blur",h.isSimulated=!0,l(c),h.target===h.currentTarget&&l(h)}else u.event.simulate(o,c.target,u.event.fix(c))}u.event.special[n]={setup:function(){var c;if(pr(this,n,!0),W.documentMode)c=ae.get(this,o),c||this.addEventListener(o,a),ae.set(this,o,(c||0)+1);else return!1},trigger:function(){return pr(this,n),!0},teardown:function(){var c;if(W.documentMode)c=ae.get(this,o)-1,c?ae.set(this,o,c):(this.removeEventListener(o,a),ae.remove(this,o));else return!1},_default:function(c){return ae.get(c.target,n)},delegateType:o},u.event.special[o]={setup:function(){var c=this.ownerDocument||this.document||this,l=W.documentMode?this:c,h=ae.get(l,o);h||(W.documentMode?this.addEventListener(o,a):c.addEventListener(n,a,!0)),ae.set(l,o,(h||0)+1)},teardown:function(){var c=this.ownerDocument||this.document||this,l=W.documentMode?this:c,h=ae.get(l,o)-1;h?ae.set(l,o,h):(W.documentMode?this.removeEventListener(o,a):c.removeEventListener(n,a,!0),ae.remove(l,o))}}}),u.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(n,o){u.event.special[n]={delegateType:o,bindType:o,handle:function(a){var c,l=this,h=a.relatedTarget,p=a.handleObj;return(!h||h!==l&&!u.contains(l,h))&&(a.type=p.origType,c=p.handler.apply(this,arguments),a.type=o),c}}}),u.fn.extend({on:function(n,o,a,c){return Ei(this,n,o,a,c)},one:function(n,o,a,c){return Ei(this,n,o,a,c,1)},off:function(n,o,a){var c,l;if(n&&n.preventDefault&&n.handleObj)return c=n.handleObj,u(n.delegateTarget).off(c.namespace?c.origType+"."+c.namespace:c.origType,c.selector,c.handler),this;if(typeof n=="object"){for(l in n)this.off(l,o,n[l]);return this}return(o===!1||typeof o=="function")&&(a=o,o=void 0),a===!1&&(a=wn),this.each(function(){u.event.remove(this,n,a,o)})}});var ff=/<script|<style|<link/i,lf=/checked\s*(?:[^=]|=\s*.checked.)/i,hf=/^\s*<!\[CDATA\[|\]\]>\s*$/g;function Os(n,o){return B(n,"table")&&B(o.nodeType!==11?o:o.firstChild,"tr")&&u(n).children("tbody")[0]||n}function df(n){return n.type=(n.getAttribute("type")!==null)+"/"+n.type,n}function pf(n){return(n.type||"").slice(0,5)==="true/"?n.type=n.type.slice(5):n.removeAttribute("type"),n}function Ps(n,o){var a,c,l,h,p,x,v;if(o.nodeType===1){if(ae.hasData(n)&&(h=ae.get(n),v=h.events,v)){ae.remove(o,"handle events");for(l in v)for(a=0,c=v[l].length;a<c;a++)u.event.add(o,l,v[l][a])}We.hasData(n)&&(p=We.access(n),x=u.extend({},p),We.set(o,x))}}function gf(n,o){var a=o.nodeName.toLowerCase();a==="input"&&Nn.test(n.type)?o.checked=n.checked:(a==="input"||a==="textarea")&&(o.defaultValue=n.defaultValue)}function bn(n,o,a,c){o=d(o);var l,h,p,x,v,T,q=0,j=n.length,O=j-1,Q=o[0],we=R(Q);if(we||j>1&&typeof Q=="string"&&!S.checkClone&&lf.test(Q))return n.each(function(Ie){var xe=n.eq(Ie);we&&(o[0]=Q.call(this,Ie,xe.html())),bn(xe,o,a,c)});if(j&&(l=Ms(o,n[0].ownerDocument,!1,n,c),h=l.firstChild,l.childNodes.length===1&&(l=h),h||c)){for(p=u.map(et(l,"script"),df),x=p.length;q<j;q++)v=l,q!==O&&(v=u.clone(v,!0,!0),x&&u.merge(p,et(v,"script"))),a.call(n[q],v,q);if(x)for(T=p[p.length-1].ownerDocument,u.map(p,pf),q=0;q<x;q++)v=p[q],Is.test(v.type||"")&&!ae.access(v,"globalEval")&&u.contains(T,v)&&(v.src&&(v.type||"").toLowerCase()!=="module"?u._evalUrl&&!v.noModule&&u._evalUrl(v.src,{nonce:v.nonce||v.getAttribute("nonce")},T):ue(v.textContent.replace(hf,""),v,T))}return n}function Ds(n,o,a){for(var c,l=o?u.filter(o,n):n,h=0;(c=l[h])!=null;h++)!a&&c.nodeType===1&&u.cleanData(et(c)),c.parentNode&&(a&&gn(c)&&ki(et(c,"script")),c.parentNode.removeChild(c));return n}u.extend({htmlPrefilter:function(n){return n},clone:function(n,o,a){var c,l,h,p,x=n.cloneNode(!0),v=gn(n);if(!S.noCloneChecked&&(n.nodeType===1||n.nodeType===11)&&!u.isXMLDoc(n))for(p=et(x),h=et(n),c=0,l=h.length;c<l;c++)gf(h[c],p[c]);if(o)if(a)for(h=h||et(n),p=p||et(x),c=0,l=h.length;c<l;c++)Ps(h[c],p[c]);else Ps(n,x);return p=et(x,"script"),p.length>0&&ki(p,!v&&et(n,"script")),x},cleanData:function(n){for(var o,a,c,l=u.event.special,h=0;(a=n[h])!==void 0;h++)if(Gt(a)){if(o=a[ae.expando]){if(o.events)for(c in o.events)l[c]?u.event.remove(a,c):u.removeEvent(a,c,o.handle);a[ae.expando]=void 0}a[We.expando]&&(a[We.expando]=void 0)}}}),u.fn.extend({detach:function(n){return Ds(this,n,!0)},remove:function(n){return Ds(this,n)},text:function(n){return Re(this,function(o){return o===void 0?u.text(this):this.empty().each(function(){(this.nodeType===1||this.nodeType===11||this.nodeType===9)&&(this.textContent=o)})},null,n,arguments.length)},append:function(){return bn(this,arguments,function(n){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var o=Os(this,n);o.appendChild(n)}})},prepend:function(){return bn(this,arguments,function(n){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var o=Os(this,n);o.insertBefore(n,o.firstChild)}})},before:function(){return bn(this,arguments,function(n){this.parentNode&&this.parentNode.insertBefore(n,this)})},after:function(){return bn(this,arguments,function(n){this.parentNode&&this.parentNode.insertBefore(n,this.nextSibling)})},empty:function(){for(var n,o=0;(n=this[o])!=null;o++)n.nodeType===1&&(u.cleanData(et(n,!1)),n.textContent="");return this},clone:function(n,o){return n=n??!1,o=o??n,this.map(function(){return u.clone(this,n,o)})},html:function(n){return Re(this,function(o){var a=this[0]||{},c=0,l=this.length;if(o===void 0&&a.nodeType===1)return a.innerHTML;if(typeof o=="string"&&!ff.test(o)&&!ot[(As.exec(o)||["",""])[1].toLowerCase()]){o=u.htmlPrefilter(o);try{for(;c<l;c++)a=this[c]||{},a.nodeType===1&&(u.cleanData(et(a,!1)),a.innerHTML=o);a=0}catch{}}a&&this.empty().append(o)},null,n,arguments.length)},replaceWith:function(){var n=[];return bn(this,arguments,function(o){var a=this.parentNode;u.inArray(this,n)<0&&(u.cleanData(et(this)),a&&a.replaceChild(o,this))},n)}}),u.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(n,o){u.fn[n]=function(a){for(var c,l=[],h=u(a),p=h.length-1,x=0;x<=p;x++)c=x===p?this:this.clone(!0),u(h[x])[o](c),g.apply(l,c.get());return this.pushStack(l)}});var Ci=new RegExp("^("+pn+")(?!px)[a-z%]+$","i"),Ti=/^--/,gr=function(n){var o=n.ownerDocument.defaultView;return(!o||!o.opener)&&(o=e),o.getComputedStyle(n)},Ns=function(n,o,a){var c,l,h={};for(l in o)h[l]=n.style[l],n.style[l]=o[l];c=a.call(n);for(l in o)n.style[l]=h[l];return c},yf=new RegExp(ht.join("|"),"i");(function(){function n(){if(T){v.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",T.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",Xt.appendChild(v).appendChild(T);var q=e.getComputedStyle(T);a=q.top!=="1%",x=o(q.marginLeft)===12,T.style.right="60%",h=o(q.right)===36,c=o(q.width)===36,T.style.position="absolute",l=o(T.offsetWidth/3)===12,Xt.removeChild(v),T=null}}function o(q){return Math.round(parseFloat(q))}var a,c,l,h,p,x,v=W.createElement("div"),T=W.createElement("div");T.style&&(T.style.backgroundClip="content-box",T.cloneNode(!0).style.backgroundClip="",S.clearCloneStyle=T.style.backgroundClip==="content-box",u.extend(S,{boxSizingReliable:function(){return n(),c},pixelBoxStyles:function(){return n(),h},pixelPosition:function(){return n(),a},reliableMarginLeft:function(){return n(),x},scrollboxSize:function(){return n(),l},reliableTrDimensions:function(){var q,j,O,Q;return p==null&&(q=W.createElement("table"),j=W.createElement("tr"),O=W.createElement("div"),q.style.cssText="position:absolute;left:-11111px;border-collapse:separate",j.style.cssText="box-sizing:content-box;border:1px solid",j.style.height="1px",O.style.height="9px",O.style.display="block",Xt.appendChild(q).appendChild(j).appendChild(O),Q=e.getComputedStyle(j),p=parseInt(Q.height,10)+parseInt(Q.borderTopWidth,10)+parseInt(Q.borderBottomWidth,10)===j.offsetHeight,Xt.removeChild(q)),p}}))})();function qn(n,o,a){var c,l,h,p,x=Ti.test(o),v=n.style;return a=a||gr(n),a&&(p=a.getPropertyValue(o)||a[o],x&&p&&(p=p.replace(z,"$1")||void 0),p===""&&!gn(n)&&(p=u.style(n,o)),!S.pixelBoxStyles()&&Ci.test(p)&&yf.test(o)&&(c=v.width,l=v.minWidth,h=v.maxWidth,v.minWidth=v.maxWidth=v.width=p,p=a.width,v.width=c,v.minWidth=l,v.maxWidth=h)),p!==void 0?p+"":p}function qs(n,o){return{get:function(){if(n()){delete this.get;return}return(this.get=o).apply(this,arguments)}}}var Ls=["Webkit","Moz","ms"],Rs=W.createElement("div").style,Hs={};function mf(n){for(var o=n[0].toUpperCase()+n.slice(1),a=Ls.length;a--;)if(n=Ls[a]+o,n in Rs)return n}function _i(n){var o=u.cssProps[n]||Hs[n];return o||(n in Rs?n:Hs[n]=mf(n)||n)}var wf=/^(none|table(?!-c[ea]).+)/,bf={position:"absolute",visibility:"hidden",display:"block"},Us={letterSpacing:"0",fontWeight:"400"};function Fs(n,o,a){var c=Zt.exec(o);return c?Math.max(0,c[2]-(a||0))+(c[3]||"px"):o}function Si(n,o,a,c,l,h){var p=o==="width"?1:0,x=0,v=0,T=0;if(a===(c?"border":"content"))return 0;for(;p<4;p+=2)a==="margin"&&(T+=u.css(n,a+ht[p],!0,l)),c?(a==="content"&&(v-=u.css(n,"padding"+ht[p],!0,l)),a!=="margin"&&(v-=u.css(n,"border"+ht[p]+"Width",!0,l))):(v+=u.css(n,"padding"+ht[p],!0,l),a!=="padding"?v+=u.css(n,"border"+ht[p]+"Width",!0,l):x+=u.css(n,"border"+ht[p]+"Width",!0,l));return!c&&h>=0&&(v+=Math.max(0,Math.ceil(n["offset"+o[0].toUpperCase()+o.slice(1)]-h-v-x-.5))||0),v+T}function js(n,o,a){var c=gr(n),l=!S.boxSizingReliable()||a,h=l&&u.css(n,"boxSizing",!1,c)==="border-box",p=h,x=qn(n,o,c),v="offset"+o[0].toUpperCase()+o.slice(1);if(Ci.test(x)){if(!a)return x;x="auto"}return(!S.boxSizingReliable()&&h||!S.reliableTrDimensions()&&B(n,"tr")||x==="auto"||!parseFloat(x)&&u.css(n,"display",!1,c)==="inline")&&n.getClientRects().length&&(h=u.css(n,"boxSizing",!1,c)==="border-box",p=v in n,p&&(x=n[v])),x=parseFloat(x)||0,x+Si(n,o,a||(h?"border":"content"),p,c,x)+"px"}u.extend({cssHooks:{opacity:{get:function(n,o){if(o){var a=qn(n,"opacity");return a===""?"1":a}}}},cssNumber:{animationIterationCount:!0,aspectRatio:!0,borderImageSlice:!0,columnCount:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,scale:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeMiterlimit:!0,strokeOpacity:!0},cssProps:{},style:function(n,o,a,c){if(!(!n||n.nodeType===3||n.nodeType===8||!n.style)){var l,h,p,x=it(o),v=Ti.test(o),T=n.style;if(v||(o=_i(x)),p=u.cssHooks[o]||u.cssHooks[x],a!==void 0){if(h=typeof a,h==="string"&&(l=Zt.exec(a))&&l[1]&&(a=_s(n,o,l),h="number"),a==null||a!==a)return;h==="number"&&!v&&(a+=l&&l[3]||(u.cssNumber[x]?"":"px")),!S.clearCloneStyle&&a===""&&o.indexOf("background")===0&&(T[o]="inherit"),(!p||!("set"in p)||(a=p.set(n,a,c))!==void 0)&&(v?T.setProperty(o,a):T[o]=a)}else return p&&"get"in p&&(l=p.get(n,!1,c))!==void 0?l:T[o]}},css:function(n,o,a,c){var l,h,p,x=it(o),v=Ti.test(o);return v||(o=_i(x)),p=u.cssHooks[o]||u.cssHooks[x],p&&"get"in p&&(l=p.get(n,!0,a)),l===void 0&&(l=qn(n,o,c)),l==="normal"&&o in Us&&(l=Us[o]),a===""||a?(h=parseFloat(l),a===!0||isFinite(h)?h||0:l):l}}),u.each(["height","width"],function(n,o){u.cssHooks[o]={get:function(a,c,l){if(c)return wf.test(u.css(a,"display"))&&(!a.getClientRects().length||!a.getBoundingClientRect().width)?Ns(a,bf,function(){return js(a,o,l)}):js(a,o,l)},set:function(a,c,l){var h,p=gr(a),x=!S.scrollboxSize()&&p.position==="absolute",v=x||l,T=v&&u.css(a,"boxSizing",!1,p)==="border-box",q=l?Si(a,o,l,T,p):0;return T&&x&&(q-=Math.ceil(a["offset"+o[0].toUpperCase()+o.slice(1)]-parseFloat(p[o])-Si(a,o,"border",!1,p)-.5)),q&&(h=Zt.exec(c))&&(h[3]||"px")!=="px"&&(a.style[o]=c,c=u.css(a,o)),Fs(a,c,q)}}}),u.cssHooks.marginLeft=qs(S.reliableMarginLeft,function(n,o){if(o)return(parseFloat(qn(n,"marginLeft"))||n.getBoundingClientRect().left-Ns(n,{marginLeft:0},function(){return n.getBoundingClientRect().left}))+"px"}),u.each({margin:"",padding:"",border:"Width"},function(n,o){u.cssHooks[n+o]={expand:function(a){for(var c=0,l={},h=typeof a=="string"?a.split(" "):[a];c<4;c++)l[n+ht[c]+o]=h[c]||h[c-2]||h[0];return l}},n!=="margin"&&(u.cssHooks[n+o].set=Fs)}),u.fn.extend({css:function(n,o){return Re(this,function(a,c,l){var h,p,x={},v=0;if(Array.isArray(c)){for(h=gr(a),p=c.length;v<p;v++)x[c[v]]=u.css(a,c[v],!1,h);return x}return l!==void 0?u.style(a,c,l):u.css(a,c)},n,o,arguments.length>1)}});function tt(n,o,a,c,l){return new tt.prototype.init(n,o,a,c,l)}u.Tween=tt,tt.prototype={constructor:tt,init:function(n,o,a,c,l,h){this.elem=n,this.prop=a,this.easing=l||u.easing._default,this.options=o,this.start=this.now=this.cur(),this.end=c,this.unit=h||(u.cssNumber[a]?"":"px")},cur:function(){var n=tt.propHooks[this.prop];return n&&n.get?n.get(this):tt.propHooks._default.get(this)},run:function(n){var o,a=tt.propHooks[this.prop];return this.options.duration?this.pos=o=u.easing[this.easing](n,this.options.duration*n,0,1,this.options.duration):this.pos=o=n,this.now=(this.end-this.start)*o+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),a&&a.set?a.set(this):tt.propHooks._default.set(this),this}},tt.prototype.init.prototype=tt.prototype,tt.propHooks={_default:{get:function(n){var o;return n.elem.nodeType!==1||n.elem[n.prop]!=null&&n.elem.style[n.prop]==null?n.elem[n.prop]:(o=u.css(n.elem,n.prop,""),!o||o==="auto"?0:o)},set:function(n){u.fx.step[n.prop]?u.fx.step[n.prop](n):n.elem.nodeType===1&&(u.cssHooks[n.prop]||n.elem.style[_i(n.prop)]!=null)?u.style(n.elem,n.prop,n.now+n.unit):n.elem[n.prop]=n.now}}},tt.propHooks.scrollTop=tt.propHooks.scrollLeft={set:function(n){n.elem.nodeType&&n.elem.parentNode&&(n.elem[n.prop]=n.now)}},u.easing={linear:function(n){return n},swing:function(n){return .5-Math.cos(n*Math.PI)/2},_default:"swing"},u.fx=tt.prototype.init,u.fx.step={};var vn,yr,vf=/^(?:toggle|show|hide)$/,xf=/queueHooks$/;function Ai(){yr&&(W.hidden===!1&&e.requestAnimationFrame?e.requestAnimationFrame(Ai):e.setTimeout(Ai,u.fx.interval),u.fx.tick())}function Ks(){return e.setTimeout(function(){vn=void 0}),vn=Date.now()}function mr(n,o){var a,c=0,l={height:n};for(o=o?1:0;c<4;c+=2-o)a=ht[c],l["margin"+a]=l["padding"+a]=n;return o&&(l.opacity=l.width=n),l}function $s(n,o,a){for(var c,l=(dt.tweeners[o]||[]).concat(dt.tweeners["*"]),h=0,p=l.length;h<p;h++)if(c=l[h].call(a,o,n))return c}function kf(n,o,a){var c,l,h,p,x,v,T,q,j="width"in o||"height"in o,O=this,Q={},we=n.style,Ie=n.nodeType&&dr(n),xe=ae.get(n,"fxshow");a.queue||(p=u._queueHooks(n,"fx"),p.unqueued==null&&(p.unqueued=0,x=p.empty.fire,p.empty.fire=function(){p.unqueued||x()}),p.unqueued++,O.always(function(){O.always(function(){p.unqueued--,u.queue(n,"fx").length||p.empty.fire()})}));for(c in o)if(l=o[c],vf.test(l)){if(delete o[c],h=h||l==="toggle",l===(Ie?"hide":"show"))if(l==="show"&&xe&&xe[c]!==void 0)Ie=!0;else continue;Q[c]=xe&&xe[c]||u.style(n,c)}if(v=!u.isEmptyObject(o),!(!v&&u.isEmptyObject(Q))){j&&n.nodeType===1&&(a.overflow=[we.overflow,we.overflowX,we.overflowY],T=xe&&xe.display,T==null&&(T=ae.get(n,"display")),q=u.css(n,"display"),q==="none"&&(T?q=T:(yn([n],!0),T=n.style.display||T,q=u.css(n,"display"),yn([n]))),(q==="inline"||q==="inline-block"&&T!=null)&&u.css(n,"float")==="none"&&(v||(O.done(function(){we.display=T}),T==null&&(q=we.display,T=q==="none"?"":q)),we.display="inline-block")),a.overflow&&(we.overflow="hidden",O.always(function(){we.overflow=a.overflow[0],we.overflowX=a.overflow[1],we.overflowY=a.overflow[2]})),v=!1;for(c in Q)v||(xe?"hidden"in xe&&(Ie=xe.hidden):xe=ae.access(n,"fxshow",{display:T}),h&&(xe.hidden=!Ie),Ie&&yn([n],!0),O.done(function(){Ie||yn([n]),ae.remove(n,"fxshow");for(c in Q)u.style(n,c,Q[c])})),v=$s(Ie?xe[c]:0,c,O),c in xe||(xe[c]=v.start,Ie&&(v.end=v.start,v.start=0))}}function Ef(n,o){var a,c,l,h,p;for(a in n)if(c=it(a),l=o[c],h=n[a],Array.isArray(h)&&(l=h[1],h=n[a]=h[0]),a!==c&&(n[c]=h,delete n[a]),p=u.cssHooks[c],p&&"expand"in p){h=p.expand(h),delete n[c];for(a in h)a in n||(n[a]=h[a],o[a]=l)}else o[c]=l}function dt(n,o,a){var c,l,h=0,p=dt.prefilters.length,x=u.Deferred().always(function(){delete v.elem}),v=function(){if(l)return!1;for(var j=vn||Ks(),O=Math.max(0,T.startTime+T.duration-j),Q=O/T.duration||0,we=1-Q,Ie=0,xe=T.tweens.length;Ie<xe;Ie++)T.tweens[Ie].run(we);return x.notifyWith(n,[T,we,O]),we<1&&xe?O:(xe||x.notifyWith(n,[T,1,0]),x.resolveWith(n,[T]),!1)},T=x.promise({elem:n,props:u.extend({},o),opts:u.extend(!0,{specialEasing:{},easing:u.easing._default},a),originalProperties:o,originalOptions:a,startTime:vn||Ks(),duration:a.duration,tweens:[],createTween:function(j,O){var Q=u.Tween(n,T.opts,j,O,T.opts.specialEasing[j]||T.opts.easing);return T.tweens.push(Q),Q},stop:function(j){var O=0,Q=j?T.tweens.length:0;if(l)return this;for(l=!0;O<Q;O++)T.tweens[O].run(1);return j?(x.notifyWith(n,[T,1,0]),x.resolveWith(n,[T,j])):x.rejectWith(n,[T,j]),this}}),q=T.props;for(Ef(q,T.opts.specialEasing);h<p;h++)if(c=dt.prefilters[h].call(T,n,q,T.opts),c)return R(c.stop)&&(u._queueHooks(T.elem,T.opts.queue).stop=c.stop.bind(c)),c;return u.map(q,$s,T),R(T.opts.start)&&T.opts.start.call(n,T),T.progress(T.opts.progress).done(T.opts.done,T.opts.complete).fail(T.opts.fail).always(T.opts.always),u.fx.timer(u.extend(v,{elem:n,anim:T,queue:T.opts.queue})),T}u.Animation=u.extend(dt,{tweeners:{"*":[function(n,o){var a=this.createTween(n,o);return _s(a.elem,n,Zt.exec(o),a),a}]},tweener:function(n,o){R(n)?(o=n,n=["*"]):n=n.match(he);for(var a,c=0,l=n.length;c<l;c++)a=n[c],dt.tweeners[a]=dt.tweeners[a]||[],dt.tweeners[a].unshift(o)},prefilters:[kf],prefilter:function(n,o){o?dt.prefilters.unshift(n):dt.prefilters.push(n)}}),u.speed=function(n,o,a){var c=n&&typeof n=="object"?u.extend({},n):{complete:a||!a&&o||R(n)&&n,duration:n,easing:a&&o||o&&!R(o)&&o};return u.fx.off?c.duration=0:typeof c.duration!="number"&&(c.duration in u.fx.speeds?c.duration=u.fx.speeds[c.duration]:c.duration=u.fx.speeds._default),(c.queue==null||c.queue===!0)&&(c.queue="fx"),c.old=c.complete,c.complete=function(){R(c.old)&&c.old.call(this),c.queue&&u.dequeue(this,c.queue)},c},u.fn.extend({fadeTo:function(n,o,a,c){return this.filter(dr).css("opacity",0).show().end().animate({opacity:o},n,a,c)},animate:function(n,o,a,c){var l=u.isEmptyObject(n),h=u.speed(o,a,c),p=function(){var x=dt(this,u.extend({},n),h);(l||ae.get(this,"finish"))&&x.stop(!0)};return p.finish=p,l||h.queue===!1?this.each(p):this.queue(h.queue,p)},stop:function(n,o,a){var c=function(l){var h=l.stop;delete l.stop,h(a)};return typeof n!="string"&&(a=o,o=n,n=void 0),o&&this.queue(n||"fx",[]),this.each(function(){var l=!0,h=n!=null&&n+"queueHooks",p=u.timers,x=ae.get(this);if(h)x[h]&&x[h].stop&&c(x[h]);else for(h in x)x[h]&&x[h].stop&&xf.test(h)&&c(x[h]);for(h=p.length;h--;)p[h].elem===this&&(n==null||p[h].queue===n)&&(p[h].anim.stop(a),l=!1,p.splice(h,1));(l||!a)&&u.dequeue(this,n)})},finish:function(n){return n!==!1&&(n=n||"fx"),this.each(function(){var o,a=ae.get(this),c=a[n+"queue"],l=a[n+"queueHooks"],h=u.timers,p=c?c.length:0;for(a.finish=!0,u.queue(this,n,[]),l&&l.stop&&l.stop.call(this,!0),o=h.length;o--;)h[o].elem===this&&h[o].queue===n&&(h[o].anim.stop(!0),h.splice(o,1));for(o=0;o<p;o++)c[o]&&c[o].finish&&c[o].finish.call(this);delete a.finish})}}),u.each(["toggle","show","hide"],function(n,o){var a=u.fn[o];u.fn[o]=function(c,l,h){return c==null||typeof c=="boolean"?a.apply(this,arguments):this.animate(mr(o,!0),c,l,h)}}),u.each({slideDown:mr("show"),slideUp:mr("hide"),slideToggle:mr("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(n,o){u.fn[n]=function(a,c,l){return this.animate(o,a,c,l)}}),u.timers=[],u.fx.tick=function(){var n,o=0,a=u.timers;for(vn=Date.now();o<a.length;o++)n=a[o],!n()&&a[o]===n&&a.splice(o--,1);a.length||u.fx.stop(),vn=void 0},u.fx.timer=function(n){u.timers.push(n),u.fx.start()},u.fx.interval=13,u.fx.start=function(){yr||(yr=!0,Ai())},u.fx.stop=function(){yr=null},u.fx.speeds={slow:600,fast:200,_default:400},u.fn.delay=function(n,o){return n=u.fx&&u.fx.speeds[n]||n,o=o||"fx",this.queue(o,function(a,c){var l=e.setTimeout(a,n);c.stop=function(){e.clearTimeout(l)}})},(function(){var n=W.createElement("input"),o=W.createElement("select"),a=o.appendChild(W.createElement("option"));n.type="checkbox",S.checkOn=n.value!=="",S.optSelected=a.selected,n=W.createElement("input"),n.value="t",n.type="radio",S.radioValue=n.value==="t"})();var Ws,Ln=u.expr.attrHandle;u.fn.extend({attr:function(n,o){return Re(this,u.attr,n,o,arguments.length>1)},removeAttr:function(n){return this.each(function(){u.removeAttr(this,n)})}}),u.extend({attr:function(n,o,a){var c,l,h=n.nodeType;if(!(h===3||h===8||h===2)){if(typeof n.getAttribute>"u")return u.prop(n,o,a);if((h!==1||!u.isXMLDoc(n))&&(l=u.attrHooks[o.toLowerCase()]||(u.expr.match.bool.test(o)?Ws:void 0)),a!==void 0){if(a===null){u.removeAttr(n,o);return}return l&&"set"in l&&(c=l.set(n,a,o))!==void 0?c:(n.setAttribute(o,a+""),a)}return l&&"get"in l&&(c=l.get(n,o))!==null?c:(c=u.find.attr(n,o),c??void 0)}},attrHooks:{type:{set:function(n,o){if(!S.radioValue&&o==="radio"&&B(n,"input")){var a=n.value;return n.setAttribute("type",o),a&&(n.value=a),o}}}},removeAttr:function(n,o){var a,c=0,l=o&&o.match(he);if(l&&n.nodeType===1)for(;a=l[c++];)n.removeAttribute(a)}}),Ws={set:function(n,o,a){return o===!1?u.removeAttr(n,a):n.setAttribute(a,a),a}},u.each(u.expr.match.bool.source.match(/\w+/g),function(n,o){var a=Ln[o]||u.find.attr;Ln[o]=function(c,l,h){var p,x,v=l.toLowerCase();return h||(x=Ln[v],Ln[v]=p,p=a(c,l,h)!=null?v:null,Ln[v]=x),p}});var Cf=/^(?:input|select|textarea|button)$/i,Tf=/^(?:a|area)$/i;u.fn.extend({prop:function(n,o){return Re(this,u.prop,n,o,arguments.length>1)},removeProp:function(n){return this.each(function(){delete this[u.propFix[n]||n]})}}),u.extend({prop:function(n,o,a){var c,l,h=n.nodeType;if(!(h===3||h===8||h===2))return(h!==1||!u.isXMLDoc(n))&&(o=u.propFix[o]||o,l=u.propHooks[o]),a!==void 0?l&&"set"in l&&(c=l.set(n,a,o))!==void 0?c:n[o]=a:l&&"get"in l&&(c=l.get(n,o))!==null?c:n[o]},propHooks:{tabIndex:{get:function(n){var o=u.find.attr(n,"tabindex");return o?parseInt(o,10):Cf.test(n.nodeName)||Tf.test(n.nodeName)&&n.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),S.optSelected||(u.propHooks.selected={get:function(n){var o=n.parentNode;return o&&o.parentNode&&o.parentNode.selectedIndex,null},set:function(n){var o=n.parentNode;o&&(o.selectedIndex,o.parentNode&&o.parentNode.selectedIndex)}}),u.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){u.propFix[this.toLowerCase()]=this});function Yt(n){var o=n.match(he)||[];return o.join(" ")}function Jt(n){return n.getAttribute&&n.getAttribute("class")||""}function Ii(n){return Array.isArray(n)?n:typeof n=="string"?n.match(he)||[]:[]}u.fn.extend({addClass:function(n){var o,a,c,l,h,p;return R(n)?this.each(function(x){u(this).addClass(n.call(this,x,Jt(this)))}):(o=Ii(n),o.length?this.each(function(){if(c=Jt(this),a=this.nodeType===1&&" "+Yt(c)+" ",a){for(h=0;h<o.length;h++)l=o[h],a.indexOf(" "+l+" ")<0&&(a+=l+" ");p=Yt(a),c!==p&&this.setAttribute("class",p)}}):this)},removeClass:function(n){var o,a,c,l,h,p;return R(n)?this.each(function(x){u(this).removeClass(n.call(this,x,Jt(this)))}):arguments.length?(o=Ii(n),o.length?this.each(function(){if(c=Jt(this),a=this.nodeType===1&&" "+Yt(c)+" ",a){for(h=0;h<o.length;h++)for(l=o[h];a.indexOf(" "+l+" ")>-1;)a=a.replace(" "+l+" "," ");p=Yt(a),c!==p&&this.setAttribute("class",p)}}):this):this.attr("class","")},toggleClass:function(n,o){var a,c,l,h,p=typeof n,x=p==="string"||Array.isArray(n);return R(n)?this.each(function(v){u(this).toggleClass(n.call(this,v,Jt(this),o),o)}):typeof o=="boolean"&&x?o?this.addClass(n):this.removeClass(n):(a=Ii(n),this.each(function(){if(x)for(h=u(this),l=0;l<a.length;l++)c=a[l],h.hasClass(c)?h.removeClass(c):h.addClass(c);else(n===void 0||p==="boolean")&&(c=Jt(this),c&&ae.set(this,"__className__",c),this.setAttribute&&this.setAttribute("class",c||n===!1?"":ae.get(this,"__className__")||""))}))},hasClass:function(n){var o,a,c=0;for(o=" "+n+" ";a=this[c++];)if(a.nodeType===1&&(" "+Yt(Jt(a))+" ").indexOf(o)>-1)return!0;return!1}});var _f=/\r/g;u.fn.extend({val:function(n){var o,a,c,l=this[0];return arguments.length?(c=R(n),this.each(function(h){var p;this.nodeType===1&&(c?p=n.call(this,h,u(this).val()):p=n,p==null?p="":typeof p=="number"?p+="":Array.isArray(p)&&(p=u.map(p,function(x){return x==null?"":x+""})),o=u.valHooks[this.type]||u.valHooks[this.nodeName.toLowerCase()],(!o||!("set"in o)||o.set(this,p,"value")===void 0)&&(this.value=p))})):l?(o=u.valHooks[l.type]||u.valHooks[l.nodeName.toLowerCase()],o&&"get"in o&&(a=o.get(l,"value"))!==void 0?a:(a=l.value,typeof a=="string"?a.replace(_f,""):a??"")):void 0}}),u.extend({valHooks:{option:{get:function(n){var o=u.find.attr(n,"value");return o??Yt(u.text(n))}},select:{get:function(n){var o,a,c,l=n.options,h=n.selectedIndex,p=n.type==="select-one",x=p?null:[],v=p?h+1:l.length;for(h<0?c=v:c=p?h:0;c<v;c++)if(a=l[c],(a.selected||c===h)&&!a.disabled&&(!a.parentNode.disabled||!B(a.parentNode,"optgroup"))){if(o=u(a).val(),p)return o;x.push(o)}return x},set:function(n,o){for(var a,c,l=n.options,h=u.makeArray(o),p=l.length;p--;)c=l[p],(c.selected=u.inArray(u.valHooks.option.get(c),h)>-1)&&(a=!0);return a||(n.selectedIndex=-1),h}}}}),u.each(["radio","checkbox"],function(){u.valHooks[this]={set:function(n,o){if(Array.isArray(o))return n.checked=u.inArray(u(n).val(),o)>-1}},S.checkOn||(u.valHooks[this].get=function(n){return n.getAttribute("value")===null?"on":n.value})});var Rn=e.location,zs={guid:Date.now()},Mi=/\?/;u.parseXML=function(n){var o,a;if(!n||typeof n!="string")return null;try{o=new e.DOMParser().parseFromString(n,"text/xml")}catch{}return a=o&&o.getElementsByTagName("parsererror")[0],(!o||a)&&u.error("Invalid XML: "+(a?u.map(a.childNodes,function(c){return c.textContent}).join(`
`):n)),o};var Vs=/^(?:focusinfocus|focusoutblur)$/,Qs=function(n){n.stopPropagation()};u.extend(u.event,{trigger:function(n,o,a,c){var l,h,p,x,v,T,q,j,O=[a||W],Q=_.call(n,"type")?n.type:n,we=_.call(n,"namespace")?n.namespace.split("."):[];if(h=j=p=a=a||W,!(a.nodeType===3||a.nodeType===8)&&!Vs.test(Q+u.event.triggered)&&(Q.indexOf(".")>-1&&(we=Q.split("."),Q=we.shift(),we.sort()),v=Q.indexOf(":")<0&&"on"+Q,n=n[u.expando]?n:new u.Event(Q,typeof n=="object"&&n),n.isTrigger=c?2:3,n.namespace=we.join("."),n.rnamespace=n.namespace?new RegExp("(^|\\.)"+we.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,n.result=void 0,n.target||(n.target=a),o=o==null?[n]:u.makeArray(o,[n]),q=u.event.special[Q]||{},!(!c&&q.trigger&&q.trigger.apply(a,o)===!1))){if(!c&&!q.noBubble&&!K(a)){for(x=q.delegateType||Q,Vs.test(x+Q)||(h=h.parentNode);h;h=h.parentNode)O.push(h),p=h;p===(a.ownerDocument||W)&&O.push(p.defaultView||p.parentWindow||e)}for(l=0;(h=O[l++])&&!n.isPropagationStopped();)j=h,n.type=l>1?x:q.bindType||Q,T=(ae.get(h,"events")||Object.create(null))[n.type]&&ae.get(h,"handle"),T&&T.apply(h,o),T=v&&h[v],T&&T.apply&&Gt(h)&&(n.result=T.apply(h,o),n.result===!1&&n.preventDefault());return n.type=Q,!c&&!n.isDefaultPrevented()&&(!q._default||q._default.apply(O.pop(),o)===!1)&&Gt(a)&&v&&R(a[Q])&&!K(a)&&(p=a[v],p&&(a[v]=null),u.event.triggered=Q,n.isPropagationStopped()&&j.addEventListener(Q,Qs),a[Q](),n.isPropagationStopped()&&j.removeEventListener(Q,Qs),u.event.triggered=void 0,p&&(a[v]=p)),n.result}},simulate:function(n,o,a){var c=u.extend(new u.Event,a,{type:n,isSimulated:!0});u.event.trigger(c,null,o)}}),u.fn.extend({trigger:function(n,o){return this.each(function(){u.event.trigger(n,o,this)})},triggerHandler:function(n,o){var a=this[0];if(a)return u.event.trigger(n,o,a,!0)}});var Sf=/\[\]$/,Gs=/\r?\n/g,Af=/^(?:submit|button|image|reset|file)$/i,If=/^(?:input|select|textarea|keygen)/i;function Bi(n,o,a,c){var l;if(Array.isArray(o))u.each(o,function(h,p){a||Sf.test(n)?c(n,p):Bi(n+"["+(typeof p=="object"&&p!=null?h:"")+"]",p,a,c)});else if(!a&&ce(o)==="object")for(l in o)Bi(n+"["+l+"]",o[l],a,c);else c(n,o)}u.param=function(n,o){var a,c=[],l=function(h,p){var x=R(p)?p():p;c[c.length]=encodeURIComponent(h)+"="+encodeURIComponent(x??"")};if(n==null)return"";if(Array.isArray(n)||n.jquery&&!u.isPlainObject(n))u.each(n,function(){l(this.name,this.value)});else for(a in n)Bi(a,n[a],o,l);return c.join("&")},u.fn.extend({serialize:function(){return u.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var n=u.prop(this,"elements");return n?u.makeArray(n):this}).filter(function(){var n=this.type;return this.name&&!u(this).is(":disabled")&&If.test(this.nodeName)&&!Af.test(n)&&(this.checked||!Nn.test(n))}).map(function(n,o){var a=u(this).val();return a==null?null:Array.isArray(a)?u.map(a,function(c){return{name:o.name,value:c.replace(Gs,`\r
`)}}):{name:o.name,value:a.replace(Gs,`\r
`)}}).get()}});var Mf=/%20/g,Bf=/#.*$/,Of=/([?&])_=[^&]*/,Pf=/^(.*?):[ \t]*([^\r\n]*)$/mg,Df=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Nf=/^(?:GET|HEAD)$/,qf=/^\/\//,Zs={},Oi={},Xs="*/".concat("*"),Pi=W.createElement("a");Pi.href=Rn.href;function Ys(n){return function(o,a){typeof o!="string"&&(a=o,o="*");var c,l=0,h=o.toLowerCase().match(he)||[];if(R(a))for(;c=h[l++];)c[0]==="+"?(c=c.slice(1)||"*",(n[c]=n[c]||[]).unshift(a)):(n[c]=n[c]||[]).push(a)}}function Js(n,o,a,c){var l={},h=n===Oi;function p(x){var v;return l[x]=!0,u.each(n[x]||[],function(T,q){var j=q(o,a,c);if(typeof j=="string"&&!h&&!l[j])return o.dataTypes.unshift(j),p(j),!1;if(h)return!(v=j)}),v}return p(o.dataTypes[0])||!l["*"]&&p("*")}function Di(n,o){var a,c,l=u.ajaxSettings.flatOptions||{};for(a in o)o[a]!==void 0&&((l[a]?n:c||(c={}))[a]=o[a]);return c&&u.extend(!0,n,c),n}function Lf(n,o,a){for(var c,l,h,p,x=n.contents,v=n.dataTypes;v[0]==="*";)v.shift(),c===void 0&&(c=n.mimeType||o.getResponseHeader("Content-Type"));if(c){for(l in x)if(x[l]&&x[l].test(c)){v.unshift(l);break}}if(v[0]in a)h=v[0];else{for(l in a){if(!v[0]||n.converters[l+" "+v[0]]){h=l;break}p||(p=l)}h=h||p}if(h)return h!==v[0]&&v.unshift(h),a[h]}function Rf(n,o,a,c){var l,h,p,x,v,T={},q=n.dataTypes.slice();if(q[1])for(p in n.converters)T[p.toLowerCase()]=n.converters[p];for(h=q.shift();h;)if(n.responseFields[h]&&(a[n.responseFields[h]]=o),!v&&c&&n.dataFilter&&(o=n.dataFilter(o,n.dataType)),v=h,h=q.shift(),h){if(h==="*")h=v;else if(v!=="*"&&v!==h){if(p=T[v+" "+h]||T["* "+h],!p){for(l in T)if(x=l.split(" "),x[1]===h&&(p=T[v+" "+x[0]]||T["* "+x[0]],p)){p===!0?p=T[l]:T[l]!==!0&&(h=x[0],q.unshift(x[1]));break}}if(p!==!0)if(p&&n.throws)o=p(o);else try{o=p(o)}catch(j){return{state:"parsererror",error:p?j:"No conversion from "+v+" to "+h}}}}return{state:"success",data:o}}u.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Rn.href,type:"GET",isLocal:Df.test(Rn.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Xs,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":u.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(n,o){return o?Di(Di(n,u.ajaxSettings),o):Di(u.ajaxSettings,n)},ajaxPrefilter:Ys(Zs),ajaxTransport:Ys(Oi),ajax:function(n,o){typeof n=="object"&&(o=n,n=void 0),o=o||{};var a,c,l,h,p,x,v,T,q,j,O=u.ajaxSetup({},o),Q=O.context||O,we=O.context&&(Q.nodeType||Q.jquery)?u(Q):u.event,Ie=u.Deferred(),xe=u.Callbacks("once memory"),ze=O.statusCode||{},Fe={},bt={},vt="canceled",Se={readyState:0,getResponseHeader:function(Me){var Ue;if(v){if(!h)for(h={};Ue=Pf.exec(l);)h[Ue[1].toLowerCase()+" "]=(h[Ue[1].toLowerCase()+" "]||[]).concat(Ue[2]);Ue=h[Me.toLowerCase()+" "]}return Ue==null?null:Ue.join(", ")},getAllResponseHeaders:function(){return v?l:null},setRequestHeader:function(Me,Ue){return v==null&&(Me=bt[Me.toLowerCase()]=bt[Me.toLowerCase()]||Me,Fe[Me]=Ue),this},overrideMimeType:function(Me){return v==null&&(O.mimeType=Me),this},statusCode:function(Me){var Ue;if(Me)if(v)Se.always(Me[Se.status]);else for(Ue in Me)ze[Ue]=[ze[Ue],Me[Ue]];return this},abort:function(Me){var Ue=Me||vt;return a&&a.abort(Ue),en(0,Ue),this}};if(Ie.promise(Se),O.url=((n||O.url||Rn.href)+"").replace(qf,Rn.protocol+"//"),O.type=o.method||o.type||O.method||O.type,O.dataTypes=(O.dataType||"*").toLowerCase().match(he)||[""],O.crossDomain==null){x=W.createElement("a");try{x.href=O.url,x.href=x.href,O.crossDomain=Pi.protocol+"//"+Pi.host!=x.protocol+"//"+x.host}catch{O.crossDomain=!0}}if(O.data&&O.processData&&typeof O.data!="string"&&(O.data=u.param(O.data,O.traditional)),Js(Zs,O,o,Se),v)return Se;T=u.event&&O.global,T&&u.active++===0&&u.event.trigger("ajaxStart"),O.type=O.type.toUpperCase(),O.hasContent=!Nf.test(O.type),c=O.url.replace(Bf,""),O.hasContent?O.data&&O.processData&&(O.contentType||"").indexOf("application/x-www-form-urlencoded")===0&&(O.data=O.data.replace(Mf,"+")):(j=O.url.slice(c.length),O.data&&(O.processData||typeof O.data=="string")&&(c+=(Mi.test(c)?"&":"?")+O.data,delete O.data),O.cache===!1&&(c=c.replace(Of,"$1"),j=(Mi.test(c)?"&":"?")+"_="+zs.guid+++j),O.url=c+j),O.ifModified&&(u.lastModified[c]&&Se.setRequestHeader("If-Modified-Since",u.lastModified[c]),u.etag[c]&&Se.setRequestHeader("If-None-Match",u.etag[c])),(O.data&&O.hasContent&&O.contentType!==!1||o.contentType)&&Se.setRequestHeader("Content-Type",O.contentType),Se.setRequestHeader("Accept",O.dataTypes[0]&&O.accepts[O.dataTypes[0]]?O.accepts[O.dataTypes[0]]+(O.dataTypes[0]!=="*"?", "+Xs+"; q=0.01":""):O.accepts["*"]);for(q in O.headers)Se.setRequestHeader(q,O.headers[q]);if(O.beforeSend&&(O.beforeSend.call(Q,Se,O)===!1||v))return Se.abort();if(vt="abort",xe.add(O.complete),Se.done(O.success),Se.fail(O.error),a=Js(Oi,O,o,Se),!a)en(-1,"No Transport");else{if(Se.readyState=1,T&&we.trigger("ajaxSend",[Se,O]),v)return Se;O.async&&O.timeout>0&&(p=e.setTimeout(function(){Se.abort("timeout")},O.timeout));try{v=!1,a.send(Fe,en)}catch(Me){if(v)throw Me;en(-1,Me)}}function en(Me,Ue,Un,qi){var xt,Fn,kt,Ht,Ut,st=Ue;v||(v=!0,p&&e.clearTimeout(p),a=void 0,l=qi||"",Se.readyState=Me>0?4:0,xt=Me>=200&&Me<300||Me===304,Un&&(Ht=Lf(O,Se,Un)),!xt&&u.inArray("script",O.dataTypes)>-1&&u.inArray("json",O.dataTypes)<0&&(O.converters["text script"]=function(){}),Ht=Rf(O,Ht,Se,xt),xt?(O.ifModified&&(Ut=Se.getResponseHeader("Last-Modified"),Ut&&(u.lastModified[c]=Ut),Ut=Se.getResponseHeader("etag"),Ut&&(u.etag[c]=Ut)),Me===204||O.type==="HEAD"?st="nocontent":Me===304?st="notmodified":(st=Ht.state,Fn=Ht.data,kt=Ht.error,xt=!kt)):(kt=st,(Me||!st)&&(st="error",Me<0&&(Me=0))),Se.status=Me,Se.statusText=(Ue||st)+"",xt?Ie.resolveWith(Q,[Fn,st,Se]):Ie.rejectWith(Q,[Se,st,kt]),Se.statusCode(ze),ze=void 0,T&&we.trigger(xt?"ajaxSuccess":"ajaxError",[Se,O,xt?Fn:kt]),xe.fireWith(Q,[Se,st]),T&&(we.trigger("ajaxComplete",[Se,O]),--u.active||u.event.trigger("ajaxStop")))}return Se},getJSON:function(n,o,a){return u.get(n,o,a,"json")},getScript:function(n,o){return u.get(n,void 0,o,"script")}}),u.each(["get","post"],function(n,o){u[o]=function(a,c,l,h){return R(c)&&(h=h||l,l=c,c=void 0),u.ajax(u.extend({url:a,type:o,dataType:h,data:c,success:l},u.isPlainObject(a)&&a))}}),u.ajaxPrefilter(function(n){var o;for(o in n.headers)o.toLowerCase()==="content-type"&&(n.contentType=n.headers[o]||"")}),u._evalUrl=function(n,o,a){return u.ajax({url:n,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(c){u.globalEval(c,o,a)}})},u.fn.extend({wrapAll:function(n){var o;return this[0]&&(R(n)&&(n=n.call(this[0])),o=u(n,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&o.insertBefore(this[0]),o.map(function(){for(var a=this;a.firstElementChild;)a=a.firstElementChild;return a}).append(this)),this},wrapInner:function(n){return R(n)?this.each(function(o){u(this).wrapInner(n.call(this,o))}):this.each(function(){var o=u(this),a=o.contents();a.length?a.wrapAll(n):o.append(n)})},wrap:function(n){var o=R(n);return this.each(function(a){u(this).wrapAll(o?n.call(this,a):n)})},unwrap:function(n){return this.parent(n).not("body").each(function(){u(this).replaceWith(this.childNodes)}),this}}),u.expr.pseudos.hidden=function(n){return!u.expr.pseudos.visible(n)},u.expr.pseudos.visible=function(n){return!!(n.offsetWidth||n.offsetHeight||n.getClientRects().length)},u.ajaxSettings.xhr=function(){try{return new e.XMLHttpRequest}catch{}};var Hf={0:200,1223:204},Hn=u.ajaxSettings.xhr();S.cors=!!Hn&&"withCredentials"in Hn,S.ajax=Hn=!!Hn,u.ajaxTransport(function(n){var o,a;if(S.cors||Hn&&!n.crossDomain)return{send:function(c,l){var h,p=n.xhr();if(p.open(n.type,n.url,n.async,n.username,n.password),n.xhrFields)for(h in n.xhrFields)p[h]=n.xhrFields[h];n.mimeType&&p.overrideMimeType&&p.overrideMimeType(n.mimeType),!n.crossDomain&&!c["X-Requested-With"]&&(c["X-Requested-With"]="XMLHttpRequest");for(h in c)p.setRequestHeader(h,c[h]);o=function(x){return function(){o&&(o=a=p.onload=p.onerror=p.onabort=p.ontimeout=p.onreadystatechange=null,x==="abort"?p.abort():x==="error"?typeof p.status!="number"?l(0,"error"):l(p.status,p.statusText):l(Hf[p.status]||p.status,p.statusText,(p.responseType||"text")!=="text"||typeof p.responseText!="string"?{binary:p.response}:{text:p.responseText},p.getAllResponseHeaders()))}},p.onload=o(),a=p.onerror=p.ontimeout=o("error"),p.onabort!==void 0?p.onabort=a:p.onreadystatechange=function(){p.readyState===4&&e.setTimeout(function(){o&&a()})},o=o("abort");try{p.send(n.hasContent&&n.data||null)}catch(x){if(o)throw x}},abort:function(){o&&o()}}}),u.ajaxPrefilter(function(n){n.crossDomain&&(n.contents.script=!1)}),u.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(n){return u.globalEval(n),n}}}),u.ajaxPrefilter("script",function(n){n.cache===void 0&&(n.cache=!1),n.crossDomain&&(n.type="GET")}),u.ajaxTransport("script",function(n){if(n.crossDomain||n.scriptAttrs){var o,a;return{send:function(c,l){o=u("<script>").attr(n.scriptAttrs||{}).prop({charset:n.scriptCharset,src:n.url}).on("load error",a=function(h){o.remove(),a=null,h&&l(h.type==="error"?404:200,h.type)}),W.head.appendChild(o[0])},abort:function(){a&&a()}}}});var ea=[],Ni=/(=)\?(?=&|$)|\?\?/;u.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var n=ea.pop()||u.expando+"_"+zs.guid++;return this[n]=!0,n}}),u.ajaxPrefilter("json jsonp",function(n,o,a){var c,l,h,p=n.jsonp!==!1&&(Ni.test(n.url)?"url":typeof n.data=="string"&&(n.contentType||"").indexOf("application/x-www-form-urlencoded")===0&&Ni.test(n.data)&&"data");if(p||n.dataTypes[0]==="jsonp")return c=n.jsonpCallback=R(n.jsonpCallback)?n.jsonpCallback():n.jsonpCallback,p?n[p]=n[p].replace(Ni,"$1"+c):n.jsonp!==!1&&(n.url+=(Mi.test(n.url)?"&":"?")+n.jsonp+"="+c),n.converters["script json"]=function(){return h||u.error(c+" was not called"),h[0]},n.dataTypes[0]="json",l=e[c],e[c]=function(){h=arguments},a.always(function(){l===void 0?u(e).removeProp(c):e[c]=l,n[c]&&(n.jsonpCallback=o.jsonpCallback,ea.push(c)),h&&R(l)&&l(h[0]),h=l=void 0}),"script"}),S.createHTMLDocument=(function(){var n=W.implementation.createHTMLDocument("").body;return n.innerHTML="<form></form><form></form>",n.childNodes.length===2})(),u.parseHTML=function(n,o,a){if(typeof n!="string")return[];typeof o=="boolean"&&(a=o,o=!1);var c,l,h;return o||(S.createHTMLDocument?(o=W.implementation.createHTMLDocument(""),c=o.createElement("base"),c.href=W.location.href,o.head.appendChild(c)):o=W),l=$.exec(n),h=!a&&[],l?[o.createElement(l[1])]:(l=Ms([n],o,h),h&&h.length&&u(h).remove(),u.merge([],l.childNodes))},u.fn.load=function(n,o,a){var c,l,h,p=this,x=n.indexOf(" ");return x>-1&&(c=Yt(n.slice(x)),n=n.slice(0,x)),R(o)?(a=o,o=void 0):o&&typeof o=="object"&&(l="POST"),p.length>0&&u.ajax({url:n,type:l||"GET",dataType:"html",data:o}).done(function(v){h=arguments,p.html(c?u("<div>").append(u.parseHTML(v)).find(c):v)}).always(a&&function(v,T){p.each(function(){a.apply(this,h||[v.responseText,T,v])})}),this},u.expr.pseudos.animated=function(n){return u.grep(u.timers,function(o){return n===o.elem}).length},u.offset={setOffset:function(n,o,a){var c,l,h,p,x,v,T,q=u.css(n,"position"),j=u(n),O={};q==="static"&&(n.style.position="relative"),x=j.offset(),h=u.css(n,"top"),v=u.css(n,"left"),T=(q==="absolute"||q==="fixed")&&(h+v).indexOf("auto")>-1,T?(c=j.position(),p=c.top,l=c.left):(p=parseFloat(h)||0,l=parseFloat(v)||0),R(o)&&(o=o.call(n,a,u.extend({},x))),o.top!=null&&(O.top=o.top-x.top+p),o.left!=null&&(O.left=o.left-x.left+l),"using"in o?o.using.call(n,O):j.css(O)}},u.fn.extend({offset:function(n){if(arguments.length)return n===void 0?this:this.each(function(l){u.offset.setOffset(this,n,l)});var o,a,c=this[0];if(c)return c.getClientRects().length?(o=c.getBoundingClientRect(),a=c.ownerDocument.defaultView,{top:o.top+a.pageYOffset,left:o.left+a.pageXOffset}):{top:0,left:0}},position:function(){if(this[0]){var n,o,a,c=this[0],l={top:0,left:0};if(u.css(c,"position")==="fixed")o=c.getBoundingClientRect();else{for(o=this.offset(),a=c.ownerDocument,n=c.offsetParent||a.documentElement;n&&(n===a.body||n===a.documentElement)&&u.css(n,"position")==="static";)n=n.parentNode;n&&n!==c&&n.nodeType===1&&(l=u(n).offset(),l.top+=u.css(n,"borderTopWidth",!0),l.left+=u.css(n,"borderLeftWidth",!0))}return{top:o.top-l.top-u.css(c,"marginTop",!0),left:o.left-l.left-u.css(c,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var n=this.offsetParent;n&&u.css(n,"position")==="static";)n=n.offsetParent;return n||Xt})}}),u.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(n,o){var a=o==="pageYOffset";u.fn[n]=function(c){return Re(this,function(l,h,p){var x;if(K(l)?x=l:l.nodeType===9&&(x=l.defaultView),p===void 0)return x?x[o]:l[h];x?x.scrollTo(a?x.pageXOffset:p,a?p:x.pageYOffset):l[h]=p},n,c,arguments.length)}}),u.each(["top","left"],function(n,o){u.cssHooks[o]=qs(S.pixelPosition,function(a,c){if(c)return c=qn(a,o),Ci.test(c)?u(a).position()[o]+"px":c})}),u.each({Height:"height",Width:"width"},function(n,o){u.each({padding:"inner"+n,content:o,"":"outer"+n},function(a,c){u.fn[c]=function(l,h){var p=arguments.length&&(a||typeof l!="boolean"),x=a||(l===!0||h===!0?"margin":"border");return Re(this,function(v,T,q){var j;return K(v)?c.indexOf("outer")===0?v["inner"+n]:v.document.documentElement["client"+n]:v.nodeType===9?(j=v.documentElement,Math.max(v.body["scroll"+n],j["scroll"+n],v.body["offset"+n],j["offset"+n],j["client"+n])):q===void 0?u.css(v,T,x):u.style(v,T,q,x)},o,p?l:void 0,p)}})}),u.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(n,o){u.fn[o]=function(a){return this.on(o,a)}}),u.fn.extend({bind:function(n,o,a){return this.on(n,null,o,a)},unbind:function(n,o){return this.off(n,null,o)},delegate:function(n,o,a,c){return this.on(o,n,a,c)},undelegate:function(n,o,a){return arguments.length===1?this.off(n,"**"):this.off(o,n||"**",a)},hover:function(n,o){return this.on("mouseenter",n).on("mouseleave",o||n)}}),u.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(n,o){u.fn[o]=function(a,c){return arguments.length>0?this.on(o,null,a,c):this.trigger(o)}});var Uf=/^[\s\uFEFF\xA0]+|([^\s\uFEFF\xA0])[\s\uFEFF\xA0]+$/g;u.proxy=function(n,o){var a,c,l;if(typeof o=="string"&&(a=n[o],o=n,n=a),!!R(n))return c=f.call(arguments,2),l=function(){return n.apply(o||this,c.concat(f.call(arguments)))},l.guid=n.guid=n.guid||u.guid++,l},u.holdReady=function(n){n?u.readyWait++:u.ready(!0)},u.isArray=Array.isArray,u.parseJSON=JSON.parse,u.nodeName=B,u.isFunction=R,u.isWindow=K,u.camelCase=it,u.type=ce,u.now=Date.now,u.isNumeric=function(n){var o=u.type(n);return(o==="number"||o==="string")&&!isNaN(n-parseFloat(n))},u.trim=function(n){return n==null?"":(n+"").replace(Uf,"$1")};var Ff=e.jQuery,jf=e.$;return u.noConflict=function(n){return e.$===u&&(e.$=jf),n&&e.jQuery===u&&(e.jQuery=Ff),u},typeof t>"u"&&(e.jQuery=e.$=u),u})})(fr)),fr.exports}var xs;function ef(){return xs||(xs=1,(function(i){(function(e){e(["jquery"],function(t){return(function(){var r,s,f=0,d={error:"error",info:"info",success:"success",warning:"warning"},g={clear:R,remove:K,error:w,getContainer:C,info:_,options:{},subscribe:A,success:I,version:"2.1.4",warning:S},y;return g;function w(B,L,pe){return Ae({type:d.error,iconClass:u().iconClasses.error,message:B,optionsOverride:pe,title:L})}function C(B,L){return B||(B=u()),r=t("#"+B.containerId),r.length||L&&(r=ue(B)),r}function _(B,L,pe){return Ae({type:d.info,iconClass:u().iconClasses.info,message:B,optionsOverride:pe,title:L})}function A(B){s=B}function I(B,L,pe){return Ae({type:d.success,iconClass:u().iconClasses.success,message:B,optionsOverride:pe,title:L})}function S(B,L,pe){return Ae({type:d.warning,iconClass:u().iconClasses.warning,message:B,optionsOverride:pe,title:L})}function R(B,L){var pe=u();r||C(pe),de(B,pe,L)||W(pe)}function K(B){var L=u();if(r||C(L),B&&t(":focus",B).length===0){J(B);return}r.children().length&&r.remove()}function W(B){for(var L=r.children(),pe=L.length-1;pe>=0;pe--)de(t(L[pe]),B)}function de(B,L,pe){var oe=pe&&pe.force?pe.force:!1;return B&&(oe||t(":focus",B).length===0)?(B[L.hideMethod]({duration:L.hideDuration,easing:L.hideEasing,complete:function(){J(B)}}),!0):!1}function ue(B){return r=t("<div/>").attr("id",B.containerId).addClass(B.positionClass),r.appendTo(t(B.target)),r}function ce(){return{tapToDismiss:!0,toastClass:"toast",containerId:"toast-container",debug:!1,showMethod:"fadeIn",showDuration:300,showEasing:"swing",onShown:void 0,hideMethod:"fadeOut",hideDuration:1e3,hideEasing:"swing",onHidden:void 0,closeMethod:!1,closeDuration:!1,closeEasing:!1,closeOnHover:!0,extendedTimeOut:1e3,iconClasses:{error:"toast-error",info:"toast-info",success:"toast-success",warning:"toast-warning"},iconClass:"toast-info",positionClass:"toast-top-right",timeOut:5e3,titleClass:"toast-title",messageClass:"toast-message",escapeHtml:!1,target:"body",closeHtml:'<button type="button">&times;</button>',closeClass:"toast-close-button",newestOnTop:!0,preventDuplicates:!1,progressBar:!1,progressClass:"toast-progress",rtl:!1}}function ve(B){s&&s(B)}function Ae(B){var L=u(),pe=B.iconClass||L.iconClass;if(typeof B.optionsOverride<"u"&&(L=t.extend(L,B.optionsOverride),pe=B.optionsOverride.iconClass||pe),Ee(L,B))return;f++,r=C(L,!0);var oe=null,P=t("<div/>"),z=t("<div/>"),H=t("<div/>"),Z=t("<div/>"),D=t(L.closeHtml),F={intervalId:null,hideEta:null,maxHideTime:null},V={toastId:f,state:"visible",startTime:new Date,options:L,map:B};return b(),ee(),G(),ve(V),L.debug&&console&&console.log(V),P;function k(ye){return ye==null&&(ye=""),ye.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function b(){X(),te(),le(),fe(),he(),ke(),ie(),$()}function $(){var ye="";switch(B.iconClass){case"toast-success":case"toast-info":ye="polite";break;default:ye="assertive"}P.attr("aria-live",ye)}function G(){L.closeOnHover&&P.hover(Ke,Ce),!L.onclick&&L.tapToDismiss&&P.click(Oe),L.closeButton&&D&&D.click(function(ye){ye.stopPropagation?ye.stopPropagation():ye.cancelBubble!==void 0&&ye.cancelBubble!==!0&&(ye.cancelBubble=!0),L.onCloseClick&&L.onCloseClick(ye),Oe(!0)}),L.onclick&&P.click(function(ye){L.onclick(ye),Oe()})}function ee(){P.hide(),P[L.showMethod]({duration:L.showDuration,easing:L.showEasing,complete:L.onShown}),L.timeOut>0&&(oe=setTimeout(Oe,L.timeOut),F.maxHideTime=parseFloat(L.timeOut),F.hideEta=new Date().getTime()+F.maxHideTime,L.progressBar&&(F.intervalId=setInterval($e,10)))}function X(){B.iconClass&&P.addClass(L.toastClass).addClass(pe)}function ie(){L.newestOnTop?r.prepend(P):r.append(P)}function te(){if(B.title){var ye=B.title;L.escapeHtml&&(ye=k(B.title)),z.append(ye).addClass(L.titleClass),P.append(z)}}function le(){if(B.message){var ye=B.message;L.escapeHtml&&(ye=k(B.message)),H.append(ye).addClass(L.messageClass),P.append(H)}}function fe(){L.closeButton&&(D.addClass(L.closeClass).attr("role","button"),P.prepend(D))}function he(){L.progressBar&&(Z.addClass(L.progressClass),P.prepend(Z))}function ke(){L.rtl&&P.addClass("rtl")}function Ee(ye,Re){if(ye.preventDuplicates){if(Re.message===y)return!0;y=Re.message}return!1}function Oe(ye){var Re=ye&&L.closeMethod!==!1?L.closeMethod:L.hideMethod,lt=ye&&L.closeDuration!==!1?L.closeDuration:L.hideDuration,Je=ye&&L.closeEasing!==!1?L.closeEasing:L.hideEasing;if(!(t(":focus",P).length&&!ye))return clearTimeout(F.intervalId),P[Re]({duration:lt,easing:Je,complete:function(){J(P),clearTimeout(oe),L.onHidden&&V.state!=="hidden"&&L.onHidden(),V.state="hidden",V.endTime=new Date,ve(V)}})}function Ce(){(L.timeOut>0||L.extendedTimeOut>0)&&(oe=setTimeout(Oe,L.extendedTimeOut),F.maxHideTime=parseFloat(L.extendedTimeOut),F.hideEta=new Date().getTime()+F.maxHideTime)}function Ke(){clearTimeout(oe),F.hideEta=0,P.stop(!0,!0)[L.showMethod]({duration:L.showDuration,easing:L.showEasing})}function $e(){var ye=(F.hideEta-new Date().getTime())/F.maxHideTime*100;Z.width(ye+"%")}}function u(){return t.extend({},ce(),g.options)}function J(B){r||(r=C()),!B.is(":visible")&&(B.remove(),B=null,r.children().length===0&&(r.remove(),y=void 0))}})()})})(function(e,t){i.exports?i.exports=t(Jc()):window.toastr=t(window.jQuery)})})(mi)),mi.exports}var tf=ef();const wt=Xc(tf);function nf(i){if(!navigator.clipboard){rf(i);return}navigator.clipboard.writeText(i).then(function(){wt.success("Copied!")},function(e){console.error("Async: Could not copy text: ",e)})}function rf(i){var e=document.createElement("textarea");e.value=i,e.style.top="0",e.style.left="0",e.style.position="fixed",document.body.appendChild(e),e.focus(),e.select();try{var t=document.execCommand("copy");t&&wt.success("Copied!")}catch(r){wt.error("Copy failed"),console.error("Fallback: Oops, unable to copy",r)}document.body.removeChild(e)}function of(){var i=250,e=Date.now()+i;(function t(){yi({particleCount:7,angle:60,spread:55,origin:{x:0}}),yi({particleCount:7,angle:120,spread:55,origin:{x:1}}),Date.now()<e&&requestAnimationFrame(t)})(),yi.reset()}const ks=i=>new Promise(e=>setTimeout(e,i));function Pn(i,e="Unknown error"){return i instanceof Error?i.message:typeof i=="string"?i:i&&typeof i=="object"&&"message"in i?String(i.message):e}wt.options={positionClass:"toast-bottom-center"};const lr=new AbortController;window.addEventListener("pagehide",()=>lr.abort(),{once:!0}),window.addEventListener("beforeunload",()=>lr.abort(),{once:!0});const wi=new Map;function Es(i,e="sat"){const t=`${String(i).replace(/\/+$/,"")}|${e}`,r=wi.get(t);if(r)return r;const s=(async()=>{const f=new pi(i,{unit:e});return await f.loadMint(),f})();return s.catch(()=>wi.delete(t)),wi.set(t,s),s}jQuery(function(i){const e=i("#cashu-pay-root");if(e.length===0)return;let t;try{t=sf(e)}catch{e.parent().find(".cashu-foot").text("Payment data incomplete, please refresh and try again.");return}const r=e.parent(),s=r.find("form.cashu-token"),f=r.find("[data-cashu-token-input]"),d=s.find('button[type="submit"]'),g=r.find(".cashu-foot"),y=r.find("#cashu-qr"),w=D=>g.text(D),C=D=>{d.prop("disabled",D),f.prop("disabled",D)},_=()=>String(f.val()??"").trim(),A={mq:`cashu_wc_mq_${t.orderId}`,change:`cashu_wc_change_${t.orderId}`,recovery:`cashu_wc_recovery_${t.orderId}`},I=Es(t.trustedMint,"sat");let S=!1,R=!1,K=null;async function W(D){if(S)return wt.error("Payment already in progress"),Promise.resolve(void 0);S=!0,C(!0);try{return await D()}catch(F){wt.error(Pn(F)),w(Pn(F))}finally{S=!1,C(!1)}}function de(D){try{const F=localStorage.getItem(D);return F?JSON.parse(F):null}catch{return null}}function ue(D,F){try{localStorage.setItem(D,JSON.stringify(F))}catch{}}function ce(D){try{localStorage.removeItem(D)}catch{}}function ve(D){const F=D.map(b=>String(b).trim()).filter(Boolean);if(F.length===0)return;const V=de(A.change)??[],k=Array.from(new Set([...V,...F])).slice(-10);ue(A.change,k)}function Ae(D,F){const V=Array.isArray(D?.change)?D.change:[];return V.length===0?"":us({mint:F,proofs:V,unit:"sat"})}function u(D){const F=y.get(0);!F||typeof QRCode>"u"||(F.innerHTML="",new QRCode(F,{text:D,width:360,height:360,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.Q}))}function J(D){if(!D||!D.quote||!D.request||!D.mint||D.amount!==t.expectedPaySats||!Ts(D.mint,t.trustedMint))return!1;const F=typeof D.expiry=="number"?D.expiry:0,V=Math.floor(Date.now()/1e3);return!(F>0&&F<=V)}async function B(){return K||(K=(async()=>{const D=de(A.mq);if(J(D))return D;const V=await(await I).createMintQuoteBolt11(t.expectedPaySats),k={mint:t.trustedMint,amount:t.expectedPaySats,quote:V.quote,request:V.request,expiry:V.expiry??null};return ue(A.mq,k),k})(),K.catch(()=>{K=null}),K)}async function L(D=[]){const F=String(window.cashu_wc?.rest_root??""),V=String(window.cashu_wc?.confirm_route??"");if(!F||!V)return null;const k=F.replace(/\/?$/,"/")+V.replace(/^\//,""),b=de(A.change)??[],$=Array.from(new Set([...b,...D.map(String)])).filter(Boolean),G={order_id:t.orderId,order_key:t.orderKey,quote_id:t.quoteId};$.length>0&&(G.change_tokens=$);try{const X=await(await fetch(k,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"same-origin",body:JSON.stringify(G)})).json();return X?.state==="PAID"&&(of(),await ks(2e3),window.location.assign(String(X.redirect??t.returnUrl))),X?.state==="EXPIRED"&&w("This payment quote has expired, please refresh the page."),X??null}catch{return null}}async function pe(D,F){for(let V=0;V<D;V++){const k=await L();if(k?.state==="PAID"||k?.state==="EXPIRED")return;await ks(F)}}async function oe(D,F){const V=Lt(D),k=F.getFeesForProofs(D);if(V-k<t.expectedPaySats){w(`Token amount (${V}) is too small after mint fees (${k}). Please paste a larger token.`);return}try{const X=us({mint:t.trustedMint,proofs:D,unit:"sat"});localStorage.setItem(A.recovery,X)}catch{}w("Paying invoice...");const b=F,$=await b.checkMeltQuoteBolt11(t.quoteId),G=await b.meltProofsBolt11($,D);wt.info("Melted proofs to pay invoice.");try{localStorage.removeItem(A.recovery)}catch{}const ee=Ae(G,b.mint.mintUrl);ee&&(ve([ee]),L([ee])),w("Confirming payment..."),await pe(12,1200)}async function P(D){R||(R=!0,await W(async()=>{w("Payment detected, finalising...");const F=await I,V=await F.mintProofsBolt11(t.expectedPaySats,D.quote);wt.info("Minted proofs at trusted mint"),ce(A.mq),await oe(V,F)}))}async function z(){const D=await B();u("lightning:"+D.request),y.off("click").on("click",()=>{nf(D.request)});const F=await I;if((await F.checkMintQuoteBolt11(D.quote)).state==="PAID"){P(D);return}try{const k=Cs(D.expiry);await F.on.onceMintPaid(D.quote,{signal:lr.signal,timeoutMs:k}),P(D)}catch(k){wt.error(Pn(k)),w(Pn(k))}}async function H(){try{const D=await I,F=Cs(t.quoteExpiry);await D.on.onceMeltPaid(t.quoteId,{signal:lr.signal,timeoutMs:F}),w("Payment detected, finalising..."),await L()}catch{}}async function Z(D){w("Checking token...");let F;try{F=Mc(D)}catch(Ee){wt.error(Pn(Ee)),w("That token does not look valid.");return}const V=String(F.mint??"").trim(),k=String(F.unit??"sat");if(!V||F.amount===0){w("Token has no spendable proofs.");return}if(k!=="sat"){w("This checkout expects sat denominated tokens.");return}w("Connecting to mint...");const b=await Es(V,"sat");let G=b.decodeToken(D).proofs;if(!Array.isArray(G)||G.length===0){w("Token has no usable proofs.");return}if(Ts(V,t.trustedMint)){const Ee=await I;await oe(G,Ee);return}const ee=await B(),X=Lt(G),ie=b.getFeesForProofs(G);w("Calculating your mintâ€™s fees...");const te=await b.createMeltQuoteBolt11(ee.request),le=te.amount+te.fee_reserve+ie,fe=te.fee_reserve+ie;if(X<le){w(`Token amount (${X}) is too small. Please paste a token of at least ${le} sats to cover your mintâ€™s fees (${fe}).`);return}w("Sending payment...");const he=await b.meltProofsBolt11(te,G),ke=Ae(he,b.mint.mintUrl);ke&&(ve([ke]),L([ke])),w("Waiting for payment confirmation...")}C(!1),w("Preparing payment..."),s.off("submit").on("submit",D=>{D.preventDefault();const F=_();if(!F){w("Paste a Cashu token first.");return}W(()=>Z(F))}),f.off("paste").on("paste",()=>{window.setTimeout(()=>{const D=_();W(()=>Z(D))},0)}),z().catch(()=>{w("Could not prepare the invoice, please refresh and try again.")}),H(),L(),w("Pay using the QR code, or paste a Cashu token.")});function sf(i){const e=Number(i.data("order-id")),t=String(i.data("order-key")??""),r=String(i.data("return-url")??""),s=Number(i.data("pay-amount-sats")??0),f=String(i.data("melt-quote-id")??""),d=Number(i.data("melt-quote-expiry")??0),g=String(i.data("trusted-mint")??"");if(!Number.isFinite(e)||e<=0||!t||!r||!g||!Number.isFinite(s)||s<=0||!f)throw new Error("bad");return{orderId:e,orderKey:t,returnUrl:r,expectedPaySats:s,quoteId:f,quoteExpiry:d,trustedMint:g}}function Cs(i){const e=Math.floor(Date.now()/1e3);return typeof i=="number"&&i>e?Math.max(1e4,(i-e+30)*1e3):900*1e3}function Ts(i,e){try{const t=new URL(i),r=new URL(e),s=t.origin+t.pathname.replace(/\/+$/,""),f=r.origin+r.pathname.replace(/\/+$/,"");return s===f}catch{return i.replace(/\/+$/,"")===e.replace(/\/+$/,"")}}})();

(function(){"use strict";const on=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function Gn(i){return i instanceof Uint8Array||ArrayBuffer.isView(i)&&i.constructor.name==="Uint8Array"}function Ar(i){if(!Number.isSafeInteger(i)||i<0)throw new Error("positive integer expected, got "+i)}function rt(i,...e){if(!Gn(i))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(i.length))throw new Error("Uint8Array expected of length "+e+", got length="+i.length)}function Ji(i){if(typeof i!="function"||typeof i.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");Ar(i.outputLen),Ar(i.blockLen)}function Zn(i,e=!0){if(i.destroyed)throw new Error("Hash instance has been destroyed");if(e&&i.finished)throw new Error("Hash#digest() has already been called")}function pa(i,e){rt(i);const t=e.outputLen;if(i.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}function Pt(...i){for(let e=0;e<i.length;e++)i[e].fill(0)}function sn(i){return new DataView(i.buffer,i.byteOffset,i.byteLength)}function mt(i,e){return i<<32-e|i>>>e}function Xn(i,e){return i<<e|i>>>32-e>>>0}const eo=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",ga=Array.from({length:256},(i,e)=>e.toString(16).padStart(2,"0"));function De(i){if(rt(i),eo)return i.toHex();let e="";for(let t=0;t<i.length;t++)e+=ga[i[t]];return e}const Tt={_0:48,_9:57,A:65,F:70,a:97,f:102};function to(i){if(i>=Tt._0&&i<=Tt._9)return i-Tt._0;if(i>=Tt.A&&i<=Tt.F)return i-(Tt.A-10);if(i>=Tt.a&&i<=Tt.f)return i-(Tt.a-10)}function qe(i){if(typeof i!="string")throw new Error("hex string expected, got "+typeof i);if(eo)return Uint8Array.fromHex(i);const e=i.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(t);for(let s=0,f=0;s<t;s++,f+=2){const d=to(i.charCodeAt(f)),p=to(i.charCodeAt(f+1));if(d===void 0||p===void 0){const y=i[f]+i[f+1];throw new Error('hex string expected, got non-hex character "'+y+'" at index '+f)}r[s]=d*16+p}return r}function In(i){if(typeof i!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(i))}function _r(i){return typeof i=="string"&&(i=In(i)),rt(i),i}function Xe(...i){let e=0;for(let r=0;r<i.length;r++){const s=i[r];rt(s),e+=s.length}const t=new Uint8Array(e);for(let r=0,s=0;r<i.length;r++){const f=i[r];t.set(f,s),s+=f.length}return t}class no{}function Ir(i){const e=r=>i().update(_r(r)).digest(),t=i();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>i(),e}function Kt(i=32){if(on&&typeof on.getRandomValues=="function")return on.getRandomValues(new Uint8Array(i));if(on&&typeof on.randomBytes=="function")return Uint8Array.from(on.randomBytes(i));throw new Error("crypto.getRandomValues must be defined")}function ya(i,e,t,r){if(typeof i.setBigUint64=="function")return i.setBigUint64(e,t,r);const s=BigInt(32),f=BigInt(4294967295),d=Number(t>>s&f),p=Number(t&f),y=r?4:0,w=r?0:4;i.setUint32(e+y,d,r),i.setUint32(e+w,p,r)}function ma(i,e,t){return i&e^~i&t}function wa(i,e,t){return i&e^i&t^e&t}class Mr extends no{constructor(e,t,r,s){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=s,this.buffer=new Uint8Array(e),this.view=sn(this.buffer)}update(e){Zn(this),e=_r(e),rt(e);const{view:t,buffer:r,blockLen:s}=this,f=e.length;for(let d=0;d<f;){const p=Math.min(s-this.pos,f-d);if(p===s){const y=sn(e);for(;s<=f-d;d+=s)this.process(y,d);continue}r.set(e.subarray(d,d+p),this.pos),this.pos+=p,d+=p,this.pos===s&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Zn(this),pa(e,this),this.finished=!0;const{buffer:t,view:r,blockLen:s,isLE:f}=this;let{pos:d}=this;t[d++]=128,Pt(this.buffer.subarray(d)),this.padOffset>s-d&&(this.process(r,0),d=0);for(let A=d;A<s;A++)t[A]=0;ya(r,s-8,BigInt(this.length*8),f),this.process(r,0);const p=sn(e),y=this.outputLen;if(y%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const w=y/4,x=this.get();if(w>x.length)throw new Error("_sha2: outputLen bigger than state");for(let A=0;A<w;A++)p.setUint32(4*A,x[A],f)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:r,length:s,finished:f,destroyed:d,pos:p}=this;return e.destroyed=d,e.finished=f,e.length=s,e.pos=p,s%t&&e.buffer.set(r),e}clone(){return this._cloneInto()}}const Ot=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Ve=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),Yn=BigInt(2**32-1),ro=BigInt(32);function ba(i,e=!1){return e?{h:Number(i&Yn),l:Number(i>>ro&Yn)}:{h:Number(i>>ro&Yn)|0,l:Number(i&Yn)|0}}function va(i,e=!1){const t=i.length;let r=new Uint32Array(t),s=new Uint32Array(t);for(let f=0;f<t;f++){const{h:d,l:p}=ba(i[f],e);[r[f],s[f]]=[d,p]}return[r,s]}const io=(i,e,t)=>i>>>t,oo=(i,e,t)=>i<<32-t|e>>>t,an=(i,e,t)=>i>>>t|e<<32-t,un=(i,e,t)=>i<<32-t|e>>>t,Jn=(i,e,t)=>i<<64-t|e>>>t-32,er=(i,e,t)=>i>>>t-32|e<<64-t;function St(i,e,t,r){const s=(e>>>0)+(r>>>0);return{h:i+t+(s/2**32|0)|0,l:s|0}}const xa=(i,e,t)=>(i>>>0)+(e>>>0)+(t>>>0),ka=(i,e,t,r)=>e+t+r+(i/2**32|0)|0,Ea=(i,e,t,r)=>(i>>>0)+(e>>>0)+(t>>>0)+(r>>>0),Ca=(i,e,t,r,s)=>e+t+r+s+(i/2**32|0)|0,Ta=(i,e,t,r,s)=>(i>>>0)+(e>>>0)+(t>>>0)+(r>>>0)+(s>>>0),Sa=(i,e,t,r,s,f)=>e+t+r+s+f+(i/2**32|0)|0,Aa=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),qt=new Uint32Array(64);class _a extends Mr{constructor(e=32){super(64,e,8,!1),this.A=Ot[0]|0,this.B=Ot[1]|0,this.C=Ot[2]|0,this.D=Ot[3]|0,this.E=Ot[4]|0,this.F=Ot[5]|0,this.G=Ot[6]|0,this.H=Ot[7]|0}get(){const{A:e,B:t,C:r,D:s,E:f,F:d,G:p,H:y}=this;return[e,t,r,s,f,d,p,y]}set(e,t,r,s,f,d,p,y){this.A=e|0,this.B=t|0,this.C=r|0,this.D=s|0,this.E=f|0,this.F=d|0,this.G=p|0,this.H=y|0}process(e,t){for(let A=0;A<16;A++,t+=4)qt[A]=e.getUint32(t,!1);for(let A=16;A<64;A++){const E=qt[A-15],T=qt[A-2],M=mt(E,7)^mt(E,18)^E>>>3,N=mt(T,17)^mt(T,19)^T>>>10;qt[A]=N+qt[A-7]+M+qt[A-16]|0}let{A:r,B:s,C:f,D:d,E:p,F:y,G:w,H:x}=this;for(let A=0;A<64;A++){const E=mt(p,6)^mt(p,11)^mt(p,25),T=x+E+ma(p,y,w)+Aa[A]+qt[A]|0,N=(mt(r,2)^mt(r,13)^mt(r,22))+wa(r,s,f)|0;x=w,w=y,y=p,p=d+T|0,d=f,f=s,s=r,r=T+N|0}r=r+this.A|0,s=s+this.B|0,f=f+this.C|0,d=d+this.D|0,p=p+this.E|0,y=y+this.F|0,w=w+this.G|0,x=x+this.H|0,this.set(r,s,f,d,p,y,w,x)}roundClean(){Pt(qt)}destroy(){this.set(0,0,0,0,0,0,0,0),Pt(this.buffer)}}const so=va(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(i=>BigInt(i))),Ia=so[0],Ma=so[1],Nt=new Uint32Array(80),Dt=new Uint32Array(80);class Ba extends Mr{constructor(e=64){super(128,e,16,!1),this.Ah=Ve[0]|0,this.Al=Ve[1]|0,this.Bh=Ve[2]|0,this.Bl=Ve[3]|0,this.Ch=Ve[4]|0,this.Cl=Ve[5]|0,this.Dh=Ve[6]|0,this.Dl=Ve[7]|0,this.Eh=Ve[8]|0,this.El=Ve[9]|0,this.Fh=Ve[10]|0,this.Fl=Ve[11]|0,this.Gh=Ve[12]|0,this.Gl=Ve[13]|0,this.Hh=Ve[14]|0,this.Hl=Ve[15]|0}get(){const{Ah:e,Al:t,Bh:r,Bl:s,Ch:f,Cl:d,Dh:p,Dl:y,Eh:w,El:x,Fh:A,Fl:E,Gh:T,Gl:M,Hh:N,Hl:W}=this;return[e,t,r,s,f,d,p,y,w,x,A,E,T,M,N,W]}set(e,t,r,s,f,d,p,y,w,x,A,E,T,M,N,W){this.Ah=e|0,this.Al=t|0,this.Bh=r|0,this.Bl=s|0,this.Ch=f|0,this.Cl=d|0,this.Dh=p|0,this.Dl=y|0,this.Eh=w|0,this.El=x|0,this.Fh=A|0,this.Fl=E|0,this.Gh=T|0,this.Gl=M|0,this.Hh=N|0,this.Hl=W|0}process(e,t){for(let ee=0;ee<16;ee++,t+=4)Nt[ee]=e.getUint32(t),Dt[ee]=e.getUint32(t+=4);for(let ee=16;ee<80;ee++){const pe=Nt[ee-15]|0,ve=Dt[ee-15]|0,Be=an(pe,ve,1)^an(pe,ve,8)^io(pe,ve,7),u=un(pe,ve,1)^un(pe,ve,8)^oo(pe,ve,7),J=Nt[ee-2]|0,P=Dt[ee-2]|0,U=an(J,P,19)^Jn(J,P,61)^io(J,P,6),he=un(J,P,19)^er(J,P,61)^oo(J,P,6),se=Ea(u,he,Dt[ee-7],Dt[ee-16]),B=Ca(se,Be,U,Nt[ee-7],Nt[ee-16]);Nt[ee]=B|0,Dt[ee]=se|0}let{Ah:r,Al:s,Bh:f,Bl:d,Ch:p,Cl:y,Dh:w,Dl:x,Eh:A,El:E,Fh:T,Fl:M,Gh:N,Gl:W,Hh:$,Hl:we}=this;for(let ee=0;ee<80;ee++){const pe=an(A,E,14)^an(A,E,18)^Jn(A,E,41),ve=un(A,E,14)^un(A,E,18)^er(A,E,41),Be=A&T^~A&N,u=E&M^~E&W,J=Ta(we,ve,u,Ma[ee],Dt[ee]),P=Sa(J,$,pe,Be,Ia[ee],Nt[ee]),U=J|0,he=an(r,s,28)^Jn(r,s,34)^Jn(r,s,39),se=un(r,s,28)^er(r,s,34)^er(r,s,39),B=r&f^r&p^f&p,K=s&d^s&y^d&y;$=N|0,we=W|0,N=T|0,W=M|0,T=A|0,M=E|0,{h:A,l:E}=St(w|0,x|0,P|0,U|0),w=p|0,x=y|0,p=f|0,y=d|0,f=r|0,d=s|0;const I=xa(U,se,K);r=ka(I,P,he,B),s=I|0}({h:r,l:s}=St(this.Ah|0,this.Al|0,r|0,s|0)),{h:f,l:d}=St(this.Bh|0,this.Bl|0,f|0,d|0),{h:p,l:y}=St(this.Ch|0,this.Cl|0,p|0,y|0),{h:w,l:x}=St(this.Dh|0,this.Dl|0,w|0,x|0),{h:A,l:E}=St(this.Eh|0,this.El|0,A|0,E|0),{h:T,l:M}=St(this.Fh|0,this.Fl|0,T|0,M|0),{h:N,l:W}=St(this.Gh|0,this.Gl|0,N|0,W|0),{h:$,l:we}=St(this.Hh|0,this.Hl|0,$|0,we|0),this.set(r,s,f,d,p,y,w,x,A,E,T,M,N,W,$,we)}roundClean(){Pt(Nt,Dt)}destroy(){Pt(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const Fe=Ir(()=>new _a),ao=Ir(()=>new Ba);class uo extends no{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,Ji(e);const r=_r(t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,f=new Uint8Array(s);f.set(r.length>s?e.create().update(r).digest():r);for(let d=0;d<f.length;d++)f[d]^=54;this.iHash.update(f),this.oHash=e.create();for(let d=0;d<f.length;d++)f[d]^=106;this.oHash.update(f),Pt(f)}update(e){return Zn(this),this.iHash.update(e),this}digestInto(e){Zn(this),rt(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:r,finished:s,destroyed:f,blockLen:d,outputLen:p}=this;return e=e,e.finished=s,e.destroyed=f,e.blockLen=d,e.outputLen=p,e.oHash=t._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Mn=(i,e,t)=>new uo(i,e).update(t).digest();Mn.create=(i,e)=>new uo(i,e);const Br=BigInt(0),Pr=BigInt(1);function tr(i,e=""){if(typeof i!="boolean"){const t=e&&`"${e}"`;throw new Error(t+"expected boolean, got type="+typeof i)}return i}function $t(i,e,t=""){const r=Gn(i),s=i?.length,f=e!==void 0;if(!r||f&&s!==e){const d=t&&`"${t}" `,p=f?` of length ${e}`:"",y=r?`length=${s}`:`type=${typeof i}`;throw new Error(d+"expected Uint8Array"+p+", got "+y)}return i}function nr(i){const e=i.toString(16);return e.length&1?"0"+e:e}function co(i){if(typeof i!="string")throw new Error("hex string expected, got "+typeof i);return i===""?Br:BigInt("0x"+i)}function cn(i){return co(De(i))}function fo(i){return rt(i),co(De(Uint8Array.from(i).reverse()))}function rr(i,e){return qe(i.toString(16).padStart(e*2,"0"))}function lo(i,e){return rr(i,e).reverse()}function Re(i,e,t){let r;if(typeof e=="string")try{r=qe(e)}catch(f){throw new Error(i+" must be hex string or Uint8Array, cause: "+f)}else if(Gn(e))r=Uint8Array.from(e);else throw new Error(i+" must be hex string or Uint8Array");const s=r.length;if(typeof t=="number"&&s!==t)throw new Error(i+" of length "+t+" expected, got "+s);return r}const Or=i=>typeof i=="bigint"&&Br<=i;function qr(i,e,t){return Or(i)&&Or(e)&&Or(t)&&e<=i&&i<t}function Pa(i,e,t,r){if(!qr(e,t,r))throw new Error("expected valid "+i+": "+t+" <= n < "+r+", got "+e)}function ho(i){let e;for(e=0;i>Br;i>>=Pr,e+=1);return e}const Bn=i=>(Pr<<BigInt(i))-Pr;function Oa(i,e,t){if(typeof i!="number"||i<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof t!="function")throw new Error("hmacFn must be a function");const r=T=>new Uint8Array(T),s=T=>Uint8Array.of(T);let f=r(i),d=r(i),p=0;const y=()=>{f.fill(1),d.fill(0),p=0},w=(...T)=>t(d,f,...T),x=(T=r(0))=>{d=w(s(0),T),f=w(),T.length!==0&&(d=w(s(1),T),f=w())},A=()=>{if(p++>=1e3)throw new Error("drbg: tried 1000 values");let T=0;const M=[];for(;T<e;){f=w();const N=f.slice();M.push(N),T+=f.length}return Xe(...M)};return(T,M)=>{y(),x(T);let N;for(;!(N=M(A()));)x();return y(),N}}function Nr(i,e,t={}){if(!i||typeof i!="object")throw new Error("expected valid options object");function r(s,f,d){const p=i[s];if(d&&p===void 0)return;const y=typeof p;if(y!==f||p===null)throw new Error(`param "${s}" is invalid: expected ${f}, got ${y}`)}Object.entries(e).forEach(([s,f])=>r(s,f,!1)),Object.entries(t).forEach(([s,f])=>r(s,f,!0))}function po(i){const e=new WeakMap;return(t,...r)=>{const s=e.get(t);if(s!==void 0)return s;const f=i(t,...r);return e.set(t,f),f}}const Ye=BigInt(0),Ge=BigInt(1),Wt=BigInt(2),go=BigInt(3),yo=BigInt(4),mo=BigInt(5),qa=BigInt(7),wo=BigInt(8),Na=BigInt(9),bo=BigInt(16);function it(i,e){const t=i%e;return t>=Ye?t:e+t}function ot(i,e,t){let r=i;for(;e-- >Ye;)r*=r,r%=t;return r}function vo(i,e){if(i===Ye)throw new Error("invert: expected non-zero number");if(e<=Ye)throw new Error("invert: expected positive modulus, got "+e);let t=it(i,e),r=e,s=Ye,f=Ge;for(;t!==Ye;){const p=r/t,y=r%t,w=s-f*p;r=t,t=y,s=f,f=w}if(r!==Ge)throw new Error("invert: does not exist");return it(s,e)}function Dr(i,e,t){if(!i.eql(i.sqr(e),t))throw new Error("Cannot find square root")}function xo(i,e){const t=(i.ORDER+Ge)/yo,r=i.pow(e,t);return Dr(i,r,e),r}function Da(i,e){const t=(i.ORDER-mo)/wo,r=i.mul(e,Wt),s=i.pow(r,t),f=i.mul(e,s),d=i.mul(i.mul(f,Wt),s),p=i.mul(f,i.sub(d,i.ONE));return Dr(i,p,e),p}function La(i){const e=Pn(i),t=ko(i),r=t(e,e.neg(e.ONE)),s=t(e,r),f=t(e,e.neg(r)),d=(i+qa)/bo;return(p,y)=>{let w=p.pow(y,d),x=p.mul(w,r);const A=p.mul(w,s),E=p.mul(w,f),T=p.eql(p.sqr(x),y),M=p.eql(p.sqr(A),y);w=p.cmov(w,x,T),x=p.cmov(E,A,M);const N=p.eql(p.sqr(x),y),W=p.cmov(w,x,N);return Dr(p,W,y),W}}function ko(i){if(i<go)throw new Error("sqrt is not defined for small field");let e=i-Ge,t=0;for(;e%Wt===Ye;)e/=Wt,t++;let r=Wt;const s=Pn(i);for(;Co(s,r)===1;)if(r++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(t===1)return xo;let f=s.pow(r,e);const d=(e+Ge)/Wt;return function(y,w){if(y.is0(w))return w;if(Co(y,w)!==1)throw new Error("Cannot find square root");let x=t,A=y.mul(y.ONE,f),E=y.pow(w,e),T=y.pow(w,d);for(;!y.eql(E,y.ONE);){if(y.is0(E))return y.ZERO;let M=1,N=y.sqr(E);for(;!y.eql(N,y.ONE);)if(M++,N=y.sqr(N),M===x)throw new Error("Cannot find square root");const W=Ge<<BigInt(x-M-1),$=y.pow(A,W);x=M,A=y.sqr($),E=y.mul(E,A),T=y.mul(T,$)}return T}}function Ha(i){return i%yo===go?xo:i%wo===mo?Da:i%bo===Na?La(i):ko(i)}const Ua=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Ra(i){const e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},t=Ua.reduce((r,s)=>(r[s]="function",r),e);return Nr(i,t),i}function ja(i,e,t){if(t<Ye)throw new Error("invalid exponent, negatives unsupported");if(t===Ye)return i.ONE;if(t===Ge)return e;let r=i.ONE,s=e;for(;t>Ye;)t&Ge&&(r=i.mul(r,s)),s=i.sqr(s),t>>=Ge;return r}function Eo(i,e,t=!1){const r=new Array(e.length).fill(t?i.ZERO:void 0),s=e.reduce((d,p,y)=>i.is0(p)?d:(r[y]=d,i.mul(d,p)),i.ONE),f=i.inv(s);return e.reduceRight((d,p,y)=>i.is0(p)?d:(r[y]=i.mul(d,r[y]),i.mul(d,p)),f),r}function Co(i,e){const t=(i.ORDER-Ge)/Wt,r=i.pow(e,t),s=i.eql(r,i.ONE),f=i.eql(r,i.ZERO),d=i.eql(r,i.neg(i.ONE));if(!s&&!f&&!d)throw new Error("invalid Legendre symbol result");return s?1:f?0:-1}function To(i,e){e!==void 0&&Ar(e);const t=e!==void 0?e:i.toString(2).length,r=Math.ceil(t/8);return{nBitLength:t,nByteLength:r}}function Pn(i,e,t=!1,r={}){if(i<=Ye)throw new Error("invalid field: expected ORDER > 0, got "+i);let s,f,d=!1,p;if(typeof e=="object"&&e!=null){if(r.sqrt||t)throw new Error("cannot specify opts in two arguments");const E=e;E.BITS&&(s=E.BITS),E.sqrt&&(f=E.sqrt),typeof E.isLE=="boolean"&&(t=E.isLE),typeof E.modFromBytes=="boolean"&&(d=E.modFromBytes),p=E.allowedLengths}else typeof e=="number"&&(s=e),r.sqrt&&(f=r.sqrt);const{nBitLength:y,nByteLength:w}=To(i,s);if(w>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let x;const A=Object.freeze({ORDER:i,isLE:t,BITS:y,BYTES:w,MASK:Bn(y),ZERO:Ye,ONE:Ge,allowedLengths:p,create:E=>it(E,i),isValid:E=>{if(typeof E!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof E);return Ye<=E&&E<i},is0:E=>E===Ye,isValidNot0:E=>!A.is0(E)&&A.isValid(E),isOdd:E=>(E&Ge)===Ge,neg:E=>it(-E,i),eql:(E,T)=>E===T,sqr:E=>it(E*E,i),add:(E,T)=>it(E+T,i),sub:(E,T)=>it(E-T,i),mul:(E,T)=>it(E*T,i),pow:(E,T)=>ja(A,E,T),div:(E,T)=>it(E*vo(T,i),i),sqrN:E=>E*E,addN:(E,T)=>E+T,subN:(E,T)=>E-T,mulN:(E,T)=>E*T,inv:E=>vo(E,i),sqrt:f||(E=>(x||(x=Ha(i)),x(A,E))),toBytes:E=>t?lo(E,w):rr(E,w),fromBytes:(E,T=!0)=>{if(p){if(!p.includes(E.length)||E.length>w)throw new Error("Field.fromBytes: expected "+p+" bytes, got "+E.length);const N=new Uint8Array(w);N.set(E,t?0:N.length-E.length),E=N}if(E.length!==w)throw new Error("Field.fromBytes: expected "+w+" bytes, got "+E.length);let M=t?fo(E):cn(E);if(d&&(M=it(M,i)),!T&&!A.isValid(M))throw new Error("invalid field element: outside of range 0..ORDER");return M},invertBatch:E=>Eo(A,E),cmov:(E,T,M)=>M?T:E});return Object.freeze(A)}function So(i){if(typeof i!="bigint")throw new Error("field order must be bigint");const e=i.toString(2).length;return Math.ceil(e/8)}function Ao(i){const e=So(i);return e+Math.ceil(e/2)}function _o(i,e,t=!1){const r=i.length,s=So(e),f=Ao(e);if(r<16||r<f||r>1024)throw new Error("expected "+f+"-1024 bytes of input, got "+r);const d=t?fo(i):cn(i),p=it(d,e-Ge)+Ge;return t?lo(p,s):rr(p,s)}const fn=BigInt(0),zt=BigInt(1);function ir(i,e){const t=e.negate();return i?t:e}function Lr(i,e){const t=Eo(i.Fp,e.map(r=>r.Z));return e.map((r,s)=>i.fromAffine(r.toAffine(t[s])))}function Io(i,e){if(!Number.isSafeInteger(i)||i<=0||i>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+i)}function Hr(i,e){Io(i,e);const t=Math.ceil(e/i)+1,r=2**(i-1),s=2**i,f=Bn(i),d=BigInt(i);return{windows:t,windowSize:r,mask:f,maxNumber:s,shiftBy:d}}function Mo(i,e,t){const{windowSize:r,mask:s,maxNumber:f,shiftBy:d}=t;let p=Number(i&s),y=i>>d;p>r&&(p-=f,y+=zt);const w=e*r,x=w+Math.abs(p)-1,A=p===0,E=p<0,T=e%2!==0;return{nextN:y,offset:x,isZero:A,isNeg:E,isNegF:T,offsetF:w}}function Fa(i,e){if(!Array.isArray(i))throw new Error("array expected");i.forEach((t,r)=>{if(!(t instanceof e))throw new Error("invalid point at index "+r)})}function Ka(i,e){if(!Array.isArray(i))throw new Error("array of scalars expected");i.forEach((t,r)=>{if(!e.isValid(t))throw new Error("invalid scalar at index "+r)})}const Ur=new WeakMap,Bo=new WeakMap;function Rr(i){return Bo.get(i)||1}function Po(i){if(i!==fn)throw new Error("invalid wNAF")}class $a{constructor(e,t){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=t}_unsafeLadder(e,t,r=this.ZERO){let s=e;for(;t>fn;)t&zt&&(r=r.add(s)),s=s.double(),t>>=zt;return r}precomputeWindow(e,t){const{windows:r,windowSize:s}=Hr(t,this.bits),f=[];let d=e,p=d;for(let y=0;y<r;y++){p=d,f.push(p);for(let w=1;w<s;w++)p=p.add(d),f.push(p);d=p.double()}return f}wNAF(e,t,r){if(!this.Fn.isValid(r))throw new Error("invalid scalar");let s=this.ZERO,f=this.BASE;const d=Hr(e,this.bits);for(let p=0;p<d.windows;p++){const{nextN:y,offset:w,isZero:x,isNeg:A,isNegF:E,offsetF:T}=Mo(r,p,d);r=y,x?f=f.add(ir(E,t[T])):s=s.add(ir(A,t[w]))}return Po(r),{p:s,f}}wNAFUnsafe(e,t,r,s=this.ZERO){const f=Hr(e,this.bits);for(let d=0;d<f.windows&&r!==fn;d++){const{nextN:p,offset:y,isZero:w,isNeg:x}=Mo(r,d,f);if(r=p,!w){const A=t[y];s=s.add(x?A.negate():A)}}return Po(r),s}getPrecomputes(e,t,r){let s=Ur.get(t);return s||(s=this.precomputeWindow(t,e),e!==1&&(typeof r=="function"&&(s=r(s)),Ur.set(t,s))),s}cached(e,t,r){const s=Rr(e);return this.wNAF(s,this.getPrecomputes(s,e,r),t)}unsafe(e,t,r,s){const f=Rr(e);return f===1?this._unsafeLadder(e,t,s):this.wNAFUnsafe(f,this.getPrecomputes(f,e,r),t,s)}createCache(e,t){Io(t,this.bits),Bo.set(e,t),Ur.delete(e)}hasCache(e){return Rr(e)!==1}}function Wa(i,e,t,r){let s=e,f=i.ZERO,d=i.ZERO;for(;t>fn||r>fn;)t&zt&&(f=f.add(s)),r&zt&&(d=d.add(s)),s=s.double(),t>>=zt,r>>=zt;return{p1:f,p2:d}}function za(i,e,t,r){Fa(t,i),Ka(r,e);const s=t.length,f=r.length;if(s!==f)throw new Error("arrays of points and scalars must have equal length");const d=i.ZERO,p=ho(BigInt(s));let y=1;p>12?y=p-3:p>4?y=p-2:p>0&&(y=2);const w=Bn(y),x=new Array(Number(w)+1).fill(d),A=Math.floor((e.BITS-1)/y)*y;let E=d;for(let T=A;T>=0;T-=y){x.fill(d);for(let N=0;N<f;N++){const W=r[N],$=Number(W>>BigInt(T)&w);x[$]=x[$].add(t[N])}let M=d;for(let N=x.length-1,W=d;N>0;N--)W=W.add(x[N]),M=M.add(W);if(E=E.add(M),T!==0)for(let N=0;N<y;N++)E=E.double()}return E}function Oo(i,e,t){if(e){if(e.ORDER!==i)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return Ra(e),e}else return Pn(i,{isLE:t})}function Va(i,e,t={},r){if(r===void 0&&(r=i==="edwards"),!e||typeof e!="object")throw new Error(`expected valid ${i} CURVE object`);for(const y of["p","n","h"]){const w=e[y];if(!(typeof w=="bigint"&&w>fn))throw new Error(`CURVE.${y} must be positive bigint`)}const s=Oo(e.p,t.Fp,r),f=Oo(e.n,t.Fn,r),p=["Gx","Gy","a","b"];for(const y of p)if(!s.isValid(e[y]))throw new Error(`CURVE.${y} must be valid field element of CURVE.Fp`);return e=Object.freeze(Object.assign({},e)),{CURVE:e,Fp:s,Fn:f}}const qo=(i,e)=>(i+(i>=0?e:-e)/No)/e;function Qa(i,e,t){const[[r,s],[f,d]]=e,p=qo(d*i,t),y=qo(-s*i,t);let w=i-p*r-y*f,x=-p*s-y*d;const A=w<_t,E=x<_t;A&&(w=-w),E&&(x=-x);const T=Bn(Math.ceil(ho(t)/2))+ln;if(w<_t||w>=T||x<_t||x>=T)throw new Error("splitScalar (endomorphism): failed, k="+i);return{k1neg:A,k1:w,k2neg:E,k2:x}}function jr(i){if(!["compact","recovered","der"].includes(i))throw new Error('Signature format must be "compact", "recovered", or "der"');return i}function Fr(i,e){const t={};for(let r of Object.keys(e))t[r]=i[r]===void 0?e[r]:i[r];return tr(t.lowS,"lowS"),tr(t.prehash,"prehash"),t.format!==void 0&&jr(t.format),t}class Ga extends Error{constructor(e=""){super(e)}}const At={Err:Ga,_tlv:{encode:(i,e)=>{const{Err:t}=At;if(i<0||i>256)throw new t("tlv.encode: wrong tag");if(e.length&1)throw new t("tlv.encode: unpadded data");const r=e.length/2,s=nr(r);if(s.length/2&128)throw new t("tlv.encode: long form length too big");const f=r>127?nr(s.length/2|128):"";return nr(i)+f+s+e},decode(i,e){const{Err:t}=At;let r=0;if(i<0||i>256)throw new t("tlv.encode: wrong tag");if(e.length<2||e[r++]!==i)throw new t("tlv.decode: wrong tlv");const s=e[r++],f=!!(s&128);let d=0;if(!f)d=s;else{const y=s&127;if(!y)throw new t("tlv.decode(long): indefinite length not supported");if(y>4)throw new t("tlv.decode(long): byte length is too big");const w=e.subarray(r,r+y);if(w.length!==y)throw new t("tlv.decode: length bytes not complete");if(w[0]===0)throw new t("tlv.decode(long): zero leftmost byte");for(const x of w)d=d<<8|x;if(r+=y,d<128)throw new t("tlv.decode(long): not minimal encoding")}const p=e.subarray(r,r+d);if(p.length!==d)throw new t("tlv.decode: wrong value length");return{v:p,l:e.subarray(r+d)}}},_int:{encode(i){const{Err:e}=At;if(i<_t)throw new e("integer: negative integers are not allowed");let t=nr(i);if(Number.parseInt(t[0],16)&8&&(t="00"+t),t.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return t},decode(i){const{Err:e}=At;if(i[0]&128)throw new e("invalid signature integer: negative");if(i[0]===0&&!(i[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return cn(i)}},toSig(i){const{Err:e,_int:t,_tlv:r}=At,s=Re("signature",i),{v:f,l:d}=r.decode(48,s);if(d.length)throw new e("invalid signature: left bytes after parsing");const{v:p,l:y}=r.decode(2,f),{v:w,l:x}=r.decode(2,y);if(x.length)throw new e("invalid signature: left bytes after parsing");return{r:t.decode(p),s:t.decode(w)}},hexFromSig(i){const{_tlv:e,_int:t}=At,r=e.encode(2,t.encode(i.r)),s=e.encode(2,t.encode(i.s)),f=r+s;return e.encode(48,f)}},_t=BigInt(0),ln=BigInt(1),No=BigInt(2),or=BigInt(3),Za=BigInt(4);function Vt(i,e){const{BYTES:t}=i;let r;if(typeof e=="bigint")r=e;else{let s=Re("private key",e);try{r=i.fromBytes(s)}catch{throw new Error(`invalid private key: expected ui8a of size ${t}, got ${typeof e}`)}}if(!i.isValidNot0(r))throw new Error("invalid private key: out of range [1..N-1]");return r}function Xa(i,e={}){const t=Va("weierstrass",i,e),{Fp:r,Fn:s}=t;let f=t.CURVE;const{h:d,n:p}=f;Nr(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:y}=e;if(y&&(!r.is0(f.a)||typeof y.beta!="bigint"||!Array.isArray(y.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const w=Lo(r,s);function x(){if(!r.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function A(se,B,K){const{x:I,y:L}=B.toAffine(),R=r.toBytes(I);if(tr(K,"isCompressed"),K){x();const V=!r.isOdd(L);return Xe(Do(V),R)}else return Xe(Uint8Array.of(4),R,r.toBytes(L))}function E(se){$t(se,void 0,"Point");const{publicKey:B,publicKeyUncompressed:K}=w,I=se.length,L=se[0],R=se.subarray(1);if(I===B&&(L===2||L===3)){const V=r.fromBytes(R);if(!r.isValid(V))throw new Error("bad point: is not on curve, wrong x");const G=N(V);let C;try{C=r.sqrt(G)}catch(Z){const te=Z instanceof Error?": "+Z.message:"";throw new Error("bad point: is not on curve, sqrt error"+te)}x();const v=r.isOdd(C);return(L&1)===1!==v&&(C=r.neg(C)),{x:V,y:C}}else if(I===K&&L===4){const V=r.BYTES,G=r.fromBytes(R.subarray(0,V)),C=r.fromBytes(R.subarray(V,V*2));if(!W(G,C))throw new Error("bad point: is not on curve");return{x:G,y:C}}else throw new Error(`bad point: got length ${I}, expected compressed=${B} or uncompressed=${K}`)}const T=e.toBytes||A,M=e.fromBytes||E;function N(se){const B=r.sqr(se),K=r.mul(B,se);return r.add(r.add(K,r.mul(se,f.a)),f.b)}function W(se,B){const K=r.sqr(B),I=N(se);return r.eql(K,I)}if(!W(f.Gx,f.Gy))throw new Error("bad curve params: generator point");const $=r.mul(r.pow(f.a,or),Za),we=r.mul(r.sqr(f.b),BigInt(27));if(r.is0(r.add($,we)))throw new Error("bad curve params: a or b");function ee(se,B,K=!1){if(!r.isValid(B)||K&&r.is0(B))throw new Error(`bad point coordinate ${se}`);return B}function pe(se){if(!(se instanceof P))throw new Error("ProjectivePoint expected")}function ve(se){if(!y||!y.basises)throw new Error("no endo");return Qa(se,y.basises,s.ORDER)}const Be=po((se,B)=>{const{X:K,Y:I,Z:L}=se;if(r.eql(L,r.ONE))return{x:K,y:I};const R=se.is0();B==null&&(B=R?r.ONE:r.inv(L));const V=r.mul(K,B),G=r.mul(I,B),C=r.mul(L,B);if(R)return{x:r.ZERO,y:r.ZERO};if(!r.eql(C,r.ONE))throw new Error("invZ was invalid");return{x:V,y:G}}),u=po(se=>{if(se.is0()){if(e.allowInfinityPoint&&!r.is0(se.Y))return;throw new Error("bad point: ZERO")}const{x:B,y:K}=se.toAffine();if(!r.isValid(B)||!r.isValid(K))throw new Error("bad point: x or y not field elements");if(!W(B,K))throw new Error("bad point: equation left != right");if(!se.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function J(se,B,K,I,L){return K=new P(r.mul(K.X,se),K.Y,K.Z),B=ir(I,B),K=ir(L,K),B.add(K)}class P{constructor(B,K,I){this.X=ee("x",B),this.Y=ee("y",K,!0),this.Z=ee("z",I),Object.freeze(this)}static CURVE(){return f}static fromAffine(B){const{x:K,y:I}=B||{};if(!B||!r.isValid(K)||!r.isValid(I))throw new Error("invalid affine point");if(B instanceof P)throw new Error("projective point not allowed");return r.is0(K)&&r.is0(I)?P.ZERO:new P(K,I,r.ONE)}static fromBytes(B){const K=P.fromAffine(M($t(B,void 0,"point")));return K.assertValidity(),K}static fromHex(B){return P.fromBytes(Re("pointHex",B))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(B=8,K=!0){return he.createCache(this,B),K||this.multiply(or),this}assertValidity(){u(this)}hasEvenY(){const{y:B}=this.toAffine();if(!r.isOdd)throw new Error("Field doesn't support isOdd");return!r.isOdd(B)}equals(B){pe(B);const{X:K,Y:I,Z:L}=this,{X:R,Y:V,Z:G}=B,C=r.eql(r.mul(K,G),r.mul(R,L)),v=r.eql(r.mul(I,G),r.mul(V,L));return C&&v}negate(){return new P(this.X,r.neg(this.Y),this.Z)}double(){const{a:B,b:K}=f,I=r.mul(K,or),{X:L,Y:R,Z:V}=this;let G=r.ZERO,C=r.ZERO,v=r.ZERO,z=r.mul(L,L),Z=r.mul(R,R),te=r.mul(V,V),Y=r.mul(L,R);return Y=r.add(Y,Y),v=r.mul(L,V),v=r.add(v,v),G=r.mul(B,v),C=r.mul(I,te),C=r.add(G,C),G=r.sub(Z,C),C=r.add(Z,C),C=r.mul(G,C),G=r.mul(Y,G),v=r.mul(I,v),te=r.mul(B,te),Y=r.sub(z,te),Y=r.mul(B,Y),Y=r.add(Y,v),v=r.add(z,z),z=r.add(v,z),z=r.add(z,te),z=r.mul(z,Y),C=r.add(C,z),te=r.mul(R,V),te=r.add(te,te),z=r.mul(te,Y),G=r.sub(G,z),v=r.mul(te,Z),v=r.add(v,v),v=r.add(v,v),new P(G,C,v)}add(B){pe(B);const{X:K,Y:I,Z:L}=this,{X:R,Y:V,Z:G}=B;let C=r.ZERO,v=r.ZERO,z=r.ZERO;const Z=f.a,te=r.mul(f.b,or);let Y=r.mul(K,R),oe=r.mul(I,V),ne=r.mul(L,G),fe=r.add(K,I),ce=r.add(R,V);fe=r.mul(fe,ce),ce=r.add(Y,oe),fe=r.sub(fe,ce),ce=r.add(K,L);let le=r.add(R,G);return ce=r.mul(ce,le),le=r.add(Y,ne),ce=r.sub(ce,le),le=r.add(I,L),C=r.add(V,G),le=r.mul(le,C),C=r.add(oe,ne),le=r.sub(le,C),z=r.mul(Z,ce),C=r.mul(te,ne),z=r.add(C,z),C=r.sub(oe,z),z=r.add(oe,z),v=r.mul(C,z),oe=r.add(Y,Y),oe=r.add(oe,Y),ne=r.mul(Z,ne),ce=r.mul(te,ce),oe=r.add(oe,ne),ne=r.sub(Y,ne),ne=r.mul(Z,ne),ce=r.add(ce,ne),Y=r.mul(oe,ce),v=r.add(v,Y),Y=r.mul(le,ce),C=r.mul(fe,C),C=r.sub(C,Y),Y=r.mul(fe,oe),z=r.mul(le,z),z=r.add(z,Y),new P(C,v,z)}subtract(B){return this.add(B.negate())}is0(){return this.equals(P.ZERO)}multiply(B){const{endo:K}=e;if(!s.isValidNot0(B))throw new Error("invalid scalar: out of range");let I,L;const R=V=>he.cached(this,V,G=>Lr(P,G));if(K){const{k1neg:V,k1:G,k2neg:C,k2:v}=ve(B),{p:z,f:Z}=R(G),{p:te,f:Y}=R(v);L=Z.add(Y),I=J(K.beta,z,te,V,C)}else{const{p:V,f:G}=R(B);I=V,L=G}return Lr(P,[I,L])[0]}multiplyUnsafe(B){const{endo:K}=e,I=this;if(!s.isValid(B))throw new Error("invalid scalar: out of range");if(B===_t||I.is0())return P.ZERO;if(B===ln)return I;if(he.hasCache(this))return this.multiply(B);if(K){const{k1neg:L,k1:R,k2neg:V,k2:G}=ve(B),{p1:C,p2:v}=Wa(P,I,R,G);return J(K.beta,C,v,L,V)}else return he.unsafe(I,B)}multiplyAndAddUnsafe(B,K,I){const L=this.multiplyUnsafe(K).add(B.multiplyUnsafe(I));return L.is0()?void 0:L}toAffine(B){return Be(this,B)}isTorsionFree(){const{isTorsionFree:B}=e;return d===ln?!0:B?B(P,this):he.unsafe(this,p).is0()}clearCofactor(){const{clearCofactor:B}=e;return d===ln?this:B?B(P,this):this.multiplyUnsafe(d)}isSmallOrder(){return this.multiplyUnsafe(d).is0()}toBytes(B=!0){return tr(B,"isCompressed"),this.assertValidity(),T(P,this,B)}toHex(B=!0){return De(this.toBytes(B))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(B=!0){return this.toBytes(B)}_setWindowSize(B){this.precompute(B)}static normalizeZ(B){return Lr(P,B)}static msm(B,K){return za(P,s,B,K)}static fromPrivateKey(B){return P.BASE.multiply(Vt(s,B))}}P.BASE=new P(f.Gx,f.Gy,r.ONE),P.ZERO=new P(r.ZERO,r.ONE,r.ZERO),P.Fp=r,P.Fn=s;const U=s.BITS,he=new $a(P,e.endo?Math.ceil(U/2):U);return P.BASE.precompute(8),P}function Do(i){return Uint8Array.of(i?2:3)}function Lo(i,e){return{secretKey:e.BYTES,publicKey:1+i.BYTES,publicKeyUncompressed:1+2*i.BYTES,publicKeyHasPrefix:!0,signature:2*e.BYTES}}function Ya(i,e={}){const{Fn:t}=i,r=e.randomBytes||Kt,s=Object.assign(Lo(i.Fp,t),{seed:Ao(t.ORDER)});function f(T){try{return!!Vt(t,T)}catch{return!1}}function d(T,M){const{publicKey:N,publicKeyUncompressed:W}=s;try{const $=T.length;return M===!0&&$!==N||M===!1&&$!==W?!1:!!i.fromBytes(T)}catch{return!1}}function p(T=r(s.seed)){return _o($t(T,s.seed,"seed"),t.ORDER)}function y(T,M=!0){return i.BASE.multiply(Vt(t,T)).toBytes(M)}function w(T){const M=p(T);return{secretKey:M,publicKey:y(M)}}function x(T){if(typeof T=="bigint")return!1;if(T instanceof i)return!0;const{secretKey:M,publicKey:N,publicKeyUncompressed:W}=s;if(t.allowedLengths||M===N)return;const $=Re("key",T).length;return $===N||$===W}function A(T,M,N=!0){if(x(T)===!0)throw new Error("first arg must be private key");if(x(M)===!1)throw new Error("second arg must be public key");const W=Vt(t,T);return i.fromHex(M).multiply(W).toBytes(N)}return Object.freeze({getPublicKey:y,getSharedSecret:A,keygen:w,Point:i,utils:{isValidSecretKey:f,isValidPublicKey:d,randomSecretKey:p,isValidPrivateKey:f,randomPrivateKey:p,normPrivateKeyToScalar:T=>Vt(t,T),precompute(T=8,M=i.BASE){return M.precompute(T,!1)}},lengths:s})}function Ja(i,e,t={}){Ji(e),Nr(t,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const r=t.randomBytes||Kt,s=t.hmac||((K,...I)=>Mn(e,K,Xe(...I))),{Fp:f,Fn:d}=i,{ORDER:p,BITS:y}=d,{keygen:w,getPublicKey:x,getSharedSecret:A,utils:E,lengths:T}=Ya(i,t),M={prehash:!1,lowS:typeof t.lowS=="boolean"?t.lowS:!1,format:void 0,extraEntropy:!1},N="compact";function W(K){const I=p>>ln;return K>I}function $(K,I){if(!d.isValidNot0(I))throw new Error(`invalid signature ${K}: out of range 1..Point.Fn.ORDER`);return I}function we(K,I){jr(I);const L=T.signature,R=I==="compact"?L:I==="recovered"?L+1:void 0;return $t(K,R,`${I} signature`)}class ee{constructor(I,L,R){this.r=$("r",I),this.s=$("s",L),R!=null&&(this.recovery=R),Object.freeze(this)}static fromBytes(I,L=N){we(I,L);let R;if(L==="der"){const{r:v,s:z}=At.toSig($t(I));return new ee(v,z)}L==="recovered"&&(R=I[0],L="compact",I=I.subarray(1));const V=d.BYTES,G=I.subarray(0,V),C=I.subarray(V,V*2);return new ee(d.fromBytes(G),d.fromBytes(C),R)}static fromHex(I,L){return this.fromBytes(qe(I),L)}addRecoveryBit(I){return new ee(this.r,this.s,I)}recoverPublicKey(I){const L=f.ORDER,{r:R,s:V,recovery:G}=this;if(G==null||![0,1,2,3].includes(G))throw new Error("recovery id invalid");if(p*No<L&&G>1)throw new Error("recovery id is ambiguous for h>1 curve");const v=G===2||G===3?R+p:R;if(!f.isValid(v))throw new Error("recovery id 2 or 3 invalid");const z=f.toBytes(v),Z=i.fromBytes(Xe(Do((G&1)===0),z)),te=d.inv(v),Y=ve(Re("msgHash",I)),oe=d.create(-Y*te),ne=d.create(V*te),fe=i.BASE.multiplyUnsafe(oe).add(Z.multiplyUnsafe(ne));if(fe.is0())throw new Error("point at infinify");return fe.assertValidity(),fe}hasHighS(){return W(this.s)}toBytes(I=N){if(jr(I),I==="der")return qe(At.hexFromSig(this));const L=d.toBytes(this.r),R=d.toBytes(this.s);if(I==="recovered"){if(this.recovery==null)throw new Error("recovery bit must be present");return Xe(Uint8Array.of(this.recovery),L,R)}return Xe(L,R)}toHex(I){return De(this.toBytes(I))}assertValidity(){}static fromCompact(I){return ee.fromBytes(Re("sig",I),"compact")}static fromDER(I){return ee.fromBytes(Re("sig",I),"der")}normalizeS(){return this.hasHighS()?new ee(this.r,d.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return De(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return De(this.toBytes("compact"))}}const pe=t.bits2int||function(I){if(I.length>8192)throw new Error("input is too large");const L=cn(I),R=I.length*8-y;return R>0?L>>BigInt(R):L},ve=t.bits2int_modN||function(I){return d.create(pe(I))},Be=Bn(y);function u(K){return Pa("num < 2^"+y,K,_t,Be),d.toBytes(K)}function J(K,I){return $t(K,void 0,"message"),I?$t(e(K),void 0,"prehashed message"):K}function P(K,I,L){if(["recovered","canonical"].some(oe=>oe in L))throw new Error("sign() legacy options not supported");const{lowS:R,prehash:V,extraEntropy:G}=Fr(L,M);K=J(K,V);const C=ve(K),v=Vt(d,I),z=[u(v),u(C)];if(G!=null&&G!==!1){const oe=G===!0?r(T.secretKey):G;z.push(Re("extraEntropy",oe))}const Z=Xe(...z),te=C;function Y(oe){const ne=pe(oe);if(!d.isValidNot0(ne))return;const fe=d.inv(ne),ce=i.BASE.multiply(ne).toAffine(),le=d.create(ce.x);if(le===_t)return;const Ae=d.create(fe*d.create(te+le*v));if(Ae===_t)return;let _e=(ce.x===le?0:2)|Number(ce.y&ln),Pe=Ae;return R&&W(Ae)&&(Pe=d.neg(Ae),_e^=1),new ee(le,Pe,_e)}return{seed:Z,k2sig:Y}}function U(K,I,L={}){K=Re("message",K);const{seed:R,k2sig:V}=P(K,I,L);return Oa(e.outputLen,d.BYTES,s)(R,V)}function he(K){let I;const L=typeof K=="string"||Gn(K),R=!L&&K!==null&&typeof K=="object"&&typeof K.r=="bigint"&&typeof K.s=="bigint";if(!L&&!R)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(R)I=new ee(K.r,K.s);else if(L){try{I=ee.fromBytes(Re("sig",K),"der")}catch(V){if(!(V instanceof At.Err))throw V}if(!I)try{I=ee.fromBytes(Re("sig",K),"compact")}catch{return!1}}return I||!1}function se(K,I,L,R={}){const{lowS:V,prehash:G,format:C}=Fr(R,M);if(L=Re("publicKey",L),I=J(Re("message",I),G),"strict"in R)throw new Error("options.strict was renamed to lowS");const v=C===void 0?he(K):ee.fromBytes(Re("sig",K),C);if(v===!1)return!1;try{const z=i.fromBytes(L);if(V&&v.hasHighS())return!1;const{r:Z,s:te}=v,Y=ve(I),oe=d.inv(te),ne=d.create(Y*oe),fe=d.create(Z*oe),ce=i.BASE.multiplyUnsafe(ne).add(z.multiplyUnsafe(fe));return ce.is0()?!1:d.create(ce.x)===Z}catch{return!1}}function B(K,I,L={}){const{prehash:R}=Fr(L,M);return I=J(I,R),ee.fromBytes(K,"recovered").recoverPublicKey(I).toBytes()}return Object.freeze({keygen:w,getPublicKey:x,getSharedSecret:A,utils:E,lengths:T,Point:i,sign:U,verify:se,recoverPublicKey:B,Signature:ee,hash:e})}function eu(i){const e={a:i.a,b:i.b,p:i.Fp.ORDER,n:i.n,h:i.h,Gx:i.Gx,Gy:i.Gy},t=i.Fp;let r=i.allowedPrivateKeyLengths?Array.from(new Set(i.allowedPrivateKeyLengths.map(d=>Math.ceil(d/2)))):void 0;const s=Pn(e.n,{BITS:i.nBitLength,allowedLengths:r,modFromBytes:i.wrapPrivateKey}),f={Fp:t,Fn:s,allowInfinityPoint:i.allowInfinityPoint,endo:i.endo,isTorsionFree:i.isTorsionFree,clearCofactor:i.clearCofactor,fromBytes:i.fromBytes,toBytes:i.toBytes};return{CURVE:e,curveOpts:f}}function tu(i){const{CURVE:e,curveOpts:t}=eu(i),r={hmac:i.hmac,randomBytes:i.randomBytes,lowS:i.lowS,bits2int:i.bits2int,bits2int_modN:i.bits2int_modN};return{CURVE:e,curveOpts:t,hash:i.hash,ecdsaOpts:r}}function nu(i,e){const t=e.Point;return Object.assign({},e,{ProjectivePoint:t,CURVE:Object.assign({},i,To(t.Fn.ORDER,t.Fn.BITS))})}function ru(i){const{CURVE:e,curveOpts:t,hash:r,ecdsaOpts:s}=tu(i),f=Xa(e,t),d=Ja(f,r,s);return nu(i,d)}function iu(i,e){const t=r=>ru({...i,hash:r});return{...t(e),create:t}}const hn={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:BigInt(1),a:BigInt(0),b:BigInt(7),Gx:BigInt("0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),Gy:BigInt("0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")},ou={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),basises:[[BigInt("0x3086d221a7d46bcde86c90e49284eb15"),-BigInt("0xe4437ed6010e88286f547fa90abfe4c3")],[BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),BigInt("0x3086d221a7d46bcde86c90e49284eb15")]]},su=BigInt(0),Ho=BigInt(1),Kr=BigInt(2);function au(i){const e=hn.p,t=BigInt(3),r=BigInt(6),s=BigInt(11),f=BigInt(22),d=BigInt(23),p=BigInt(44),y=BigInt(88),w=i*i*i%e,x=w*w*i%e,A=ot(x,t,e)*x%e,E=ot(A,t,e)*x%e,T=ot(E,Kr,e)*w%e,M=ot(T,s,e)*T%e,N=ot(M,f,e)*M%e,W=ot(N,p,e)*N%e,$=ot(W,y,e)*W%e,we=ot($,p,e)*N%e,ee=ot(we,t,e)*x%e,pe=ot(ee,d,e)*M%e,ve=ot(pe,r,e)*w%e,Be=ot(ve,Kr,e);if(!sr.eql(sr.sqr(Be),i))throw new Error("Cannot find square root");return Be}const sr=Pn(hn.p,{sqrt:au}),Se=iu({...hn,Fp:sr,lowS:!0,endo:ou},Fe),Uo={};function ar(i,...e){let t=Uo[i];if(t===void 0){const r=Fe(In(i));t=Xe(r,r),Uo[i]=t}return Fe(Xe(t,...e))}const $r=i=>i.toBytes(!0).slice(1),dn=Se.Point,Wr=i=>i%Kr===su;function zr(i){const{Fn:e,BASE:t}=dn,r=Vt(e,i),s=t.multiply(r);return{scalar:Wr(s.y)?r:e.neg(r),bytes:$r(s)}}function Ro(i){const e=sr;if(!e.isValidNot0(i))throw new Error("invalid x: Fail if x â‰¥ p");const t=e.create(i*i),r=e.create(t*i+BigInt(7));let s=e.sqrt(r);Wr(s)||(s=e.neg(s));const f=dn.fromAffine({x:i,y:s});return f.assertValidity(),f}const On=cn;function jo(...i){return dn.Fn.create(On(ar("BIP0340/challenge",...i)))}function Fo(i){return zr(i).bytes}function uu(i,e,t=Kt(32)){const{Fn:r}=dn,s=Re("message",i),{bytes:f,scalar:d}=zr(e),p=Re("auxRand",t,32),y=r.toBytes(d^On(ar("BIP0340/aux",p))),w=ar("BIP0340/nonce",y,f,s),{bytes:x,scalar:A}=zr(w),E=jo(x,f,s),T=new Uint8Array(64);if(T.set(x,0),T.set(r.toBytes(r.create(A+E*d)),32),!Ko(T,s,f))throw new Error("sign: Invalid signature produced");return T}function Ko(i,e,t){const{Fn:r,BASE:s}=dn,f=Re("signature",i,64),d=Re("message",e),p=Re("publicKey",t,32);try{const y=Ro(On(p)),w=On(f.subarray(0,32));if(!qr(w,Ho,hn.p))return!1;const x=On(f.subarray(32,64));if(!qr(x,Ho,hn.n))return!1;const A=jo(r.toBytes(w),$r(y),d),E=s.multiplyUnsafe(x).add(y.multiplyUnsafe(r.neg(A))),{x:T,y:M}=E.toAffine();return!(E.is0()||!Wr(M)||T!==w)}catch{return!1}}const ur=(()=>{const t=(s=Kt(48))=>_o(s,hn.n);Se.utils.randomSecretKey;function r(s){const f=t(s);return{secretKey:f,publicKey:Fo(f)}}return{keygen:r,getPublicKey:Fo,sign:uu,verify:Ko,Point:dn,utils:{randomSecretKey:t,randomPrivateKey:t,taggedHash:ar,lift_x:Ro,pointToBytes:$r,numberToBytesBE:rr,bytesToNumberBE:cn,mod:it},lengths:{secretKey:32,publicKey:32,publicKeyHasPrefix:!1,signature:64,seed:48}}})(),cu=Uint8Array.from([7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8]),$o=Uint8Array.from(new Array(16).fill(0).map((i,e)=>e)),fu=$o.map(i=>(9*i+5)%16),Wo=(()=>{const t=[[$o],[fu]];for(let r=0;r<4;r++)for(let s of t)s.push(s[r].map(f=>cu[f]));return t})(),zo=Wo[0],Vo=Wo[1],Qo=[[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8],[12,13,11,15,6,9,9,7,12,15,11,13,7,8,7,7],[13,15,14,11,7,7,6,8,13,14,13,12,5,5,6,9],[14,11,12,14,8,6,5,5,15,12,15,14,9,9,8,6],[15,12,13,13,9,5,8,6,14,11,12,11,8,6,5,5]].map(i=>Uint8Array.from(i)),lu=zo.map((i,e)=>i.map(t=>Qo[e][t])),hu=Vo.map((i,e)=>i.map(t=>Qo[e][t])),du=Uint32Array.from([0,1518500249,1859775393,2400959708,2840853838]),pu=Uint32Array.from([1352829926,1548603684,1836072691,2053994217,0]);function Go(i,e,t,r){return i===0?e^t^r:i===1?e&t|~e&r:i===2?(e|~t)^r:i===3?e&r|t&~r:e^(t|~r)}const cr=new Uint32Array(16);class gu extends Mr{constructor(){super(64,20,8,!0),this.h0=1732584193,this.h1=-271733879,this.h2=-1732584194,this.h3=271733878,this.h4=-1009589776}get(){const{h0:e,h1:t,h2:r,h3:s,h4:f}=this;return[e,t,r,s,f]}set(e,t,r,s,f){this.h0=e|0,this.h1=t|0,this.h2=r|0,this.h3=s|0,this.h4=f|0}process(e,t){for(let T=0;T<16;T++,t+=4)cr[T]=e.getUint32(t,!0);let r=this.h0|0,s=r,f=this.h1|0,d=f,p=this.h2|0,y=p,w=this.h3|0,x=w,A=this.h4|0,E=A;for(let T=0;T<5;T++){const M=4-T,N=du[T],W=pu[T],$=zo[T],we=Vo[T],ee=lu[T],pe=hu[T];for(let ve=0;ve<16;ve++){const Be=Xn(r+Go(T,f,p,w)+cr[$[ve]]+N,ee[ve])+A|0;r=A,A=w,w=Xn(p,10)|0,p=f,f=Be}for(let ve=0;ve<16;ve++){const Be=Xn(s+Go(M,d,y,x)+cr[we[ve]]+W,pe[ve])+E|0;s=E,E=x,x=Xn(y,10)|0,y=d,d=Be}}this.set(this.h1+p+x|0,this.h2+w+E|0,this.h3+A+s|0,this.h4+r+d|0,this.h0+f+y|0)}roundClean(){Pt(cr)}destroy(){this.destroyed=!0,Pt(this.buffer),this.set(0,0,0,0,0)}}const yu=Ir(()=>new gu);function Vr(i){return i instanceof Uint8Array||ArrayBuffer.isView(i)&&i.constructor.name==="Uint8Array"}function Zo(i,e){return Array.isArray(e)?e.length===0?!0:i?e.every(t=>typeof t=="string"):e.every(t=>Number.isSafeInteger(t)):!1}function mu(i){if(typeof i!="function")throw new Error("function expected");return!0}function Qr(i,e){if(typeof e!="string")throw new Error(`${i}: string expected`);return!0}function Gr(i){if(!Number.isSafeInteger(i))throw new Error(`invalid integer: ${i}`)}function Zr(i){if(!Array.isArray(i))throw new Error("array expected")}function Xo(i,e){if(!Zo(!0,e))throw new Error(`${i}: array of strings expected`)}function wu(i,e){if(!Zo(!1,e))throw new Error(`${i}: array of numbers expected`)}function Yo(...i){const e=f=>f,t=(f,d)=>p=>f(d(p)),r=i.map(f=>f.encode).reduceRight(t,e),s=i.map(f=>f.decode).reduce(t,e);return{encode:r,decode:s}}function bu(i){const e=typeof i=="string"?i.split(""):i,t=e.length;Xo("alphabet",e);const r=new Map(e.map((s,f)=>[s,f]));return{encode:s=>(Zr(s),s.map(f=>{if(!Number.isSafeInteger(f)||f<0||f>=t)throw new Error(`alphabet.encode: digit index outside alphabet "${f}". Allowed: ${i}`);return e[f]})),decode:s=>(Zr(s),s.map(f=>{Qr("alphabet.decode",f);const d=r.get(f);if(d===void 0)throw new Error(`Unknown letter: "${f}". Allowed: ${i}`);return d}))}}function vu(i=""){return Qr("join",i),{encode:e=>(Xo("join.decode",e),e.join(i)),decode:e=>(Qr("join.decode",e),e.split(i))}}function Jo(i,e,t){if(e<2)throw new Error(`convertRadix: invalid from=${e}, base cannot be less than 2`);if(t<2)throw new Error(`convertRadix: invalid to=${t}, base cannot be less than 2`);if(Zr(i),!i.length)return[];let r=0;const s=[],f=Array.from(i,p=>{if(Gr(p),p<0||p>=e)throw new Error(`invalid integer: ${p}`);return p}),d=f.length;for(;;){let p=0,y=!0;for(let w=r;w<d;w++){const x=f[w],A=e*p,E=A+x;if(!Number.isSafeInteger(E)||A/e!==p||E-x!==A)throw new Error("convertRadix: carry overflow");const T=E/t;p=E%t;const M=Math.floor(T);if(f[w]=M,!Number.isSafeInteger(M)||M*t+p!==E)throw new Error("convertRadix: carry overflow");if(y)M?y=!1:r=w;else continue}if(s.push(p),y)break}for(let p=0;p<i.length-1&&i[p]===0;p++)s.push(0);return s.reverse()}function xu(i){Gr(i);const e=2**8;return{encode:t=>{if(!Vr(t))throw new Error("radix.encode input should be Uint8Array");return Jo(Array.from(t),e,i)},decode:t=>(wu("radix.decode",t),Uint8Array.from(Jo(t,i,e)))}}function ku(i,e){return Gr(i),mu(e),{encode(t){if(!Vr(t))throw new Error("checksum.encode: input should be Uint8Array");const r=e(t).slice(0,i),s=new Uint8Array(t.length+i);return s.set(t),s.set(r,t.length),s},decode(t){if(!Vr(t))throw new Error("checksum.decode: input should be Uint8Array");const r=t.slice(0,-i),s=t.slice(-i),f=e(r).slice(0,i);for(let d=0;d<i;d++)if(f[d]!==s[d])throw new Error("Invalid checksum");return r}}}const Eu=(i=>Yo(xu(58),bu(i),vu("")))("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),Cu=i=>Yo(ku(4,e=>i(i(e))),Eu);const fr=Se.ProjectivePoint,Xr=Cu(Fe);function es(i){rt(i);const e=i.length===0?"0":De(i);return BigInt("0x"+e)}function Tu(i){if(typeof i!="bigint")throw new Error("bigint expected");return qe(i.toString(16).padStart(64,"0"))}const Su=In("Bitcoin seed"),Yr={private:76066276,public:76067358},Jr=2147483648,Au=i=>yu(Fe(i)),_u=i=>sn(i).getUint32(0,!1),lr=i=>{if(!Number.isSafeInteger(i)||i<0||i>2**32-1)throw new Error("invalid number, should be from 0 to 2**32-1, got "+i);const e=new Uint8Array(4);return sn(e).setUint32(0,i,!1),e};class Qt{get fingerprint(){if(!this.pubHash)throw new Error("No publicKey set!");return _u(this.pubHash)}get identifier(){return this.pubHash}get pubKeyHash(){return this.pubHash}get privateKey(){return this.privKeyBytes||null}get publicKey(){return this.pubKey||null}get privateExtendedKey(){const e=this.privateKey;if(!e)throw new Error("No private key");return Xr.encode(this.serialize(this.versions.private,Xe(new Uint8Array([0]),e)))}get publicExtendedKey(){if(!this.pubKey)throw new Error("No public key");return Xr.encode(this.serialize(this.versions.public,this.pubKey))}static fromMasterSeed(e,t=Yr){if(rt(e),8*e.length<128||8*e.length>512)throw new Error("HDKey: seed length must be between 128 and 512 bits; 256 bits is advised, got "+e.length);const r=Mn(ao,Su,e);return new Qt({versions:t,chainCode:r.slice(32),privateKey:r.slice(0,32)})}static fromExtendedKey(e,t=Yr){const r=Xr.decode(e),s=sn(r),f=s.getUint32(0,!1),d={versions:t,depth:r[4],parentFingerprint:s.getUint32(5,!1),index:s.getUint32(9,!1),chainCode:r.slice(13,45)},p=r.slice(45),y=p[0]===0;if(f!==t[y?"private":"public"])throw new Error("Version mismatch");return y?new Qt({...d,privateKey:p.slice(1)}):new Qt({...d,publicKey:p})}static fromJSON(e){return Qt.fromExtendedKey(e.xpriv)}constructor(e){if(this.depth=0,this.index=0,this.chainCode=null,this.parentFingerprint=0,!e||typeof e!="object")throw new Error("HDKey.constructor must not be called directly");if(this.versions=e.versions||Yr,this.depth=e.depth||0,this.chainCode=e.chainCode||null,this.index=e.index||0,this.parentFingerprint=e.parentFingerprint||0,!this.depth&&(this.parentFingerprint||this.index))throw new Error("HDKey: zero depth with non-zero index/parent fingerprint");if(e.publicKey&&e.privateKey)throw new Error("HDKey: publicKey and privateKey at same time.");if(e.privateKey){if(!Se.utils.isValidPrivateKey(e.privateKey))throw new Error("Invalid private key");this.privKey=typeof e.privateKey=="bigint"?e.privateKey:es(e.privateKey),this.privKeyBytes=Tu(this.privKey),this.pubKey=Se.getPublicKey(e.privateKey,!0)}else if(e.publicKey)this.pubKey=fr.fromHex(e.publicKey).toRawBytes(!0);else throw new Error("HDKey: no public or private key provided");this.pubHash=Au(this.pubKey)}derive(e){if(!/^[mM]'?/.test(e))throw new Error('Path must start with "m" or "M"');if(/^[mM]'?$/.test(e))return this;const t=e.replace(/^[mM]'?\//,"").split("/");let r=this;for(const s of t){const f=/^(\d+)('?)$/.exec(s),d=f&&f[1];if(!f||f.length!==3||typeof d!="string")throw new Error("invalid child index: "+s);let p=+d;if(!Number.isSafeInteger(p)||p>=Jr)throw new Error("Invalid index");f[2]==="'"&&(p+=Jr),r=r.deriveChild(p)}return r}deriveChild(e){if(!this.pubKey||!this.chainCode)throw new Error("No publicKey or chainCode set");let t=lr(e);if(e>=Jr){const p=this.privateKey;if(!p)throw new Error("Could not derive hardened child key");t=Xe(new Uint8Array([0]),p,t)}else t=Xe(this.pubKey,t);const r=Mn(ao,this.chainCode,t),s=es(r.slice(0,32)),f=r.slice(32);if(!Se.utils.isValidPrivateKey(s))throw new Error("Tweak bigger than curve order");const d={versions:this.versions,chainCode:f,depth:this.depth+1,parentFingerprint:this.fingerprint,index:e};try{if(this.privateKey){const p=it(this.privKey+s,Se.CURVE.n);if(!Se.utils.isValidPrivateKey(p))throw new Error("The tweak was out of range or the resulted private key is invalid");d.privateKey=p}else{const p=fr.fromHex(this.pubKey).add(fr.fromPrivateKey(s));if(p.equals(fr.ZERO))throw new Error("The tweak was equal to negative P, which made the result key invalid");d.publicKey=p.toRawBytes(!0)}return new Qt(d)}catch{return this.deriveChild(e+1)}}sign(e){if(!this.privateKey)throw new Error("No privateKey set!");return rt(e,32),Se.sign(e,this.privKey).toCompactRawBytes()}verify(e,t){if(rt(e,32),rt(t,64),!this.publicKey)throw new Error("No publicKey set!");let r;try{r=Se.Signature.fromCompact(t)}catch{return!1}return Se.verify(r,e,this.publicKey)}wipePrivateData(){return this.privKey=void 0,this.privKeyBytes&&(this.privKeyBytes.fill(0),this.privKeyBytes=void 0),this}toJSON(){return{xpriv:this.privateExtendedKey,xpub:this.publicExtendedKey}}serialize(e,t){if(!this.chainCode)throw new Error("No chainCode set");return rt(t,33),Xe(lr(e),new Uint8Array([this.depth]),lr(this.parentFingerprint),lr(this.index),this.chainCode,t)}}class qn extends Error{constructor(e,t){super(e),this.status=t,this.name="HttpResponseError",Object.setPrototypeOf(this,qn.prototype)}}class ei extends Error{constructor(e){super(e),this.name="NetworkError",Object.setPrototypeOf(this,ei.prototype)}}class ti extends qn{constructor(e,t){super(t||"Unknown mint operation error",400),this.code=e,this.name="MintOperationError",Object.setPrototypeOf(this,ti.prototype)}}const lt={error(){},warn(){},info(){},debug(){},trace(){},log(){}};function hr(i,e=lt,t){throw e.error(i,t),new Error(i)}function ni(i,e,t=lt,r){i&&hr(e,t,r)}function ts(i,e,t=lt,r){i==null&&hr(e,t,r)}function Nn(i,e,t=lt,r){if(i)try{const s=i(e);s&&typeof s.then=="function"&&s.catch(f=>{try{t.warn("callback failed",{...r??{},error:f,cb:i.name??""})}catch{}})}catch(s){try{t.warn("callback failed",{...r??{},error:s,cb:i.name??""})}catch{}}}function Iu(){const i=Date.now();return{elapsed:()=>Date.now()-i}}let Mu={},ns=lt;function Bu(i){ns=i}async function Pu({endpoint:i,requestBody:e,headers:t,...r}){const s=e?JSON.stringify(e):void 0,f={Accept:"application/json, text/plain, */*",...s?{"Content-Type":"application/json"}:void 0,...t};let d;try{d=await fetch(i,{body:s,headers:f,...r})}catch(p){throw new ei(p instanceof Error?p.message:"Network request failed")}if(!d.ok){let p;try{p=await d.json()}catch{p={error:"bad response"}}if(d.status===400&&"code"in p&&typeof p.code=="number"&&"detail"in p&&typeof p.detail=="string")throw new ti(p.code,p.detail);let y="HTTP request failed";throw"error"in p&&typeof p.error=="string"?y=p.error:"detail"in p&&typeof p.detail=="string"&&(y=p.detail),new qn(y,d.status)}try{return await d.json()}catch(p){throw ns.error("Failed to parse HTTP response",{err:p}),new qn("bad response",d.status)}}async function Ou(i){return await Pu({...i,...Mu})}let ri;typeof WebSocket<"u"&&(ri=WebSocket);function qu(){if(ri===void 0)throw new Error("WebSocket implementation not initialized");return ri}class Ne{static fromHex(e){if(e=e.trim(),e.length===0)return new Uint8Array(0);if(e.length<2||e.length&1)throw new Error("Invalid hex string: odd length.");if((e.startsWith("0x")||e.startsWith("0X"))&&(e=e.slice(2)),!e.match(/^[0-9a-fA-F]*$/))throw new Error("Invalid hex string: contains non-hex characters");const t=e.match(/.{1,2}/g);if(!t)throw new Error("Invalid hex string");return new Uint8Array(t.map(r=>parseInt(r,16)))}static toHex(e){return Array.from(e,t=>t.toString(16).padStart(2,"0")).join("")}static fromString(e){return e=e.trim(),new TextEncoder().encode(e)}static toString(e){return new TextDecoder("utf-8").decode(e)}static concat(...e){const t=e.reduce((f,d)=>f+d.length,0),r=new Uint8Array(t);let s=0;for(const f of e)r.set(f,s),s+=f.length;return r}static alloc(e){return new Uint8Array(e)}static writeBigUint64BE(e){const t=new ArrayBuffer(8);return new DataView(t).setBigUint64(0,e,!1),new Uint8Array(t)}static toBase64(e){if(typeof Buffer<"u")return Buffer.from(e).toString("base64");if(e.length>32768){let t="";for(let r=0;r<e.length;r+=32768){const s=e.slice(r,r+32768);t+=btoa(String.fromCharCode(...s))}return t}return btoa(String.fromCharCode(...e))}static fromBase64(e){e=e.trim();let t=e.replace(/-/g,"+").replace(/_/g,"/");for(;t.length%4;)t+="=";return typeof Buffer<"u"?new Uint8Array(Buffer.from(t,"base64")):new Uint8Array([...atob(t)].map(r=>r.charCodeAt(0)))}static equals(e,t){if(e.length!==t.length)return!1;let r=0;for(let s=0;s<e.length;s++)r|=e[s]^t[s];return r===0}static compare(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){if(e[s]<t[s])return-1;if(e[s]>t[s])return 1}return e.length-t.length}}function ii(i){return Ne.toBase64(i).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function rs(i){return Ne.fromBase64(i)}function Nu(i){const e=Ne.toString(Ne.fromBase64(Du(i)));return JSON.parse(e)}function Du(i){return i.replace(/-/g,"+").replace(/_/g,"/").split("=")[0]}function oi(i){if(typeof i!="string"||i.length===0)return!1;const e=/^[A-Za-z0-9\-_]+={0,2}$/,t=/^[A-Za-z0-9+/]+={0,2}$/;if(!e.test(i)&&!t.test(i))return!1;const r=i.replace(/-/g,"+").replace(/_/g,"/"),s=(4-r.length%4)%4;if(s>2)return!1;const f=r+"=".repeat(s);try{const d=Ne.fromBase64(f),p=Ne.toBase64(d),y=p.replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,""),w=r.replace(/=+$/,"");return p.replace(/=+$/,"")===w||y===w}catch{return!1}}function Lu(i){return typeof i=="number"||typeof i=="string"}function Hu(i){const e=[];return si(i,e),new Uint8Array(e)}function si(i,e){if(i===null)e.push(246);else if(i===void 0)e.push(247);else if(typeof i=="boolean")e.push(i?245:244);else if(typeof i=="number")Fu(i,e);else if(typeof i=="string")is(i,e);else if(Array.isArray(i))$u(i,e);else if(i instanceof Uint8Array)Ku(i,e);else if(typeof i=="object"&&i!==null&&!Array.isArray(i))Wu(i,e);else throw new Error("Unsupported type")}function Uu(i,e){if(i<24)e.push(i);else if(i<256)e.push(24,i);else if(i<65536)e.push(25,i>>>8&255,i&255);else if(i<4294967296)e.push(26,i>>>24&255,i>>>16&255,i>>>8&255,i&255);else throw new Error("Unsupported integer size")}function Ru(i,e){const t=-1-i;if(t<24)e.push(32|t);else if(t<256)e.push(56,t&255);else if(t<65536)e.push(57,t>>>8&255,t&255);else if(t<4294967296)e.push(58,t>>>24&255,t>>>16&255,t>>>8&255,t&255);else throw new Error("Unsupported integer size")}function ju(i,e){const t=new ArrayBuffer(8),r=new DataView(t);r.setFloat64(0,i,!1),e.push(251);for(let s=0;s<8;s++)e.push(r.getUint8(s))}function Fu(i,e){Number.isInteger(i)?i>=0?Uu(i,e):Ru(i,e):ju(i,e)}function Ku(i,e){const t=i.length;if(t<24)e.push(64+t);else if(t<256)e.push(88,t);else if(t<65536)e.push(89,t>>8&255,t&255);else if(t<4294967296)e.push(90,t>>>24&255,t>>>16&255,t>>>8&255,t&255);else throw new Error("Byte string too long to encode");for(let r=0;r<i.length;r++)e.push(i[r])}function is(i,e){const t=new TextEncoder().encode(i),r=t.length;if(r<24)e.push(96+r);else if(r<256)e.push(120,r);else if(r<65536)e.push(121,r>>>8&255,r&255);else if(r<4294967296)e.push(122,r>>>24&255,r>>>16&255,r>>>8&255,r&255);else throw new Error("String too long to encode");for(let s=0;s<t.length;s++)e.push(t[s])}function $u(i,e){const t=i.length;if(t<24)e.push(128|t);else if(t<256)e.push(152,t);else if(t<65536)e.push(153,t>>>8&255,t&255);else throw new Error("Unsupported array length");for(const r of i)si(r,e)}function Wu(i,e){const t=Object.keys(i),r=t.length;if(r>=4294967296)throw new Error("Object has too many keys to encode");r<24?e.push(160|r):r<256?e.push(184,r):r<65536?e.push(185,r>>8&255,r&255):e.push(186,r>>24&255,r>>16&255,r>>8&255,r&255);for(const s of t)is(s,e),si(i[s],e)}function zu(i){const e=new DataView(i.buffer,i.byteOffset,i.byteLength);return dr(e,0).value}function dr(i,e){if(e>=i.byteLength)throw new Error("Unexpected end of data");const t=i.getUint8(e++),r=t>>5,s=t&31;switch(r){case 0:return Vu(i,e,s);case 1:return Qu(i,e,s);case 2:return Gu(i,e,s);case 3:return Zu(i,e,s);case 4:return Xu(i,e,s);case 5:return Yu(i,e,s);case 7:return ec(i,e,s);default:throw new Error(`Unsupported major type: ${r}`)}}function Lt(i,e,t){if(e+t>i.byteLength)throw new Error("Unexpected end of data")}function pn(i,e,t){if(t<24)return{value:t,offset:e};if(t===24)return Lt(i,e,1),{value:i.getUint8(e++),offset:e};if(t===25){Lt(i,e,2);const r=i.getUint16(e,!1);return e+=2,{value:r,offset:e}}if(t===26){Lt(i,e,4);const r=i.getUint32(e,!1);return e+=4,{value:r,offset:e}}if(t===27){Lt(i,e,8);const r=i.getUint32(e,!1),s=i.getUint32(e+4,!1);return e+=8,{value:r*2**32+s,offset:e}}throw new Error(`Unsupported length: ${t}`)}function Vu(i,e,t){const{value:r,offset:s}=pn(i,e,t);return{value:r,offset:s}}function Qu(i,e,t){const{value:r,offset:s}=pn(i,e,t);return{value:-1-r,offset:s}}function Gu(i,e,t){const{value:r,offset:s}=pn(i,e,t);if(s+r>i.byteLength)throw new Error("Byte string length exceeds data length");return{value:new Uint8Array(i.buffer,i.byteOffset+s,r),offset:s+r}}function Zu(i,e,t){const{value:r,offset:s}=pn(i,e,t);if(s+r>i.byteLength)throw new Error("String length exceeds data length");const f=new Uint8Array(i.buffer,i.byteOffset+s,r);return{value:new TextDecoder().decode(f),offset:s+r}}function Xu(i,e,t){const{value:r,offset:s}=pn(i,e,t),f=[];let d=s;for(let p=0;p<r;p++){const y=dr(i,d);f.push(y.value),d=y.offset}return{value:f,offset:d}}function Yu(i,e,t){const{value:r,offset:s}=pn(i,e,t),f={};let d=s;for(let p=0;p<r;p++){const y=dr(i,d);if(!Lu(y.value))throw new Error("Invalid key type");const w=dr(i,y.offset);f[y.value]=w.value,d=w.offset}return{value:f,offset:d}}function Ju(i){const e=(i&31744)>>10,t=i&1023,r=i&32768?-1:1;return e===0?r*2**-14*(t/1024):e===31?t?NaN:r*(1/0):r*2**(e-15)*(1+t/1024)}function ec(i,e,t){if(t<24)switch(t){case 20:return{value:!1,offset:e};case 21:return{value:!0,offset:e};case 22:return{value:null,offset:e};case 23:return{value:void 0,offset:e};default:throw new Error(`Unknown simple value: ${t}`)}if(t===24)return Lt(i,e,1),{value:i.getUint8(e++),offset:e};if(t===25){Lt(i,e,2);const r=Ju(i.getUint16(e,!1));return e+=2,{value:r,offset:e}}if(t===26){Lt(i,e,4);const r=i.getFloat32(e,!1);return e+=4,{value:r,offset:e}}if(t===27){Lt(i,e,8);const r=i.getFloat64(e,!1);return e+=8,{value:r,offset:e}}throw new Error(`Unknown simple or float value: ${t}`)}const tc=In("Secp256k1_HashToCurve_Cashu_");function pr(i){const e=Fe(Ne.concat(tc,i)),t=new Uint32Array(1),r=2**16;for(let s=0;s<r;s++){const f=new Uint8Array(t.buffer),d=Fe(Ne.concat(e,f));try{return gn(De(Ne.concat(new Uint8Array([2]),d)))}catch{t[0]++}}throw new Error("No valid point found")}function nc(i){const e=i.map(t=>t.toHex(!1)).join("");return Fe(new TextEncoder().encode(e))}function gn(i){return Se.Point.fromHex(i)}const rc=i=>{let e;return/^[a-fA-F0-9]+$/.test(i)?e=Dn(i)%BigInt(2**31-1):e=gr(rs(i))%BigInt(2**31-1),e};function ic(){return Se.utils.randomSecretKey()}function ai(i,e){const t=pr(i);e||(e=Se.Point.Fn.fromBytes(ic()));const r=Se.Point.BASE.multiply(e);return{B_:t.add(r),r:e,secret:i}}function oc(i,e,t){return i.subtract(t.multiply(e))}function sc(i,e,t,r){const s=r,f=oc(i.C_,e,s);return{id:i.id,amount:i.amount,secret:t,C:f}}const ac=i=>({amount:i.amount,C:i.C.toHex(!0),id:i.id,secret:new TextDecoder().decode(i.secret),witness:JSON.stringify(i.witness)}),uc=(i,e)=>{const t=Fe(new TextEncoder().encode(i)),r=typeof e=="string"?qe(e):e,s=ur.sign(t,r);return De(s)},cc=(i,e,t,r=!1)=>{try{const s=Fe(new TextEncoder().encode(e)),f=t.length===66?t.slice(2):t;return ur.verify(qe(i),s,qe(f))}catch(s){if(r)throw s}return!1};function ui(i){let e;try{typeof i=="string"?e=JSON.parse(i):e=i}catch{throw new Error("Can't parse secret")}if(!Array.isArray(e)||e.length!==2||typeof e[0]!="string"||typeof e[1]!="object"||e[0].trim().length===0||e[1]===null)throw new Error("Invalid NUT-10 secret");const[t,r]=e;if(typeof r.nonce!="string"||typeof r.data!="string")throw new Error("Invalid NUT-10 secret nonce / data");if(r.tags){if(!Array.isArray(r.tags))throw new Error("Invalid NUT-10 secret tags");if(r.tags.some(s=>!Array.isArray(s)||s.length===0||s.some(f=>typeof f!="string"||!f.length)))throw new Error("Invalid NUT-10 tag(s)")}return[t,{nonce:r.nonce,data:r.data,tags:r.tags}]}function fc(i,e){const t=Array.isArray(i)?i:[i],r=ui(e),s=r[0];if(!t.includes(s))throw new Error(`Invalid secret kind: ${s} Allowed: ${t.join(", ")}`);return r}function lc(i){return ui(i)[0]}function os(i){return ui(i)[1]}function hc(i){const{data:e}=os(i);return e}function dc(i){const{tags:e}=os(i);return e??[]}function ci(i,e){const t=dc(i).find(r=>r[0]===e);if(!(!t||t.length<=1))return t.slice(1)}function ss(i,e){const t=ci(i,e);return t&&t.length>0?t[0]:void 0}function pc(i,e){const t=ss(i,e);if(t===void 0)return;const r=Number.parseInt(t,10);return Number.isFinite(r)?r:void 0}const as=In("Cashu_P2BK_v1");function gc(i,e,t){if(!i.length)return{blinded:[],Ehex:""};t=t??Se.utils.randomSecretKey();const r=Se.Point.Fn.fromBytes(t),s=Se.getPublicKey(t,!0),f=qe(e);return{blinded:i.map((d,p)=>{const y=gn(d),w=us(y,r,f,p),x=y.add(Se.Point.BASE.multiply(w));if(x.equals(Se.Point.ZERO))throw new Error("Blinded key at infinity");return x.toHex(!0)}),Ehex:De(s)}}function yc(i,e,t,r){const s=Array.isArray(e)?e:[e],f=Array.isArray(t)?t:[t],d=new Set,p=Se.Point.fromHex(i),y=qe(r);for(const w of s){const x=Se.Point.Fn.fromBytes(qe(w)),A=Se.getPublicKey(qe(w),!0);f.forEach((E,T)=>{const M=us(p,x,y,T),N=qe(E),W=mc(w,M,N,A);W&&d.add(W)})}return Array.from(d)}function mc(i,e,t,r){const s=Se.Point.CURVE().n,f=typeof i=="string"?Dn(i):i,d=typeof e=="string"?Dn(e):e;if(f<=0n||f>=s)throw new Error("Invalid private key");if(d<=0n||d>=s)throw new Error("Invalid scalar r");if(r=r??Se.Point.BASE.multiply(f).toBytes(!0),r.length!==33)throw new Error("naturalPub must be 33 bytes");const p=(f+d)%s,y=(s-f+d)%s;if(!t){if(p===0n)throw new Error("Derived secret key is zero");return li(p)}if(t.length!==33)throw new Error("blindPubkey must be 33 bytes");const w=Se.Point.fromHex(De(t)),x=Se.Point.BASE.multiply(d),A=w.subtract(x);if(A.equals(Se.Point.ZERO))return null;const E=A.toBytes(!0).slice(1),T=r.slice(1);if(!Ne.equals(E,T))return null;const M=A.toBytes(!0)[0]&1,N=r[0]&1,W=M===N?p:y;if(W===0n)throw new Error("Derived secret key is zero");return li(W)}function us(i,e,t,r){const s=i.multiply(e).toBytes(!0).slice(1),f=new Uint8Array([r&255]);let d=gr(Fe(Ne.concat(as,s,t,f)));if((d===0n||d>=Se.Point.CURVE().n)&&(d=gr(Fe(Ne.concat(as,s,t,f,new Uint8Array([255])))),d===0n||d>=Se.Point.CURVE().n))throw new Error("P2BK: tweak derivation failed");return d}function wt(i){return i instanceof Uint8Array&&(i=new TextDecoder().decode(i)),fc(["P2PK","HTLC"],i)}function wc(i){try{const e=wt(i),t=vc(e),r=cs(e),s=fs(e);if(t==="ACTIVE"||t==="PERMANENT")return r;if(t==="EXPIRED"&&s.length){const f=[...r,...s];return Array.from(new Set(f))}}catch{}return[]}function cs(i){const e=wt(i);let t="";lc(e)==="P2PK"&&(t=hc(e));const r=ci(e,"pubkeys")??[],s=[t,...r].filter(Boolean);return Array.from(new Set(s))}function fs(i){const e=wt(i);return ci(e,"refund")??[]}function bc(i){const e=wt(i),t=pc(e,"locktime");return t===void 0||!Number.isFinite(t)||t<=0?1/0:t}function vc(i,e=Math.floor(Date.now()/1e3)){const t=wt(i),r=bc(t);return Number.isFinite(r)?e<r?"ACTIVE":"EXPIRED":"PERMANENT"}function fi(i){const e=wt(i);return ss(e,"sigflag")==="SIG_ALL"?"SIG_ALL":"SIG_INPUTS"}function xc(i){return ls(i)?.signatures??[]}function ls(i){if(!i)return;let e;try{e=typeof i=="string"?JSON.parse(i):i}catch(r){console.error("Failed to parse witness string:",r);return}const t={signatures:e.signatures??[]};return typeof e.preimage=="string"&&e.preimage.length>0&&(t.preimage=e.preimage),t}function hs(i,e,t=lt,r){const s=d=>typeof d=="string"?d:De(d),f=Array.isArray(e)?e.map(s):s(e);return i.map((d,p)=>{const y=Ec(f,d);let w=d;for(const x of y)try{w=kc(w,x,r)}catch(A){const E=A instanceof Error?A.message:"Unknown error";t.warn(`Proof #${p+1}: ${E}`)}return w})}function kc(i,e,t){const r=wt(i.secret);t=t??i.secret;const s=typeof e=="string"?qe(e):e,f=De(ur.getPublicKey(s)),d=wc(r);if(!d.length||!d.some(x=>x.includes(f)))throw new Error(`Signature not required from [02|03]${f}`);if(xc(i.witness).some(x=>cc(x,t,f)))throw new Error(`Proof already signed by [02|03]${f}`);const p=uc(t,e),y=ls(i.witness),w={...y&&y.preimage!==void 0?{preimage:y.preimage}:{},signatures:[...y?.signatures??[],p]};return{...i,witness:w}}function Ec(i,e){const t=Array.isArray(i)?i:[i],r=e?.p2pk_e;if(!r)return Array.from(new Set(t));const s=wt(e.secret),f=[...cs(s),...fs(s)],d=e.id;return yc(r,t,f,d)}function Cc(i){if(i.length===0)throw new Error("No proofs");const e=wt(i[0].secret);if(fi(e)!=="SIG_ALL")throw new Error("First proof is not SIG_ALL");const t=e[1].data,r=JSON.stringify(e[1].tags??[]);for(let s=1;s<i.length;s++){const f=wt(i[s].secret);if(f[0]!==e[0])throw new Error(`Proof #${s+1} is not ${e[0]}`);if(fi(f)!=="SIG_ALL")throw new Error(`Proof #${s+1} is not SIG_ALL`);if(f[1].data!==t)throw new Error("SIG_ALL inputs must share identical Secret.data");if(JSON.stringify(f[1].tags??[])!==r)throw new Error("SIG_ALL inputs must share identical Secret.tags")}}function Tc(i,e,t){const r=[];for(const s of i)r.push(s.secret,s.C);for(const s of e)r.push(String(s.blindedMessage.amount),s.blindedMessage.B_);return t&&r.push(t),r.join("")}function ds(i){return i.some(e=>{try{return fi(e.secret)==="SIG_ALL"}catch{return!1}})}function Sc(i,e,t){const r=[];for(const s of i)r.push(s.secret,s.C);for(const s of e)r.push(String(s.blindedMessage.amount),s.blindedMessage.id,s.blindedMessage.B_);return t&&r.push(t),r.join("")}function Ac(i,e,t){const r=[];for(const s of i)r.push(s.secret);for(const s of e)r.push(s.blindedMessage.B_);return t&&r.push(t),r.join("")}function _c(i,e){if(i.length!==e.length)return!1;for(let t=0;t<i.length;t++)if(i[t]!==e[t])return!1;return!0}const Ic=(i,e,t,r)=>{const s=Se.Point.Fn.fromBytes(i.s),f=Se.Point.Fn.fromBytes(i.e),d=Se.Point.BASE.multiply(s),p=r.multiply(f),y=e.multiply(s),w=t.multiply(f),x=d.subtract(p),A=y.subtract(w),E=nc([x,A,r,t]);return _c(E,i.e)},Mc=(i,e,t,r)=>{if(e.r===void 0)throw new Error("verifyDLEQProof_reblind: Undefined blinding factor");const s=pr(i),f=t.add(r.multiply(e.r)),d=Se.Point.BASE.multiply(e.r),p=s.add(d);return Ic(e,p,f,r)},Bc="m/129372'/0'",Pc=(i,e,t)=>{const r=/^[a-fA-F0-9]+$/.test(e);if(!r&&oi(e)||r&&e.startsWith("00"))return gs(i,e,t,0);if(r&&e.startsWith("01"))return ps(i,e,t,0);throw new Error(`Unrecognized keyset ID version ${e.slice(0,2)}`)},Oc=(i,e,t)=>{const r=/^[a-fA-F0-9]+$/.test(e);if(!r&&oi(e)||r&&e.startsWith("00"))return gs(i,e,t,1);if(r&&e.startsWith("01"))return ps(i,e,t,1);throw new Error(`Unrecognized keyset ID version ${e.slice(0,2)}`)},ps=(i,e,t,r)=>{let s=Ne.concat(Ne.fromString("Cashu_KDF_HMAC_SHA256"),Ne.fromHex(e),Ne.writeBigUint64BE(BigInt(t)));switch(r){case 0:s=Ne.concat(s,Ne.fromHex("00"));break;case 1:s=Ne.concat(s,Ne.fromHex("01"))}return Mn(Fe,i,s)},gs=(i,e,t,r)=>{const s=Qt.fromMasterSeed(i),f=rc(e),d=`${Bc}/${f}'/${t}'/${r}`,p=s.derive(d);if(p.privateKey===null)throw new Error("Could not derive private key");return p.privateKey};function qc(i,e){let t=i;for(const s of e)t+=s.B_;const r=new TextEncoder().encode(t);return Fe(r)}function Nc(i,e,t){const r=qc(e,t),s=qe(i),f=ur.sign(r,s);return De(f)}function Ht(i,e,t,r){if(t){const f=xs(t);if(i===0&&f===0)return t;const d=t.filter(y=>y>0),p=xs(d);if(p>i)throw new Error(`Split is greater than total amount: ${p} > ${i}`);if(d.some(y=>!ms(y,e)))throw new Error("Provided amount preferences do not match the amounts of the mint keyset.");if(p===i)return d;t=d,i-=p}else t=[];const s=ys(e,"desc");if(!s||s.length===0)throw new Error("Cannot split amount, keyset is inactive or contains no keys");for(const f of s){if(f<=0)continue;const d=Math.floor(i/f);if(t.push(...Array(d).fill(f)),i-=f*d,i===0)break}if(i!==0)throw new Error(`Unable to split remaining amount: ${i}`);return r?t.sort((f,d)=>f-d):t}function Dc(i,e,t,r){const s=[],f=i.map(p=>p.amount);ys(t,"asc").forEach(p=>{const y=f.filter(x=>x===p).length,w=Math.max(r-y,0);for(let x=0;x<w&&!(s.reduce((A,E)=>A+E,0)+p>e);++x)s.push(p)});const d=e-s.reduce((p,y)=>p+y,0);return d&&Ht(d,t).forEach(p=>{s.push(p)}),s.sort((p,y)=>p-y)}function ys(i,e="desc"){return e=="desc"?Object.keys(i).map(t=>parseInt(t)).sort((t,r)=>r-t):Object.keys(i).map(t=>parseInt(t)).sort((t,r)=>t-r)}function ms(i,e){return i in e}function gr(i){return Dn(De(i))}function Dn(i){return BigInt(`0x${i}`)}function li(i){return i.toString(16).padStart(64,"0")}function yn(i){return/^[a-f0-9]*$/i.test(i)}function Lc(i){return Array.isArray(i)?i.some(e=>!yn(e.id)):!yn(i.id)}function Hc(i){return i.map(e=>{const t={...e};return t.id=t.id.slice(0,16),t})}function ws(i,e){if(i.proofs.forEach(p=>{if(p.dleq&&p.dleq.r==null)throw new Error("Missing blinding factor in included DLEQ proof")}),Lc(i.proofs))throw new Error("can not encode to v4 token if proofs contain non-hex keyset id");i.proofs=Hc(i.proofs);const t=Uc(i),r=Hu(t),s="cashu",f="B",d=ii(r);return s+f+d}function Uc(i){const e={},t=i.mint;for(let s=0;s<i.proofs.length;s++){const f=i.proofs[s];e[f.id]?e[f.id].push(f):e[f.id]=[f]}const r={m:t,u:i.unit||"sat",t:Object.keys(e).map(s=>({i:qe(s),p:e[s].map(f=>({a:f.amount,s:f.secret,c:qe(f.C),...f.dleq&&{d:{e:qe(f.dleq.e),s:qe(f.dleq.s),r:qe(f.dleq.r??"00")}},...f.p2pk_e&&{pe:qe(f.p2pk_e)},...f.witness&&{w:JSON.stringify(f.witness)}}))}))};return i.memo&&(r.d=i.memo),r}function hi(i,e=!1){if(typeof i!="number"||!Number.isFinite(i)||!Number.isInteger(i))throw new Error(`Invalid amount: ${String(i)}`);if(!Number.isSafeInteger(i))throw new Error(`Amount must be a safe integer: ${i}`);if(e?i<0:i<=0)throw new Error(`Amount must be ${e?"non-negative":"positive"}: ${i}`)}function Rc(i){const e=[];i.t.forEach(r=>r.p.forEach(s=>{hi(s.a,!0),e.push({secret:s.s,C:De(s.c),amount:s.a,id:De(r.i),...s.d&&{dleq:{r:De(s.d.r),s:De(s.d.s),e:De(s.d.e)}},...s.pe&&{p2pk_e:De(s.pe)},...s.w&&{witness:s.w}})}));const t={mint:i.m,proofs:e,unit:i.u||"sat"};return i.d&&(t.memo=i.d),t}function jc(i,e){const t=(e??[]).map(f=>typeof f=="string"?f:f.id),r=ks(i),s=bs(r);return s.proofs=zc(s.proofs,t),s}function Fc(i){i=ks(i);const e=bs(i);return{unit:e.unit||"sat",mint:e.mint,amount:Gt(e.proofs),...e.memo&&{memo:e.memo},incompleteProofs:e.proofs.map(t=>({secret:t.secret,C:t.C,amount:t.amount,...t.dleq&&{dleq:t.dleq},...t.witness&&{witness:t.witness}}))}}function bs(i){const e=i.slice(0,1),t=i.slice(1);if(e==="A"){const r=Nu(t);if(r.token.length>1)throw new Error("Multi entry token are not supported");const s=r.token[0];for(const d of s.proofs)hi(d.amount,!0);const f={mint:s.mint,proofs:s.proofs,unit:r.unit||"sat"};return r.memo&&(f.memo=r.memo),f}else if(e==="B"){const r=rs(t),s=zu(r);return Rc(s)}throw new Error("Token version is not supported")}function Kc(i,e,t,r=0,s=!1){if(s){const y=Object.entries(i).sort((x,A)=>+x[0]-+A[0]).map(([,x])=>x).reduce((x,A)=>x+A,""),w=Fe(Ne.fromString(y));return Ne.toBase64(w).slice(0,12)}let f=Object.entries(i).sort((y,w)=>+y[0]-+w[0]).map(([,y])=>qe(y)).reduce((y,w)=>di(y,w),new Uint8Array),d,p;switch(r){case 0:return d=Fe(f),p=Ne.toHex(d).slice(0,14),"00"+p;case 1:if(!e)throw new Error("Cannot compute keyset ID version 01: unit is required.");return f=di(f,Ne.fromString("unit:"+e)),t&&(f=di(f,Ne.fromString("final_expiry:"+t.toString()))),d=Fe(f),p=Ne.toHex(d),"01"+p;default:throw new Error(`Unrecognized keyset ID version: ${r}`)}}function di(i,e){const t=new Uint8Array(i.length+e.length);return t.set(i),t.set(e,i.length),t}function bt(i){return typeof i=="object"}function mn(...i){return i.map(e=>e.replace(/(^\/+|\/+$)/g,"")).join("/")}function vs(i){return i.replace(/\/$/,"")}function Gt(i){return i.reduce((e,t)=>e+t.amount,0)}class $c{get value(){return this._value}set value(e){this._value=e}get next(){return this._next}set next(e){this._next=e}constructor(e){this._value=e,this._next=null}}class Wc{get first(){return this._first}set first(e){this._first=e}get last(){return this._last}set last(e){this._last=e}get size(){return this._size}set size(e){this._size=e}constructor(){this._first=null,this._last=null,this._size=0}enqueue(e){const t=new $c(e);return this._size===0||!this._last?(this._first=t,this._last=t):(this._last.next=t,this._last=t),this._size++,!0}dequeue(){if(this._size===0||!this._first)return null;const e=this._first;return this._first=e.next,e.next=null,this._size--,e.value}}function zc(i,e){const t=(e??[]).map(s=>typeof s=="string"?s:s.id),r=[];for(const s of i){let f;try{f=qe(s.id)}catch{r.push(s);continue}if(f[0]===0)r.push(s);else if(f[0]===1){if(!t)throw new Error("A short keyset ID v2 was encountered, but got no keysets to map it to.");let d=!1;for(const p of t)if(s.id===p.slice(0,s.id.length)){s.id=p,r.push(s),d=!0;break}if(!d)throw new Error(`Couldn't map short keyset ID ${s.id} to any known keysets of the current Mint`)}else throw new Error(`Unknown keyset ID version: ${f[0]}`)}return r}function Vc(i,e){if(i.dleq==null)return!1;const t={e:qe(i.dleq.e),s:qe(i.dleq.s),r:Dn(i.dleq.r??"00")};if(!ms(i.amount,e.keys))throw new Error(`Undefined key for amount ${i.amount} in keyset ${e.id}`);const r=e.keys[i.amount];return Mc(new TextEncoder().encode(i.secret),t,gn(i.C),gn(r))}function xs(i){return i.reduce((e,t)=>e+t,0)}function ks(i){return["web+cashu://","cashu://","cashu:","cashu"].forEach(e=>{i.startsWith(e)&&(i=i.slice(e.length))}),i}function Qc(i){return/^ln[a-z]{2,}[1-9][0-9]*(?:[mun]|0p)?1/i.test(i)}class wn{constructor(){this.connectionMap=new Map}static getInstance(){return wn.instance||(wn.instance=new wn),wn.instance}getConnection(e,t){if(this.connectionMap.has(e))return this.connectionMap.get(e);const r=new Gc(e,t);return this.connectionMap.set(e,r),r}}class Gc{constructor(e,t){this.subListeners={},this.rpcListeners={},this.rpcId=0,this.onCloseCallbacks=[],this._WS=qu(),this.url=new URL(e),this.messageQueue=new Wc,this._logger=t??lt}connect(){return this.connectionPromise||(this.connectionPromise=new Promise((e,t)=>{try{this.ws=new this._WS(this.url.toString()),this.onCloseCallbacks=[]}catch(r){t(r instanceof Error?r:new Error(String(r)));return}this.ws.onopen=()=>{e()},this.ws.onerror=()=>{t(new Error("Failed to open WebSocket"))},this.ws.onmessage=r=>{this.messageQueue.enqueue(r.data),this.handlingInterval||(this.handlingInterval=setInterval(this.handleNextMessage.bind(this),0))},this.ws.onclose=r=>{this.connectionPromise=void 0,this.onCloseCallbacks.forEach(s=>s(r))}})),this.connectionPromise}sendRequest(e,t){if(this.ws?.readyState!==1){if(e==="unsubscribe")return;throw this._logger.error("Attempted sendRequest, but socket was not open"),new Error("Socket not open")}const r=this.rpcId;this.rpcId++;const s=JSON.stringify({jsonrpc:"2.0",method:e,params:t,id:r});this.ws?.send(s)}closeSubscription(e){this.ws?.send(JSON.stringify(["CLOSE",e]))}addSubListener(e,t){(this.subListeners[e]=this.subListeners[e]||[]).push(t)}addRpcListener(e,t,r){this.rpcListeners[r]={callback:e,errorCallback:t}}removeRpcListener(e){delete this.rpcListeners[e]}removeListener(e,t){if(this.subListeners[e]){if(this.subListeners[e].length===1){delete this.subListeners[e];return}this.subListeners[e]=this.subListeners[e].filter(r=>r!==t)}}async ensureConnection(){this.ws?.readyState!==1&&await this.connect()}handleNextMessage(){if(this.messageQueue.size===0){clearInterval(this.handlingInterval),this.handlingInterval=void 0;return}const e=this.messageQueue.dequeue();let t;try{if(t=JSON.parse(e),"result"in t&&t.id!=null)this.rpcListeners[t.id]&&(this.rpcListeners[t.id].callback(),this.removeRpcListener(t.id));else if("error"in t&&t.id!=null)this.rpcListeners[t.id]&&(this.rpcListeners[t.id].errorCallback(new Error(t.error.message)),this.removeRpcListener(t.id));else if("method"in t&&!("id"in t)){const r=t.params?.subId;if(!r)return;if(this.subListeners[r]?.length>0){const s=t;this.subListeners[r].forEach(f=>f(s.params?.payload))}}}catch(r){this._logger.error("Error doing handleNextMessage",{e:r});return}}createSubscription(e,t,r){if(this.ws?.readyState!==1)throw this._logger.error("Attempted createSubscription, but socket was not open"),new Error("Socket is not open");const s=(Math.random()+1).toString(36).substring(7);return this.addRpcListener(()=>{this.addSubListener(s,t)},r,this.rpcId),this.sendRequest("subscribe",{...e,subId:s}),this.rpcId++,s}cancelSubscription(e,t,r){this.removeListener(e,t),this.addRpcListener(()=>{this._logger.info("Unsubscribed {subId}",{subId:e})},r||(s=>this._logger.error("Unsubscribe failed",{e:s})),this.rpcId),this.sendRequest("unsubscribe",{subId:e})}get activeSubscriptions(){return Object.keys(this.subListeners)}close(){this.ws&&this.ws?.close()}onClose(e){this.onCloseCallbacks.push(e)}}const pi={UNPAID:"UNPAID",PAID:"PAID"},Ln={UNPAID:"UNPAID",PENDING:"PENDING",PAID:"PAID"},gi={UNSPENT:"UNSPENT",PENDING:"PENDING",SPENT:"SPENT"};function yi(i,e){return i.state||(e.warn("Field 'state' not found in Melt quote response. Update NUT-05 of mint: https://github.com/cashubtc/nuts/pull/136)"),typeof i.paid=="boolean"&&(i.state=i.paid?Ln.PAID:Ln.UNPAID)),i}function Es(i,e){return i.state||(e.warn("Field 'state' not found in Mint quote response. Update NUT-04 of mint: https://github.com/cashubtc/nuts/pull/141)"),typeof i.paid=="boolean"&&(i.state=i.paid?pi.PAID:pi.UNPAID)),i}function Zc(i,e){return Array.isArray(i?.contact)&&i?.contact.length>0&&(i.contact=i.contact.map(t=>Array.isArray(t)&&t.length===2&&typeof t[0]=="string"&&typeof t[1]=="string"?(e.warn("Mint returned deprecated 'contact' field: Update NUT-06: https://github.com/cashubtc/nuts/pull/117"),{method:t[0],info:t[1]}):t)),i}class mi{constructor(e){this.REGEX_METACHAR=/[\\^$.*+?()[\]{}|]/,this._mintInfo=e;const t=this.toEndpoints(e?.nuts?.[22]?.protected_endpoints);this._protected22=this.buildIndex(t);const r=this.toEndpoints(e?.nuts?.[21]?.protected_endpoints);this._protected21=this.buildIndex(r)}isSupported(e){switch(e){case 4:case 5:return this.checkMintMelt(e);case 7:case 8:case 9:case 10:case 11:case 12:case 14:case 20:return this.checkGenericNut(e);case 17:return this.checkNut17();case 15:return this.checkNut15();default:throw new Error("nut is not supported by cashu-ts")}}requiresBlindAuthToken(e,t){return this.matchesProtected(this._protected22,e,t)}requiresClearAuthToken(e,t){return this.matchesProtected(this._protected21,e,t)}matchesProtected(e,t,r){if(!e)return!1;const s=`${t} ${r}`,f=e.cache[s];if(typeof f=="boolean")return f;const d=e.exact.some(w=>w.method===t&&w.path===r),p=d?!1:e.regex.some(w=>w.method===t&&w.regex.test(r)),y=d||p;return e.cache[s]=y,y}checkGenericNut(e){return this._mintInfo.nuts[e]?.supported?{supported:!0}:{supported:!1}}checkMintMelt(e){const t=this._mintInfo.nuts[e];return t&&t.methods.length>0&&!t.disabled?{disabled:!1,params:t.methods}:{disabled:!0,params:t?.methods??[]}}checkNut17(){return this._mintInfo.nuts[17]&&this._mintInfo.nuts[17].supported.length>0?{supported:!0,params:this._mintInfo.nuts[17].supported}:{supported:!1}}checkNut15(){return this._mintInfo.nuts[15]&&this._mintInfo.nuts[15].methods.length>0?{supported:!0,params:this._mintInfo.nuts[15].methods}:{supported:!1}}toEndpoints(e){if(!Array.isArray(e))return[];const t=[];for(const r of e)if(r&&typeof r=="object"){const s=r,f=s.method,d=s.path;if(typeof f=="string"&&typeof d=="string"){const p=f.toUpperCase();(p==="GET"||p==="POST")&&t.push({method:p,path:d})}}return t}buildIndex(e){if(!e||e.length===0)return;const t=[],r=[],s=this.REGEX_METACHAR;for(const f of e){if(f.path.startsWith("^")||f.path.endsWith("$")||s.test(f.path))try{r.push({method:f.method,regex:new RegExp(f.path)});continue}catch{}t.push({method:f.method,path:f.path})}return{cache:{},exact:t,regex:r}}get cache(){return this._mintInfo}get contact(){return this._mintInfo.contact}get description(){return this._mintInfo.description}get description_long(){return this._mintInfo.description_long}get name(){return this._mintInfo.name}get pubkey(){return this._mintInfo.pubkey}get nuts(){return this._mintInfo.nuts}get version(){return this._mintInfo.version}get motd(){return this._mintInfo.motd}get supportsBolt12Description(){return this.supportsNut04Description("bolt12")}supportsNut04Description(e,t){return this._mintInfo.nuts[4]?.methods.some(r=>r.method===e&&(t?r.unit===t:!0)&&(r.options?.description===!0||r.description===!0))}supportsAmountless(e="bolt11",t="sat"){const r=this._mintInfo?.nuts?.[5]?.methods??[];return Array.isArray(r)?r.some(s=>s.method===e&&s.unit===t&&s.options?.amountless===!0):!1}}class wi{constructor(e,t){this.tokenListeners=[],this.discoveryUrl=e,this.logger=t?.logger??lt,this.clientId=t?.clientId??"cashu-client",this.scope=t?.scope??"openid",this.onTokens=t?.onTokens}static fromMintInfo(e,t){const r=e?.nuts?.["21"];if(!r?.openid_discovery)throw new Error("OIDCAuth: mint does not advertise NUT-21 openid_discovery");const s=t?.clientId??r.client_id??"cashu-client";return new wi(r.openid_discovery,{...t,clientId:s})}setClient(e){this.clientId=e}setScope(e){this.scope=e??"openid"}addTokenListener(e){this.tokenListeners.push(e)}async loadConfig(){if(this.config)return this.config;const e=await fetch(this.discoveryUrl,{method:"GET",headers:{Accept:"application/json"}}),t=await e.text();let r;try{r=t?JSON.parse(t):void 0}catch(f){this.logger.warn("OIDCAuth: bad discovery JSON",{err:f})}if(!e.ok||!r)throw new Error("OIDCAuth: invalid discovery document");const s=r;if(typeof s.token_endpoint!="string"||s.token_endpoint.length===0)throw new Error("OIDCAuth: invalid discovery document, missing token_endpoint");return this.config=s,s}generatePKCE(){const e=Kt(48),t=ii(e),r=Ne.fromString(t),s=Fe(r),f=ii(s);return{verifier:t,challenge:f}}async buildAuthCodeUrl(e){const t=await this.loadConfig(),r=e.scope??this.scope,s=new URLSearchParams({response_type:"code",client_id:this.clientId,redirect_uri:e.redirectUri,scope:r,code_challenge_method:e.codeChallengeMethod??"S256",code_challenge:e.codeChallenge});if(e.state&&s.set("state",e.state),!t.authorization_endpoint)throw new Error("OIDCAuth: discovery lacks authorization_endpoint");return`${t.authorization_endpoint}?${s.toString()}`}async exchangeAuthCode(e){const t=await this.loadConfig(),r=this.toForm({grant_type:"authorization_code",code:e.code,redirect_uri:e.redirectUri,client_id:this.clientId,code_verifier:e.codeVerifier}),s=await this.postFormStrict(t.token_endpoint,r);return this.handleTokens(s),s}async deviceStart(){const e=(await this.loadConfig()).device_authorization_endpoint;if(!e)throw new Error("OIDCAuth: provider lacks device_authorization_endpoint");const t=this.toForm({client_id:this.clientId,scope:this.scope});return this.postFormStrict(e,t)}async devicePoll(e,t=5){const r=await this.loadConfig();let s=Math.max(1,t);for(;;){await this.sleep(s*1e3);const f=this.toForm({grant_type:"urn:ietf:params:oauth:grant-type:device_code",device_code:e,client_id:this.clientId}),d=await this.postFormLoose(r.token_endpoint,f);if(d.access_token)return this.handleTokens(d),d;const p=(d.error??"").toString();if(p==="authorization_pending")continue;if(p==="slow_down"){s=Math.max(s+5,s*2);continue}const y=d.error_description||p||"device authorization failed";throw new Error(`OIDCAuth: ${y}`)}}async startDeviceAuth(e=5){const t=await this.deviceStart(),r=Math.max(t.interval??1,e);let s=!1;return{...t,poll:async()=>{const f=await this.loadConfig();let d=Math.max(1,r);for(;;){if(s)throw new Error("OIDCAuth: device polling cancelled");await this.sleep(d*1e3);const p=this.toForm({grant_type:"urn:ietf:params:oauth:grant-type:device_code",device_code:t.device_code,client_id:this.clientId}),y=await this.postFormLoose(f.token_endpoint,p);if(y.access_token)return this.handleTokens(y),y;const w=(y.error??"").toString();if(w==="authorization_pending")continue;if(w==="slow_down"){d=Math.max(d+5,d*2);continue}const x=y.error_description||w||"device authorization failed";throw new Error(`OIDCAuth: ${x}`)}},cancel:()=>{s=!0}}}async refresh(e){const t=await this.loadConfig(),r=this.toForm({grant_type:"refresh_token",refresh_token:e,client_id:this.clientId}),s=await this.postFormStrict(t.token_endpoint,r);return this.handleTokens(s),s}async passwordGrant(e,t){const r=await this.loadConfig(),s=this.toForm({grant_type:"password",client_id:this.clientId,username:e,password:t,scope:this.scope}),f=await this.postFormStrict(r.token_endpoint,s);return this.handleTokens(f),f}handleTokens(e){if(!e.access_token){const t=e.error_description||e.error||"token response missing access_token";throw new Error(`OIDCAuth: ${t}`)}queueMicrotask(()=>Nn(this.onTokens,e,this.logger,{where:"OIDCAuth.handleTokens"}));for(const t of this.tokenListeners)queueMicrotask(()=>Nn(t,e,this.logger,{where:"OIDCAuth.handleTokens.listener"}))}toForm(e){const t=r=>encodeURIComponent(r).replace(/%20/g,"+");return Object.entries(e).map(([r,s])=>`${t(r)}=${t(s)}`).join("&")}async postFormStrict(e,t){try{this.logger.debug("OIDCAuth Request",{formBody:t});const r=await fetch(e,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},body:t}),s=await r.text();let f;try{f=s?JSON.parse(s):void 0}catch(d){this.logger.warn("OIDCAuth: bad JSON (strict)",{err:d})}if(!r.ok){const d=f??{},p=d.error_description||d.error||`HTTP ${r.status}`;throw new Error(`OIDCAuth: ${p}`)}return this.logger.debug("OIDCAuth Response",{json:f}),f??{}}catch(r){throw this.logger.error("OIDCAuth: postFormStrict failed",{err:r}),r}}async postFormLoose(e,t){try{this.logger.debug("OIDCAuth Request",{formBody:t});const r=await(await fetch(e,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},body:t})).text();let s;try{s=r?JSON.parse(r):void 0}catch(f){this.logger.warn("OIDCAuth: bad JSON (loose)",{err:f})}return this.logger.debug("OIDCAuth Response",{json:s}),s??{}}catch(r){return this.logger.error("OIDCAuth: postFormLoose network error",{err:r}),{error:"network_error",error_description:String(r)}}}sleep(e){return new Promise(t=>setTimeout(t,e))}}class Cs{constructor(e,t){this._mintUrl=vs(e),this._request=t?.customRequest??Ou,this._authProvider=t?.authProvider,this._logger=t?.logger??lt,Bu(this._logger)}get mintUrl(){return this._mintUrl}async oidcAuth(e){const t=(await this.getLazyMintInfo()).nuts[21];if(!t?.openid_discovery)throw new Error("Mint: no NUT-21 openid_discovery");return new wi(t.openid_discovery,{...e,clientId:e?.clientId??t.client_id??"cashu-client"})}async getInfo(e){const t=await(e??this._request)({endpoint:mn(this._mintUrl,"/v1/info")});return Zc(t,this._logger)}async getLazyMintInfo(){if(this._mintInfo)return this._mintInfo;const e=await this.getInfo();return this._mintInfo=new mi(e),this._mintInfo}async swap(e,t){const r=await this.requestWithAuth("POST","/v1/swap",{requestBody:e},t);if(!bt(r)||!Array.isArray(r?.signatures))throw this._logger.error("Invalid response from mint...",{data:r,op:"swap"}),new Error("Invalid response from mint");return r}async createMintQuoteBolt11(e,t){const r=await this.requestWithAuth("POST","/v1/mint/quote/bolt11",{requestBody:e},t);return Es(r,this._logger)}async createMintQuoteBolt12(e,t){return await this.requestWithAuth("POST","/v1/mint/quote/bolt12",{requestBody:e},t)}async checkMintQuoteBolt11(e,t){const r=await this.requestWithAuth("GET",`/v1/mint/quote/bolt11/${e}`,{},t);return Es(r,this._logger)}async checkMintQuoteBolt12(e,t){return await this.requestWithAuth("GET",`/v1/mint/quote/bolt12/${e}`,{},t)}async mintBolt11(e,t){const r=await this.requestWithAuth("POST","/v1/mint/bolt11",{requestBody:e},t);if(!bt(r)||!Array.isArray(r?.signatures))throw this._logger.error("Invalid response from mint...",{data:r,op:"mintBolt11"}),new Error("Invalid response from mint");return r}async mintBolt12(e,t){const r=await this.requestWithAuth("POST","/v1/mint/bolt12",{requestBody:e},t);if(!bt(r)||!Array.isArray(r?.signatures))throw this._logger.error("Invalid response from mint...",{data:r,op:"mintBolt12"}),new Error("Invalid response from mint");return r}async createMeltQuoteBolt11(e,t){const r=await this.requestWithAuth("POST","/v1/melt/quote/bolt11",{requestBody:e},t),s=yi(r,this._logger);if(!bt(s)||typeof s?.amount!="number"||typeof s?.fee_reserve!="number"||typeof s?.quote!="string")throw this._logger.error("Invalid response from mint...",{data:s,op:"createMeltQuoteBolt11"}),new Error("Invalid response from mint");return s}async createMeltQuoteBolt12(e,t){return await this.requestWithAuth("POST","/v1/melt/quote/bolt12",{requestBody:e},t)}async checkMeltQuoteBolt11(e,t){const r=await this.requestWithAuth("GET",`/v1/melt/quote/bolt11/${e}`,{},t),s=yi(r,this._logger);if(!bt(s)||typeof s?.amount!="number"||typeof s?.fee_reserve!="number"||typeof s?.quote!="string"||typeof s?.state!="string"||!Object.values(Ln).includes(s.state))throw this._logger.error("Invalid response from mint...",{data:s,op:"checkMeltQuoteBolt11"}),new Error("Invalid response from mint");return s}async checkMeltQuoteBolt12(e,t){return await this.requestWithAuth("GET",`/v1/melt/quote/bolt12/${e}`,{},t)}async melt(e,t,r){const s={...r?.preferAsync?{Prefer:"respond-async"}:{}};ni(!this.isValidMethodString(e),`Invalid melt method: ${e}`,this._logger);const f=await this.requestWithAuth("POST",`/v1/melt/${e}`,{requestBody:t,headers:s},r?.customRequest);if(!bt(f))throw this._logger.error("Invalid response from mint...",{data:f,op:"melt"}),new Error("Invalid response from mint");return f}async meltBolt11(e,t){const r=await this.melt("bolt11",e,t),s=yi(r,this._logger);if(!bt(s)||typeof s?.state!="string"||!Object.values(Ln).includes(s.state))throw this._logger.error("Invalid response from mint...",{data:s,op:"meltBolt11"}),new Error("Invalid response from mint");return s}async meltBolt12(e,t){return this.melt("bolt12",e,t)}async check(e,t){const r=await this.requestWithAuth("POST","/v1/checkstate",{requestBody:e},t);if(!bt(r)||!Array.isArray(r?.states))throw this._logger.error("Invalid response from mint...",{data:r,op:"check"}),new Error("Invalid response from mint");return r}async getKeys(e,t,r){const s=t||this._mintUrl;e&&(e=e.replace(/\//g,"_").replace(/\+/g,"-"));const f=await(r??this._request)({endpoint:e?mn(s,"/v1/keys",e):mn(s,"/v1/keys")});if(!bt(f)||!Array.isArray(f.keysets))throw this._logger.error("Invalid response from mint...",{data:f,op:"getKeys"}),new Error("Invalid response from mint");return f}async getKeySets(e){return(e??this._request)({endpoint:mn(this._mintUrl,"/v1/keysets")})}async restore(e,t){const r=await(t??this._request)({endpoint:mn(this._mintUrl,"/v1/restore"),method:"POST",requestBody:e});if(!bt(r)||!Array.isArray(r?.outputs)||!Array.isArray(r?.signatures))throw this._logger.error("Invalid response from mint...",{data:r,op:"restore"}),new Error("Invalid response from mint");return r}async connectWebSocket(){if(this.ws)await this.ws.ensureConnection();else{const e=new URL(this._mintUrl),t="v1/ws";e.pathname&&(e.pathname.endsWith("/")?e.pathname+=t:e.pathname+="/"+t),this.ws=wn.getInstance().getConnection(`${e.protocol==="https:"?"wss":"ws"}://${e.host}${e.pathname}`);try{await this.ws.connect()}catch(r){throw this._logger.error("Failed to connect to WebSocket...",{e:r}),new Error("Failed to connect to WebSocket...")}}}disconnectWebSocket(){this.ws&&this.ws.close()}get webSocketConnection(){return this.ws}async handleClearAuth(e,t){if(!(!this._authProvider||!(await this.getLazyMintInfo()).requiresClearAuthToken(e,t)))return this._logger.error("Clear Authentication Token...",{cat:this._authProvider.getCAT()}),this._authProvider.getCAT()}async handleBlindAuth(e,t){if(!this._authProvider||!(await this.getLazyMintInfo()).requiresBlindAuthToken(e,t))return;const r=await this._authProvider.getBlindAuthToken({method:e,path:t});return this._logger.error("Blind Authentication Token...",{bat:r}),r}async requestWithAuth(e,t,r={},s){const f=s??this._request,d=await this.handleBlindAuth(e,t),p=await this.handleClearAuth(e,t),y={...r.headers??{},...d?{"Blind-auth":d}:{},...p?{"Clear-auth":p}:{}};return f({...r,endpoint:mn(this._mintUrl,t),method:e,headers:y})}isValidMethodString(e){return!!(typeof e=="string"&&/^[a-z0-9_-]+$/.test(e))}}class Hn{constructor(e,t,r,s,f){this._keys={},this._id=e,this._unit=t,this._active=r,this._input_fee_ppk=s,this._final_expiry=f}get id(){return this._id}get unit(){return this._unit}get isActive(){return this._active}get fee(){return this._input_fee_ppk??0}get expiry(){return this._final_expiry}get hasKeys(){return Object.keys(this._keys).length>0}get hasHexId(){return yn(this._id)}get keys(){return this._keys}set keys(e){this._keys=e}get active(){return this.isActive}get input_fee_ppk(){return this.fee}get final_expiry(){return this.expiry}toMintKeyset(){return{id:this._id,unit:this._unit,active:this._active,input_fee_ppk:this._input_fee_ppk,final_expiry:this._final_expiry}}toMintKeys(){return this.hasKeys?{id:this._id,unit:this._unit,keys:this._keys}:null}verify(){return this.hasKeys?Hn.verifyKeysetId({id:this._id,unit:this._unit,final_expiry:this._final_expiry,keys:this._keys}):!1}static verifyKeysetId(e){if(!e.keys||Object.keys(e.keys).length===0)return!1;const t=oi(e.id)&&!yn(e.id),r=yn(e.id)?qe(e.id)[0]:0;return Kc(e.keys,e.unit,e.final_expiry,r,t)===e.id}static fromMintApi(e,t){const r=new Hn(e.id,e.unit,e.active,e.input_fee_ppk,e.final_expiry);if(t){if(t.id!==e.id)throw new Error(`Mismatched keyset ids: meta=${e.id}, keys=${t.id}`);if(t.unit!==e.unit)throw new Error(`Mismatched keyset units: meta=${e.unit}, keys=${t.unit}`);if(t.final_expiry!==void 0&&e.final_expiry!==void 0&&t.final_expiry!==e.final_expiry)throw new Error(`Mismatched keyset expiry for id=${e.id}`);r.keys=t.keys}return r}}class Zt{constructor(e,t,r,s){if(this.keysets={},this.mint=typeof e=="string"?new Cs(e):e,this.unit=t,r&&s){const f=Array.isArray(s)?s:[s];this.buildKeychain(r,f),this.getCheapestKeyset()}}static fromCache(e,t){const r=new Zt(e,t.unit);return r.loadFromCache(t),r}static mintToCacheDTO(e,t,r,s){const f=new Map(s.map(d=>[d.id,d]));return{keysets:r.map(d=>{const p=f.get(d.id),y={...d};return p&&(y.keys=p.keys),y}),unit:e,mintUrl:t}}static cacheToMintDTO(e){const t=e.keysets.map(s=>({id:s.id,unit:s.unit,active:s.active,input_fee_ppk:s.input_fee_ppk,final_expiry:s.final_expiry})),r=e.keysets.filter(s=>!!s.keys).map(s=>({id:s.id,unit:s.unit,keys:s.keys,final_expiry:s.final_expiry}));return{keysets:t,keys:r}}async init(e){if(Object.keys(this.keysets).length>0&&!e)return;const[t,r]=await Promise.all([this.mint.getKeySets(),this.mint.getKeys()]);this.buildKeychain(t.keysets,r.keysets),this.getCheapestKeyset()}loadFromCache(e){if(e.unit!==this.unit)throw new Error(`KeyChain unit mismatch in cache, expected '${this.unit}', got '${e.unit}' from ${e.mintUrl}`);const{keysets:t,keys:r}=Zt.cacheToMintDTO(e);this.buildKeychain(t,r),this.getCheapestKeyset()}buildKeychain(e,t){this.keysets={};const r=e.filter(f=>f.unit===this.unit);if(!r.length)throw new Error(`No Keysets found for unit: ${this.unit}`);const s=new Map(t.filter(f=>f.unit===this.unit).map(f=>[f.id,f]));for(const f of r){let d;if(f.active&&yn(f.id)){const p=s.get(f.id);d=Hn.fromMintApi(f,p)}else d=Hn.fromMintApi(f);if(d.hasKeys&&!d.verify())throw new Error(`Keyset verification failed for ID ${d.id}`);this.keysets[d.id]=d}}getKeyset(e){const t=e?this.keysets[e]:this.getCheapestKeyset();if(!t)throw new Error(`Keyset '${e}' not found`);return t}getCheapestKeyset(){if(Object.keys(this.keysets).length===0)throw new Error("KeyChain not initialized");const e=Object.values(this.keysets).filter(t=>t.isActive&&t.hasHexId&&t.hasKeys);if(e.length===0)throw new Error("No active keyset found");return e.sort((t,r)=>t.fee-r.fee)[0]}getKeysets(){if(Object.keys(this.keysets).length===0)throw new Error("KeyChain not initialized");return Object.values(this.keysets)}getAllKeys(){return this.getKeysets().map(e=>e.toMintKeys()).filter(e=>e!==null)}getAllKeysetIds(){return this.getKeysets().map(e=>e.id)}get cache(){const e=this.getKeysets(),t=e.map(s=>s.toMintKeyset()),r=e.map(s=>s.toMintKeys()).filter(s=>s!==null);return Zt.mintToCacheDTO(this.unit,this.mint.mintUrl,t,r)}getCache(){const e=this.cache,{keysets:t,keys:r}=Zt.cacheToMintDTO(e);return{keysets:t,keys:r,unit:e.unit,mintUrl:e.mintUrl}}}class bi{constructor(e,t,r){this.amount=e,this.B_=t,this.id=r}getSerializedBlindedMessage(){return{amount:this.amount,B_:this.B_.toHex(!0),id:this.id}}}const Xc=new Set(["locktime","pubkeys","n_sigs","refund","n_sigs_refund"]);function Yc(i){if(!i||typeof i!="string")throw new Error("tag key must be a non empty string");if(Xc.has(i))throw new Error(`additionalTags must not use reserved key "${i}"`)}const Ts=1024,vi=new WeakMap;function Jc(i,e){e&&vi.set(i,e)}function ef(i){const e=vi.get(i);if(e)return vi.delete(i),e}class ht{constructor(e,t,r){this.secret=r,this.blindingFactor=t,this.blindedMessage=e}toProof(e,t){let r;e.dleq&&(r={s:qe(e.dleq.s),e:qe(e.dleq.e),r:this.blindingFactor});const s={id:e.id,amount:e.amount,C_:gn(e.C_)},f=gn(t.keys[e.amount]),d=sc(s,this.blindingFactor,this.secret,f),p={...ac(d),...r&&{dleq:{s:De(r.s),e:De(r.e),r:li(r.r??BigInt(0))}}},y=ef(this);return y&&(p.p2pk_e=y),p}static createP2PKData(e,t,r,s){return Ht(t,r.keys,s).map(f=>this.createSingleP2PKData(e,f,r.id))}static createSingleP2PKData(e,t,r){const s=Array.isArray(e.pubkey)?e.pubkey:[e.pubkey],f=e.refundKeys??[],d=Math.max(1,Math.min(e.requiredSignatures??1,s.length)),p=Math.max(1,Math.min(e.requiredRefundSignatures??1,f.length||1));if(s.length===0)throw new Error("P2PK requires at least one pubkey");const y=typeof e.hashlock=="string"&&e.hashlock.length>0;let w=y?e.hashlock:s[0],x=y?s:s.slice(1),A=f,E;if(e.blindKeys){const Be=[...s,...f],{blinded:u,Ehex:J}=gc(Be,r);y?x=u.slice(0,s.length):(w=u[0],x=u.slice(1,s.length)),A=u.slice(s.length),E=J}const T=[],M=e.locktime??NaN;if(Number.isSafeInteger(M)&&M>=0&&T.push(["locktime",String(M)]),x.length>0&&(T.push(["pubkeys",...x]),d>1&&T.push(["n_sigs",String(d)])),A.length>0&&(T.push(["refund",...A]),p>1&&T.push(["n_sigs_refund",String(p)])),e.sigFlag=="SIG_ALL"&&T.push(["sigflag","SIG_ALL"]),e.additionalTags?.length){const Be=e.additionalTags.map(([u,...J])=>(Yc(u),[u,...J.map(String)]));T.push(...Be)}const N=[y?"HTLC":"P2PK",{nonce:De(Kt(32)),data:w,tags:T}],W=JSON.stringify(N),$=[...W].length;if($>Ts)throw new Error(`Secret too long (${$} characters), maximum is ${Ts}`);const we=new TextEncoder().encode(W),{r:ee,B_:pe}=ai(we),ve=new ht(new bi(t,pe,r).getSerializedBlindedMessage(),ee,we);return e.blindKeys&&E&&Jc(ve,E),ve}static createRandomData(e,t,r){return Ht(e,t.keys,r).map(s=>this.createSingleRandomData(s,t.id))}static createSingleRandomData(e,t){const r=De(Kt(32)),s=new TextEncoder().encode(r),{r:f,B_:d}=ai(s);return new ht(new bi(e,d,t).getSerializedBlindedMessage(),f,s)}static createDeterministicData(e,t,r,s,f){return Ht(e,s.keys,f).map((d,p)=>this.createSingleDeterministicData(d,t,r+p,s.id))}static createSingleDeterministicData(e,t,r,s){const f=Pc(t,s,r),d=De(f),p=new TextEncoder().encode(d),y=gr(Oc(t,s,r)),{r:w,B_:x}=ai(p,y);return new ht(new bi(e,x,s).getSerializedBlindedMessage(),w,p)}static sumOutputAmounts(e){return e.reduce((t,r)=>t+r.blindedMessage.amount,0)}}const tf=(i,e,t,r=!1,s=!1,f=lt)=>{const d=Iu();let p=null,y=1/0,w=0,x=0;const A=u=>{try{return t.getKeyset(u.id).fee}catch(J){hr(`Could not get fee. No keyset found for keyset id: ${u.id}`,f,{error:J,keychain:t.getKeysets()})}},E=(u,J)=>u-(r?Math.ceil(J/1e3):0),T=u=>{const J=[...u];for(let P=J.length-1;P>0;P--){const U=Math.floor(Math.random()*(P+1));[J[P],J[U]]=[J[U],J[P]]}return J},M=(u,J,P)=>{let U=0,he=u.length-1,se=null;for(;U<=he;){const B=Math.floor((U+he)/2),K=u[B].exFee;(P?K<=J:K>=J)?(se=B,P?U=B+1:he=B-1):P?he=B-1:U=B+1}return P?se:U<u.length?U:null},N=(u,J)=>{const P=J.exFee;let U=0,he=u.length;for(;U<he;){const se=Math.floor((U+he)/2);u[se].exFee<P?U=se+1:he=se}u.splice(U,0,J)},W=(u,J)=>E(u,J)<e?1/0:u+J/1e3-e;let $=0,we=0;const ee=i.map(u=>{const J=A(u),P=r?u.amount-J/1e3:u.amount,U={proof:u,exFee:P,ppkfee:J};return(!r||P>0)&&($+=u.amount,we+=J),U});let pe=r?ee.filter(u=>u.exFee>0):ee;if(pe.sort((u,J)=>u.exFee-J.exFee),pe.length>0){let u;if(s){const J=M(pe,e,!0);u=J!==null?J+1:0}else{const J=M(pe,e,!1);if(J!==null){const P=pe[J].exFee,U=M(pe,P,!0);ts(U,"Unexpected null rightIndex in binary search",f),u=U+1}else u=pe.length}for(let J=u;J<pe.length;J++)$-=pe[J].proof.amount,we-=pe[J].ppkfee;pe=pe.slice(0,u)}const ve=E($,we);if(e<=0||e>ve)return{keep:i,send:[]};const Be=Math.min(Math.ceil(e*(1+0/100)),e+0,ve);for(let u=0;u<60;u++){const J=[];let P=0,U=0;for(const I of T(pe)){const L=P+I.proof.amount,R=U+I.ppkfee,V=E(L,R);if(s&&V>e||(J.push(I),P=L,U=R,V>=e))break}const he=new Set(J),se=pe.filter(I=>!he.has(I)),B=T(Array.from({length:J.length},(I,L)=>L)).slice(0,5e3);for(const I of B){const L=E(P,U);if(L===e||!s&&L>=e&&L<=Be)break;const R=J[I],V=P-R.proof.amount,G=U-R.ppkfee,C=E(V,G),v=e-C,z=M(se,v,s);if(z!==null){const Z=se[z];(!s||Z.exFee>R.exFee)&&(v>=0||Z.exFee<=R.exFee)&&(J[I]=Z,P=V+Z.proof.amount,U=G+Z.ppkfee,se.splice(z,1),N(se,R))}}const K=W(P,U);if(K<y){f.debug(`selectProofsToSend: best solution found in trial #${u} - amount: ${P}, delta: ${K}`),p=[...J].sort((L,R)=>R.exFee-L.exFee),y=K,w=P,x=U;const I=[...p];for(;I.length>1&&y>0;){const L=I.pop(),R=P-L.proof.amount,V=U-L.ppkfee,G=W(R,V);if(G==1/0)break;G<y&&(p=[...I],y=G,w=R,x=V,P=R,U=V)}}if(p&&y<1/0){const I=E(w,x);if(I===e||!s&&I>=e&&I<=Be)break}if(d.elapsed()>1e3){ni(s,"Proof selection took too long. Try again with a smaller proof set.",f),f.warn("Proof selection took too long. Returning best selection so far.");break}}if(p&&y<1/0){const u=p.map(U=>U.proof),J=new Set(u),P=i.filter(U=>!J.has(U));return f.info(`Proof selection took ${d.elapsed()}ms`),{keep:P,send:u}}return{keep:i,send:[]}};class nf{constructor(e){if(this.next=new Map,this.locks=new Map,e)for(const[t,r]of Object.entries(e))this.next.set(t,r)}async withLock(e,t){const r=this.locks.get(e)??Promise.resolve();let s;const f=new Promise(p=>s=p),d=r.then(()=>f);this.locks.set(e,d);try{return await r,await t()}finally{s(),this.locks.get(e)===d&&this.locks.delete(e)}}async reserve(e,t){if(t<0)throw new Error("reserve called with negative count");return this.withLock(e,()=>{const r=this.next.get(e)??0;return t===0?{start:r,count:0}:(this.next.set(e,r+t),{start:r,count:t})})}async advanceToAtLeast(e,t){await this.withLock(e,()=>{const r=this.next.get(e)??0;t>r&&this.next.set(e,t)})}async setNext(e,t){await this.withLock(e,()=>{if(t<0)throw new Error("setNext: negative next not allowed");this.next.set(e,t)})}snapshot(){return Promise.resolve(Object.fromEntries(this.next.entries()))}}class rf{constructor(e){this.wallet=e}send(e,t){return new of(this.wallet,e,t)}receive(e){return new sf(this.wallet,e)}mintBolt11(e,t){return new Ss(this.wallet,"bolt11",e,t)}mintBolt12(e,t){return new Ss(this.wallet,"bolt12",e,t)}meltBolt11(e,t){return new As(this.wallet,"bolt11",e,t)}meltBolt12(e,t){return new As(this.wallet,"bolt12",e,t)}}class of{constructor(e,t,r){this.wallet=e,this.amount=t,this.proofs=r,this.config={}}asRandom(e){return this.sendOT={type:"random",denominations:e},this}asDeterministic(e=0,t){return this.sendOT={type:"deterministic",counter:e,denominations:t},this}asP2PK(e,t){return this.sendOT={type:"p2pk",options:e,denominations:t},this}asFactory(e,t){return this.sendOT={type:"factory",factory:e,denominations:t},this}asCustom(e){return this.sendOT={type:"custom",data:e},this}keepAsRandom(e){return this.keepOT={type:"random",denominations:e},this}keepAsDeterministic(e=0,t){return this.keepOT={type:"deterministic",counter:e,denominations:t},this}keepAsP2PK(e,t){return this.keepOT={type:"p2pk",options:e,denominations:t},this}keepAsFactory(e,t){return this.keepOT={type:"factory",factory:e,denominations:t},this}keepAsCustom(e){return this.keepOT={type:"custom",data:e},this}includeFees(e=!0){return this.config.includeFees=e,this}keyset(e){return this.config.keysetId=e,this}privkey(e){return this.config.privkey=e,this}proofsWeHave(e){return this.config.proofsWeHave=e,this}onCountersReserved(e){return this.config.onCountersReserved=e,this}offlineExactOnly(e=!1){return this.offlineExact={requireDleq:e},this}offlineCloseMatch(e=!1){return this.offlineClose={requireDleq:e},this}async prepare(){const e={send:this.sendOT??this.wallet.defaultOutputType(),...this.keepOT?{keep:this.keepOT}:{}};return this.wallet.prepareSwapToSend(this.amount,this.proofs,this.config,e)}async run(){if((this.offlineExact||this.offlineClose)&&(this.sendOT||this.keepOT))throw new Error("Offline selection cannot be combined with custom output types. Remove send/keep output configuration, or use an online swap.");if(this.offlineExact)return this.config.privkey&&(this.proofs=this.wallet.signP2PKProofs(this.proofs,this.config.privkey)),this.wallet.sendOffline(this.amount,this.proofs,{includeFees:this.config.includeFees,exactMatch:!0,requireDleq:this.offlineExact.requireDleq});if(this.offlineClose)return this.config.privkey&&(this.proofs=this.wallet.signP2PKProofs(this.proofs,this.config.privkey)),this.wallet.sendOffline(this.amount,this.proofs,{includeFees:this.config.includeFees,exactMatch:!1,requireDleq:this.offlineClose.requireDleq});const e={send:this.sendOT??this.wallet.defaultOutputType(),...this.keepOT?{keep:this.keepOT}:{}};return this.wallet.send(this.amount,this.proofs,this.config,e)}}class sf{constructor(e,t){this.wallet=e,this.token=t,this.config={}}asRandom(e){return this.outputType={type:"random",denominations:e},this}asDeterministic(e=0,t){return this.outputType={type:"deterministic",counter:e,denominations:t},this}asP2PK(e,t){return this.outputType={type:"p2pk",options:e,denominations:t},this}asFactory(e,t){return this.outputType={type:"factory",factory:e,denominations:t},this}asCustom(e){return this.outputType={type:"custom",data:e},this}keyset(e){return this.config.keysetId=e,this}requireDleq(e=!0){return this.config.requireDleq=e,this}privkey(e){return this.config.privkey=e,this}proofsWeHave(e){return this.config.proofsWeHave=e,this}onCountersReserved(e){return this.config.onCountersReserved=e,this}async prepare(){return this.wallet.prepareSwapToReceive(this.token,this.config,this.outputType)}async run(){return this.wallet.receive(this.token,this.config,this.outputType)}}class Ss{constructor(e,t,r,s){this.wallet=e,this.method=t,this.amount=r,this.quote=s,this.config={},this._hasPrivkey}asRandom(e){return this.outputType={type:"random",denominations:e},this}asDeterministic(e=0,t){return this.outputType={type:"deterministic",counter:e,denominations:t},this}asP2PK(e,t){return this.outputType={type:"p2pk",options:e,denominations:t},this}asFactory(e,t){return this.outputType={type:"factory",factory:e,denominations:t},this}asCustom(e){return this.outputType={type:"custom",data:e},this}keyset(e){return this.config.keysetId=e,this}privkey(e){return this.config.privkey=e,this}proofsWeHave(e){return this.config.proofsWeHave=e,this}onCountersReserved(e){return this.config.onCountersReserved=e,this}async run(){if(this.method==="bolt11"){const t=this.quote;if(typeof t!="string"&&t.pubkey&&!this.config.privkey)throw new Error("privkey is required for locked BOLT11 mint quotes");return this.wallet.mintProofsBolt11(this.amount,t,this.config,this.outputType)}const e=this.quote;if(!this.config.privkey)throw new Error("privkey is required for BOLT12 mint quotes");return this.wallet.mintProofsBolt12(this.amount,e,this.config.privkey,this.config,this.outputType)}}class As{constructor(e,t,r,s){this.wallet=e,this.method=t,this.quote=r,this.proofs=s,this.config={}}asRandom(e){return this.outputType={type:"random",denominations:e},this}asDeterministic(e=0,t){return this.outputType={type:"deterministic",counter:e,denominations:t},this}asP2PK(e,t){return this.outputType={type:"p2pk",options:e,denominations:t},this}asFactory(e,t){return this.outputType={type:"factory",factory:e,denominations:t},this}asCustom(e){return this.outputType={type:"custom",data:e},this}keyset(e){return this.config.keysetId=e,this}privkey(e){return this.config.privkey=e,this}onCountersReserved(e){return this.config.onCountersReserved=e,this}onChangeOutputsCreated(e){return this.config.onChangeOutputsCreated=e,this}async prepare(){return await this.wallet.prepareMelt(this.method,this.quote,this.proofs,this.config,this.outputType)}async run(){const e=await this.wallet.prepareMelt(this.method,this.quote,this.proofs,this.config,this.outputType);return this.wallet.completeMelt(e,this.config.privkey)}}function af(i){const e=new WeakSet;try{return JSON.stringify(i,(t,r)=>{if(typeof r=="object"&&r!==null){if(e.has(r))return"[Circular]";e.add(r)}return r})}catch{return Object.prototype.toString.call(i)}}function _s(i){if(i instanceof Error)return i;const e=typeof i=="string"?i:af(i),t=new Error(e);return t.cause=i,t}function Is(){const i=new Error("Aborted");return Object.defineProperty(i,"name",{value:"AbortError"}),i}function bn(i){i&&Promise.resolve(i).then(e=>{try{e()}catch{}}).catch(()=>{})}class uf{constructor(e){this.wallet=e,this.countersReservedHandlers=new Set,this.meltBlanksHandlers=new Set}withAbort(e,t){if(!e)return t;if(e.aborted)return t(),()=>{};const r=()=>t();return e.addEventListener("abort",r,{once:!0}),()=>{e.removeEventListener("abort",r),t()}}waitUntilPaid(e,t,r,s="Timeout waiting for paid"){return new Promise((f,d)=>{let p=null,y=null;const w=A=>{bn(p),y&&(clearTimeout(y),y=null),r?.signal&&r.signal.removeEventListener("abort",x),A&&d(_s(A))},x=()=>w(Is());if(r?.signal){if(r.signal.aborted)return x();r.signal.addEventListener("abort",x,{once:!0})}r?.timeoutMs&&r.timeoutMs>0&&(y=setTimeout(()=>w(new Error(s)),r.timeoutMs)),p=e(t,A=>{w(),f(A)},A=>w(A),{signal:r?.signal})})}countersReserved(e,t){this.countersReservedHandlers.add(e);const r=()=>this.countersReservedHandlers.delete(e);return this.withAbort(t?.signal,r)}_emitCountersReserved(e){for(const t of this.countersReservedHandlers)Nn(t,e,this.wallet.logger,{event:"countersReserved"})}meltBlanksCreated(e,t){this.meltBlanksHandlers.add(e);const r=()=>this.meltBlanksHandlers.delete(e);return this.withAbort(t?.signal,r)}_emitMeltBlanksCreated(e){for(const t of this.meltBlanksHandlers)Nn(t,e,this.wallet.logger,{event:"meltBlanksCreated"})}async mintQuoteUpdates(e,t,r,s){await this.wallet.mint.connectWebSocket();const f=this.wallet.mint.webSocketConnection;if(!f)throw new Error("Failed to establish WebSocket connection.");const d=Array.from(new Set(e)),p=f.createSubscription({kind:"bolt11_mint_quote",filters:d},t,r),y=()=>f.cancelSubscription(p,t);return this.withAbort(s?.signal,y)}async mintQuotePaid(e,t,r,s){return this.mintQuoteUpdates([e],f=>{f.state===pi.PAID&&t(f)},r,s)}async meltQuoteUpdates(e,t,r,s){await this.wallet.mint.connectWebSocket();const f=this.wallet.mint.webSocketConnection;if(!f)throw new Error("Failed to establish WebSocket connection.");const d=Array.from(new Set(e)),p=f.createSubscription({kind:"bolt11_melt_quote",filters:d},t,r),y=()=>f.cancelSubscription(p,t);return this.withAbort(s?.signal,y)}async meltQuotePaid(e,t,r,s){return this.meltQuoteUpdates([e],f=>{f.state===Ln.PAID&&t(f)},r,s)}async proofStateUpdates(e,t,r,s){await this.wallet.mint.connectWebSocket();const f=this.wallet.mint.webSocketConnection;if(!f)throw new Error("Failed to establish WebSocket connection.");const d=new TextEncoder,p={};for(const E of e){const T=pr(d.encode(E.secret)).toHex(!0);p[T]=E}const y=Object.keys(p),w=E=>{t({...E,proof:p[E.Y]})},x=f.createSubscription({kind:"proof_state",filters:y},w,r),A=()=>f.cancelSubscription(x,w);return this.withAbort(s?.signal,A)}onceMintPaid(e,t){return this.waitUntilPaid(this.mintQuotePaid.bind(this),e,t,"Timeout waiting for mint paid")}onceAnyMintPaid(e,t){return new Promise((r,s)=>{const f=Array.from(new Set(e)),d=new Map;let p=null,y=null,w=!1;const x=E=>{for(const T of d.values())bn(T);d.clear(),p&&(clearTimeout(p),p=null),t?.signal&&t.signal.removeEventListener("abort",A),E&&s(_s(E))},A=()=>x(Is());if(t?.signal){if(t.signal.aborted)return A();t.signal.addEventListener("abort",A,{once:!0})}if(t?.timeoutMs&&t.timeoutMs>0&&(p=setTimeout(()=>x(new Error("Timeout waiting for any mint paid")),t.timeoutMs)),f.length===0)return x(new Error("No quote ids provided"));for(const E of f){const T=this.mintQuotePaid(E,M=>{x(),r({id:E,quote:M})},M=>{if(t?.failOnError){x(M);return}y=M;const N=d.get(E);N&&(bn(N),d.delete(E)),w&&d.size===0&&x(y??new Error("No subscriptions remaining"))});d.set(E,T)}w=!0})}onceMeltPaid(e,t){return this.waitUntilPaid(this.meltQuotePaid.bind(this),e,t,"Timeout waiting for melt paid")}proofStatesStream(e,t){return(async function*(){const r=[];let s=!1,f=null;const d=t?.maxBuffer&&t.maxBuffer>0?t.maxBuffer:1/0,p=t?.drop??"oldest",y=()=>{const E=f;f=null,E&&E()},w=E=>{if(r.length>=d)if(p==="oldest"){const T=r.shift();if(T!==void 0)try{t?.onDrop?.(T)}catch{}r.push(E)}else{try{t?.onDrop?.(E)}catch{}return}else r.push(E);y()},x=this.proofStateUpdates(e,E=>{w(E)},()=>{s=!0,y()},{signal:t?.signal}),A=()=>{s=!0,y()};try{for(t?.signal&&(t.signal.aborted?A():t.signal.addEventListener("abort",A,{once:!0}));!s||r.length;){for(;r.length;)yield r.shift();if(s)break;await new Promise(E=>f=E)}}finally{bn(x),t?.signal&&t.signal.removeEventListener("abort",A)}}).call(this)}group(){const e=[];let t=!1;const r=(()=>{if(!t)for(t=!0;e.length;)bn(e.pop())});return r.add=s=>t?(bn(s),s):(e.push(s),s),Object.defineProperty(r,"cancelled",{get:()=>t,enumerable:!0}),r}}class cf{constructor(e){this.src=e}async peekNext(e){return(await this.src.reserve(e,0)).start}async advanceToAtLeast(e,t){await this.src.advanceToAtLeast(e,t)}async setNext(e,t){if(typeof this.src.setNext=="function"){await this.src.setNext(e,t);return}throw new Error("CounterSource does not support setNext()")}async snapshot(){if(typeof this.src.snapshot=="function")return await this.src.snapshot();throw new Error("CounterSource does not support snapshot()")}}const xi="__PENDING__";class ki{constructor(e,t){if(this._seed=void 0,this._unit="sat",this._mintInfo=void 0,this._denominationTarget=3,this._secretsPolicy="auto",this._boundKeysetId=xi,this.swap=this.send.bind(this),this.ops=new rf(this),this.on=new uf(this),this._logger=t?.logger??lt,this._selectProofs=t?.selectProofs??tf,this.mint=typeof e=="string"?new Cs(e,{authProvider:t?.authProvider,logger:this._logger}):e,this._unit=t?.unit??this._unit,this._boundKeysetId=t?.keysetId??this._boundKeysetId,t?.bip39seed&&(this.failIf(!(t.bip39seed instanceof Uint8Array),"bip39seed must be a valid Uint8Array",{bip39seed:t.bip39seed}),this._seed=t.bip39seed),this._secretsPolicy=t?.secretsPolicy??this._secretsPolicy,t?.counterSource?this._counterSource=t.counterSource:this._counterSource=new nf(t?.counterInit),this.counters=new cf(this._counterSource),this._keyChain=new Zt(this.mint,this._unit),this._denominationTarget=t?.denominationTarget??this._denominationTarget,t?.keysets&&t?.keys&&t?.mintInfo){const r=Array.isArray(t.keys)?t.keys:[t.keys],s=Zt.mintToCacheDTO(this._unit,this.mint.mintUrl,t.keysets,r);this.loadMintFromCache(t.mintInfo,s)}}fail(e,t){return hr(e,this._logger,t)}failIf(e,t,r){return ni(e,t,this._logger,r)}failIfNullish(e,t,r){return ts(e,t,this._logger,r)}safeCallback(e,t,r){Nn(e,t,this._logger,r)}assertAmount(e,t){try{hi(e,!1)}catch(r){this.fail(r.message,{op:t,amount:e})}}async loadMint(e){const t=[];(!this._mintInfo||e)&&t.push(this.mint.getInfo().then(r=>(this._mintInfo=new mi(r),null))),t.push(this._keyChain.init(e).then(()=>null)),await Promise.all(t),this.finishInit()}loadMintFromCache(e,t){this._mintInfo=new mi(e),this._keyChain.loadFromCache(t),this.finishInit()}finishInit(){const e=this._keyChain.getCheapestKeyset().id;if(this._logger.debug("KeyChain",{keychain:this._keyChain.cache}),this._boundKeysetId===xi)this._boundKeysetId=e;else{const t=this._keyChain.getKeyset(this._boundKeysetId);this.failIf(!t.hasKeys,"Wallet keyset has no keys",{keyset:t.id})}this.getMintInfo()}get keyChain(){return this._keyChain}get unit(){return this._unit}getMintInfo(){return this.failIfNullish(this._mintInfo,"Mint info not initialized; call loadMint or loadMintFromCache first"),this._mintInfo}get keysetId(){return this.failIf(this._boundKeysetId===xi,"Wallet not initialised, call loadMint or loadMintFromCache first"),this._boundKeysetId}getKeyset(e){const t=this._keyChain.getKeyset(e??this.keysetId);return this.failIf(t.unit!==this._unit,"Keyset unit does not match wallet unit",{keyset:t.id,unit:t.unit,walletUnit:this._unit}),this.failIf(!t.hasKeys,"Keyset has no keys loaded",{keyset:t.id}),t}get logger(){return this._logger}async reserveFor(e,t){return t<=0?{start:0,count:0}:this._counterSource.reserve(e,t)}countersNeeded(e){return e.type!=="deterministic"||e.counter!==0?0:(e.denominations??[]).length}async addCountersToOutputTypes(e,...t){const r=t.filter(w=>w.type==="deterministic"&&w.counter>0&&(w.denominations?.length??0)>0);if(r.length>1){const w=r.map(x=>({start:x.counter,end:x.counter+x.denominations.length})).sort((x,A)=>x.start-A.start);for(let x=1;x<w.length;x++)this.failIf(w[x].start<w[x-1].end,"Manual counter ranges overlap",{keysetId:e,prev:w[x-1],cur:w[x]})}if(r.length>0){const w=Math.max(...r.map(x=>x.counter+x.denominations.length));await this._counterSource.advanceToAtLeast(e,w),this._logger.debug("Counter source advanced to respect manual deterministic counters",{keysetId:e,maxManualEnd:w})}const s=t.reduce((w,x)=>w+this.countersNeeded(x),0);if(s===0)return{outputTypes:t};const f=await this.reserveFor(e,s);let d=f.start;const p=t.map(w=>{if(w.type==="deterministic"&&w.counter===0){const x=w.denominations?.length??0;if(x>0){const A={...w,counter:d};return d+=x,A}}return w}),y={keysetId:e,start:f.start,count:f.count,next:f.start+f.count};return this.on._emitCountersReserved(y),{outputTypes:p,used:y}}bindKeyset(e){const t=this._keyChain.getKeyset(e);this.failIf(t.unit!==this._unit,"Keyset unit does not match wallet unit",{keyset:t.id,unit:t.unit,walletUnit:this._unit}),this.failIf(!t.hasKeys,"Keyset has no keys loaded",{keyset:t.id}),this._boundKeysetId=t.id,this._logger.debug("Wallet bound to keyset",{keysetId:t.id,unit:t.unit,feePPK:t.fee})}withKeyset(e,t){const r=new ki(this.mint,{keysetId:e,bip39seed:this._seed,secretsPolicy:this._secretsPolicy,logger:this._logger,counterSource:t?.counterSource??this._counterSource});return r.loadMintFromCache(this.getMintInfo().cache,this._keyChain.cache),r}defaultOutputType(){return this._secretsPolicy==="random"?{type:"random"}:this._secretsPolicy==="deterministic"?(this.failIfNullish(this._seed,"Deterministic policy requires a seed"),{type:"deterministic",counter:0}):this._seed?{type:"deterministic",counter:0}:{type:"random"}}configureOutputs(e,t,r,s=!1,f=[]){let d=e;if(r.type==="custom"){this.failIf(s,"The custom OutputType does not support automatic fee inclusion");const y=ht.sumOutputAmounts(r.data);return this.failIf(y!==e,`Custom output data total (${y}) does not match amount (${e})`),r}let p=r.denominations??[];if(p.length===0&&f.length>0&&(p=Dc(f,d,t.keys,this._denominationTarget)),p=Ht(d,t.keys,p),s){let y=this.getFeesForKeyset(p.length,t.id),w=Ht(y,t.keys);for(;this.getFeesForKeyset(p.length+w.length,t.id)>y;)y++,w=Ht(y,t.keys);d+=y,p=[...p,...w]}return{...r,denominations:p}}preparedTotal(e){return e.type==="custom"?ht.sumOutputAmounts(e.data):(e.denominations??[]).reduce((t,r)=>t+r,0)}createOutputData(e,t,r){if(this.failIf(e<0,"Amount was negative",{amount:e}),r.type!="custom"&&r.denominations&&r.denominations.length>0){const f=r.denominations.reduce((d,p)=>d+p,0);this.failIf(f!==e,"Denominations do not sum to the expected amount",{splitSum:f,expected:e})}let s;switch(r.type){case"random":s=ht.createRandomData(e,t,r.denominations);break;case"deterministic":this.failIfNullish(this._seed,"Deterministic outputs require a seed configured in the wallet"),s=ht.createDeterministicData(e,this._seed,r.counter,t,r.denominations);break;case"p2pk":s=ht.createP2PKData(r.options,e,t,r.denominations);break;case"factory":{s=Ht(e,t.keys,r.denominations).map(f=>r.factory(f,t));break}case"custom":{s=r.data;const f=ht.sumOutputAmounts(s);this.failIf(f!==e,`Custom output data total (${f}) does not match amount (${e})`);break}default:this.fail("Invalid OutputType")}return s}createSwapTransaction(e,t,r=[]){e=this._prepareInputsForMint(e);const s=[...t,...r],f=s.map((x,A)=>A);ds(e)||f.sort((x,A)=>s[x].blindedMessage.amount-s[A].blindedMessage.amount);const d=[...Array.from({length:t.length},()=>!0),...Array.from({length:r.length},()=>!1)],p=f.map(x=>s[x]),y=f.map(x=>d[x]),w=p.map(x=>x.blindedMessage);return this._logger.debug("createSwapTransaction:",{indices:f,sortedKeepVector:y}),{payload:{inputs:e,outputs:w},outputData:p,keepVector:y,sortedIndices:f}}async receive(e,t,r){const s=await this.prepareSwapToReceive(e,t,r),{keep:f}=await this.completeSwap(s,t?.privkey);return f}async prepareSwapToReceive(e,t,r){const{keysetId:s,requireDleq:f,proofsWeHave:d,onCountersReserved:p}=t||{};r=r??this.defaultOutputType();const y=typeof e=="string"?this.decodeToken(e):e,w=vs(y.mint);this.failIf(w!==this.mint.mintUrl,"Token belongs to a different mint",{token:w,wallet:this.mint.mintUrl}),this.failIf(y.unit!==this._unit,"Token is not in wallet unit",{token:y.unit,wallet:this._unit});let x=[];({proofs:x}=y);const A=Gt(x);this.failIf(A===0,"Token contains no proofs",{proofs:x}),this.assertAmount(A,"prepareSwapToReceive");const E=this.getKeyset(s);if(f)for(const we of x){const ee=this._keyChain.getKeyset(we.id);Vc(we,ee)||this.fail("Token contains proofs with invalid or missing DLEQ")}const T=this.getFeesForProofs(x),M=A-T;let N=this.configureOutputs(M,E,r,!1,d);const W=await this.addCountersToOutputTypes(E.id,N);[N]=W.outputTypes,W.used&&this.safeCallback(p,W.used,{op:"receive"}),this._logger.debug("receive counter",{counter:W.used,receiveOT:N});const $=this.createOutputData(this.preparedTotal(N),E,N);return{amount:M,fees:T,keysetId:E.id,inputs:x,keepOutputs:$}}sendOffline(e,t,r){this.assertAmount(e,"sendOffline");const{requireDleq:s=!1,includeFees:f=!1,exactMatch:d=!0}=r||{};s&&(t=t.filter(x=>x.dleq!=null)),this.failIf(Gt(t)<e,"Not enough funds available to send");const{keep:p,send:y}=this.selectProofsToSend(t,e,f,d),w=this._prepareInputsForMint(y,s);return{keep:p,send:w}}async send(e,t,r,s){this.assertAmount(e,"send");const{keysetId:f,includeFees:d=!1}=r||{};s=s??{send:this.defaultOutputType(),keep:this.defaultOutputType()};try{const y=this.defaultOutputType().type==="deterministic",w=T=>!T||T.type==="random"&&(!T.denominations||T.denominations.length===0);if(f||y||!w(s.send)||s.keep&&!w(s.keep)){const T=[];throw f&&T.push("keysetId override"),y&&T.push("wallet default is deterministic"),w(s.send)||T.push("non-default send output type"),s.keep&&!w(s.keep)&&T.push("non-default keep output type"),new Error(`Options require a swap: ${T.join(", ")}`)}const{keep:x,send:A}=this.sendOffline(e,t,{includeFees:d,exactMatch:!0,requireDleq:!1}),E=d?this.getFeesForProofs(A):0;if(Gt(A)===e+E)return this._logger.info("Successful exactMatch offline selection!"),{keep:x,send:A}}catch(y){const w=y instanceof Error?y.message:"Unknown error";this._logger.debug("ExactMatch offline selection failed.",{e:w})}const p=await this.prepareSwapToSend(e,t,r,s);return await this.completeSwap(p,r?.privkey)}async prepareSwapToSend(e,t,r,s){const{keysetId:f,includeFees:d=!1,onCountersReserved:p}=r||{};s=s??{send:this.defaultOutputType(),keep:this.defaultOutputType()};const y=this.getKeyset(f);let w=this.configureOutputs(e,y,s.send??this.defaultOutputType(),d);const x=this.preparedTotal(w),{keep:A,send:E}=this.selectProofsToSend(t,x,!0);if(E.length===0)throw new Error("Not enough funds available to send");const T=Gt(E),M=this.getFeesForProofs(E),N=T-M-x;this.failIf(N<0,"Not enough funds available for swap",{selectedSum:T,swapFee:M,sendAmount:x,changeAmount:N});let W=this.configureOutputs(N,y,s.keep??this.defaultOutputType(),!1,r?.proofsWeHave);const $=this.preparedTotal(W),we=await this.addCountersToOutputTypes(y.id,w,W);[w,W]=we.outputTypes,we.used&&this.safeCallback(p,we.used,{op:"send"}),this._logger.debug("send counters",{counter:we.used,sendOT:w,keepOT:W});const ee=this.createOutputData(x,y,w),pe=this.createOutputData($,y,W);return{amount:e,fees:M,keysetId:y.id,inputs:E,sendOutputs:ee,keepOutputs:pe,unselectedProofs:A}}async completeSwap(e,t){const r=e?.keepOutputs?e.keepOutputs:[],s=e.sendOutputs?e.sendOutputs:[],f=e.unselectedProofs?e.unselectedProofs:[];t&&(e.inputs=this.signP2PKProofs(e.inputs,t,[...r,...s]));const d=this.createSwapTransaction(e.inputs,r,s),{signatures:p}=await this.mint.swap(d.payload);this.failIf(p.length<d.outputData.length,`Mint returned ${p.length} signatures, expected ${d.outputData.length}`);const y=this.getKeyset(e.keysetId),w=d.outputData.map((M,N)=>M.toProof(p[N],y)),x=Array(w.length),A=Array(d.keepVector.length);d.sortedIndices.forEach((M,N)=>{A[M]=d.keepVector[N],x[M]=w[N]});const E=[],T=[];return x.forEach((M,N)=>{A[N]?E.push(M):T.push(M)}),this._logger.debug("SEND COMPLETED",{unselectedProofs:f.map(M=>M.amount),keepProofs:E.map(M=>M.amount),sendProofs:T.map(M=>M.amount)}),{keep:[...E,...f],send:T}}selectProofsToSend(e,t,r=!1,s=!1){this.assertAmount(t,"selectProofsToSend");const{keep:f,send:d}=this._selectProofs(e,t,this._keyChain,r,s);return{keep:f,send:d}}signP2PKProofs(e,t,r,s){if(!ds(e))return hs(e,t,this._logger);this.failIfNullish(r,"OutputData is required for SIG_ALL proof signing."),Cc(e);const[f,...d]=e;let p=f;const y=[Ac(e,r,s),Sc(e,r,s),Tc(e,r,s)];for(const w of y)p=hs([p],t,this._logger,w)[0];return[p,...d]}getFeesForProofs(e){const t=e.reduce((r,s)=>r+this.getProofFeePPK(s),0);return Math.ceil(t/1e3)}getProofFeePPK(e){try{return this._keyChain.getKeyset(e.id).fee}catch(t){this.fail(`Could not get fee. No keyset found for keyset id: ${e.id}`,{e:t,keychain:this._keyChain.getKeysets()})}}getFeesForKeyset(e,t){try{const r=this._keyChain.getKeyset(t).fee;return Math.floor(Math.max((e*r+999)/1e3,0))}catch(r){this.fail(`No keyset found with ID ${t}`,{e:r})}}_prepareInputsForMint(e,t=!1){return e.map(r=>{const s=r.witness&&typeof r.witness!="string"?JSON.stringify(r.witness):r.witness,{dleq:f,p2pk_e:d,...p}=r;return t&&f?{...p,dleq:f,witness:s}:{...p,witness:s}})}decodeToken(e){const t=this._keyChain.getAllKeysetIds();return jc(e,t)}async batchRestore(e=300,t=100,r=0,s){const f=Math.ceil(e/t),d=[];let p,y=0;for(;y<f;){const w=await this.restore(r,t,{keysetId:s});w.proofs.length>0?(y=0,d.push(...w.proofs),p=w.lastCounterWithSignature):y++,r+=t}return{proofs:d,lastCounterWithSignature:p}}async restore(e,t,r){const{keysetId:s}=r||{},f=this.getKeyset(s);this.failIfNullish(this._seed,"Cashu Wallet must be initialized with a seed to use restore");const d=Array(t).fill(0),p=ht.createDeterministicData(0,this._seed,e,f,d),{outputs:y,signatures:w}=await this.mint.restore({outputs:p.map(T=>T.blindedMessage)}),x={};y.forEach((T,M)=>x[T.B_]=w[M]);const A=[];let E;for(let T=0;T<p.length;T++){const M=x[p[T].blindedMessage.B_];M&&(E=e+T,p[T].blindedMessage.amount=M.amount,A.push(p[T].toProof(M,f)))}return{proofs:A,lastCounterWithSignature:E}}async createMintQuote(e,t){return this.createMintQuoteBolt11(e,t)}async createMintQuoteBolt11(e,t){this.assertAmount(e,"createMintQuoteBolt11"),t&&(this.getMintInfo().supportsNut04Description("bolt11",this._unit)||this.fail("Mint does not support description for bolt11"));const r={unit:this._unit,amount:e,description:t},s=await this.mint.createMintQuoteBolt11(r);return{...s,amount:s.amount||e,unit:s.unit||this._unit}}async createLockedMintQuote(e,t,r){this.assertAmount(e,"createLockedMintQuote");const{supported:s}=this.getMintInfo().isSupported(20);this.failIf(!s,"Mint does not support NUT-20");const f={unit:this._unit,amount:e,description:r,pubkey:t},d=await this.mint.createMintQuoteBolt11(f);this.failIf(typeof d.pubkey!="string","Mint returned unlocked mint quote");const p=d.pubkey;return{...d,pubkey:p,amount:d.amount||e,unit:d.unit||this._unit}}async createMintQuoteBolt12(e,t){const r=this.getMintInfo();t?.description&&!r.supportsNut04Description("bolt12",this._unit)&&this.fail("Mint does not support description for bolt12");const s={pubkey:e,unit:this._unit,amount:t?.amount,description:t?.description};return this.mint.createMintQuoteBolt12(s)}async checkMintQuote(e){return this.checkMintQuoteBolt11(e)}async checkMintQuoteBolt11(e){const t=typeof e=="string"?e:e.quote,r=await this.mint.checkMintQuoteBolt11(t);return typeof e=="string"?r:{...r,amount:r.amount||e.amount,unit:r.unit||e.unit}}async checkMintQuoteBolt12(e){return this.mint.checkMintQuoteBolt12(e)}async mintProofs(e,t,r,s){return this._mintProofs("bolt11",e,t,r,s)}async mintProofsBolt11(e,t,r,s){return this._mintProofs("bolt11",e,t,r,s)}async mintProofsBolt12(e,t,r,s,f){return this._mintProofs("bolt12",e,t,{...s,privkey:r},f)}async _mintProofs(e,t,r,s,f){this.assertAmount(t,`_mintProofs: ${e}`),f=f??this.defaultOutputType();const{privkey:d,keysetId:p,proofsWeHave:y,onCountersReserved:w}=s??{},x=this.getKeyset(p);let A=this.configureOutputs(t,x,f,!1,y);const E=this.preparedTotal(A),T=await this.addCountersToOutputTypes(x.id,A);[A]=T.outputTypes,T.used&&this.safeCallback(w,T.used,{op:"mintProofs"}),this._logger.debug("mint counter",{counter:T.used,mintOT:A});const M=this.createOutputData(E,x,A),N=M.map(we=>we.blindedMessage),W={outputs:N,quote:typeof r=="string"?r:r.quote};if(typeof r!="string"&&r.pubkey){this.failIf(!d,"Can not sign locked quote without private key");const we=Nc(d,r.quote,N);W.signature=we}let $;return e==="bolt12"?{signatures:$}=await this.mint.mintBolt12(W):{signatures:$}=await this.mint.mintBolt11(W),this.failIf($.length!==M.length,`Mint returned ${$.length} signatures, expected ${M.length}`),this._logger.debug("MINT COMPLETED",{amounts:M.map(we=>we.blindedMessage.amount)}),M.map((we,ee)=>we.toProof($[ee],x))}async createMeltQuote(e,t){return this.createMeltQuoteBolt11(e,t)}async createMeltQuoteBolt11(e,t){t!==void 0&&(this.failIf(Qc(e),"amountMsat supplied but invoice already contains an amount. Leave amountMsat undefined for non-zero invoices."),this.assertAmount(t,"createMeltQuoteBolt11"));const r=this._mintInfo?.supportsAmountless?.("bolt11",this._unit)??!1,s={unit:this._unit,request:e,...r&&t!==void 0?{options:{amountless:{amount_msat:t}}}:{}},f=await this.mint.createMeltQuoteBolt11(s);return{...f,unit:f.unit||this._unit,request:f.request||e}}async createMeltQuoteBolt12(e,t){return this.mint.createMeltQuoteBolt12({unit:this._unit,request:e,options:t?{amountless:{amount_msat:t}}:void 0})}async createMultiPathMeltQuote(e,t){this.assertAmount(t,"createMultiPathMeltQuote");const{supported:r,params:s}=this.getMintInfo().isSupported(15);this.failIf(!r,"Mint does not support NUT-15"),this.failIf(!s?.some(d=>d.method==="bolt11"&&d.unit===this._unit),`Mint does not support MPP for bolt11 and ${this._unit}`);const f={unit:this._unit,request:e,options:{mpp:{amount:t}}};return{...await this.mint.createMeltQuoteBolt11(f),request:e,unit:this._unit}}async checkMeltQuote(e){return this.checkMeltQuoteBolt11(e)}async checkMeltQuoteBolt11(e){const t=typeof e=="string"?e:e.quote,r=await this.mint.checkMeltQuoteBolt11(t);return typeof e=="string"?r:{...r,request:e.request,unit:e.unit}}async checkMeltQuoteBolt12(e){return this.mint.checkMeltQuoteBolt12(e)}async meltProofs(e,t,r,s){return this.meltProofsBolt11(e,t,r,s)}async meltProofsBolt11(e,t,r,s){const f=await this.prepareMelt("bolt11",e,t,r,s),d=typeof r?.onChangeOutputsCreated=="function";return this.completeMelt(f,r?.privkey,d)}async meltProofsBolt12(e,t,r,s){const f=await this.prepareMelt("bolt12",e,t,r,s),d=typeof r?.onChangeOutputsCreated=="function";return this.completeMelt(f,r?.privkey,d)}async prepareMelt(e,t,r,s,f){f=f??this.defaultOutputType();const{keysetId:d,onChangeOutputsCreated:p,onCountersReserved:y}=s||{},w=this.getKeyset(d),x=Gt(r),A=x-t.amount;let E=[];if(this.failIf(A<0,"Not enough proofs to cover amount + fee reserve",{sendAmount:x,quoteAmount:t.amount}),A>0){let M=Math.ceil(Math.log2(A))||1;M<0&&(M=0);const N=M?new Array(M).fill(0):[];this._logger.debug("Creating NUT-08 blanks for fee reserve",{feeReserve:A,denominations:N}),f.type==="custom"&&this.fail("Custom OutputType not supported for melt change (must be 0-sat blanks)");let W={...f,denominations:N};const $=await this.addCountersToOutputTypes(w.id,W);[W]=$.outputTypes,$.used&&this.safeCallback(y,$.used,{op:"meltProofs"}),this._logger.debug("melt counter",{counter:$.used,meltOT:W}),E=this.createOutputData(0,w,W)}const T={method:e,inputs:r,outputData:E,keysetId:w.id,quote:t};if(E.length>0){const M={method:e,payload:{quote:t.quote,inputs:r,outputs:E.map(N=>N.blindedMessage)},outputData:E,keyset:w,quote:t};this.safeCallback(p,M,{op:"meltProofs"}),this.on._emitMeltBlanksCreated(M)}return T}async completeMelt(e,t,r){e=this.maybeConvertMeltBlanks(e);let s=e.inputs;const f=e.outputData.map(A=>A.blindedMessage),d=e.quote.quote,p=this.getKeyset(e.keysetId);t&&(s=this.signP2PKProofs(s,t,e.outputData,d)),s=this._prepareInputsForMint(s);const y={quote:d,inputs:s,outputs:f},w=e.method==="bolt11"?await this.mint.meltBolt11(y,{preferAsync:r}):await this.mint.melt(e.method,y,{preferAsync:r});this.failIf((w.change?.length??0)>e.outputData.length,`Mint returned ${w.change?.length??0} signatures, but only ${e.outputData.length} blanks were provided`);const x=w.change?.map((A,E)=>e.outputData[E].toProof(A,p))??[];return r?this._logger.debug("ASYNC MELT REQUESTED",w):this._logger.debug("MELT COMPLETED",{changeAmounts:x.map(A=>A.amount)}),{quote:{...e.quote,...w},change:x}}maybeConvertMeltBlanks(e){if(!("payload"in e))return e;this._logger.warn("MeltBlanks objects and the meltBlanksCreated / onChangeOutputsCreated events are deprecated. Please use wallet.prepareMelt() to create a MeltPreview instead.");const{method:t,payload:r,outputData:s,keyset:f,quote:d}=e;return{method:t,inputs:r.inputs,outputData:s,keysetId:f.id,quote:d}}async checkProofsStates(e){const t=new TextEncoder,r=e.map(d=>pr(t.encode(d.secret)).toHex(!0)),s=100,f=[];for(let d=0;d<r.length;d+=s){const p=r.slice(d,d+s),{states:y}=await this.mint.check({Ys:p}),w={};y.forEach(x=>{w[x.Y]=x});for(let x=0;x<p.length;x++){const A=w[p[x]];this.failIfNullish(A,"Could not find state for proof with Y: "+p[x]),f.push(A)}}return f}async groupProofsByState(e){const t=await this.checkProofsStates(e),r={unspent:[],pending:[],spent:[]};for(let s=0;s<t.length;s++){const f=e[s];switch(t[s].state){case gi.UNSPENT:r.unspent.push(f);break;case gi.PENDING:r.pending.push(f);break;case gi.SPENT:r.spent.push(f);break}}return r}}var Ei={};(function i(e,t,r,s){var f=!!(e.Worker&&e.Blob&&e.Promise&&e.OffscreenCanvas&&e.OffscreenCanvasRenderingContext2D&&e.HTMLCanvasElement&&e.HTMLCanvasElement.prototype.transferControlToOffscreen&&e.URL&&e.URL.createObjectURL),d=typeof Path2D=="function"&&typeof DOMMatrix=="function",p=(function(){if(!e.OffscreenCanvas)return!1;try{var C=new OffscreenCanvas(1,1),v=C.getContext("2d");v.fillRect(0,0,1,1);var z=C.transferToImageBitmap();v.createPattern(z,"no-repeat")}catch{return!1}return!0})();function y(){}function w(C){var v=t.exports.Promise,z=v!==void 0?v:e.Promise;return typeof z=="function"?new z(C):(C(y,y),null)}var x=(function(C,v){return{transform:function(z){if(C)return z;if(v.has(z))return v.get(z);var Z=new OffscreenCanvas(z.width,z.height),te=Z.getContext("2d");return te.drawImage(z,0,0),v.set(z,Z),Z},clear:function(){v.clear()}}})(p,new Map),A=(function(){var C=Math.floor(16.666666666666668),v,z,Z={},te=0;return typeof requestAnimationFrame=="function"&&typeof cancelAnimationFrame=="function"?(v=function(Y){var oe=Math.random();return Z[oe]=requestAnimationFrame(function ne(fe){te===fe||te+C-1<fe?(te=fe,delete Z[oe],Y()):Z[oe]=requestAnimationFrame(ne)}),oe},z=function(Y){Z[Y]&&cancelAnimationFrame(Z[Y])}):(v=function(Y){return setTimeout(Y,C)},z=function(Y){return clearTimeout(Y)}),{frame:v,cancel:z}})(),E=(function(){var C,v,z={};function Z(te){function Y(oe,ne){te.postMessage({options:oe||{},callback:ne})}te.init=function(ne){var fe=ne.transferControlToOffscreen();te.postMessage({canvas:fe},[fe])},te.fire=function(ne,fe,ce){if(v)return Y(ne,null),v;var le=Math.random().toString(36).slice(2);return v=w(function(Ae){function _e(Pe){Pe.data.callback===le&&(delete z[le],te.removeEventListener("message",_e),v=null,x.clear(),ce(),Ae())}te.addEventListener("message",_e),Y(ne,le),z[le]=_e.bind(null,{data:{callback:le}})}),v},te.reset=function(){te.postMessage({reset:!0});for(var ne in z)z[ne](),delete z[ne]}}return function(){if(C)return C;if(!r&&f){var te=["var CONFETTI, SIZE = {}, module = {};","("+i.toString()+")(this, module, true, SIZE);","onmessage = function(msg) {","  if (msg.data.options) {","    CONFETTI(msg.data.options).then(function () {","      if (msg.data.callback) {","        postMessage({ callback: msg.data.callback });","      }","    });","  } else if (msg.data.reset) {","    CONFETTI && CONFETTI.reset();","  } else if (msg.data.resize) {","    SIZE.width = msg.data.resize.width;","    SIZE.height = msg.data.resize.height;","  } else if (msg.data.canvas) {","    SIZE.width = msg.data.canvas.width;","    SIZE.height = msg.data.canvas.height;","    CONFETTI = module.exports.create(msg.data.canvas);","  }","}"].join(`
`);try{C=new Worker(URL.createObjectURL(new Blob([te])))}catch(Y){return typeof console<"u"&&typeof console.warn=="function"&&console.warn("ðŸŽŠ Could not load worker",Y),null}Z(C)}return C}})(),T={particleCount:50,angle:90,spread:45,startVelocity:45,decay:.9,gravity:1,drift:0,ticks:200,x:.5,y:.5,shapes:["square","circle"],zIndex:100,colors:["#26ccff","#a25afd","#ff5e7e","#88ff5a","#fcff42","#ffa62d","#ff36ff"],disableForReducedMotion:!1,scalar:1};function M(C,v){return v?v(C):C}function N(C){return C!=null}function W(C,v,z){return M(C&&N(C[v])?C[v]:T[v],z)}function $(C){return C<0?0:Math.floor(C)}function we(C,v){return Math.floor(Math.random()*(v-C))+C}function ee(C){return parseInt(C,16)}function pe(C){return C.map(ve)}function ve(C){var v=String(C).replace(/[^0-9a-f]/gi,"");return v.length<6&&(v=v[0]+v[0]+v[1]+v[1]+v[2]+v[2]),{r:ee(v.substring(0,2)),g:ee(v.substring(2,4)),b:ee(v.substring(4,6))}}function Be(C){var v=W(C,"origin",Object);return v.x=W(v,"x",Number),v.y=W(v,"y",Number),v}function u(C){C.width=document.documentElement.clientWidth,C.height=document.documentElement.clientHeight}function J(C){var v=C.getBoundingClientRect();C.width=v.width,C.height=v.height}function P(C){var v=document.createElement("canvas");return v.style.position="fixed",v.style.top="0px",v.style.left="0px",v.style.pointerEvents="none",v.style.zIndex=C,v}function U(C,v,z,Z,te,Y,oe,ne,fe){C.save(),C.translate(v,z),C.rotate(Y),C.scale(Z,te),C.arc(0,0,1,oe,ne,fe),C.restore()}function he(C){var v=C.angle*(Math.PI/180),z=C.spread*(Math.PI/180);return{x:C.x,y:C.y,wobble:Math.random()*10,wobbleSpeed:Math.min(.11,Math.random()*.1+.05),velocity:C.startVelocity*.5+Math.random()*C.startVelocity,angle2D:-v+(.5*z-Math.random()*z),tiltAngle:(Math.random()*(.75-.25)+.25)*Math.PI,color:C.color,shape:C.shape,tick:0,totalTicks:C.ticks,decay:C.decay,drift:C.drift,random:Math.random()+2,tiltSin:0,tiltCos:0,wobbleX:0,wobbleY:0,gravity:C.gravity*3,ovalScalar:.6,scalar:C.scalar,flat:C.flat}}function se(C,v){v.x+=Math.cos(v.angle2D)*v.velocity+v.drift,v.y+=Math.sin(v.angle2D)*v.velocity+v.gravity,v.velocity*=v.decay,v.flat?(v.wobble=0,v.wobbleX=v.x+10*v.scalar,v.wobbleY=v.y+10*v.scalar,v.tiltSin=0,v.tiltCos=0,v.random=1):(v.wobble+=v.wobbleSpeed,v.wobbleX=v.x+10*v.scalar*Math.cos(v.wobble),v.wobbleY=v.y+10*v.scalar*Math.sin(v.wobble),v.tiltAngle+=.1,v.tiltSin=Math.sin(v.tiltAngle),v.tiltCos=Math.cos(v.tiltAngle),v.random=Math.random()+2);var z=v.tick++/v.totalTicks,Z=v.x+v.random*v.tiltCos,te=v.y+v.random*v.tiltSin,Y=v.wobbleX+v.random*v.tiltCos,oe=v.wobbleY+v.random*v.tiltSin;if(C.fillStyle="rgba("+v.color.r+", "+v.color.g+", "+v.color.b+", "+(1-z)+")",C.beginPath(),d&&v.shape.type==="path"&&typeof v.shape.path=="string"&&Array.isArray(v.shape.matrix))C.fill(R(v.shape.path,v.shape.matrix,v.x,v.y,Math.abs(Y-Z)*.1,Math.abs(oe-te)*.1,Math.PI/10*v.wobble));else if(v.shape.type==="bitmap"){var ne=Math.PI/10*v.wobble,fe=Math.abs(Y-Z)*.1,ce=Math.abs(oe-te)*.1,le=v.shape.bitmap.width*v.scalar,Ae=v.shape.bitmap.height*v.scalar,_e=new DOMMatrix([Math.cos(ne)*fe,Math.sin(ne)*fe,-Math.sin(ne)*ce,Math.cos(ne)*ce,v.x,v.y]);_e.multiplySelf(new DOMMatrix(v.shape.matrix));var Pe=C.createPattern(x.transform(v.shape.bitmap),"no-repeat");Pe.setTransform(_e),C.globalAlpha=1-z,C.fillStyle=Pe,C.fillRect(v.x-le/2,v.y-Ae/2,le,Ae),C.globalAlpha=1}else if(v.shape==="circle")C.ellipse?C.ellipse(v.x,v.y,Math.abs(Y-Z)*v.ovalScalar,Math.abs(oe-te)*v.ovalScalar,Math.PI/10*v.wobble,0,2*Math.PI):U(C,v.x,v.y,Math.abs(Y-Z)*v.ovalScalar,Math.abs(oe-te)*v.ovalScalar,Math.PI/10*v.wobble,0,2*Math.PI);else if(v.shape==="star")for(var ke=Math.PI/2*3,Ke=4*v.scalar,$e=8*v.scalar,ge=v.x,He=v.y,dt=5,Je=Math.PI/dt;dt--;)ge=v.x+Math.cos(ke)*$e,He=v.y+Math.sin(ke)*$e,C.lineTo(ge,He),ke+=Je,ge=v.x+Math.cos(ke)*Ke,He=v.y+Math.sin(ke)*Ke,C.lineTo(ge,He),ke+=Je;else C.moveTo(Math.floor(v.x),Math.floor(v.y)),C.lineTo(Math.floor(v.wobbleX),Math.floor(te)),C.lineTo(Math.floor(Y),Math.floor(oe)),C.lineTo(Math.floor(Z),Math.floor(v.wobbleY));return C.closePath(),C.fill(),v.tick<v.totalTicks}function B(C,v,z,Z,te){var Y=v.slice(),oe=C.getContext("2d"),ne,fe,ce=w(function(le){function Ae(){ne=fe=null,oe.clearRect(0,0,Z.width,Z.height),x.clear(),te(),le()}function _e(){r&&!(Z.width===s.width&&Z.height===s.height)&&(Z.width=C.width=s.width,Z.height=C.height=s.height),!Z.width&&!Z.height&&(z(C),Z.width=C.width,Z.height=C.height),oe.clearRect(0,0,Z.width,Z.height),Y=Y.filter(function(Pe){return se(oe,Pe)}),Y.length?ne=A.frame(_e):Ae()}ne=A.frame(_e),fe=Ae});return{addFettis:function(le){return Y=Y.concat(le),ce},canvas:C,promise:ce,reset:function(){ne&&A.cancel(ne),fe&&fe()}}}function K(C,v){var z=!C,Z=!!W(v||{},"resize"),te=!1,Y=W(v,"disableForReducedMotion",Boolean),oe=f&&!!W(v||{},"useWorker"),ne=oe?E():null,fe=z?u:J,ce=C&&ne?!!C.__confetti_initialized:!1,le=typeof matchMedia=="function"&&matchMedia("(prefers-reduced-motion)").matches,Ae;function _e(ke,Ke,$e){for(var ge=W(ke,"particleCount",$),He=W(ke,"angle",Number),dt=W(ke,"spread",Number),Je=W(ke,"startVelocity",Number),Ii=W(ke,"decay",Number),at=W(ke,"gravity",Number),Xt=W(ke,"drift",Number),Ut=W(ke,"colors",pe),ue=W(ke,"ticks",Number),We=W(ke,"shapes"),Mi=W(ke,"scalar"),Bi=!!W(ke,"flat"),mr=Be(ke),Rn=ge,vn=[],Yt=C.width*mr.x,pt=C.height*mr.y;Rn--;)vn.push(he({x:Yt,y:pt,angle:He,spread:dt,startVelocity:Je,color:Ut[Rn%Ut.length],shape:We[we(0,We.length)],ticks:ue,decay:Ii,gravity:at,drift:Xt,scalar:Mi,flat:Bi}));return Ae?Ae.addFettis(vn):(Ae=B(C,vn,fe,Ke,$e),Ae.promise)}function Pe(ke){var Ke=Y||W(ke,"disableForReducedMotion",Boolean),$e=W(ke,"zIndex",Number);if(Ke&&le)return w(function(Je){Je()});z&&Ae?C=Ae.canvas:z&&!C&&(C=P($e),document.body.appendChild(C)),Z&&!ce&&fe(C);var ge={width:C.width,height:C.height};ne&&!ce&&ne.init(C),ce=!0,ne&&(C.__confetti_initialized=!0);function He(){if(ne){var Je={getBoundingClientRect:function(){if(!z)return C.getBoundingClientRect()}};fe(Je),ne.postMessage({resize:{width:Je.width,height:Je.height}});return}ge.width=ge.height=null}function dt(){Ae=null,Z&&(te=!1,e.removeEventListener("resize",He)),z&&C&&(document.body.contains(C)&&document.body.removeChild(C),C=null,ce=!1)}return Z&&!te&&(te=!0,e.addEventListener("resize",He,!1)),ne?ne.fire(ke,ge,dt):_e(ke,ge,dt)}return Pe.reset=function(){ne&&ne.reset(),Ae&&Ae.reset()},Pe}var I;function L(){return I||(I=K(null,{useWorker:!0,resize:!0})),I}function R(C,v,z,Z,te,Y,oe){var ne=new Path2D(C),fe=new Path2D;fe.addPath(ne,new DOMMatrix(v));var ce=new Path2D;return ce.addPath(fe,new DOMMatrix([Math.cos(oe)*te,Math.sin(oe)*te,-Math.sin(oe)*Y,Math.cos(oe)*Y,z,Z])),ce}function V(C){if(!d)throw new Error("path confetti are not supported in this browser");var v,z;typeof C=="string"?v=C:(v=C.path,z=C.matrix);var Z=new Path2D(v),te=document.createElement("canvas"),Y=te.getContext("2d");if(!z){for(var oe=1e3,ne=oe,fe=oe,ce=0,le=0,Ae,_e,Pe=0;Pe<oe;Pe+=2)for(var ke=0;ke<oe;ke+=2)Y.isPointInPath(Z,Pe,ke,"nonzero")&&(ne=Math.min(ne,Pe),fe=Math.min(fe,ke),ce=Math.max(ce,Pe),le=Math.max(le,ke));Ae=ce-ne,_e=le-fe;var Ke=10,$e=Math.min(Ke/Ae,Ke/_e);z=[$e,0,0,$e,-Math.round(Ae/2+ne)*$e,-Math.round(_e/2+fe)*$e]}return{type:"path",path:v,matrix:z}}function G(C){var v,z=1,Z="#000000",te='"Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji", "EmojiOne Color", "Android Emoji", "Twemoji Mozilla", "system emoji", sans-serif';typeof C=="string"?v=C:(v=C.text,z="scalar"in C?C.scalar:z,te="fontFamily"in C?C.fontFamily:te,Z="color"in C?C.color:Z);var Y=10*z,oe=""+Y+"px "+te,ne=new OffscreenCanvas(Y,Y),fe=ne.getContext("2d");fe.font=oe;var ce=fe.measureText(v),le=Math.ceil(ce.actualBoundingBoxRight+ce.actualBoundingBoxLeft),Ae=Math.ceil(ce.actualBoundingBoxAscent+ce.actualBoundingBoxDescent),_e=2,Pe=ce.actualBoundingBoxLeft+_e,ke=ce.actualBoundingBoxAscent+_e;le+=_e+_e,Ae+=_e+_e,ne=new OffscreenCanvas(le,Ae),fe=ne.getContext("2d"),fe.font=oe,fe.fillStyle=Z,fe.fillText(v,Pe,ke);var Ke=1/z;return{type:"bitmap",bitmap:ne.transferToImageBitmap(),matrix:[Ke,0,0,Ke,-le*Ke/2,-Ae*Ke/2]}}t.exports=function(){return L().apply(this,arguments)},t.exports.reset=function(){L().reset()},t.exports.create=K,t.exports.shapeFromPath=V,t.exports.shapeFromText=G})((function(){return typeof window<"u"?window:typeof self<"u"?self:this||{}})(),Ei,!1);const Ci=Ei.exports;Ei.exports.create;function ff(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Ti={exports:{}},yr={exports:{}};var lf=yr.exports,Ms;function hf(){return Ms||(Ms=1,(function(i){(function(e,t){i.exports=e.document?t(e,!0):function(r){if(!r.document)throw new Error("jQuery requires a window with a document");return t(r)}})(typeof window<"u"?window:lf,function(e,t){var r=[],s=Object.getPrototypeOf,f=r.slice,d=r.flat?function(n){return r.flat.call(n)}:function(n){return r.concat.apply([],n)},p=r.push,y=r.indexOf,w={},x=w.toString,A=w.hasOwnProperty,E=A.toString,T=E.call(Object),M={},N=function(o){return typeof o=="function"&&typeof o.nodeType!="number"&&typeof o.item!="function"},W=function(o){return o!=null&&o===o.window},$=e.document,we={type:!0,src:!0,nonce:!0,noModule:!0};function ee(n,o,a){a=a||$;var c,l,h=a.createElement("script");if(h.text=n,o)for(c in we)l=o[c]||o.getAttribute&&o.getAttribute(c),l&&h.setAttribute(c,l);a.head.appendChild(h).parentNode.removeChild(h)}function pe(n){return n==null?n+"":typeof n=="object"||typeof n=="function"?w[x.call(n)]||"object":typeof n}var ve="3.7.1",Be=/HTML$/i,u=function(n,o){return new u.fn.init(n,o)};u.fn=u.prototype={jquery:ve,constructor:u,length:0,toArray:function(){return f.call(this)},get:function(n){return n==null?f.call(this):n<0?this[n+this.length]:this[n]},pushStack:function(n){var o=u.merge(this.constructor(),n);return o.prevObject=this,o},each:function(n){return u.each(this,n)},map:function(n){return this.pushStack(u.map(this,function(o,a){return n.call(o,a,o)}))},slice:function(){return this.pushStack(f.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(u.grep(this,function(n,o){return(o+1)%2}))},odd:function(){return this.pushStack(u.grep(this,function(n,o){return o%2}))},eq:function(n){var o=this.length,a=+n+(n<0?o:0);return this.pushStack(a>=0&&a<o?[this[a]]:[])},end:function(){return this.prevObject||this.constructor()},push:p,sort:r.sort,splice:r.splice},u.extend=u.fn.extend=function(){var n,o,a,c,l,h,g=arguments[0]||{},k=1,b=arguments.length,_=!1;for(typeof g=="boolean"&&(_=g,g=arguments[k]||{},k++),typeof g!="object"&&!N(g)&&(g={}),k===b&&(g=this,k--);k<b;k++)if((n=arguments[k])!=null)for(o in n)c=n[o],!(o==="__proto__"||g===c)&&(_&&c&&(u.isPlainObject(c)||(l=Array.isArray(c)))?(a=g[o],l&&!Array.isArray(a)?h=[]:!l&&!u.isPlainObject(a)?h={}:h=a,l=!1,g[o]=u.extend(_,h,c)):c!==void 0&&(g[o]=c));return g},u.extend({expando:"jQuery"+(ve+Math.random()).replace(/\D/g,""),isReady:!0,error:function(n){throw new Error(n)},noop:function(){},isPlainObject:function(n){var o,a;return!n||x.call(n)!=="[object Object]"?!1:(o=s(n),o?(a=A.call(o,"constructor")&&o.constructor,typeof a=="function"&&E.call(a)===T):!0)},isEmptyObject:function(n){var o;for(o in n)return!1;return!0},globalEval:function(n,o,a){ee(n,{nonce:o&&o.nonce},a)},each:function(n,o){var a,c=0;if(J(n))for(a=n.length;c<a&&o.call(n[c],c,n[c])!==!1;c++);else for(c in n)if(o.call(n[c],c,n[c])===!1)break;return n},text:function(n){var o,a="",c=0,l=n.nodeType;if(!l)for(;o=n[c++];)a+=u.text(o);return l===1||l===11?n.textContent:l===9?n.documentElement.textContent:l===3||l===4?n.nodeValue:a},makeArray:function(n,o){var a=o||[];return n!=null&&(J(Object(n))?u.merge(a,typeof n=="string"?[n]:n):p.call(a,n)),a},inArray:function(n,o,a){return o==null?-1:y.call(o,n,a)},isXMLDoc:function(n){var o=n&&n.namespaceURI,a=n&&(n.ownerDocument||n).documentElement;return!Be.test(o||a&&a.nodeName||"HTML")},merge:function(n,o){for(var a=+o.length,c=0,l=n.length;c<a;c++)n[l++]=o[c];return n.length=l,n},grep:function(n,o,a){for(var c,l=[],h=0,g=n.length,k=!a;h<g;h++)c=!o(n[h],h),c!==k&&l.push(n[h]);return l},map:function(n,o,a){var c,l,h=0,g=[];if(J(n))for(c=n.length;h<c;h++)l=o(n[h],h,a),l!=null&&g.push(l);else for(h in n)l=o(n[h],h,a),l!=null&&g.push(l);return d(g)},guid:1,support:M}),typeof Symbol=="function"&&(u.fn[Symbol.iterator]=r[Symbol.iterator]),u.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(n,o){w["[object "+o+"]"]=o.toLowerCase()});function J(n){var o=!!n&&"length"in n&&n.length,a=pe(n);return N(n)||W(n)?!1:a==="array"||o===0||typeof o=="number"&&o>0&&o-1 in n}function P(n,o){return n.nodeName&&n.nodeName.toLowerCase()===o.toLowerCase()}var U=r.pop,he=r.sort,se=r.splice,B="[\\x20\\t\\r\\n\\f]",K=new RegExp("^"+B+"+|((?:^|[^\\\\])(?:\\\\.)*)"+B+"+$","g");u.contains=function(n,o){var a=o&&o.parentNode;return n===a||!!(a&&a.nodeType===1&&(n.contains?n.contains(a):n.compareDocumentPosition&&n.compareDocumentPosition(a)&16))};var I=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\x80-\uFFFF\w-]/g;function L(n,o){return o?n==="\0"?"ï¿½":n.slice(0,-1)+"\\"+n.charCodeAt(n.length-1).toString(16)+" ":"\\"+n}u.escapeSelector=function(n){return(n+"").replace(I,L)};var R=$,V=p;(function(){var n,o,a,c,l,h=V,g,k,b,_,H,F=u.expando,q=0,Q=0,me=Er(),Ie=Er(),xe=Er(),ze=Er(),je=function(m,S){return m===S&&(l=!0),0},vt="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",xt="(?:\\\\[\\da-fA-F]{1,6}"+B+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",Te="\\["+B+"*("+xt+")(?:"+B+"*([*^$|!~]?=)"+B+`*(?:'((?:\\\\.|[^\\\\'])*)'|"((?:\\\\.|[^\\\\"])*)"|(`+xt+"))|)"+B+"*\\]",nn=":("+xt+`)(?:\\((('((?:\\\\.|[^\\\\'])*)'|"((?:\\\\.|[^\\\\"])*)")|((?:\\\\.|[^\\\\()[\\]]|`+Te+")*)|.*)\\)|)",Me=new RegExp(B+"+","g"),Ue=new RegExp("^"+B+"*,"+B+"*"),zn=new RegExp("^"+B+"*([>+~]|"+B+")"+B+"*"),zi=new RegExp(B+"|>"),kt=new RegExp(nn),Vn=new RegExp("^"+xt+"$"),Et={ID:new RegExp("^#("+xt+")"),CLASS:new RegExp("^\\.("+xt+")"),TAG:new RegExp("^("+xt+"|[*])"),ATTR:new RegExp("^"+Te),PSEUDO:new RegExp("^"+nn),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+B+"*(even|odd|(([+-]|)(\\d*)n|)"+B+"*(?:([+-]|)"+B+"*(\\d+)|))"+B+"*\\)|)","i"),bool:new RegExp("^(?:"+vt+")$","i"),needsContext:new RegExp("^"+B+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+B+"*((?:-\\d)?\\d*)"+B+"*\\)|)(?=[^-]|$)","i")},Rt=/^(?:input|select|textarea|button)$/i,jt=/^h\d$/i,ct=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,Vi=/[+~]/,Mt=new RegExp("\\\\[\\da-fA-F]{1,6}"+B+"?|\\\\([^\\r\\n\\f])","g"),Bt=function(m,S){var O="0x"+m.slice(1)-65536;return S||(O<0?String.fromCharCode(O+65536):String.fromCharCode(O>>10|55296,O&1023|56320))},nl=function(){Ft()},rl=Tr(function(m){return m.disabled===!0&&P(m,"fieldset")},{dir:"parentNode",next:"legend"});function il(){try{return g.activeElement}catch{}}try{h.apply(r=f.call(R.childNodes),R.childNodes),r[R.childNodes.length].nodeType}catch{h={apply:function(S,O){V.apply(S,f.call(O))},call:function(S){V.apply(S,f.call(arguments,1))}}}function Oe(m,S,O,D){var j,X,re,ae,ie,Ee,ye,be=S&&S.ownerDocument,Ce=S?S.nodeType:9;if(O=O||[],typeof m!="string"||!m||Ce!==1&&Ce!==9&&Ce!==11)return O;if(!D&&(Ft(S),S=S||g,b)){if(Ce!==11&&(ie=ct.exec(m)))if(j=ie[1]){if(Ce===9)if(re=S.getElementById(j)){if(re.id===j)return h.call(O,re),O}else return O;else if(be&&(re=be.getElementById(j))&&Oe.contains(S,re)&&re.id===j)return h.call(O,re),O}else{if(ie[2])return h.apply(O,S.getElementsByTagName(m)),O;if((j=ie[3])&&S.getElementsByClassName)return h.apply(O,S.getElementsByClassName(j)),O}if(!ze[m+" "]&&(!_||!_.test(m))){if(ye=m,be=S,Ce===1&&(zi.test(m)||zn.test(m))){for(be=Vi.test(m)&&Qi(S.parentNode)||S,(be!=S||!M.scope)&&((ae=S.getAttribute("id"))?ae=u.escapeSelector(ae):S.setAttribute("id",ae=F)),Ee=Qn(m),X=Ee.length;X--;)Ee[X]=(ae?"#"+ae:":scope")+" "+Cr(Ee[X]);ye=Ee.join(",")}try{return h.apply(O,be.querySelectorAll(ye)),O}catch{ze(m,!0)}finally{ae===F&&S.removeAttribute("id")}}}return da(m.replace(K,"$1"),S,O,D)}function Er(){var m=[];function S(O,D){return m.push(O+" ")>o.cacheLength&&delete S[m.shift()],S[O+" "]=D}return S}function yt(m){return m[F]=!0,m}function An(m){var S=g.createElement("fieldset");try{return!!m(S)}catch{return!1}finally{S.parentNode&&S.parentNode.removeChild(S),S=null}}function ol(m){return function(S){return P(S,"input")&&S.type===m}}function sl(m){return function(S){return(P(S,"input")||P(S,"button"))&&S.type===m}}function la(m){return function(S){return"form"in S?S.parentNode&&S.disabled===!1?"label"in S?"label"in S.parentNode?S.parentNode.disabled===m:S.disabled===m:S.isDisabled===m||S.isDisabled!==!m&&rl(S)===m:S.disabled===m:"label"in S?S.disabled===m:!1}}function rn(m){return yt(function(S){return S=+S,yt(function(O,D){for(var j,X=m([],O.length,S),re=X.length;re--;)O[j=X[re]]&&(O[j]=!(D[j]=O[j]))})})}function Qi(m){return m&&typeof m.getElementsByTagName<"u"&&m}function Ft(m){var S,O=m?m.ownerDocument||m:R;return O==g||O.nodeType!==9||!O.documentElement||(g=O,k=g.documentElement,b=!u.isXMLDoc(g),H=k.matches||k.webkitMatchesSelector||k.msMatchesSelector,k.msMatchesSelector&&R!=g&&(S=g.defaultView)&&S.top!==S&&S.addEventListener("unload",nl),M.getById=An(function(D){return k.appendChild(D).id=u.expando,!g.getElementsByName||!g.getElementsByName(u.expando).length}),M.disconnectedMatch=An(function(D){return H.call(D,"*")}),M.scope=An(function(){return g.querySelectorAll(":scope")}),M.cssHas=An(function(){try{return g.querySelector(":has(*,:jqfake)"),!1}catch{return!0}}),M.getById?(o.filter.ID=function(D){var j=D.replace(Mt,Bt);return function(X){return X.getAttribute("id")===j}},o.find.ID=function(D,j){if(typeof j.getElementById<"u"&&b){var X=j.getElementById(D);return X?[X]:[]}}):(o.filter.ID=function(D){var j=D.replace(Mt,Bt);return function(X){var re=typeof X.getAttributeNode<"u"&&X.getAttributeNode("id");return re&&re.value===j}},o.find.ID=function(D,j){if(typeof j.getElementById<"u"&&b){var X,re,ae,ie=j.getElementById(D);if(ie){if(X=ie.getAttributeNode("id"),X&&X.value===D)return[ie];for(ae=j.getElementsByName(D),re=0;ie=ae[re++];)if(X=ie.getAttributeNode("id"),X&&X.value===D)return[ie]}return[]}}),o.find.TAG=function(D,j){return typeof j.getElementsByTagName<"u"?j.getElementsByTagName(D):j.querySelectorAll(D)},o.find.CLASS=function(D,j){if(typeof j.getElementsByClassName<"u"&&b)return j.getElementsByClassName(D)},_=[],An(function(D){var j;k.appendChild(D).innerHTML="<a id='"+F+"' href='' disabled='disabled'></a><select id='"+F+"-\r\\' disabled='disabled'><option selected=''></option></select>",D.querySelectorAll("[selected]").length||_.push("\\["+B+"*(?:value|"+vt+")"),D.querySelectorAll("[id~="+F+"-]").length||_.push("~="),D.querySelectorAll("a#"+F+"+*").length||_.push(".#.+[+~]"),D.querySelectorAll(":checked").length||_.push(":checked"),j=g.createElement("input"),j.setAttribute("type","hidden"),D.appendChild(j).setAttribute("name","D"),k.appendChild(D).disabled=!0,D.querySelectorAll(":disabled").length!==2&&_.push(":enabled",":disabled"),j=g.createElement("input"),j.setAttribute("name",""),D.appendChild(j),D.querySelectorAll("[name='']").length||_.push("\\["+B+"*name"+B+"*="+B+`*(?:''|"")`)}),M.cssHas||_.push(":has"),_=_.length&&new RegExp(_.join("|")),je=function(D,j){if(D===j)return l=!0,0;var X=!D.compareDocumentPosition-!j.compareDocumentPosition;return X||(X=(D.ownerDocument||D)==(j.ownerDocument||j)?D.compareDocumentPosition(j):1,X&1||!M.sortDetached&&j.compareDocumentPosition(D)===X?D===g||D.ownerDocument==R&&Oe.contains(R,D)?-1:j===g||j.ownerDocument==R&&Oe.contains(R,j)?1:c?y.call(c,D)-y.call(c,j):0:X&4?-1:1)}),g}Oe.matches=function(m,S){return Oe(m,null,null,S)},Oe.matchesSelector=function(m,S){if(Ft(m),b&&!ze[S+" "]&&(!_||!_.test(S)))try{var O=H.call(m,S);if(O||M.disconnectedMatch||m.document&&m.document.nodeType!==11)return O}catch{ze(S,!0)}return Oe(S,g,null,[m]).length>0},Oe.contains=function(m,S){return(m.ownerDocument||m)!=g&&Ft(m),u.contains(m,S)},Oe.attr=function(m,S){(m.ownerDocument||m)!=g&&Ft(m);var O=o.attrHandle[S.toLowerCase()],D=O&&A.call(o.attrHandle,S.toLowerCase())?O(m,S,!b):void 0;return D!==void 0?D:m.getAttribute(S)},Oe.error=function(m){throw new Error("Syntax error, unrecognized expression: "+m)},u.uniqueSort=function(m){var S,O=[],D=0,j=0;if(l=!M.sortStable,c=!M.sortStable&&f.call(m,0),he.call(m,je),l){for(;S=m[j++];)S===m[j]&&(D=O.push(j));for(;D--;)se.call(m,O[D],1)}return c=null,m},u.fn.uniqueSort=function(){return this.pushStack(u.uniqueSort(f.apply(this)))},o=u.expr={cacheLength:50,createPseudo:yt,match:Et,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(m){return m[1]=m[1].replace(Mt,Bt),m[3]=(m[3]||m[4]||m[5]||"").replace(Mt,Bt),m[2]==="~="&&(m[3]=" "+m[3]+" "),m.slice(0,4)},CHILD:function(m){return m[1]=m[1].toLowerCase(),m[1].slice(0,3)==="nth"?(m[3]||Oe.error(m[0]),m[4]=+(m[4]?m[5]+(m[6]||1):2*(m[3]==="even"||m[3]==="odd")),m[5]=+(m[7]+m[8]||m[3]==="odd")):m[3]&&Oe.error(m[0]),m},PSEUDO:function(m){var S,O=!m[6]&&m[2];return Et.CHILD.test(m[0])?null:(m[3]?m[2]=m[4]||m[5]||"":O&&kt.test(O)&&(S=Qn(O,!0))&&(S=O.indexOf(")",O.length-S)-O.length)&&(m[0]=m[0].slice(0,S),m[2]=O.slice(0,S)),m.slice(0,3))}},filter:{TAG:function(m){var S=m.replace(Mt,Bt).toLowerCase();return m==="*"?function(){return!0}:function(O){return P(O,S)}},CLASS:function(m){var S=me[m+" "];return S||(S=new RegExp("(^|"+B+")"+m+"("+B+"|$)"))&&me(m,function(O){return S.test(typeof O.className=="string"&&O.className||typeof O.getAttribute<"u"&&O.getAttribute("class")||"")})},ATTR:function(m,S,O){return function(D){var j=Oe.attr(D,m);return j==null?S==="!=":S?(j+="",S==="="?j===O:S==="!="?j!==O:S==="^="?O&&j.indexOf(O)===0:S==="*="?O&&j.indexOf(O)>-1:S==="$="?O&&j.slice(-O.length)===O:S==="~="?(" "+j.replace(Me," ")+" ").indexOf(O)>-1:S==="|="?j===O||j.slice(0,O.length+1)===O+"-":!1):!0}},CHILD:function(m,S,O,D,j){var X=m.slice(0,3)!=="nth",re=m.slice(-4)!=="last",ae=S==="of-type";return D===1&&j===0?function(ie){return!!ie.parentNode}:function(ie,Ee,ye){var be,Ce,de,Le,nt,Qe=X!==re?"nextSibling":"previousSibling",ft=ie.parentNode,Ct=ae&&ie.nodeName.toLowerCase(),_n=!ye&&!ae,Ze=!1;if(ft){if(X){for(;Qe;){for(de=ie;de=de[Qe];)if(ae?P(de,Ct):de.nodeType===1)return!1;nt=Qe=m==="only"&&!nt&&"nextSibling"}return!0}if(nt=[re?ft.firstChild:ft.lastChild],re&&_n){for(Ce=ft[F]||(ft[F]={}),be=Ce[m]||[],Le=be[0]===q&&be[1],Ze=Le&&be[2],de=Le&&ft.childNodes[Le];de=++Le&&de&&de[Qe]||(Ze=Le=0)||nt.pop();)if(de.nodeType===1&&++Ze&&de===ie){Ce[m]=[q,Le,Ze];break}}else if(_n&&(Ce=ie[F]||(ie[F]={}),be=Ce[m]||[],Le=be[0]===q&&be[1],Ze=Le),Ze===!1)for(;(de=++Le&&de&&de[Qe]||(Ze=Le=0)||nt.pop())&&!((ae?P(de,Ct):de.nodeType===1)&&++Ze&&(_n&&(Ce=de[F]||(de[F]={}),Ce[m]=[q,Ze]),de===ie)););return Ze-=j,Ze===D||Ze%D===0&&Ze/D>=0}}},PSEUDO:function(m,S){var O,D=o.pseudos[m]||o.setFilters[m.toLowerCase()]||Oe.error("unsupported pseudo: "+m);return D[F]?D(S):D.length>1?(O=[m,m,"",S],o.setFilters.hasOwnProperty(m.toLowerCase())?yt(function(j,X){for(var re,ae=D(j,S),ie=ae.length;ie--;)re=y.call(j,ae[ie]),j[re]=!(X[re]=ae[ie])}):function(j){return D(j,0,O)}):D}},pseudos:{not:yt(function(m){var S=[],O=[],D=Yi(m.replace(K,"$1"));return D[F]?yt(function(j,X,re,ae){for(var ie,Ee=D(j,null,ae,[]),ye=j.length;ye--;)(ie=Ee[ye])&&(j[ye]=!(X[ye]=ie))}):function(j,X,re){return S[0]=j,D(S,null,re,O),S[0]=null,!O.pop()}}),has:yt(function(m){return function(S){return Oe(m,S).length>0}}),contains:yt(function(m){return m=m.replace(Mt,Bt),function(S){return(S.textContent||u.text(S)).indexOf(m)>-1}}),lang:yt(function(m){return Vn.test(m||"")||Oe.error("unsupported lang: "+m),m=m.replace(Mt,Bt).toLowerCase(),function(S){var O;do if(O=b?S.lang:S.getAttribute("xml:lang")||S.getAttribute("lang"))return O=O.toLowerCase(),O===m||O.indexOf(m+"-")===0;while((S=S.parentNode)&&S.nodeType===1);return!1}}),target:function(m){var S=e.location&&e.location.hash;return S&&S.slice(1)===m.id},root:function(m){return m===k},focus:function(m){return m===il()&&g.hasFocus()&&!!(m.type||m.href||~m.tabIndex)},enabled:la(!1),disabled:la(!0),checked:function(m){return P(m,"input")&&!!m.checked||P(m,"option")&&!!m.selected},selected:function(m){return m.parentNode&&m.parentNode.selectedIndex,m.selected===!0},empty:function(m){for(m=m.firstChild;m;m=m.nextSibling)if(m.nodeType<6)return!1;return!0},parent:function(m){return!o.pseudos.empty(m)},header:function(m){return jt.test(m.nodeName)},input:function(m){return Rt.test(m.nodeName)},button:function(m){return P(m,"input")&&m.type==="button"||P(m,"button")},text:function(m){var S;return P(m,"input")&&m.type==="text"&&((S=m.getAttribute("type"))==null||S.toLowerCase()==="text")},first:rn(function(){return[0]}),last:rn(function(m,S){return[S-1]}),eq:rn(function(m,S,O){return[O<0?O+S:O]}),even:rn(function(m,S){for(var O=0;O<S;O+=2)m.push(O);return m}),odd:rn(function(m,S){for(var O=1;O<S;O+=2)m.push(O);return m}),lt:rn(function(m,S,O){var D;for(O<0?D=O+S:O>S?D=S:D=O;--D>=0;)m.push(D);return m}),gt:rn(function(m,S,O){for(var D=O<0?O+S:O;++D<S;)m.push(D);return m})}},o.pseudos.nth=o.pseudos.eq;for(n in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})o.pseudos[n]=ol(n);for(n in{submit:!0,reset:!0})o.pseudos[n]=sl(n);function ha(){}ha.prototype=o.filters=o.pseudos,o.setFilters=new ha;function Qn(m,S){var O,D,j,X,re,ae,ie,Ee=Ie[m+" "];if(Ee)return S?0:Ee.slice(0);for(re=m,ae=[],ie=o.preFilter;re;){(!O||(D=Ue.exec(re)))&&(D&&(re=re.slice(D[0].length)||re),ae.push(j=[])),O=!1,(D=zn.exec(re))&&(O=D.shift(),j.push({value:O,type:D[0].replace(K," ")}),re=re.slice(O.length));for(X in o.filter)(D=Et[X].exec(re))&&(!ie[X]||(D=ie[X](D)))&&(O=D.shift(),j.push({value:O,type:X,matches:D}),re=re.slice(O.length));if(!O)break}return S?re.length:re?Oe.error(m):Ie(m,ae).slice(0)}function Cr(m){for(var S=0,O=m.length,D="";S<O;S++)D+=m[S].value;return D}function Tr(m,S,O){var D=S.dir,j=S.next,X=j||D,re=O&&X==="parentNode",ae=Q++;return S.first?function(ie,Ee,ye){for(;ie=ie[D];)if(ie.nodeType===1||re)return m(ie,Ee,ye);return!1}:function(ie,Ee,ye){var be,Ce,de=[q,ae];if(ye){for(;ie=ie[D];)if((ie.nodeType===1||re)&&m(ie,Ee,ye))return!0}else for(;ie=ie[D];)if(ie.nodeType===1||re)if(Ce=ie[F]||(ie[F]={}),j&&P(ie,j))ie=ie[D]||ie;else{if((be=Ce[X])&&be[0]===q&&be[1]===ae)return de[2]=be[2];if(Ce[X]=de,de[2]=m(ie,Ee,ye))return!0}return!1}}function Gi(m){return m.length>1?function(S,O,D){for(var j=m.length;j--;)if(!m[j](S,O,D))return!1;return!0}:m[0]}function al(m,S,O){for(var D=0,j=S.length;D<j;D++)Oe(m,S[D],O);return O}function Sr(m,S,O,D,j){for(var X,re=[],ae=0,ie=m.length,Ee=S!=null;ae<ie;ae++)(X=m[ae])&&(!O||O(X,D,j))&&(re.push(X),Ee&&S.push(ae));return re}function Zi(m,S,O,D,j,X){return D&&!D[F]&&(D=Zi(D)),j&&!j[F]&&(j=Zi(j,X)),yt(function(re,ae,ie,Ee){var ye,be,Ce,de,Le=[],nt=[],Qe=ae.length,ft=re||al(S||"*",ie.nodeType?[ie]:ie,[]),Ct=m&&(re||!S)?Sr(ft,Le,m,ie,Ee):ft;if(O?(de=j||(re?m:Qe||D)?[]:ae,O(Ct,de,ie,Ee)):de=Ct,D)for(ye=Sr(de,nt),D(ye,[],ie,Ee),be=ye.length;be--;)(Ce=ye[be])&&(de[nt[be]]=!(Ct[nt[be]]=Ce));if(re){if(j||m){if(j){for(ye=[],be=de.length;be--;)(Ce=de[be])&&ye.push(Ct[be]=Ce);j(null,de=[],ye,Ee)}for(be=de.length;be--;)(Ce=de[be])&&(ye=j?y.call(re,Ce):Le[be])>-1&&(re[ye]=!(ae[ye]=Ce))}}else de=Sr(de===ae?de.splice(Qe,de.length):de),j?j(null,ae,de,Ee):h.apply(ae,de)})}function Xi(m){for(var S,O,D,j=m.length,X=o.relative[m[0].type],re=X||o.relative[" "],ae=X?1:0,ie=Tr(function(be){return be===S},re,!0),Ee=Tr(function(be){return y.call(S,be)>-1},re,!0),ye=[function(be,Ce,de){var Le=!X&&(de||Ce!=a)||((S=Ce).nodeType?ie(be,Ce,de):Ee(be,Ce,de));return S=null,Le}];ae<j;ae++)if(O=o.relative[m[ae].type])ye=[Tr(Gi(ye),O)];else{if(O=o.filter[m[ae].type].apply(null,m[ae].matches),O[F]){for(D=++ae;D<j&&!o.relative[m[D].type];D++);return Zi(ae>1&&Gi(ye),ae>1&&Cr(m.slice(0,ae-1).concat({value:m[ae-2].type===" "?"*":""})).replace(K,"$1"),O,ae<D&&Xi(m.slice(ae,D)),D<j&&Xi(m=m.slice(D)),D<j&&Cr(m))}ye.push(O)}return Gi(ye)}function ul(m,S){var O=S.length>0,D=m.length>0,j=function(X,re,ae,ie,Ee){var ye,be,Ce,de=0,Le="0",nt=X&&[],Qe=[],ft=a,Ct=X||D&&o.find.TAG("*",Ee),_n=q+=ft==null?1:Math.random()||.1,Ze=Ct.length;for(Ee&&(a=re==g||re||Ee);Le!==Ze&&(ye=Ct[Le])!=null;Le++){if(D&&ye){for(be=0,!re&&ye.ownerDocument!=g&&(Ft(ye),ae=!b);Ce=m[be++];)if(Ce(ye,re||g,ae)){h.call(ie,ye);break}Ee&&(q=_n)}O&&((ye=!Ce&&ye)&&de--,X&&nt.push(ye))}if(de+=Le,O&&Le!==de){for(be=0;Ce=S[be++];)Ce(nt,Qe,re,ae);if(X){if(de>0)for(;Le--;)nt[Le]||Qe[Le]||(Qe[Le]=U.call(ie));Qe=Sr(Qe)}h.apply(ie,Qe),Ee&&!X&&Qe.length>0&&de+S.length>1&&u.uniqueSort(ie)}return Ee&&(q=_n,a=ft),nt};return O?yt(j):j}function Yi(m,S){var O,D=[],j=[],X=xe[m+" "];if(!X){for(S||(S=Qn(m)),O=S.length;O--;)X=Xi(S[O]),X[F]?D.push(X):j.push(X);X=xe(m,ul(j,D)),X.selector=m}return X}function da(m,S,O,D){var j,X,re,ae,ie,Ee=typeof m=="function"&&m,ye=!D&&Qn(m=Ee.selector||m);if(O=O||[],ye.length===1){if(X=ye[0]=ye[0].slice(0),X.length>2&&(re=X[0]).type==="ID"&&S.nodeType===9&&b&&o.relative[X[1].type]){if(S=(o.find.ID(re.matches[0].replace(Mt,Bt),S)||[])[0],S)Ee&&(S=S.parentNode);else return O;m=m.slice(X.shift().value.length)}for(j=Et.needsContext.test(m)?0:X.length;j--&&(re=X[j],!o.relative[ae=re.type]);)if((ie=o.find[ae])&&(D=ie(re.matches[0].replace(Mt,Bt),Vi.test(X[0].type)&&Qi(S.parentNode)||S))){if(X.splice(j,1),m=D.length&&Cr(X),!m)return h.apply(O,D),O;break}}return(Ee||Yi(m,ye))(D,S,!b,O,!S||Vi.test(m)&&Qi(S.parentNode)||S),O}M.sortStable=F.split("").sort(je).join("")===F,Ft(),M.sortDetached=An(function(m){return m.compareDocumentPosition(g.createElement("fieldset"))&1}),u.find=Oe,u.expr[":"]=u.expr.pseudos,u.unique=u.uniqueSort,Oe.compile=Yi,Oe.select=da,Oe.setDocument=Ft,Oe.tokenize=Qn,Oe.escape=u.escapeSelector,Oe.getText=u.text,Oe.isXML=u.isXMLDoc,Oe.selectors=u.expr,Oe.support=u.support,Oe.uniqueSort=u.uniqueSort})();var G=function(n,o,a){for(var c=[],l=a!==void 0;(n=n[o])&&n.nodeType!==9;)if(n.nodeType===1){if(l&&u(n).is(a))break;c.push(n)}return c},C=function(n,o){for(var a=[];n;n=n.nextSibling)n.nodeType===1&&n!==o&&a.push(n);return a},v=u.expr.match.needsContext,z=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function Z(n,o,a){return N(o)?u.grep(n,function(c,l){return!!o.call(c,l,c)!==a}):o.nodeType?u.grep(n,function(c){return c===o!==a}):typeof o!="string"?u.grep(n,function(c){return y.call(o,c)>-1!==a}):u.filter(o,n,a)}u.filter=function(n,o,a){var c=o[0];return a&&(n=":not("+n+")"),o.length===1&&c.nodeType===1?u.find.matchesSelector(c,n)?[c]:[]:u.find.matches(n,u.grep(o,function(l){return l.nodeType===1}))},u.fn.extend({find:function(n){var o,a,c=this.length,l=this;if(typeof n!="string")return this.pushStack(u(n).filter(function(){for(o=0;o<c;o++)if(u.contains(l[o],this))return!0}));for(a=this.pushStack([]),o=0;o<c;o++)u.find(n,l[o],a);return c>1?u.uniqueSort(a):a},filter:function(n){return this.pushStack(Z(this,n||[],!1))},not:function(n){return this.pushStack(Z(this,n||[],!0))},is:function(n){return!!Z(this,typeof n=="string"&&v.test(n)?u(n):n||[],!1).length}});var te,Y=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/,oe=u.fn.init=function(n,o,a){var c,l;if(!n)return this;if(a=a||te,typeof n=="string")if(n[0]==="<"&&n[n.length-1]===">"&&n.length>=3?c=[null,n,null]:c=Y.exec(n),c&&(c[1]||!o))if(c[1]){if(o=o instanceof u?o[0]:o,u.merge(this,u.parseHTML(c[1],o&&o.nodeType?o.ownerDocument||o:$,!0)),z.test(c[1])&&u.isPlainObject(o))for(c in o)N(this[c])?this[c](o[c]):this.attr(c,o[c]);return this}else return l=$.getElementById(c[2]),l&&(this[0]=l,this.length=1),this;else return!o||o.jquery?(o||a).find(n):this.constructor(o).find(n);else{if(n.nodeType)return this[0]=n,this.length=1,this;if(N(n))return a.ready!==void 0?a.ready(n):n(u)}return u.makeArray(n,this)};oe.prototype=u.fn,te=u($);var ne=/^(?:parents|prev(?:Until|All))/,fe={children:!0,contents:!0,next:!0,prev:!0};u.fn.extend({has:function(n){var o=u(n,this),a=o.length;return this.filter(function(){for(var c=0;c<a;c++)if(u.contains(this,o[c]))return!0})},closest:function(n,o){var a,c=0,l=this.length,h=[],g=typeof n!="string"&&u(n);if(!v.test(n)){for(;c<l;c++)for(a=this[c];a&&a!==o;a=a.parentNode)if(a.nodeType<11&&(g?g.index(a)>-1:a.nodeType===1&&u.find.matchesSelector(a,n))){h.push(a);break}}return this.pushStack(h.length>1?u.uniqueSort(h):h)},index:function(n){return n?typeof n=="string"?y.call(u(n),this[0]):y.call(this,n.jquery?n[0]:n):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(n,o){return this.pushStack(u.uniqueSort(u.merge(this.get(),u(n,o))))},addBack:function(n){return this.add(n==null?this.prevObject:this.prevObject.filter(n))}});function ce(n,o){for(;(n=n[o])&&n.nodeType!==1;);return n}u.each({parent:function(n){var o=n.parentNode;return o&&o.nodeType!==11?o:null},parents:function(n){return G(n,"parentNode")},parentsUntil:function(n,o,a){return G(n,"parentNode",a)},next:function(n){return ce(n,"nextSibling")},prev:function(n){return ce(n,"previousSibling")},nextAll:function(n){return G(n,"nextSibling")},prevAll:function(n){return G(n,"previousSibling")},nextUntil:function(n,o,a){return G(n,"nextSibling",a)},prevUntil:function(n,o,a){return G(n,"previousSibling",a)},siblings:function(n){return C((n.parentNode||{}).firstChild,n)},children:function(n){return C(n.firstChild)},contents:function(n){return n.contentDocument!=null&&s(n.contentDocument)?n.contentDocument:(P(n,"template")&&(n=n.content||n),u.merge([],n.childNodes))}},function(n,o){u.fn[n]=function(a,c){var l=u.map(this,o,a);return n.slice(-5)!=="Until"&&(c=a),c&&typeof c=="string"&&(l=u.filter(c,l)),this.length>1&&(fe[n]||u.uniqueSort(l),ne.test(n)&&l.reverse()),this.pushStack(l)}});var le=/[^\x20\t\r\n\f]+/g;function Ae(n){var o={};return u.each(n.match(le)||[],function(a,c){o[c]=!0}),o}u.Callbacks=function(n){n=typeof n=="string"?Ae(n):u.extend({},n);var o,a,c,l,h=[],g=[],k=-1,b=function(){for(l=l||n.once,c=o=!0;g.length;k=-1)for(a=g.shift();++k<h.length;)h[k].apply(a[0],a[1])===!1&&n.stopOnFalse&&(k=h.length,a=!1);n.memory||(a=!1),o=!1,l&&(a?h=[]:h="")},_={add:function(){return h&&(a&&!o&&(k=h.length-1,g.push(a)),(function H(F){u.each(F,function(q,Q){N(Q)?(!n.unique||!_.has(Q))&&h.push(Q):Q&&Q.length&&pe(Q)!=="string"&&H(Q)})})(arguments),a&&!o&&b()),this},remove:function(){return u.each(arguments,function(H,F){for(var q;(q=u.inArray(F,h,q))>-1;)h.splice(q,1),q<=k&&k--}),this},has:function(H){return H?u.inArray(H,h)>-1:h.length>0},empty:function(){return h&&(h=[]),this},disable:function(){return l=g=[],h=a="",this},disabled:function(){return!h},lock:function(){return l=g=[],!a&&!o&&(h=a=""),this},locked:function(){return!!l},fireWith:function(H,F){return l||(F=F||[],F=[H,F.slice?F.slice():F],g.push(F),o||b()),this},fire:function(){return _.fireWith(this,arguments),this},fired:function(){return!!c}};return _};function _e(n){return n}function Pe(n){throw n}function ke(n,o,a,c){var l;try{n&&N(l=n.promise)?l.call(n).done(o).fail(a):n&&N(l=n.then)?l.call(n,o,a):o.apply(void 0,[n].slice(c))}catch(h){a.apply(void 0,[h])}}u.extend({Deferred:function(n){var o=[["notify","progress",u.Callbacks("memory"),u.Callbacks("memory"),2],["resolve","done",u.Callbacks("once memory"),u.Callbacks("once memory"),0,"resolved"],["reject","fail",u.Callbacks("once memory"),u.Callbacks("once memory"),1,"rejected"]],a="pending",c={state:function(){return a},always:function(){return l.done(arguments).fail(arguments),this},catch:function(h){return c.then(null,h)},pipe:function(){var h=arguments;return u.Deferred(function(g){u.each(o,function(k,b){var _=N(h[b[4]])&&h[b[4]];l[b[1]](function(){var H=_&&_.apply(this,arguments);H&&N(H.promise)?H.promise().progress(g.notify).done(g.resolve).fail(g.reject):g[b[0]+"With"](this,_?[H]:arguments)})}),h=null}).promise()},then:function(h,g,k){var b=0;function _(H,F,q,Q){return function(){var me=this,Ie=arguments,xe=function(){var je,vt;if(!(H<b)){if(je=q.apply(me,Ie),je===F.promise())throw new TypeError("Thenable self-resolution");vt=je&&(typeof je=="object"||typeof je=="function")&&je.then,N(vt)?Q?vt.call(je,_(b,F,_e,Q),_(b,F,Pe,Q)):(b++,vt.call(je,_(b,F,_e,Q),_(b,F,Pe,Q),_(b,F,_e,F.notifyWith))):(q!==_e&&(me=void 0,Ie=[je]),(Q||F.resolveWith)(me,Ie))}},ze=Q?xe:function(){try{xe()}catch(je){u.Deferred.exceptionHook&&u.Deferred.exceptionHook(je,ze.error),H+1>=b&&(q!==Pe&&(me=void 0,Ie=[je]),F.rejectWith(me,Ie))}};H?ze():(u.Deferred.getErrorHook?ze.error=u.Deferred.getErrorHook():u.Deferred.getStackHook&&(ze.error=u.Deferred.getStackHook()),e.setTimeout(ze))}}return u.Deferred(function(H){o[0][3].add(_(0,H,N(k)?k:_e,H.notifyWith)),o[1][3].add(_(0,H,N(h)?h:_e)),o[2][3].add(_(0,H,N(g)?g:Pe))}).promise()},promise:function(h){return h!=null?u.extend(h,c):c}},l={};return u.each(o,function(h,g){var k=g[2],b=g[5];c[g[1]]=k.add,b&&k.add(function(){a=b},o[3-h][2].disable,o[3-h][3].disable,o[0][2].lock,o[0][3].lock),k.add(g[3].fire),l[g[0]]=function(){return l[g[0]+"With"](this===l?void 0:this,arguments),this},l[g[0]+"With"]=k.fireWith}),c.promise(l),n&&n.call(l,l),l},when:function(n){var o=arguments.length,a=o,c=Array(a),l=f.call(arguments),h=u.Deferred(),g=function(k){return function(b){c[k]=this,l[k]=arguments.length>1?f.call(arguments):b,--o||h.resolveWith(c,l)}};if(o<=1&&(ke(n,h.done(g(a)).resolve,h.reject,!o),h.state()==="pending"||N(l[a]&&l[a].then)))return h.then();for(;a--;)ke(l[a],g(a),h.reject);return h.promise()}});var Ke=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;u.Deferred.exceptionHook=function(n,o){e.console&&e.console.warn&&n&&Ke.test(n.name)&&e.console.warn("jQuery.Deferred exception: "+n.message,n.stack,o)},u.readyException=function(n){e.setTimeout(function(){throw n})};var $e=u.Deferred();u.fn.ready=function(n){return $e.then(n).catch(function(o){u.readyException(o)}),this},u.extend({isReady:!1,readyWait:1,ready:function(n){(n===!0?--u.readyWait:u.isReady)||(u.isReady=!0,!(n!==!0&&--u.readyWait>0)&&$e.resolveWith($,[u]))}}),u.ready.then=$e.then;function ge(){$.removeEventListener("DOMContentLoaded",ge),e.removeEventListener("load",ge),u.ready()}$.readyState==="complete"||$.readyState!=="loading"&&!$.documentElement.doScroll?e.setTimeout(u.ready):($.addEventListener("DOMContentLoaded",ge),e.addEventListener("load",ge));var He=function(n,o,a,c,l,h,g){var k=0,b=n.length,_=a==null;if(pe(a)==="object"){l=!0;for(k in a)He(n,o,k,a[k],!0,h,g)}else if(c!==void 0&&(l=!0,N(c)||(g=!0),_&&(g?(o.call(n,c),o=null):(_=o,o=function(H,F,q){return _.call(u(H),q)})),o))for(;k<b;k++)o(n[k],a,g?c:c.call(n[k],k,o(n[k],a)));return l?n:_?o.call(n):b?o(n[0],a):h},dt=/^-ms-/,Je=/-([a-z])/g;function Ii(n,o){return o.toUpperCase()}function at(n){return n.replace(dt,"ms-").replace(Je,Ii)}var Xt=function(n){return n.nodeType===1||n.nodeType===9||!+n.nodeType};function Ut(){this.expando=u.expando+Ut.uid++}Ut.uid=1,Ut.prototype={cache:function(n){var o=n[this.expando];return o||(o={},Xt(n)&&(n.nodeType?n[this.expando]=o:Object.defineProperty(n,this.expando,{value:o,configurable:!0}))),o},set:function(n,o,a){var c,l=this.cache(n);if(typeof o=="string")l[at(o)]=a;else for(c in o)l[at(c)]=o[c];return l},get:function(n,o){return o===void 0?this.cache(n):n[this.expando]&&n[this.expando][at(o)]},access:function(n,o,a){return o===void 0||o&&typeof o=="string"&&a===void 0?this.get(n,o):(this.set(n,o,a),a!==void 0?a:o)},remove:function(n,o){var a,c=n[this.expando];if(c!==void 0){if(o!==void 0)for(Array.isArray(o)?o=o.map(at):(o=at(o),o=o in c?[o]:o.match(le)||[]),a=o.length;a--;)delete c[o[a]];(o===void 0||u.isEmptyObject(c))&&(n.nodeType?n[this.expando]=void 0:delete n[this.expando])}},hasData:function(n){var o=n[this.expando];return o!==void 0&&!u.isEmptyObject(o)}};var ue=new Ut,We=new Ut,Mi=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Bi=/[A-Z]/g;function mr(n){return n==="true"?!0:n==="false"?!1:n==="null"?null:n===+n+""?+n:Mi.test(n)?JSON.parse(n):n}function Rn(n,o,a){var c;if(a===void 0&&n.nodeType===1)if(c="data-"+o.replace(Bi,"-$&").toLowerCase(),a=n.getAttribute(c),typeof a=="string"){try{a=mr(a)}catch{}We.set(n,o,a)}else a=void 0;return a}u.extend({hasData:function(n){return We.hasData(n)||ue.hasData(n)},data:function(n,o,a){return We.access(n,o,a)},removeData:function(n,o){We.remove(n,o)},_data:function(n,o,a){return ue.access(n,o,a)},_removeData:function(n,o){ue.remove(n,o)}}),u.fn.extend({data:function(n,o){var a,c,l,h=this[0],g=h&&h.attributes;if(n===void 0){if(this.length&&(l=We.get(h),h.nodeType===1&&!ue.get(h,"hasDataAttrs"))){for(a=g.length;a--;)g[a]&&(c=g[a].name,c.indexOf("data-")===0&&(c=at(c.slice(5)),Rn(h,c,l[c])));ue.set(h,"hasDataAttrs",!0)}return l}return typeof n=="object"?this.each(function(){We.set(this,n)}):He(this,function(k){var b;if(h&&k===void 0)return b=We.get(h,n),b!==void 0||(b=Rn(h,n),b!==void 0)?b:void 0;this.each(function(){We.set(this,n,k)})},null,o,arguments.length>1,null,!0)},removeData:function(n){return this.each(function(){We.remove(this,n)})}}),u.extend({queue:function(n,o,a){var c;if(n)return o=(o||"fx")+"queue",c=ue.get(n,o),a&&(!c||Array.isArray(a)?c=ue.access(n,o,u.makeArray(a)):c.push(a)),c||[]},dequeue:function(n,o){o=o||"fx";var a=u.queue(n,o),c=a.length,l=a.shift(),h=u._queueHooks(n,o),g=function(){u.dequeue(n,o)};l==="inprogress"&&(l=a.shift(),c--),l&&(o==="fx"&&a.unshift("inprogress"),delete h.stop,l.call(n,g,h)),!c&&h&&h.empty.fire()},_queueHooks:function(n,o){var a=o+"queueHooks";return ue.get(n,a)||ue.access(n,a,{empty:u.Callbacks("once memory").add(function(){ue.remove(n,[o+"queue",a])})})}}),u.fn.extend({queue:function(n,o){var a=2;return typeof n!="string"&&(o=n,n="fx",a--),arguments.length<a?u.queue(this[0],n):o===void 0?this:this.each(function(){var c=u.queue(this,n,o);u._queueHooks(this,n),n==="fx"&&c[0]!=="inprogress"&&u.dequeue(this,n)})},dequeue:function(n){return this.each(function(){u.dequeue(this,n)})},clearQueue:function(n){return this.queue(n||"fx",[])},promise:function(n,o){var a,c=1,l=u.Deferred(),h=this,g=this.length,k=function(){--c||l.resolveWith(h,[h])};for(typeof n!="string"&&(o=n,n=void 0),n=n||"fx";g--;)a=ue.get(h[g],n+"queueHooks"),a&&a.empty&&(c++,a.empty.add(k));return k(),l.promise(o)}});var vn=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,Yt=new RegExp("^(?:([+-])=|)("+vn+")([a-z%]*)$","i"),pt=["Top","Right","Bottom","Left"],Jt=$.documentElement,xn=function(n){return u.contains(n.ownerDocument,n)},vf={composed:!0};Jt.getRootNode&&(xn=function(n){return u.contains(n.ownerDocument,n)||n.getRootNode(vf)===n.ownerDocument});var wr=function(n,o){return n=o||n,n.style.display==="none"||n.style.display===""&&xn(n)&&u.css(n,"display")==="none"};function Ds(n,o,a,c){var l,h,g=20,k=c?function(){return c.cur()}:function(){return u.css(n,o,"")},b=k(),_=a&&a[3]||(u.cssNumber[o]?"":"px"),H=n.nodeType&&(u.cssNumber[o]||_!=="px"&&+b)&&Yt.exec(u.css(n,o));if(H&&H[3]!==_){for(b=b/2,_=_||H[3],H=+b||1;g--;)u.style(n,o,H+_),(1-h)*(1-(h=k()/b||.5))<=0&&(g=0),H=H/h;H=H*2,u.style(n,o,H+_),a=a||[]}return a&&(H=+H||+b||0,l=a[1]?H+(a[1]+1)*a[2]:+a[2],c&&(c.unit=_,c.start=H,c.end=l)),l}var Ls={};function xf(n){var o,a=n.ownerDocument,c=n.nodeName,l=Ls[c];return l||(o=a.body.appendChild(a.createElement(c)),l=u.css(o,"display"),o.parentNode.removeChild(o),l==="none"&&(l="block"),Ls[c]=l,l)}function kn(n,o){for(var a,c,l=[],h=0,g=n.length;h<g;h++)c=n[h],c.style&&(a=c.style.display,o?(a==="none"&&(l[h]=ue.get(c,"display")||null,l[h]||(c.style.display="")),c.style.display===""&&wr(c)&&(l[h]=xf(c))):a!=="none"&&(l[h]="none",ue.set(c,"display",a)));for(h=0;h<g;h++)l[h]!=null&&(n[h].style.display=l[h]);return n}u.fn.extend({show:function(){return kn(this,!0)},hide:function(){return kn(this)},toggle:function(n){return typeof n=="boolean"?n?this.show():this.hide():this.each(function(){wr(this)?u(this).show():u(this).hide()})}});var jn=/^(?:checkbox|radio)$/i,Hs=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,Us=/^$|^module$|\/(?:java|ecma)script/i;(function(){var n=$.createDocumentFragment(),o=n.appendChild($.createElement("div")),a=$.createElement("input");a.setAttribute("type","radio"),a.setAttribute("checked","checked"),a.setAttribute("name","t"),o.appendChild(a),M.checkClone=o.cloneNode(!0).cloneNode(!0).lastChild.checked,o.innerHTML="<textarea>x</textarea>",M.noCloneChecked=!!o.cloneNode(!0).lastChild.defaultValue,o.innerHTML="<option></option>",M.option=!!o.lastChild})();var ut={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};ut.tbody=ut.tfoot=ut.colgroup=ut.caption=ut.thead,ut.th=ut.td,M.option||(ut.optgroup=ut.option=[1,"<select multiple='multiple'>","</select>"]);function et(n,o){var a;return typeof n.getElementsByTagName<"u"?a=n.getElementsByTagName(o||"*"):typeof n.querySelectorAll<"u"?a=n.querySelectorAll(o||"*"):a=[],o===void 0||o&&P(n,o)?u.merge([n],a):a}function Pi(n,o){for(var a=0,c=n.length;a<c;a++)ue.set(n[a],"globalEval",!o||ue.get(o[a],"globalEval"))}var kf=/<|&#?\w+;/;function Rs(n,o,a,c,l){for(var h,g,k,b,_,H,F=o.createDocumentFragment(),q=[],Q=0,me=n.length;Q<me;Q++)if(h=n[Q],h||h===0)if(pe(h)==="object")u.merge(q,h.nodeType?[h]:h);else if(!kf.test(h))q.push(o.createTextNode(h));else{for(g=g||F.appendChild(o.createElement("div")),k=(Hs.exec(h)||["",""])[1].toLowerCase(),b=ut[k]||ut._default,g.innerHTML=b[1]+u.htmlPrefilter(h)+b[2],H=b[0];H--;)g=g.lastChild;u.merge(q,g.childNodes),g=F.firstChild,g.textContent=""}for(F.textContent="",Q=0;h=q[Q++];){if(c&&u.inArray(h,c)>-1){l&&l.push(h);continue}if(_=xn(h),g=et(F.appendChild(h),"script"),_&&Pi(g),a)for(H=0;h=g[H++];)Us.test(h.type||"")&&a.push(h)}return F}var js=/^([^.]*)(?:\.(.+)|)/;function En(){return!0}function Cn(){return!1}function Oi(n,o,a,c,l,h){var g,k;if(typeof o=="object"){typeof a!="string"&&(c=c||a,a=void 0);for(k in o)Oi(n,k,a,c,o[k],h);return n}if(c==null&&l==null?(l=a,c=a=void 0):l==null&&(typeof a=="string"?(l=c,c=void 0):(l=c,c=a,a=void 0)),l===!1)l=Cn;else if(!l)return n;return h===1&&(g=l,l=function(b){return u().off(b),g.apply(this,arguments)},l.guid=g.guid||(g.guid=u.guid++)),n.each(function(){u.event.add(this,o,l,c,a)})}u.event={global:{},add:function(n,o,a,c,l){var h,g,k,b,_,H,F,q,Q,me,Ie,xe=ue.get(n);if(Xt(n))for(a.handler&&(h=a,a=h.handler,l=h.selector),l&&u.find.matchesSelector(Jt,l),a.guid||(a.guid=u.guid++),(b=xe.events)||(b=xe.events=Object.create(null)),(g=xe.handle)||(g=xe.handle=function(ze){return typeof u<"u"&&u.event.triggered!==ze.type?u.event.dispatch.apply(n,arguments):void 0}),o=(o||"").match(le)||[""],_=o.length;_--;)k=js.exec(o[_])||[],Q=Ie=k[1],me=(k[2]||"").split(".").sort(),Q&&(F=u.event.special[Q]||{},Q=(l?F.delegateType:F.bindType)||Q,F=u.event.special[Q]||{},H=u.extend({type:Q,origType:Ie,data:c,handler:a,guid:a.guid,selector:l,needsContext:l&&u.expr.match.needsContext.test(l),namespace:me.join(".")},h),(q=b[Q])||(q=b[Q]=[],q.delegateCount=0,(!F.setup||F.setup.call(n,c,me,g)===!1)&&n.addEventListener&&n.addEventListener(Q,g)),F.add&&(F.add.call(n,H),H.handler.guid||(H.handler.guid=a.guid)),l?q.splice(q.delegateCount++,0,H):q.push(H),u.event.global[Q]=!0)},remove:function(n,o,a,c,l){var h,g,k,b,_,H,F,q,Q,me,Ie,xe=ue.hasData(n)&&ue.get(n);if(!(!xe||!(b=xe.events))){for(o=(o||"").match(le)||[""],_=o.length;_--;){if(k=js.exec(o[_])||[],Q=Ie=k[1],me=(k[2]||"").split(".").sort(),!Q){for(Q in b)u.event.remove(n,Q+o[_],a,c,!0);continue}for(F=u.event.special[Q]||{},Q=(c?F.delegateType:F.bindType)||Q,q=b[Q]||[],k=k[2]&&new RegExp("(^|\\.)"+me.join("\\.(?:.*\\.|)")+"(\\.|$)"),g=h=q.length;h--;)H=q[h],(l||Ie===H.origType)&&(!a||a.guid===H.guid)&&(!k||k.test(H.namespace))&&(!c||c===H.selector||c==="**"&&H.selector)&&(q.splice(h,1),H.selector&&q.delegateCount--,F.remove&&F.remove.call(n,H));g&&!q.length&&((!F.teardown||F.teardown.call(n,me,xe.handle)===!1)&&u.removeEvent(n,Q,xe.handle),delete b[Q])}u.isEmptyObject(b)&&ue.remove(n,"handle events")}},dispatch:function(n){var o,a,c,l,h,g,k=new Array(arguments.length),b=u.event.fix(n),_=(ue.get(this,"events")||Object.create(null))[b.type]||[],H=u.event.special[b.type]||{};for(k[0]=b,o=1;o<arguments.length;o++)k[o]=arguments[o];if(b.delegateTarget=this,!(H.preDispatch&&H.preDispatch.call(this,b)===!1)){for(g=u.event.handlers.call(this,b,_),o=0;(l=g[o++])&&!b.isPropagationStopped();)for(b.currentTarget=l.elem,a=0;(h=l.handlers[a++])&&!b.isImmediatePropagationStopped();)(!b.rnamespace||h.namespace===!1||b.rnamespace.test(h.namespace))&&(b.handleObj=h,b.data=h.data,c=((u.event.special[h.origType]||{}).handle||h.handler).apply(l.elem,k),c!==void 0&&(b.result=c)===!1&&(b.preventDefault(),b.stopPropagation()));return H.postDispatch&&H.postDispatch.call(this,b),b.result}},handlers:function(n,o){var a,c,l,h,g,k=[],b=o.delegateCount,_=n.target;if(b&&_.nodeType&&!(n.type==="click"&&n.button>=1)){for(;_!==this;_=_.parentNode||this)if(_.nodeType===1&&!(n.type==="click"&&_.disabled===!0)){for(h=[],g={},a=0;a<b;a++)c=o[a],l=c.selector+" ",g[l]===void 0&&(g[l]=c.needsContext?u(l,this).index(_)>-1:u.find(l,this,null,[_]).length),g[l]&&h.push(c);h.length&&k.push({elem:_,handlers:h})}}return _=this,b<o.length&&k.push({elem:_,handlers:o.slice(b)}),k},addProp:function(n,o){Object.defineProperty(u.Event.prototype,n,{enumerable:!0,configurable:!0,get:N(o)?function(){if(this.originalEvent)return o(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[n]},set:function(a){Object.defineProperty(this,n,{enumerable:!0,configurable:!0,writable:!0,value:a})}})},fix:function(n){return n[u.expando]?n:new u.Event(n)},special:{load:{noBubble:!0},click:{setup:function(n){var o=this||n;return jn.test(o.type)&&o.click&&P(o,"input")&&br(o,"click",!0),!1},trigger:function(n){var o=this||n;return jn.test(o.type)&&o.click&&P(o,"input")&&br(o,"click"),!0},_default:function(n){var o=n.target;return jn.test(o.type)&&o.click&&P(o,"input")&&ue.get(o,"click")||P(o,"a")}},beforeunload:{postDispatch:function(n){n.result!==void 0&&n.originalEvent&&(n.originalEvent.returnValue=n.result)}}}};function br(n,o,a){if(!a){ue.get(n,o)===void 0&&u.event.add(n,o,En);return}ue.set(n,o,!1),u.event.add(n,o,{namespace:!1,handler:function(c){var l,h=ue.get(this,o);if(c.isTrigger&1&&this[o]){if(h)(u.event.special[o]||{}).delegateType&&c.stopPropagation();else if(h=f.call(arguments),ue.set(this,o,h),this[o](),l=ue.get(this,o),ue.set(this,o,!1),h!==l)return c.stopImmediatePropagation(),c.preventDefault(),l}else h&&(ue.set(this,o,u.event.trigger(h[0],h.slice(1),this)),c.stopPropagation(),c.isImmediatePropagationStopped=En)}})}u.removeEvent=function(n,o,a){n.removeEventListener&&n.removeEventListener(o,a)},u.Event=function(n,o){if(!(this instanceof u.Event))return new u.Event(n,o);n&&n.type?(this.originalEvent=n,this.type=n.type,this.isDefaultPrevented=n.defaultPrevented||n.defaultPrevented===void 0&&n.returnValue===!1?En:Cn,this.target=n.target&&n.target.nodeType===3?n.target.parentNode:n.target,this.currentTarget=n.currentTarget,this.relatedTarget=n.relatedTarget):this.type=n,o&&u.extend(this,o),this.timeStamp=n&&n.timeStamp||Date.now(),this[u.expando]=!0},u.Event.prototype={constructor:u.Event,isDefaultPrevented:Cn,isPropagationStopped:Cn,isImmediatePropagationStopped:Cn,isSimulated:!1,preventDefault:function(){var n=this.originalEvent;this.isDefaultPrevented=En,n&&!this.isSimulated&&n.preventDefault()},stopPropagation:function(){var n=this.originalEvent;this.isPropagationStopped=En,n&&!this.isSimulated&&n.stopPropagation()},stopImmediatePropagation:function(){var n=this.originalEvent;this.isImmediatePropagationStopped=En,n&&!this.isSimulated&&n.stopImmediatePropagation(),this.stopPropagation()}},u.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},u.event.addProp),u.each({focus:"focusin",blur:"focusout"},function(n,o){function a(c){if($.documentMode){var l=ue.get(this,"handle"),h=u.event.fix(c);h.type=c.type==="focusin"?"focus":"blur",h.isSimulated=!0,l(c),h.target===h.currentTarget&&l(h)}else u.event.simulate(o,c.target,u.event.fix(c))}u.event.special[n]={setup:function(){var c;if(br(this,n,!0),$.documentMode)c=ue.get(this,o),c||this.addEventListener(o,a),ue.set(this,o,(c||0)+1);else return!1},trigger:function(){return br(this,n),!0},teardown:function(){var c;if($.documentMode)c=ue.get(this,o)-1,c?ue.set(this,o,c):(this.removeEventListener(o,a),ue.remove(this,o));else return!1},_default:function(c){return ue.get(c.target,n)},delegateType:o},u.event.special[o]={setup:function(){var c=this.ownerDocument||this.document||this,l=$.documentMode?this:c,h=ue.get(l,o);h||($.documentMode?this.addEventListener(o,a):c.addEventListener(n,a,!0)),ue.set(l,o,(h||0)+1)},teardown:function(){var c=this.ownerDocument||this.document||this,l=$.documentMode?this:c,h=ue.get(l,o)-1;h?ue.set(l,o,h):($.documentMode?this.removeEventListener(o,a):c.removeEventListener(n,a,!0),ue.remove(l,o))}}}),u.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(n,o){u.event.special[n]={delegateType:o,bindType:o,handle:function(a){var c,l=this,h=a.relatedTarget,g=a.handleObj;return(!h||h!==l&&!u.contains(l,h))&&(a.type=g.origType,c=g.handler.apply(this,arguments),a.type=o),c}}}),u.fn.extend({on:function(n,o,a,c){return Oi(this,n,o,a,c)},one:function(n,o,a,c){return Oi(this,n,o,a,c,1)},off:function(n,o,a){var c,l;if(n&&n.preventDefault&&n.handleObj)return c=n.handleObj,u(n.delegateTarget).off(c.namespace?c.origType+"."+c.namespace:c.origType,c.selector,c.handler),this;if(typeof n=="object"){for(l in n)this.off(l,o,n[l]);return this}return(o===!1||typeof o=="function")&&(a=o,o=void 0),a===!1&&(a=Cn),this.each(function(){u.event.remove(this,n,a,o)})}});var Ef=/<script|<style|<link/i,Cf=/checked\s*(?:[^=]|=\s*.checked.)/i,Tf=/^\s*<!\[CDATA\[|\]\]>\s*$/g;function Fs(n,o){return P(n,"table")&&P(o.nodeType!==11?o:o.firstChild,"tr")&&u(n).children("tbody")[0]||n}function Sf(n){return n.type=(n.getAttribute("type")!==null)+"/"+n.type,n}function Af(n){return(n.type||"").slice(0,5)==="true/"?n.type=n.type.slice(5):n.removeAttribute("type"),n}function Ks(n,o){var a,c,l,h,g,k,b;if(o.nodeType===1){if(ue.hasData(n)&&(h=ue.get(n),b=h.events,b)){ue.remove(o,"handle events");for(l in b)for(a=0,c=b[l].length;a<c;a++)u.event.add(o,l,b[l][a])}We.hasData(n)&&(g=We.access(n),k=u.extend({},g),We.set(o,k))}}function _f(n,o){var a=o.nodeName.toLowerCase();a==="input"&&jn.test(n.type)?o.checked=n.checked:(a==="input"||a==="textarea")&&(o.defaultValue=n.defaultValue)}function Tn(n,o,a,c){o=d(o);var l,h,g,k,b,_,H=0,F=n.length,q=F-1,Q=o[0],me=N(Q);if(me||F>1&&typeof Q=="string"&&!M.checkClone&&Cf.test(Q))return n.each(function(Ie){var xe=n.eq(Ie);me&&(o[0]=Q.call(this,Ie,xe.html())),Tn(xe,o,a,c)});if(F&&(l=Rs(o,n[0].ownerDocument,!1,n,c),h=l.firstChild,l.childNodes.length===1&&(l=h),h||c)){for(g=u.map(et(l,"script"),Sf),k=g.length;H<F;H++)b=l,H!==q&&(b=u.clone(b,!0,!0),k&&u.merge(g,et(b,"script"))),a.call(n[H],b,H);if(k)for(_=g[g.length-1].ownerDocument,u.map(g,Af),H=0;H<k;H++)b=g[H],Us.test(b.type||"")&&!ue.access(b,"globalEval")&&u.contains(_,b)&&(b.src&&(b.type||"").toLowerCase()!=="module"?u._evalUrl&&!b.noModule&&u._evalUrl(b.src,{nonce:b.nonce||b.getAttribute("nonce")},_):ee(b.textContent.replace(Tf,""),b,_))}return n}function $s(n,o,a){for(var c,l=o?u.filter(o,n):n,h=0;(c=l[h])!=null;h++)!a&&c.nodeType===1&&u.cleanData(et(c)),c.parentNode&&(a&&xn(c)&&Pi(et(c,"script")),c.parentNode.removeChild(c));return n}u.extend({htmlPrefilter:function(n){return n},clone:function(n,o,a){var c,l,h,g,k=n.cloneNode(!0),b=xn(n);if(!M.noCloneChecked&&(n.nodeType===1||n.nodeType===11)&&!u.isXMLDoc(n))for(g=et(k),h=et(n),c=0,l=h.length;c<l;c++)_f(h[c],g[c]);if(o)if(a)for(h=h||et(n),g=g||et(k),c=0,l=h.length;c<l;c++)Ks(h[c],g[c]);else Ks(n,k);return g=et(k,"script"),g.length>0&&Pi(g,!b&&et(n,"script")),k},cleanData:function(n){for(var o,a,c,l=u.event.special,h=0;(a=n[h])!==void 0;h++)if(Xt(a)){if(o=a[ue.expando]){if(o.events)for(c in o.events)l[c]?u.event.remove(a,c):u.removeEvent(a,c,o.handle);a[ue.expando]=void 0}a[We.expando]&&(a[We.expando]=void 0)}}}),u.fn.extend({detach:function(n){return $s(this,n,!0)},remove:function(n){return $s(this,n)},text:function(n){return He(this,function(o){return o===void 0?u.text(this):this.empty().each(function(){(this.nodeType===1||this.nodeType===11||this.nodeType===9)&&(this.textContent=o)})},null,n,arguments.length)},append:function(){return Tn(this,arguments,function(n){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var o=Fs(this,n);o.appendChild(n)}})},prepend:function(){return Tn(this,arguments,function(n){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var o=Fs(this,n);o.insertBefore(n,o.firstChild)}})},before:function(){return Tn(this,arguments,function(n){this.parentNode&&this.parentNode.insertBefore(n,this)})},after:function(){return Tn(this,arguments,function(n){this.parentNode&&this.parentNode.insertBefore(n,this.nextSibling)})},empty:function(){for(var n,o=0;(n=this[o])!=null;o++)n.nodeType===1&&(u.cleanData(et(n,!1)),n.textContent="");return this},clone:function(n,o){return n=n??!1,o=o??n,this.map(function(){return u.clone(this,n,o)})},html:function(n){return He(this,function(o){var a=this[0]||{},c=0,l=this.length;if(o===void 0&&a.nodeType===1)return a.innerHTML;if(typeof o=="string"&&!Ef.test(o)&&!ut[(Hs.exec(o)||["",""])[1].toLowerCase()]){o=u.htmlPrefilter(o);try{for(;c<l;c++)a=this[c]||{},a.nodeType===1&&(u.cleanData(et(a,!1)),a.innerHTML=o);a=0}catch{}}a&&this.empty().append(o)},null,n,arguments.length)},replaceWith:function(){var n=[];return Tn(this,arguments,function(o){var a=this.parentNode;u.inArray(this,n)<0&&(u.cleanData(et(this)),a&&a.replaceChild(o,this))},n)}}),u.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(n,o){u.fn[n]=function(a){for(var c,l=[],h=u(a),g=h.length-1,k=0;k<=g;k++)c=k===g?this:this.clone(!0),u(h[k])[o](c),p.apply(l,c.get());return this.pushStack(l)}});var qi=new RegExp("^("+vn+")(?!px)[a-z%]+$","i"),Ni=/^--/,vr=function(n){var o=n.ownerDocument.defaultView;return(!o||!o.opener)&&(o=e),o.getComputedStyle(n)},Ws=function(n,o,a){var c,l,h={};for(l in o)h[l]=n.style[l],n.style[l]=o[l];c=a.call(n);for(l in o)n.style[l]=h[l];return c},If=new RegExp(pt.join("|"),"i");(function(){function n(){if(_){b.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",_.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",Jt.appendChild(b).appendChild(_);var H=e.getComputedStyle(_);a=H.top!=="1%",k=o(H.marginLeft)===12,_.style.right="60%",h=o(H.right)===36,c=o(H.width)===36,_.style.position="absolute",l=o(_.offsetWidth/3)===12,Jt.removeChild(b),_=null}}function o(H){return Math.round(parseFloat(H))}var a,c,l,h,g,k,b=$.createElement("div"),_=$.createElement("div");_.style&&(_.style.backgroundClip="content-box",_.cloneNode(!0).style.backgroundClip="",M.clearCloneStyle=_.style.backgroundClip==="content-box",u.extend(M,{boxSizingReliable:function(){return n(),c},pixelBoxStyles:function(){return n(),h},pixelPosition:function(){return n(),a},reliableMarginLeft:function(){return n(),k},scrollboxSize:function(){return n(),l},reliableTrDimensions:function(){var H,F,q,Q;return g==null&&(H=$.createElement("table"),F=$.createElement("tr"),q=$.createElement("div"),H.style.cssText="position:absolute;left:-11111px;border-collapse:separate",F.style.cssText="box-sizing:content-box;border:1px solid",F.style.height="1px",q.style.height="9px",q.style.display="block",Jt.appendChild(H).appendChild(F).appendChild(q),Q=e.getComputedStyle(F),g=parseInt(Q.height,10)+parseInt(Q.borderTopWidth,10)+parseInt(Q.borderBottomWidth,10)===F.offsetHeight,Jt.removeChild(H)),g}}))})();function Fn(n,o,a){var c,l,h,g,k=Ni.test(o),b=n.style;return a=a||vr(n),a&&(g=a.getPropertyValue(o)||a[o],k&&g&&(g=g.replace(K,"$1")||void 0),g===""&&!xn(n)&&(g=u.style(n,o)),!M.pixelBoxStyles()&&qi.test(g)&&If.test(o)&&(c=b.width,l=b.minWidth,h=b.maxWidth,b.minWidth=b.maxWidth=b.width=g,g=a.width,b.width=c,b.minWidth=l,b.maxWidth=h)),g!==void 0?g+"":g}function zs(n,o){return{get:function(){if(n()){delete this.get;return}return(this.get=o).apply(this,arguments)}}}var Vs=["Webkit","Moz","ms"],Qs=$.createElement("div").style,Gs={};function Mf(n){for(var o=n[0].toUpperCase()+n.slice(1),a=Vs.length;a--;)if(n=Vs[a]+o,n in Qs)return n}function Di(n){var o=u.cssProps[n]||Gs[n];return o||(n in Qs?n:Gs[n]=Mf(n)||n)}var Bf=/^(none|table(?!-c[ea]).+)/,Pf={position:"absolute",visibility:"hidden",display:"block"},Zs={letterSpacing:"0",fontWeight:"400"};function Xs(n,o,a){var c=Yt.exec(o);return c?Math.max(0,c[2]-(a||0))+(c[3]||"px"):o}function Li(n,o,a,c,l,h){var g=o==="width"?1:0,k=0,b=0,_=0;if(a===(c?"border":"content"))return 0;for(;g<4;g+=2)a==="margin"&&(_+=u.css(n,a+pt[g],!0,l)),c?(a==="content"&&(b-=u.css(n,"padding"+pt[g],!0,l)),a!=="margin"&&(b-=u.css(n,"border"+pt[g]+"Width",!0,l))):(b+=u.css(n,"padding"+pt[g],!0,l),a!=="padding"?b+=u.css(n,"border"+pt[g]+"Width",!0,l):k+=u.css(n,"border"+pt[g]+"Width",!0,l));return!c&&h>=0&&(b+=Math.max(0,Math.ceil(n["offset"+o[0].toUpperCase()+o.slice(1)]-h-b-k-.5))||0),b+_}function Ys(n,o,a){var c=vr(n),l=!M.boxSizingReliable()||a,h=l&&u.css(n,"boxSizing",!1,c)==="border-box",g=h,k=Fn(n,o,c),b="offset"+o[0].toUpperCase()+o.slice(1);if(qi.test(k)){if(!a)return k;k="auto"}return(!M.boxSizingReliable()&&h||!M.reliableTrDimensions()&&P(n,"tr")||k==="auto"||!parseFloat(k)&&u.css(n,"display",!1,c)==="inline")&&n.getClientRects().length&&(h=u.css(n,"boxSizing",!1,c)==="border-box",g=b in n,g&&(k=n[b])),k=parseFloat(k)||0,k+Li(n,o,a||(h?"border":"content"),g,c,k)+"px"}u.extend({cssHooks:{opacity:{get:function(n,o){if(o){var a=Fn(n,"opacity");return a===""?"1":a}}}},cssNumber:{animationIterationCount:!0,aspectRatio:!0,borderImageSlice:!0,columnCount:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,scale:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeMiterlimit:!0,strokeOpacity:!0},cssProps:{},style:function(n,o,a,c){if(!(!n||n.nodeType===3||n.nodeType===8||!n.style)){var l,h,g,k=at(o),b=Ni.test(o),_=n.style;if(b||(o=Di(k)),g=u.cssHooks[o]||u.cssHooks[k],a!==void 0){if(h=typeof a,h==="string"&&(l=Yt.exec(a))&&l[1]&&(a=Ds(n,o,l),h="number"),a==null||a!==a)return;h==="number"&&!b&&(a+=l&&l[3]||(u.cssNumber[k]?"":"px")),!M.clearCloneStyle&&a===""&&o.indexOf("background")===0&&(_[o]="inherit"),(!g||!("set"in g)||(a=g.set(n,a,c))!==void 0)&&(b?_.setProperty(o,a):_[o]=a)}else return g&&"get"in g&&(l=g.get(n,!1,c))!==void 0?l:_[o]}},css:function(n,o,a,c){var l,h,g,k=at(o),b=Ni.test(o);return b||(o=Di(k)),g=u.cssHooks[o]||u.cssHooks[k],g&&"get"in g&&(l=g.get(n,!0,a)),l===void 0&&(l=Fn(n,o,c)),l==="normal"&&o in Zs&&(l=Zs[o]),a===""||a?(h=parseFloat(l),a===!0||isFinite(h)?h||0:l):l}}),u.each(["height","width"],function(n,o){u.cssHooks[o]={get:function(a,c,l){if(c)return Bf.test(u.css(a,"display"))&&(!a.getClientRects().length||!a.getBoundingClientRect().width)?Ws(a,Pf,function(){return Ys(a,o,l)}):Ys(a,o,l)},set:function(a,c,l){var h,g=vr(a),k=!M.scrollboxSize()&&g.position==="absolute",b=k||l,_=b&&u.css(a,"boxSizing",!1,g)==="border-box",H=l?Li(a,o,l,_,g):0;return _&&k&&(H-=Math.ceil(a["offset"+o[0].toUpperCase()+o.slice(1)]-parseFloat(g[o])-Li(a,o,"border",!1,g)-.5)),H&&(h=Yt.exec(c))&&(h[3]||"px")!=="px"&&(a.style[o]=c,c=u.css(a,o)),Xs(a,c,H)}}}),u.cssHooks.marginLeft=zs(M.reliableMarginLeft,function(n,o){if(o)return(parseFloat(Fn(n,"marginLeft"))||n.getBoundingClientRect().left-Ws(n,{marginLeft:0},function(){return n.getBoundingClientRect().left}))+"px"}),u.each({margin:"",padding:"",border:"Width"},function(n,o){u.cssHooks[n+o]={expand:function(a){for(var c=0,l={},h=typeof a=="string"?a.split(" "):[a];c<4;c++)l[n+pt[c]+o]=h[c]||h[c-2]||h[0];return l}},n!=="margin"&&(u.cssHooks[n+o].set=Xs)}),u.fn.extend({css:function(n,o){return He(this,function(a,c,l){var h,g,k={},b=0;if(Array.isArray(c)){for(h=vr(a),g=c.length;b<g;b++)k[c[b]]=u.css(a,c[b],!1,h);return k}return l!==void 0?u.style(a,c,l):u.css(a,c)},n,o,arguments.length>1)}});function tt(n,o,a,c,l){return new tt.prototype.init(n,o,a,c,l)}u.Tween=tt,tt.prototype={constructor:tt,init:function(n,o,a,c,l,h){this.elem=n,this.prop=a,this.easing=l||u.easing._default,this.options=o,this.start=this.now=this.cur(),this.end=c,this.unit=h||(u.cssNumber[a]?"":"px")},cur:function(){var n=tt.propHooks[this.prop];return n&&n.get?n.get(this):tt.propHooks._default.get(this)},run:function(n){var o,a=tt.propHooks[this.prop];return this.options.duration?this.pos=o=u.easing[this.easing](n,this.options.duration*n,0,1,this.options.duration):this.pos=o=n,this.now=(this.end-this.start)*o+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),a&&a.set?a.set(this):tt.propHooks._default.set(this),this}},tt.prototype.init.prototype=tt.prototype,tt.propHooks={_default:{get:function(n){var o;return n.elem.nodeType!==1||n.elem[n.prop]!=null&&n.elem.style[n.prop]==null?n.elem[n.prop]:(o=u.css(n.elem,n.prop,""),!o||o==="auto"?0:o)},set:function(n){u.fx.step[n.prop]?u.fx.step[n.prop](n):n.elem.nodeType===1&&(u.cssHooks[n.prop]||n.elem.style[Di(n.prop)]!=null)?u.style(n.elem,n.prop,n.now+n.unit):n.elem[n.prop]=n.now}}},tt.propHooks.scrollTop=tt.propHooks.scrollLeft={set:function(n){n.elem.nodeType&&n.elem.parentNode&&(n.elem[n.prop]=n.now)}},u.easing={linear:function(n){return n},swing:function(n){return .5-Math.cos(n*Math.PI)/2},_default:"swing"},u.fx=tt.prototype.init,u.fx.step={};var Sn,xr,Of=/^(?:toggle|show|hide)$/,qf=/queueHooks$/;function Hi(){xr&&($.hidden===!1&&e.requestAnimationFrame?e.requestAnimationFrame(Hi):e.setTimeout(Hi,u.fx.interval),u.fx.tick())}function Js(){return e.setTimeout(function(){Sn=void 0}),Sn=Date.now()}function kr(n,o){var a,c=0,l={height:n};for(o=o?1:0;c<4;c+=2-o)a=pt[c],l["margin"+a]=l["padding"+a]=n;return o&&(l.opacity=l.width=n),l}function ea(n,o,a){for(var c,l=(gt.tweeners[o]||[]).concat(gt.tweeners["*"]),h=0,g=l.length;h<g;h++)if(c=l[h].call(a,o,n))return c}function Nf(n,o,a){var c,l,h,g,k,b,_,H,F="width"in o||"height"in o,q=this,Q={},me=n.style,Ie=n.nodeType&&wr(n),xe=ue.get(n,"fxshow");a.queue||(g=u._queueHooks(n,"fx"),g.unqueued==null&&(g.unqueued=0,k=g.empty.fire,g.empty.fire=function(){g.unqueued||k()}),g.unqueued++,q.always(function(){q.always(function(){g.unqueued--,u.queue(n,"fx").length||g.empty.fire()})}));for(c in o)if(l=o[c],Of.test(l)){if(delete o[c],h=h||l==="toggle",l===(Ie?"hide":"show"))if(l==="show"&&xe&&xe[c]!==void 0)Ie=!0;else continue;Q[c]=xe&&xe[c]||u.style(n,c)}if(b=!u.isEmptyObject(o),!(!b&&u.isEmptyObject(Q))){F&&n.nodeType===1&&(a.overflow=[me.overflow,me.overflowX,me.overflowY],_=xe&&xe.display,_==null&&(_=ue.get(n,"display")),H=u.css(n,"display"),H==="none"&&(_?H=_:(kn([n],!0),_=n.style.display||_,H=u.css(n,"display"),kn([n]))),(H==="inline"||H==="inline-block"&&_!=null)&&u.css(n,"float")==="none"&&(b||(q.done(function(){me.display=_}),_==null&&(H=me.display,_=H==="none"?"":H)),me.display="inline-block")),a.overflow&&(me.overflow="hidden",q.always(function(){me.overflow=a.overflow[0],me.overflowX=a.overflow[1],me.overflowY=a.overflow[2]})),b=!1;for(c in Q)b||(xe?"hidden"in xe&&(Ie=xe.hidden):xe=ue.access(n,"fxshow",{display:_}),h&&(xe.hidden=!Ie),Ie&&kn([n],!0),q.done(function(){Ie||kn([n]),ue.remove(n,"fxshow");for(c in Q)u.style(n,c,Q[c])})),b=ea(Ie?xe[c]:0,c,q),c in xe||(xe[c]=b.start,Ie&&(b.end=b.start,b.start=0))}}function Df(n,o){var a,c,l,h,g;for(a in n)if(c=at(a),l=o[c],h=n[a],Array.isArray(h)&&(l=h[1],h=n[a]=h[0]),a!==c&&(n[c]=h,delete n[a]),g=u.cssHooks[c],g&&"expand"in g){h=g.expand(h),delete n[c];for(a in h)a in n||(n[a]=h[a],o[a]=l)}else o[c]=l}function gt(n,o,a){var c,l,h=0,g=gt.prefilters.length,k=u.Deferred().always(function(){delete b.elem}),b=function(){if(l)return!1;for(var F=Sn||Js(),q=Math.max(0,_.startTime+_.duration-F),Q=q/_.duration||0,me=1-Q,Ie=0,xe=_.tweens.length;Ie<xe;Ie++)_.tweens[Ie].run(me);return k.notifyWith(n,[_,me,q]),me<1&&xe?q:(xe||k.notifyWith(n,[_,1,0]),k.resolveWith(n,[_]),!1)},_=k.promise({elem:n,props:u.extend({},o),opts:u.extend(!0,{specialEasing:{},easing:u.easing._default},a),originalProperties:o,originalOptions:a,startTime:Sn||Js(),duration:a.duration,tweens:[],createTween:function(F,q){var Q=u.Tween(n,_.opts,F,q,_.opts.specialEasing[F]||_.opts.easing);return _.tweens.push(Q),Q},stop:function(F){var q=0,Q=F?_.tweens.length:0;if(l)return this;for(l=!0;q<Q;q++)_.tweens[q].run(1);return F?(k.notifyWith(n,[_,1,0]),k.resolveWith(n,[_,F])):k.rejectWith(n,[_,F]),this}}),H=_.props;for(Df(H,_.opts.specialEasing);h<g;h++)if(c=gt.prefilters[h].call(_,n,H,_.opts),c)return N(c.stop)&&(u._queueHooks(_.elem,_.opts.queue).stop=c.stop.bind(c)),c;return u.map(H,ea,_),N(_.opts.start)&&_.opts.start.call(n,_),_.progress(_.opts.progress).done(_.opts.done,_.opts.complete).fail(_.opts.fail).always(_.opts.always),u.fx.timer(u.extend(b,{elem:n,anim:_,queue:_.opts.queue})),_}u.Animation=u.extend(gt,{tweeners:{"*":[function(n,o){var a=this.createTween(n,o);return Ds(a.elem,n,Yt.exec(o),a),a}]},tweener:function(n,o){N(n)?(o=n,n=["*"]):n=n.match(le);for(var a,c=0,l=n.length;c<l;c++)a=n[c],gt.tweeners[a]=gt.tweeners[a]||[],gt.tweeners[a].unshift(o)},prefilters:[Nf],prefilter:function(n,o){o?gt.prefilters.unshift(n):gt.prefilters.push(n)}}),u.speed=function(n,o,a){var c=n&&typeof n=="object"?u.extend({},n):{complete:a||!a&&o||N(n)&&n,duration:n,easing:a&&o||o&&!N(o)&&o};return u.fx.off?c.duration=0:typeof c.duration!="number"&&(c.duration in u.fx.speeds?c.duration=u.fx.speeds[c.duration]:c.duration=u.fx.speeds._default),(c.queue==null||c.queue===!0)&&(c.queue="fx"),c.old=c.complete,c.complete=function(){N(c.old)&&c.old.call(this),c.queue&&u.dequeue(this,c.queue)},c},u.fn.extend({fadeTo:function(n,o,a,c){return this.filter(wr).css("opacity",0).show().end().animate({opacity:o},n,a,c)},animate:function(n,o,a,c){var l=u.isEmptyObject(n),h=u.speed(o,a,c),g=function(){var k=gt(this,u.extend({},n),h);(l||ue.get(this,"finish"))&&k.stop(!0)};return g.finish=g,l||h.queue===!1?this.each(g):this.queue(h.queue,g)},stop:function(n,o,a){var c=function(l){var h=l.stop;delete l.stop,h(a)};return typeof n!="string"&&(a=o,o=n,n=void 0),o&&this.queue(n||"fx",[]),this.each(function(){var l=!0,h=n!=null&&n+"queueHooks",g=u.timers,k=ue.get(this);if(h)k[h]&&k[h].stop&&c(k[h]);else for(h in k)k[h]&&k[h].stop&&qf.test(h)&&c(k[h]);for(h=g.length;h--;)g[h].elem===this&&(n==null||g[h].queue===n)&&(g[h].anim.stop(a),l=!1,g.splice(h,1));(l||!a)&&u.dequeue(this,n)})},finish:function(n){return n!==!1&&(n=n||"fx"),this.each(function(){var o,a=ue.get(this),c=a[n+"queue"],l=a[n+"queueHooks"],h=u.timers,g=c?c.length:0;for(a.finish=!0,u.queue(this,n,[]),l&&l.stop&&l.stop.call(this,!0),o=h.length;o--;)h[o].elem===this&&h[o].queue===n&&(h[o].anim.stop(!0),h.splice(o,1));for(o=0;o<g;o++)c[o]&&c[o].finish&&c[o].finish.call(this);delete a.finish})}}),u.each(["toggle","show","hide"],function(n,o){var a=u.fn[o];u.fn[o]=function(c,l,h){return c==null||typeof c=="boolean"?a.apply(this,arguments):this.animate(kr(o,!0),c,l,h)}}),u.each({slideDown:kr("show"),slideUp:kr("hide"),slideToggle:kr("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(n,o){u.fn[n]=function(a,c,l){return this.animate(o,a,c,l)}}),u.timers=[],u.fx.tick=function(){var n,o=0,a=u.timers;for(Sn=Date.now();o<a.length;o++)n=a[o],!n()&&a[o]===n&&a.splice(o--,1);a.length||u.fx.stop(),Sn=void 0},u.fx.timer=function(n){u.timers.push(n),u.fx.start()},u.fx.interval=13,u.fx.start=function(){xr||(xr=!0,Hi())},u.fx.stop=function(){xr=null},u.fx.speeds={slow:600,fast:200,_default:400},u.fn.delay=function(n,o){return n=u.fx&&u.fx.speeds[n]||n,o=o||"fx",this.queue(o,function(a,c){var l=e.setTimeout(a,n);c.stop=function(){e.clearTimeout(l)}})},(function(){var n=$.createElement("input"),o=$.createElement("select"),a=o.appendChild($.createElement("option"));n.type="checkbox",M.checkOn=n.value!=="",M.optSelected=a.selected,n=$.createElement("input"),n.value="t",n.type="radio",M.radioValue=n.value==="t"})();var ta,Kn=u.expr.attrHandle;u.fn.extend({attr:function(n,o){return He(this,u.attr,n,o,arguments.length>1)},removeAttr:function(n){return this.each(function(){u.removeAttr(this,n)})}}),u.extend({attr:function(n,o,a){var c,l,h=n.nodeType;if(!(h===3||h===8||h===2)){if(typeof n.getAttribute>"u")return u.prop(n,o,a);if((h!==1||!u.isXMLDoc(n))&&(l=u.attrHooks[o.toLowerCase()]||(u.expr.match.bool.test(o)?ta:void 0)),a!==void 0){if(a===null){u.removeAttr(n,o);return}return l&&"set"in l&&(c=l.set(n,a,o))!==void 0?c:(n.setAttribute(o,a+""),a)}return l&&"get"in l&&(c=l.get(n,o))!==null?c:(c=u.find.attr(n,o),c??void 0)}},attrHooks:{type:{set:function(n,o){if(!M.radioValue&&o==="radio"&&P(n,"input")){var a=n.value;return n.setAttribute("type",o),a&&(n.value=a),o}}}},removeAttr:function(n,o){var a,c=0,l=o&&o.match(le);if(l&&n.nodeType===1)for(;a=l[c++];)n.removeAttribute(a)}}),ta={set:function(n,o,a){return o===!1?u.removeAttr(n,a):n.setAttribute(a,a),a}},u.each(u.expr.match.bool.source.match(/\w+/g),function(n,o){var a=Kn[o]||u.find.attr;Kn[o]=function(c,l,h){var g,k,b=l.toLowerCase();return h||(k=Kn[b],Kn[b]=g,g=a(c,l,h)!=null?b:null,Kn[b]=k),g}});var Lf=/^(?:input|select|textarea|button)$/i,Hf=/^(?:a|area)$/i;u.fn.extend({prop:function(n,o){return He(this,u.prop,n,o,arguments.length>1)},removeProp:function(n){return this.each(function(){delete this[u.propFix[n]||n]})}}),u.extend({prop:function(n,o,a){var c,l,h=n.nodeType;if(!(h===3||h===8||h===2))return(h!==1||!u.isXMLDoc(n))&&(o=u.propFix[o]||o,l=u.propHooks[o]),a!==void 0?l&&"set"in l&&(c=l.set(n,a,o))!==void 0?c:n[o]=a:l&&"get"in l&&(c=l.get(n,o))!==null?c:n[o]},propHooks:{tabIndex:{get:function(n){var o=u.find.attr(n,"tabindex");return o?parseInt(o,10):Lf.test(n.nodeName)||Hf.test(n.nodeName)&&n.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),M.optSelected||(u.propHooks.selected={get:function(n){var o=n.parentNode;return o&&o.parentNode&&o.parentNode.selectedIndex,null},set:function(n){var o=n.parentNode;o&&(o.selectedIndex,o.parentNode&&o.parentNode.selectedIndex)}}),u.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){u.propFix[this.toLowerCase()]=this});function en(n){var o=n.match(le)||[];return o.join(" ")}function tn(n){return n.getAttribute&&n.getAttribute("class")||""}function Ui(n){return Array.isArray(n)?n:typeof n=="string"?n.match(le)||[]:[]}u.fn.extend({addClass:function(n){var o,a,c,l,h,g;return N(n)?this.each(function(k){u(this).addClass(n.call(this,k,tn(this)))}):(o=Ui(n),o.length?this.each(function(){if(c=tn(this),a=this.nodeType===1&&" "+en(c)+" ",a){for(h=0;h<o.length;h++)l=o[h],a.indexOf(" "+l+" ")<0&&(a+=l+" ");g=en(a),c!==g&&this.setAttribute("class",g)}}):this)},removeClass:function(n){var o,a,c,l,h,g;return N(n)?this.each(function(k){u(this).removeClass(n.call(this,k,tn(this)))}):arguments.length?(o=Ui(n),o.length?this.each(function(){if(c=tn(this),a=this.nodeType===1&&" "+en(c)+" ",a){for(h=0;h<o.length;h++)for(l=o[h];a.indexOf(" "+l+" ")>-1;)a=a.replace(" "+l+" "," ");g=en(a),c!==g&&this.setAttribute("class",g)}}):this):this.attr("class","")},toggleClass:function(n,o){var a,c,l,h,g=typeof n,k=g==="string"||Array.isArray(n);return N(n)?this.each(function(b){u(this).toggleClass(n.call(this,b,tn(this),o),o)}):typeof o=="boolean"&&k?o?this.addClass(n):this.removeClass(n):(a=Ui(n),this.each(function(){if(k)for(h=u(this),l=0;l<a.length;l++)c=a[l],h.hasClass(c)?h.removeClass(c):h.addClass(c);else(n===void 0||g==="boolean")&&(c=tn(this),c&&ue.set(this,"__className__",c),this.setAttribute&&this.setAttribute("class",c||n===!1?"":ue.get(this,"__className__")||""))}))},hasClass:function(n){var o,a,c=0;for(o=" "+n+" ";a=this[c++];)if(a.nodeType===1&&(" "+en(tn(a))+" ").indexOf(o)>-1)return!0;return!1}});var Uf=/\r/g;u.fn.extend({val:function(n){var o,a,c,l=this[0];return arguments.length?(c=N(n),this.each(function(h){var g;this.nodeType===1&&(c?g=n.call(this,h,u(this).val()):g=n,g==null?g="":typeof g=="number"?g+="":Array.isArray(g)&&(g=u.map(g,function(k){return k==null?"":k+""})),o=u.valHooks[this.type]||u.valHooks[this.nodeName.toLowerCase()],(!o||!("set"in o)||o.set(this,g,"value")===void 0)&&(this.value=g))})):l?(o=u.valHooks[l.type]||u.valHooks[l.nodeName.toLowerCase()],o&&"get"in o&&(a=o.get(l,"value"))!==void 0?a:(a=l.value,typeof a=="string"?a.replace(Uf,""):a??"")):void 0}}),u.extend({valHooks:{option:{get:function(n){var o=u.find.attr(n,"value");return o??en(u.text(n))}},select:{get:function(n){var o,a,c,l=n.options,h=n.selectedIndex,g=n.type==="select-one",k=g?null:[],b=g?h+1:l.length;for(h<0?c=b:c=g?h:0;c<b;c++)if(a=l[c],(a.selected||c===h)&&!a.disabled&&(!a.parentNode.disabled||!P(a.parentNode,"optgroup"))){if(o=u(a).val(),g)return o;k.push(o)}return k},set:function(n,o){for(var a,c,l=n.options,h=u.makeArray(o),g=l.length;g--;)c=l[g],(c.selected=u.inArray(u.valHooks.option.get(c),h)>-1)&&(a=!0);return a||(n.selectedIndex=-1),h}}}}),u.each(["radio","checkbox"],function(){u.valHooks[this]={set:function(n,o){if(Array.isArray(o))return n.checked=u.inArray(u(n).val(),o)>-1}},M.checkOn||(u.valHooks[this].get=function(n){return n.getAttribute("value")===null?"on":n.value})});var $n=e.location,na={guid:Date.now()},Ri=/\?/;u.parseXML=function(n){var o,a;if(!n||typeof n!="string")return null;try{o=new e.DOMParser().parseFromString(n,"text/xml")}catch{}return a=o&&o.getElementsByTagName("parsererror")[0],(!o||a)&&u.error("Invalid XML: "+(a?u.map(a.childNodes,function(c){return c.textContent}).join(`
`):n)),o};var ra=/^(?:focusinfocus|focusoutblur)$/,ia=function(n){n.stopPropagation()};u.extend(u.event,{trigger:function(n,o,a,c){var l,h,g,k,b,_,H,F,q=[a||$],Q=A.call(n,"type")?n.type:n,me=A.call(n,"namespace")?n.namespace.split("."):[];if(h=F=g=a=a||$,!(a.nodeType===3||a.nodeType===8)&&!ra.test(Q+u.event.triggered)&&(Q.indexOf(".")>-1&&(me=Q.split("."),Q=me.shift(),me.sort()),b=Q.indexOf(":")<0&&"on"+Q,n=n[u.expando]?n:new u.Event(Q,typeof n=="object"&&n),n.isTrigger=c?2:3,n.namespace=me.join("."),n.rnamespace=n.namespace?new RegExp("(^|\\.)"+me.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,n.result=void 0,n.target||(n.target=a),o=o==null?[n]:u.makeArray(o,[n]),H=u.event.special[Q]||{},!(!c&&H.trigger&&H.trigger.apply(a,o)===!1))){if(!c&&!H.noBubble&&!W(a)){for(k=H.delegateType||Q,ra.test(k+Q)||(h=h.parentNode);h;h=h.parentNode)q.push(h),g=h;g===(a.ownerDocument||$)&&q.push(g.defaultView||g.parentWindow||e)}for(l=0;(h=q[l++])&&!n.isPropagationStopped();)F=h,n.type=l>1?k:H.bindType||Q,_=(ue.get(h,"events")||Object.create(null))[n.type]&&ue.get(h,"handle"),_&&_.apply(h,o),_=b&&h[b],_&&_.apply&&Xt(h)&&(n.result=_.apply(h,o),n.result===!1&&n.preventDefault());return n.type=Q,!c&&!n.isDefaultPrevented()&&(!H._default||H._default.apply(q.pop(),o)===!1)&&Xt(a)&&b&&N(a[Q])&&!W(a)&&(g=a[b],g&&(a[b]=null),u.event.triggered=Q,n.isPropagationStopped()&&F.addEventListener(Q,ia),a[Q](),n.isPropagationStopped()&&F.removeEventListener(Q,ia),u.event.triggered=void 0,g&&(a[b]=g)),n.result}},simulate:function(n,o,a){var c=u.extend(new u.Event,a,{type:n,isSimulated:!0});u.event.trigger(c,null,o)}}),u.fn.extend({trigger:function(n,o){return this.each(function(){u.event.trigger(n,o,this)})},triggerHandler:function(n,o){var a=this[0];if(a)return u.event.trigger(n,o,a,!0)}});var Rf=/\[\]$/,oa=/\r?\n/g,jf=/^(?:submit|button|image|reset|file)$/i,Ff=/^(?:input|select|textarea|keygen)/i;function ji(n,o,a,c){var l;if(Array.isArray(o))u.each(o,function(h,g){a||Rf.test(n)?c(n,g):ji(n+"["+(typeof g=="object"&&g!=null?h:"")+"]",g,a,c)});else if(!a&&pe(o)==="object")for(l in o)ji(n+"["+l+"]",o[l],a,c);else c(n,o)}u.param=function(n,o){var a,c=[],l=function(h,g){var k=N(g)?g():g;c[c.length]=encodeURIComponent(h)+"="+encodeURIComponent(k??"")};if(n==null)return"";if(Array.isArray(n)||n.jquery&&!u.isPlainObject(n))u.each(n,function(){l(this.name,this.value)});else for(a in n)ji(a,n[a],o,l);return c.join("&")},u.fn.extend({serialize:function(){return u.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var n=u.prop(this,"elements");return n?u.makeArray(n):this}).filter(function(){var n=this.type;return this.name&&!u(this).is(":disabled")&&Ff.test(this.nodeName)&&!jf.test(n)&&(this.checked||!jn.test(n))}).map(function(n,o){var a=u(this).val();return a==null?null:Array.isArray(a)?u.map(a,function(c){return{name:o.name,value:c.replace(oa,`\r
`)}}):{name:o.name,value:a.replace(oa,`\r
`)}}).get()}});var Kf=/%20/g,$f=/#.*$/,Wf=/([?&])_=[^&]*/,zf=/^(.*?):[ \t]*([^\r\n]*)$/mg,Vf=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Qf=/^(?:GET|HEAD)$/,Gf=/^\/\//,sa={},Fi={},aa="*/".concat("*"),Ki=$.createElement("a");Ki.href=$n.href;function ua(n){return function(o,a){typeof o!="string"&&(a=o,o="*");var c,l=0,h=o.toLowerCase().match(le)||[];if(N(a))for(;c=h[l++];)c[0]==="+"?(c=c.slice(1)||"*",(n[c]=n[c]||[]).unshift(a)):(n[c]=n[c]||[]).push(a)}}function ca(n,o,a,c){var l={},h=n===Fi;function g(k){var b;return l[k]=!0,u.each(n[k]||[],function(_,H){var F=H(o,a,c);if(typeof F=="string"&&!h&&!l[F])return o.dataTypes.unshift(F),g(F),!1;if(h)return!(b=F)}),b}return g(o.dataTypes[0])||!l["*"]&&g("*")}function $i(n,o){var a,c,l=u.ajaxSettings.flatOptions||{};for(a in o)o[a]!==void 0&&((l[a]?n:c||(c={}))[a]=o[a]);return c&&u.extend(!0,n,c),n}function Zf(n,o,a){for(var c,l,h,g,k=n.contents,b=n.dataTypes;b[0]==="*";)b.shift(),c===void 0&&(c=n.mimeType||o.getResponseHeader("Content-Type"));if(c){for(l in k)if(k[l]&&k[l].test(c)){b.unshift(l);break}}if(b[0]in a)h=b[0];else{for(l in a){if(!b[0]||n.converters[l+" "+b[0]]){h=l;break}g||(g=l)}h=h||g}if(h)return h!==b[0]&&b.unshift(h),a[h]}function Xf(n,o,a,c){var l,h,g,k,b,_={},H=n.dataTypes.slice();if(H[1])for(g in n.converters)_[g.toLowerCase()]=n.converters[g];for(h=H.shift();h;)if(n.responseFields[h]&&(a[n.responseFields[h]]=o),!b&&c&&n.dataFilter&&(o=n.dataFilter(o,n.dataType)),b=h,h=H.shift(),h){if(h==="*")h=b;else if(b!=="*"&&b!==h){if(g=_[b+" "+h]||_["* "+h],!g){for(l in _)if(k=l.split(" "),k[1]===h&&(g=_[b+" "+k[0]]||_["* "+k[0]],g)){g===!0?g=_[l]:_[l]!==!0&&(h=k[0],H.unshift(k[1]));break}}if(g!==!0)if(g&&n.throws)o=g(o);else try{o=g(o)}catch(F){return{state:"parsererror",error:g?F:"No conversion from "+b+" to "+h}}}}return{state:"success",data:o}}u.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:$n.href,type:"GET",isLocal:Vf.test($n.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":aa,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":u.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(n,o){return o?$i($i(n,u.ajaxSettings),o):$i(u.ajaxSettings,n)},ajaxPrefilter:ua(sa),ajaxTransport:ua(Fi),ajax:function(n,o){typeof n=="object"&&(o=n,n=void 0),o=o||{};var a,c,l,h,g,k,b,_,H,F,q=u.ajaxSetup({},o),Q=q.context||q,me=q.context&&(Q.nodeType||Q.jquery)?u(Q):u.event,Ie=u.Deferred(),xe=u.Callbacks("once memory"),ze=q.statusCode||{},je={},vt={},xt="canceled",Te={readyState:0,getResponseHeader:function(Me){var Ue;if(b){if(!h)for(h={};Ue=zf.exec(l);)h[Ue[1].toLowerCase()+" "]=(h[Ue[1].toLowerCase()+" "]||[]).concat(Ue[2]);Ue=h[Me.toLowerCase()+" "]}return Ue==null?null:Ue.join(", ")},getAllResponseHeaders:function(){return b?l:null},setRequestHeader:function(Me,Ue){return b==null&&(Me=vt[Me.toLowerCase()]=vt[Me.toLowerCase()]||Me,je[Me]=Ue),this},overrideMimeType:function(Me){return b==null&&(q.mimeType=Me),this},statusCode:function(Me){var Ue;if(Me)if(b)Te.always(Me[Te.status]);else for(Ue in Me)ze[Ue]=[ze[Ue],Me[Ue]];return this},abort:function(Me){var Ue=Me||xt;return a&&a.abort(Ue),nn(0,Ue),this}};if(Ie.promise(Te),q.url=((n||q.url||$n.href)+"").replace(Gf,$n.protocol+"//"),q.type=o.method||o.type||q.method||q.type,q.dataTypes=(q.dataType||"*").toLowerCase().match(le)||[""],q.crossDomain==null){k=$.createElement("a");try{k.href=q.url,k.href=k.href,q.crossDomain=Ki.protocol+"//"+Ki.host!=k.protocol+"//"+k.host}catch{q.crossDomain=!0}}if(q.data&&q.processData&&typeof q.data!="string"&&(q.data=u.param(q.data,q.traditional)),ca(sa,q,o,Te),b)return Te;_=u.event&&q.global,_&&u.active++===0&&u.event.trigger("ajaxStart"),q.type=q.type.toUpperCase(),q.hasContent=!Qf.test(q.type),c=q.url.replace($f,""),q.hasContent?q.data&&q.processData&&(q.contentType||"").indexOf("application/x-www-form-urlencoded")===0&&(q.data=q.data.replace(Kf,"+")):(F=q.url.slice(c.length),q.data&&(q.processData||typeof q.data=="string")&&(c+=(Ri.test(c)?"&":"?")+q.data,delete q.data),q.cache===!1&&(c=c.replace(Wf,"$1"),F=(Ri.test(c)?"&":"?")+"_="+na.guid+++F),q.url=c+F),q.ifModified&&(u.lastModified[c]&&Te.setRequestHeader("If-Modified-Since",u.lastModified[c]),u.etag[c]&&Te.setRequestHeader("If-None-Match",u.etag[c])),(q.data&&q.hasContent&&q.contentType!==!1||o.contentType)&&Te.setRequestHeader("Content-Type",q.contentType),Te.setRequestHeader("Accept",q.dataTypes[0]&&q.accepts[q.dataTypes[0]]?q.accepts[q.dataTypes[0]]+(q.dataTypes[0]!=="*"?", "+aa+"; q=0.01":""):q.accepts["*"]);for(H in q.headers)Te.setRequestHeader(H,q.headers[H]);if(q.beforeSend&&(q.beforeSend.call(Q,Te,q)===!1||b))return Te.abort();if(xt="abort",xe.add(q.complete),Te.done(q.success),Te.fail(q.error),a=ca(Fi,q,o,Te),!a)nn(-1,"No Transport");else{if(Te.readyState=1,_&&me.trigger("ajaxSend",[Te,q]),b)return Te;q.async&&q.timeout>0&&(g=e.setTimeout(function(){Te.abort("timeout")},q.timeout));try{b=!1,a.send(je,nn)}catch(Me){if(b)throw Me;nn(-1,Me)}}function nn(Me,Ue,zn,zi){var kt,Vn,Et,Rt,jt,ct=Ue;b||(b=!0,g&&e.clearTimeout(g),a=void 0,l=zi||"",Te.readyState=Me>0?4:0,kt=Me>=200&&Me<300||Me===304,zn&&(Rt=Zf(q,Te,zn)),!kt&&u.inArray("script",q.dataTypes)>-1&&u.inArray("json",q.dataTypes)<0&&(q.converters["text script"]=function(){}),Rt=Xf(q,Rt,Te,kt),kt?(q.ifModified&&(jt=Te.getResponseHeader("Last-Modified"),jt&&(u.lastModified[c]=jt),jt=Te.getResponseHeader("etag"),jt&&(u.etag[c]=jt)),Me===204||q.type==="HEAD"?ct="nocontent":Me===304?ct="notmodified":(ct=Rt.state,Vn=Rt.data,Et=Rt.error,kt=!Et)):(Et=ct,(Me||!ct)&&(ct="error",Me<0&&(Me=0))),Te.status=Me,Te.statusText=(Ue||ct)+"",kt?Ie.resolveWith(Q,[Vn,ct,Te]):Ie.rejectWith(Q,[Te,ct,Et]),Te.statusCode(ze),ze=void 0,_&&me.trigger(kt?"ajaxSuccess":"ajaxError",[Te,q,kt?Vn:Et]),xe.fireWith(Q,[Te,ct]),_&&(me.trigger("ajaxComplete",[Te,q]),--u.active||u.event.trigger("ajaxStop")))}return Te},getJSON:function(n,o,a){return u.get(n,o,a,"json")},getScript:function(n,o){return u.get(n,void 0,o,"script")}}),u.each(["get","post"],function(n,o){u[o]=function(a,c,l,h){return N(c)&&(h=h||l,l=c,c=void 0),u.ajax(u.extend({url:a,type:o,dataType:h,data:c,success:l},u.isPlainObject(a)&&a))}}),u.ajaxPrefilter(function(n){var o;for(o in n.headers)o.toLowerCase()==="content-type"&&(n.contentType=n.headers[o]||"")}),u._evalUrl=function(n,o,a){return u.ajax({url:n,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(c){u.globalEval(c,o,a)}})},u.fn.extend({wrapAll:function(n){var o;return this[0]&&(N(n)&&(n=n.call(this[0])),o=u(n,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&o.insertBefore(this[0]),o.map(function(){for(var a=this;a.firstElementChild;)a=a.firstElementChild;return a}).append(this)),this},wrapInner:function(n){return N(n)?this.each(function(o){u(this).wrapInner(n.call(this,o))}):this.each(function(){var o=u(this),a=o.contents();a.length?a.wrapAll(n):o.append(n)})},wrap:function(n){var o=N(n);return this.each(function(a){u(this).wrapAll(o?n.call(this,a):n)})},unwrap:function(n){return this.parent(n).not("body").each(function(){u(this).replaceWith(this.childNodes)}),this}}),u.expr.pseudos.hidden=function(n){return!u.expr.pseudos.visible(n)},u.expr.pseudos.visible=function(n){return!!(n.offsetWidth||n.offsetHeight||n.getClientRects().length)},u.ajaxSettings.xhr=function(){try{return new e.XMLHttpRequest}catch{}};var Yf={0:200,1223:204},Wn=u.ajaxSettings.xhr();M.cors=!!Wn&&"withCredentials"in Wn,M.ajax=Wn=!!Wn,u.ajaxTransport(function(n){var o,a;if(M.cors||Wn&&!n.crossDomain)return{send:function(c,l){var h,g=n.xhr();if(g.open(n.type,n.url,n.async,n.username,n.password),n.xhrFields)for(h in n.xhrFields)g[h]=n.xhrFields[h];n.mimeType&&g.overrideMimeType&&g.overrideMimeType(n.mimeType),!n.crossDomain&&!c["X-Requested-With"]&&(c["X-Requested-With"]="XMLHttpRequest");for(h in c)g.setRequestHeader(h,c[h]);o=function(k){return function(){o&&(o=a=g.onload=g.onerror=g.onabort=g.ontimeout=g.onreadystatechange=null,k==="abort"?g.abort():k==="error"?typeof g.status!="number"?l(0,"error"):l(g.status,g.statusText):l(Yf[g.status]||g.status,g.statusText,(g.responseType||"text")!=="text"||typeof g.responseText!="string"?{binary:g.response}:{text:g.responseText},g.getAllResponseHeaders()))}},g.onload=o(),a=g.onerror=g.ontimeout=o("error"),g.onabort!==void 0?g.onabort=a:g.onreadystatechange=function(){g.readyState===4&&e.setTimeout(function(){o&&a()})},o=o("abort");try{g.send(n.hasContent&&n.data||null)}catch(k){if(o)throw k}},abort:function(){o&&o()}}}),u.ajaxPrefilter(function(n){n.crossDomain&&(n.contents.script=!1)}),u.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(n){return u.globalEval(n),n}}}),u.ajaxPrefilter("script",function(n){n.cache===void 0&&(n.cache=!1),n.crossDomain&&(n.type="GET")}),u.ajaxTransport("script",function(n){if(n.crossDomain||n.scriptAttrs){var o,a;return{send:function(c,l){o=u("<script>").attr(n.scriptAttrs||{}).prop({charset:n.scriptCharset,src:n.url}).on("load error",a=function(h){o.remove(),a=null,h&&l(h.type==="error"?404:200,h.type)}),$.head.appendChild(o[0])},abort:function(){a&&a()}}}});var fa=[],Wi=/(=)\?(?=&|$)|\?\?/;u.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var n=fa.pop()||u.expando+"_"+na.guid++;return this[n]=!0,n}}),u.ajaxPrefilter("json jsonp",function(n,o,a){var c,l,h,g=n.jsonp!==!1&&(Wi.test(n.url)?"url":typeof n.data=="string"&&(n.contentType||"").indexOf("application/x-www-form-urlencoded")===0&&Wi.test(n.data)&&"data");if(g||n.dataTypes[0]==="jsonp")return c=n.jsonpCallback=N(n.jsonpCallback)?n.jsonpCallback():n.jsonpCallback,g?n[g]=n[g].replace(Wi,"$1"+c):n.jsonp!==!1&&(n.url+=(Ri.test(n.url)?"&":"?")+n.jsonp+"="+c),n.converters["script json"]=function(){return h||u.error(c+" was not called"),h[0]},n.dataTypes[0]="json",l=e[c],e[c]=function(){h=arguments},a.always(function(){l===void 0?u(e).removeProp(c):e[c]=l,n[c]&&(n.jsonpCallback=o.jsonpCallback,fa.push(c)),h&&N(l)&&l(h[0]),h=l=void 0}),"script"}),M.createHTMLDocument=(function(){var n=$.implementation.createHTMLDocument("").body;return n.innerHTML="<form></form><form></form>",n.childNodes.length===2})(),u.parseHTML=function(n,o,a){if(typeof n!="string")return[];typeof o=="boolean"&&(a=o,o=!1);var c,l,h;return o||(M.createHTMLDocument?(o=$.implementation.createHTMLDocument(""),c=o.createElement("base"),c.href=$.location.href,o.head.appendChild(c)):o=$),l=z.exec(n),h=!a&&[],l?[o.createElement(l[1])]:(l=Rs([n],o,h),h&&h.length&&u(h).remove(),u.merge([],l.childNodes))},u.fn.load=function(n,o,a){var c,l,h,g=this,k=n.indexOf(" ");return k>-1&&(c=en(n.slice(k)),n=n.slice(0,k)),N(o)?(a=o,o=void 0):o&&typeof o=="object"&&(l="POST"),g.length>0&&u.ajax({url:n,type:l||"GET",dataType:"html",data:o}).done(function(b){h=arguments,g.html(c?u("<div>").append(u.parseHTML(b)).find(c):b)}).always(a&&function(b,_){g.each(function(){a.apply(this,h||[b.responseText,_,b])})}),this},u.expr.pseudos.animated=function(n){return u.grep(u.timers,function(o){return n===o.elem}).length},u.offset={setOffset:function(n,o,a){var c,l,h,g,k,b,_,H=u.css(n,"position"),F=u(n),q={};H==="static"&&(n.style.position="relative"),k=F.offset(),h=u.css(n,"top"),b=u.css(n,"left"),_=(H==="absolute"||H==="fixed")&&(h+b).indexOf("auto")>-1,_?(c=F.position(),g=c.top,l=c.left):(g=parseFloat(h)||0,l=parseFloat(b)||0),N(o)&&(o=o.call(n,a,u.extend({},k))),o.top!=null&&(q.top=o.top-k.top+g),o.left!=null&&(q.left=o.left-k.left+l),"using"in o?o.using.call(n,q):F.css(q)}},u.fn.extend({offset:function(n){if(arguments.length)return n===void 0?this:this.each(function(l){u.offset.setOffset(this,n,l)});var o,a,c=this[0];if(c)return c.getClientRects().length?(o=c.getBoundingClientRect(),a=c.ownerDocument.defaultView,{top:o.top+a.pageYOffset,left:o.left+a.pageXOffset}):{top:0,left:0}},position:function(){if(this[0]){var n,o,a,c=this[0],l={top:0,left:0};if(u.css(c,"position")==="fixed")o=c.getBoundingClientRect();else{for(o=this.offset(),a=c.ownerDocument,n=c.offsetParent||a.documentElement;n&&(n===a.body||n===a.documentElement)&&u.css(n,"position")==="static";)n=n.parentNode;n&&n!==c&&n.nodeType===1&&(l=u(n).offset(),l.top+=u.css(n,"borderTopWidth",!0),l.left+=u.css(n,"borderLeftWidth",!0))}return{top:o.top-l.top-u.css(c,"marginTop",!0),left:o.left-l.left-u.css(c,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var n=this.offsetParent;n&&u.css(n,"position")==="static";)n=n.offsetParent;return n||Jt})}}),u.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(n,o){var a=o==="pageYOffset";u.fn[n]=function(c){return He(this,function(l,h,g){var k;if(W(l)?k=l:l.nodeType===9&&(k=l.defaultView),g===void 0)return k?k[o]:l[h];k?k.scrollTo(a?k.pageXOffset:g,a?g:k.pageYOffset):l[h]=g},n,c,arguments.length)}}),u.each(["top","left"],function(n,o){u.cssHooks[o]=zs(M.pixelPosition,function(a,c){if(c)return c=Fn(a,o),qi.test(c)?u(a).position()[o]+"px":c})}),u.each({Height:"height",Width:"width"},function(n,o){u.each({padding:"inner"+n,content:o,"":"outer"+n},function(a,c){u.fn[c]=function(l,h){var g=arguments.length&&(a||typeof l!="boolean"),k=a||(l===!0||h===!0?"margin":"border");return He(this,function(b,_,H){var F;return W(b)?c.indexOf("outer")===0?b["inner"+n]:b.document.documentElement["client"+n]:b.nodeType===9?(F=b.documentElement,Math.max(b.body["scroll"+n],F["scroll"+n],b.body["offset"+n],F["offset"+n],F["client"+n])):H===void 0?u.css(b,_,k):u.style(b,_,H,k)},o,g?l:void 0,g)}})}),u.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(n,o){u.fn[o]=function(a){return this.on(o,a)}}),u.fn.extend({bind:function(n,o,a){return this.on(n,null,o,a)},unbind:function(n,o){return this.off(n,null,o)},delegate:function(n,o,a,c){return this.on(o,n,a,c)},undelegate:function(n,o,a){return arguments.length===1?this.off(n,"**"):this.off(o,n||"**",a)},hover:function(n,o){return this.on("mouseenter",n).on("mouseleave",o||n)}}),u.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(n,o){u.fn[o]=function(a,c){return arguments.length>0?this.on(o,null,a,c):this.trigger(o)}});var Jf=/^[\s\uFEFF\xA0]+|([^\s\uFEFF\xA0])[\s\uFEFF\xA0]+$/g;u.proxy=function(n,o){var a,c,l;if(typeof o=="string"&&(a=n[o],o=n,n=a),!!N(n))return c=f.call(arguments,2),l=function(){return n.apply(o||this,c.concat(f.call(arguments)))},l.guid=n.guid=n.guid||u.guid++,l},u.holdReady=function(n){n?u.readyWait++:u.ready(!0)},u.isArray=Array.isArray,u.parseJSON=JSON.parse,u.nodeName=P,u.isFunction=N,u.isWindow=W,u.camelCase=at,u.type=pe,u.now=Date.now,u.isNumeric=function(n){var o=u.type(n);return(o==="number"||o==="string")&&!isNaN(n-parseFloat(n))},u.trim=function(n){return n==null?"":(n+"").replace(Jf,"$1")};var el=e.jQuery,tl=e.$;return u.noConflict=function(n){return e.$===u&&(e.$=tl),n&&e.jQuery===u&&(e.jQuery=el),u},typeof t>"u"&&(e.jQuery=e.$=u),u})})(yr)),yr.exports}var Bs;function df(){return Bs||(Bs=1,(function(i){(function(e){e(["jquery"],function(t){return(function(){var r,s,f=0,d={error:"error",info:"info",success:"success",warning:"warning"},p={clear:N,remove:W,error:w,getContainer:x,info:A,options:{},subscribe:E,success:T,version:"2.1.4",warning:M},y;return p;function w(P,U,he){return Be({type:d.error,iconClass:u().iconClasses.error,message:P,optionsOverride:he,title:U})}function x(P,U){return P||(P=u()),r=t("#"+P.containerId),r.length||U&&(r=ee(P)),r}function A(P,U,he){return Be({type:d.info,iconClass:u().iconClasses.info,message:P,optionsOverride:he,title:U})}function E(P){s=P}function T(P,U,he){return Be({type:d.success,iconClass:u().iconClasses.success,message:P,optionsOverride:he,title:U})}function M(P,U,he){return Be({type:d.warning,iconClass:u().iconClasses.warning,message:P,optionsOverride:he,title:U})}function N(P,U){var he=u();r||x(he),we(P,he,U)||$(he)}function W(P){var U=u();if(r||x(U),P&&t(":focus",P).length===0){J(P);return}r.children().length&&r.remove()}function $(P){for(var U=r.children(),he=U.length-1;he>=0;he--)we(t(U[he]),P)}function we(P,U,he){var se=he&&he.force?he.force:!1;return P&&(se||t(":focus",P).length===0)?(P[U.hideMethod]({duration:U.hideDuration,easing:U.hideEasing,complete:function(){J(P)}}),!0):!1}function ee(P){return r=t("<div/>").attr("id",P.containerId).addClass(P.positionClass),r.appendTo(t(P.target)),r}function pe(){return{tapToDismiss:!0,toastClass:"toast",containerId:"toast-container",debug:!1,showMethod:"fadeIn",showDuration:300,showEasing:"swing",onShown:void 0,hideMethod:"fadeOut",hideDuration:1e3,hideEasing:"swing",onHidden:void 0,closeMethod:!1,closeDuration:!1,closeEasing:!1,closeOnHover:!0,extendedTimeOut:1e3,iconClasses:{error:"toast-error",info:"toast-info",success:"toast-success",warning:"toast-warning"},iconClass:"toast-info",positionClass:"toast-top-right",timeOut:5e3,titleClass:"toast-title",messageClass:"toast-message",escapeHtml:!1,target:"body",closeHtml:'<button type="button">&times;</button>',closeClass:"toast-close-button",newestOnTop:!0,preventDuplicates:!1,progressBar:!1,progressClass:"toast-progress",rtl:!1}}function ve(P){s&&s(P)}function Be(P){var U=u(),he=P.iconClass||U.iconClass;if(typeof P.optionsOverride<"u"&&(U=t.extend(U,P.optionsOverride),he=P.optionsOverride.iconClass||he),_e(U,P))return;f++,r=x(U,!0);var se=null,B=t("<div/>"),K=t("<div/>"),I=t("<div/>"),L=t("<div/>"),R=t(U.closeHtml),V={intervalId:null,hideEta:null,maxHideTime:null},G={toastId:f,state:"visible",startTime:new Date,options:U,map:P};return v(),te(),Z(),ve(G),U.debug&&console&&console.log(G),B;function C(ge){return ge==null&&(ge=""),ge.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function v(){Y(),ne(),fe(),ce(),le(),Ae(),oe(),z()}function z(){var ge="";switch(P.iconClass){case"toast-success":case"toast-info":ge="polite";break;default:ge="assertive"}B.attr("aria-live",ge)}function Z(){U.closeOnHover&&B.hover(Ke,ke),!U.onclick&&U.tapToDismiss&&B.click(Pe),U.closeButton&&R&&R.click(function(ge){ge.stopPropagation?ge.stopPropagation():ge.cancelBubble!==void 0&&ge.cancelBubble!==!0&&(ge.cancelBubble=!0),U.onCloseClick&&U.onCloseClick(ge),Pe(!0)}),U.onclick&&B.click(function(ge){U.onclick(ge),Pe()})}function te(){B.hide(),B[U.showMethod]({duration:U.showDuration,easing:U.showEasing,complete:U.onShown}),U.timeOut>0&&(se=setTimeout(Pe,U.timeOut),V.maxHideTime=parseFloat(U.timeOut),V.hideEta=new Date().getTime()+V.maxHideTime,U.progressBar&&(V.intervalId=setInterval($e,10)))}function Y(){P.iconClass&&B.addClass(U.toastClass).addClass(he)}function oe(){U.newestOnTop?r.prepend(B):r.append(B)}function ne(){if(P.title){var ge=P.title;U.escapeHtml&&(ge=C(P.title)),K.append(ge).addClass(U.titleClass),B.append(K)}}function fe(){if(P.message){var ge=P.message;U.escapeHtml&&(ge=C(P.message)),I.append(ge).addClass(U.messageClass),B.append(I)}}function ce(){U.closeButton&&(R.addClass(U.closeClass).attr("role","button"),B.prepend(R))}function le(){U.progressBar&&(L.addClass(U.progressClass),B.prepend(L))}function Ae(){U.rtl&&B.addClass("rtl")}function _e(ge,He){if(ge.preventDuplicates){if(He.message===y)return!0;y=He.message}return!1}function Pe(ge){var He=ge&&U.closeMethod!==!1?U.closeMethod:U.hideMethod,dt=ge&&U.closeDuration!==!1?U.closeDuration:U.hideDuration,Je=ge&&U.closeEasing!==!1?U.closeEasing:U.hideEasing;if(!(t(":focus",B).length&&!ge))return clearTimeout(V.intervalId),B[He]({duration:dt,easing:Je,complete:function(){J(B),clearTimeout(se),U.onHidden&&G.state!=="hidden"&&U.onHidden(),G.state="hidden",G.endTime=new Date,ve(G)}})}function ke(){(U.timeOut>0||U.extendedTimeOut>0)&&(se=setTimeout(Pe,U.extendedTimeOut),V.maxHideTime=parseFloat(U.extendedTimeOut),V.hideEta=new Date().getTime()+V.maxHideTime)}function Ke(){clearTimeout(se),V.hideEta=0,B.stop(!0,!0)[U.showMethod]({duration:U.showDuration,easing:U.showEasing})}function $e(){var ge=(V.hideEta-new Date().getTime())/V.maxHideTime*100;L.width(ge+"%")}}function u(){return t.extend({},pe(),p.options)}function J(P){r||(r=x()),!P.is(":visible")&&(P.remove(),P=null,r.children().length===0&&(r.remove(),y=void 0))}})()})})(function(e,t){i.exports?i.exports=t(hf()):window.toastr=t(window.jQuery)})})(Ti)),Ti.exports}var pf=df();const st=ff(pf);function gf(i){if(!navigator.clipboard){yf(i);return}navigator.clipboard.writeText(i).then(function(){st.success("Copied!")},function(e){console.error("Async: Could not copy text: ",e)})}function yf(i){var e=document.createElement("textarea");e.value=i,e.style.top="0",e.style.left="0",e.style.position="fixed",document.body.appendChild(e),e.focus(),e.select();try{var t=document.execCommand("copy");t&&st.success("Copied!")}catch(r){st.error("Copy failed"),console.error("Fallback: Oops, unable to copy",r)}document.body.removeChild(e)}function mf(){var i=250,e=Date.now()+i;(function t(){Ci({particleCount:7,angle:60,spread:55,origin:{x:0}}),Ci({particleCount:7,angle:120,spread:55,origin:{x:1}}),Date.now()<e&&requestAnimationFrame(t)})(),Ci.reset()}const Un=i=>new Promise(e=>setTimeout(e,i));function Ps(i,e="Unknown error"){return i instanceof Error?i.message:typeof i=="string"?i:i&&typeof i=="object"&&"message"in i?String(i.message):e}st.options={positionClass:"toast-bottom-center"};const It=new AbortController;window.addEventListener("pagehide",()=>It.abort(),{once:!0}),window.addEventListener("beforeunload",()=>It.abort(),{once:!0});const Si=new Map;function Os(i,e="sat"){const t=`${String(i).replace(/\/+$/,"")}|${e}`,r=Si.get(t);if(r)return r;const s=(async()=>{const f=new ki(i,{unit:e});return await f.loadMint(),f})();return s.catch(()=>Si.delete(t)),Si.set(t,s),s}function wf(i){const e=Number(i.data("order-id")),t=String(i.data("order-key")??""),r=String(i.data("return-url")??""),s=Number(i.data("pay-amount-sats")??0),f=String(i.data("melt-quote-id")??""),d=Number(i.data("spot-quote-expiry")??0),p=String(i.data("trusted-mint")??"");if(!Number.isFinite(e)||e<=0||!t||!r||!p||!Number.isFinite(s)||s<=0||!f)throw new Error("Bad order data");return{orderId:e,orderKey:t,returnUrl:r,expectedPaySats:s,quoteId:f,quoteExpiry:d,trustedMint:p}}function Ai(i){const e=Math.floor(Date.now()/1e3);return typeof i=="number"&&i>e?Math.max(1e4,(i-e+30)*1e3):900*1e3}function qs(i,e){try{const t=new URL(i),r=new URL(e),s=t.origin+t.pathname.replace(/\/+$/,""),f=r.origin+r.pathname.replace(/\/+$/,"");return s===f}catch{return i.replace(/\/+$/,"")===e.replace(/\/+$/,"")}}function _i(i){try{const e=localStorage.getItem(i);return e?JSON.parse(e):null}catch{return null}}function Ns(i,e){try{localStorage.setItem(i,JSON.stringify(e))}catch{}}function bf(i){try{localStorage.removeItem(i)}catch{}}jQuery(function(i){const e=i("#cashu-pay-root");if(!e.length)return;const t=e.next("section.cashu-checkout");if(!t.length)return;const r=t.find("form.cashu-token"),s=t.find("[data-cashu-token-input]"),f=r.find('button[type="submit"]'),d=t.find(".cashu-status"),p=t.find("[data-cashu-qr]"),y=I=>d.text(I),w=I=>{f.prop("disabled",I),s.prop("disabled",I)};w(!1),r.off("submit").on("submit",I=>{I.preventDefault();const L=W();if(!L){y("Paste a Cashu token first.");return}ee(()=>Be(L),{user:!0})});let x;try{x=wf(e)}catch{d.text("Payment data incomplete, please refresh and try again.");return}let A=null,E=Promise.resolve(),T=null,M=0;const N=Os(x.trustedMint,"sat"),W=()=>String(s.val()??"").trim(),$={mq:"cashu_wc_mq",change:"cashu_wc_change",recovery:"cashu_wc_recovery"};we().catch(()=>{y("Could not prepare the invoice, please refresh and try again.")}),P(),he(),ee(()=>B());async function we(){const I=await u(),L=p.get(0);!L||typeof QRCode>"u"||(L.innerHTML="",new QRCode(L,{text:"lightning:"+I.request,width:360,height:360,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.Q}),p.off("click").on("click",()=>gf(I.request)))}async function ee(I,L={}){const R=!!L.user;if(R&&M>0)return st.error("Payment already in progress"),Promise.resolve(void 0);R&&(M++,M===1&&w(!0));const V=E.then(I).catch(G=>{const C=Ps(G);y(C),R&&st.error(C)});E=V.then(()=>{});try{return await V}finally{R&&(M--,M===0&&w(!1))}}function pe(I){const L=I.map(G=>String(G).trim()).filter(Boolean);if(L.length===0)return;const R=_i($.change)??[],V=Array.from(new Set([...R,...L])).slice(-10);Ns($.change,V)}function ve(I,L){const R=Array.isArray(I?.change)?I.change:[];return R.length===0?"":ws({mint:L,proofs:R,unit:"sat"})}async function Be(I){y("Checking token...");let L;try{L=Fc(I)}catch(le){st.error(Ps(le)),y("That token does not look valid.");return}const R=String(L.mint??"").trim(),V=String(L.unit??"sat");if(!R||L.amount===0){y("Token has no spendable proofs.");return}if(V!=="sat"){y("This checkout expects sat denominated tokens.");return}y("Connecting to mint...");const G=await Os(R,"sat");let v=G.decodeToken(I).proofs;if(!Array.isArray(v)||v.length===0){y("Token has no usable proofs.");return}if(qs(R,x.trustedMint)){const le=await N;await se(v,le);return}const z=await u(),Z=Gt(v),te=G.getFeesForProofs(v);y("Calculating your mintâ€™s fees...");const Y=await G.createMeltQuoteBolt11(z.request),oe=Y.amount+Y.fee_reserve+te,ne=Y.fee_reserve+te;if(Z<oe){y(`Token amount (${Z}) is too small. Please paste a token of at least ${oe} sats to cover your mintâ€™s fees (${ne}).`);return}y("Sending payment...");const fe=await G.meltProofsBolt11(Y,v),ce=ve(fe,G.mint.mintUrl);ce&&(pe([ce]),ee(()=>B([ce]))),y("Waiting for payment confirmation...")}async function u(){return A||(A=(async()=>{const I=_i($.mq);if(J(I))return I;const R=await(await N).createMintQuoteBolt11(x.expectedPaySats);st.info("created mint quote");const V={mint:x.trustedMint,amount:x.expectedPaySats,quote:R.quote,request:R.request,expiry:R.expiry??null};return Ns($.mq,V),V})(),A.catch(()=>{A=null}),A)}function J(I){if(!I||!I.quote||!I.request||!I.mint||I.amount!==x.expectedPaySats||!qs(I.mint,x.trustedMint))return!1;const L=typeof I.expiry=="number"?I.expiry:0,R=Math.floor(Date.now()/1e3);return!(L>0&&L<=R)}async function P(){const I=await u(),L=await N,R=Date.now()+Ai(I.expiry),V=async()=>{const C=Math.max(1e4,R-Date.now());await L.on.onceMintPaid(I.quote,{signal:It.signal,timeoutMs:C})},G=async()=>{for(;!It.signal.aborted&&Date.now()<R;){if((await L.checkMintQuoteBolt11(I.quote)).state==="PAID")return;await Un(3e3)}throw new Error("Mint quote timed out or was aborted.")};try{await V()}catch(C){if(It.signal.aborted)throw C;await G()}ee(()=>U(I))}async function U(I){if(T)return T;T=(async()=>{y("Payment detected, finalising...");const L=await N,R=await L.mintProofsBolt11(x.expectedPaySats,I.quote);bf($.mq),A=null,await se(R,L)})();try{await T}catch(L){throw T=null,L}}async function he(){const I=await N,L=Date.now()+Ai(mq.expiry),R=async()=>{const G=Math.max(1e4,L-Date.now());await I.on.onceMintPaid(mq.quote,{signal:It.signal,timeoutMs:G})},V=async()=>{for(;!It.signal.aborted&&Date.now()<L;){if((await I.checkMintQuoteBolt11(mq.quote)).state==="PAID")return;await Un(3e3)}throw new Error("Mint quote timed out or was aborted.")};try{await R()}catch(G){if(It.signal.aborted)throw G;await V()}ee(()=>U(mq))}async function se(I,L){try{const v=ws({mint:x.trustedMint,proofs:I,unit:"sat"});localStorage.setItem($.recovery,v)}catch{}y("Paying invoice...");const R=L,V=await R.checkMeltQuoteBolt11(x.quoteId),G=await R.meltProofsBolt11(V,I);st.info("Melted proofs to pay invoice.");try{localStorage.removeItem($.recovery)}catch{}const C=ve(G,R.mint.mintUrl);C&&(pe([C]),st.info("Confirming melt + saving change!"),ee(()=>B([C]))),y("Confirming payment..."),ee(()=>K(12,1200))}async function B(I=[]){const L=String(window.cashu_wc?.rest_root??""),R=String(window.cashu_wc?.confirm_route??"");if(!L||!R)return null;const V=L.replace(/\/?$/,"/")+R.replace(/^\//,""),G=_i($.change)??[],C=Array.from(new Set([...G,...I.map(String)])).filter(Boolean),v={order_id:x.orderId,order_key:x.orderKey,quote_id:x.quoteId};C.length>0&&(v.change_tokens=C);try{const Z=await(await fetch(V,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"same-origin",body:JSON.stringify(v)})).json();return Z?.state==="PAID"&&(mf(),await Un(2e3),window.location.assign(String(Z.redirect??x.returnUrl))),Z?.state==="EXPIRED"&&(y("This payment quote has expired."),st.error("This payment quote has expired."),await Un(2e3),window.location.assign(String(x.returnUrl))),Z??null}catch{return null}}async function K(I,L){for(let R=0;R<I;R++){await Un(L),st.info("Confirming melt - poll #"+R);const V=await B();if(V?.state==="PAID"||V?.state==="EXPIRED")return}}})})();
